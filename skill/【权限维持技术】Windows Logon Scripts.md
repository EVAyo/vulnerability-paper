<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/GS2hreJ8JSQMe_hogR-vhA)

  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/Op7Y2S0HyKx4Sibx9mxsrz68yfgLOMCxU05FFBGZtaHqGlp9uPhdwKhs0vLnxgibBpLrwfGhQVWpIHdjxlfhDyLg/640?wx_fmt=png)

免责声明

![](https://mmbiz.qpic.cn/mmbiz_png/yRDp2K3ZBpKOicaBvhSTPZYqTVq8ku50NMtfAqkWhJw2cyMfYEhzIZHlVGLH0Wl2tQ8usSOv6xbZxBiabe1XiaLhA/640?wx_fmt=png)

  

本文仅用于技术讨论与学习，利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，文章作者及本公众号不为此承担任何责任。

  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/Op7Y2S0HyKx4Sibx9mxsrz68yfgLOMCxU05FFBGZtaHqGlp9uPhdwKhs0vLnxgibBpLrwfGhQVWpIHdjxlfhDyLg/640?wx_fmt=png)

Logon Script

![](https://mmbiz.qpic.cn/mmbiz_png/yRDp2K3ZBpKOicaBvhSTPZYqTVq8ku50NMtfAqkWhJw2cyMfYEhzIZHlVGLH0Wl2tQ8usSOv6xbZxBiabe1XiaLhA/640?wx_fmt=png)

  

Windows Logon Scripts 是 Windows 为了方便管理员管理而设计的，允许管理员为用户登录定义脚本。这些脚本可以执行多种任务，如映射网络驱动器，连接打印机，或启动应用程序等。管理员可以通过 Active Directory 的用户属性设置 Logon 脚本。当用户登录时，就会自动执行 Logon Script。

以下是一些典型的用途：

1.  映射网络驱动器：登陆脚本可以用来在用户登录时自动连接到网络上的某个特定驱动器。
    
2.  安装更新：当有新的软件更新发布时，登陆脚本可以自动执行更新的安装。
    
3.  执行系统设置：例如，更改系统设置，应用一些特定的安全策略，或者修改注册表。
    
4.  启动应用程序：在用户登录 Windows 后自动启动某些应用程序或服务。
    
5.  数据备份：可以定期备份用户的个人数据或系统数据。
    

  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/Op7Y2S0HyKx4Sibx9mxsrz68yfgLOMCxU05FFBGZtaHqGlp9uPhdwKhs0vLnxgibBpLrwfGhQVWpIHdjxlfhDyLg/640?wx_fmt=png)

复现

![](https://mmbiz.qpic.cn/mmbiz_png/yRDp2K3ZBpKOicaBvhSTPZYqTVq8ku50NMtfAqkWhJw2cyMfYEhzIZHlVGLH0Wl2tQ8usSOv6xbZxBiabe1XiaLhA/640?wx_fmt=png)

  

1. 打开注册表，找到 Logon Script 键值：  

```
EY_CURRENT_USER\Environment\

```

2. 创建字符串键值：UserInitMprLogonScript，键值设置为 bat 的绝对路径：C:\Users\fatmo\Desktop\calc.exe

```
@echo off
start calc.exe

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/FVvAFkxoh9D1oB8u0licKw6VubMw5w7nZ4icrJXC3VLiabRDRBAXLvE7OodN6nIvx02iayC2icht5SEkctsMZxuf3Ew/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/FVvAFkxoh9D1oB8u0licKw6VubMw5w7nZ2CkUoJuQNPvRDqdKiajz2VyyIp9XnAk80pTiarOStEpZQSiczp1jDZ75g/640?wx_fmt=png)

3. 设置完毕后，当用户登录时，就会自动执行 Logon Script，本文以弹出计算器为例。  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/FVvAFkxoh9D1oB8u0licKw6VubMw5w7nZa7iaJbZyCIZUU786Wib2smCAtvHuaQD73Q5Ialwdrmkkn1ibs01iclTTcw/640?wx_fmt=png)

  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/Op7Y2S0HyKx4Sibx9mxsrz68yfgLOMCxU05FFBGZtaHqGlp9uPhdwKhs0vLnxgibBpLrwfGhQVWpIHdjxlfhDyLg/640?wx_fmt=png)

防范

![](https://mmbiz.qpic.cn/mmbiz_png/yRDp2K3ZBpKOicaBvhSTPZYqTVq8ku50NMtfAqkWhJw2cyMfYEhzIZHlVGLH0Wl2tQ8usSOv6xbZxBiabe1XiaLhA/640?wx_fmt=png)

  

1.  监控注册表读写，可以直接禁止注册表关键路径的写入  
    
2.  监控用户登录时的系统动作，比如对外连接和文件写入