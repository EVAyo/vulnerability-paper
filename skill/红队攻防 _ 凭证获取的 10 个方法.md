<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/8z3kaRibQbdhJhy4QLWWfQ)

扫码领资料

获网安教程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/CBJYPapLzSFbaUgVwdsriauB77CgQS8lyBNAxtx9IMqJQdhuuoITunu8A5Gp7kFjF7BvEXSaLMuDTYhnu7Nicghg/640?wx_fmt=other&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1&tp=webp)

![](https://mmbiz.qpic.cn/mmbiz_png/b96CibCt70iaaJcib7FH02wTKvoHALAMw4fchVnBLMw4kTQ7B9oUy0RGfiacu34QEZgDpfia0sVmWrHcDZCV1Na5wDQ/640?wx_fmt=other&wxfrom=5&wx_lazy=1&wx_co=1&tp=webp)

  

**来** **Track 安全社区投稿~** 

**千元稿费！还有保底奖励~（https://bbs.zkaq.cn）**

作为红队成员，就像许多其他 APT 一样，我们须找到通往目标网络和资产的方法，因此要付出大量努力，从我们可以获得的任何资源中获取登录凭证或令牌。

这并不意味着我们只寻找登录特定服务的用户名和密码，在许多情况下，我们还需要寻找令牌，API 密钥，甚至有效 Cookie。特别是在采用最佳安全实践并在许多不同服务中使用 2FA/MFA 的目标中。

有很多方法可以找到凭证或令牌，在这里**，我将展示我发现的 10 种在我的工作中非常有用的方法，而且不需要进行 sg。**

![](https://mmbiz.qpic.cn/sz_mmbiz_png/CBJYPapLzSHcEMylZpXMvU0AbVYXUgP66V8OujibRvNTsr3LPKzb2pWGQjcNzNic2QbHhsaxGeRX38XJ2tfw5IsA/640?wx_fmt=png&from=appmsg)

我们要找什么样的凭证？
===========

我们之前提到的有不同的类型和不同的用例。

第一种当是**用户名和密码**。找到用户名总是好的，如果他们持有高权限，这可能会节省我们横向移动和权限提升工作。虽然有很多情况下，一对好的用户名和密码可能能够直接让我们拿下目标，但有两点我们必须考虑：

*   我们不可能每次都可以找到好用的用户名和密码
    
*   即使我们找到了，我们还可能需要面对 2FA 验证
    

因此，我们需要将目光转移到其他凭据类型。

**Cookies** 我们都知道。但是这是我们比较难得到的，但一旦我们得到了，**它比密码更强大，cookie 可以绕过 99% 的 2FA**。稍后，我们将讨论从目标收集 cookie 的方法。

我们要讨论的最后一种凭证是**令牌和 API 密钥。**这种凭证也是**绕过 2FA 的一种很好的方式**，因为它通常是在身份验证过程之后发布的令牌，或者可能是应该用于自动服务的令牌 / 密钥。令牌和密钥有很多种，不同类型的令牌（与 Cookie 不同）的用法可能不同。看看这个 keyhacks 的 repo，了解更多关于常见类型的服务令牌使用的信息。

让我们深入了解一些练习方法，以便在我们的参与中收获尽可能多的凭据。

方法 #1：源代码获取
===========

一般闭源商用源代码是不能从网上直接下载的，因此这个方法不推荐，如果涉及商用代码信息窃取是违法的。

方法 #2：网上泄露的数据
=============

有一些资源包含从不同漏洞泄露的大量用户名和密码集合。例如，几年前发生的 LinkedIn 违规事件。但人与人一样，通常不会更改密码，除非他们被迫更改，即使如此，很多时候也会从 “coolcat2023” 更改为“coolcat2024”。

下面是我在信息收集时通常使用的工具：

*   breachdirectory.com
    
*   dehashed.com
    
*   leak-lookup.com
    

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/CBJYPapLzSHcEMylZpXMvU0AbVYXUgP6VEUw5vjX3pqKrDElWT8Tqz6Myyg6IExR306hKlQ4lichWsEOJCrxbiaA/640?wx_fmt=jpeg&from=appmsg)

BreachDirectory 搜索结果

在某些情况下，结果可能不是明文密码，而是散列密码的集合。在这种情况下需要对其进行破解，我们可以使用 hashcat 结合我们的字典 t（就像一个简单的 rockyou 列表），或者我们可以使用一个在线破解工具，它已经包含了一些巨大的列表：

*   cloudcracker.net
    
*   hash-cracker.com
    
*   crackstation.net
    
*   onlinehashcrack.com
    
*   等等
    

方法 #3：GitHub Dorking
====================

尽管大多数人对 github 很熟悉，但仍然有很多红队和 bug 猎人会忽略这个点。让我们来谈谈这种方法的优点和缺点。

优点：

*   公开可用，我们可以使用一些智能关键字，使我们更快搜索凭据
    
*   存储库可能包含各种凭证：密码、令牌和 API 密钥！
    
*   在程序代码中找到 c 凭证可以节省我们的时间，因为其中往往会包含凭证的用法
    

缺点：

*   在大多数情况下，公司不会向公众公开他们的敏感存储库，通常是错误的
    
*   有时这种 github 的 Dorking 可能需要很多时间，
    

值得一提的是，即使仓库本身没有凭证，它有时可以帮助我们更好地理解如何使用我们从其他地方找到的凭证。

这种方法可能有点耗时，但有一些工具可以自动化这个过程。我最喜欢的工具之一是 Trufflehog：https://github.com/trufflesecurity/trufflehog，它可以以 docker 方式安装运行。

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/CBJYPapLzSHcEMylZpXMvU0AbVYXUgP6OJTPWhw1JqB0DAe8Y5tFazbxAtnvvBmicxYBQM53ZG4eUmh7uJcWrIw/640?wx_fmt=jpeg&from=appmsg)

Trufflehog 示例的输出

此外，获取更多种类的 dorking 工具和 github 关键字，可以看到 HackTricks：https://book.hacktricks.xyz/generic-methodologies-and-resources/external-recon-methodology/github-leaked-secrets。

方法 #4：WaybackMachine
====================

有时候，为了从目标那里获得一些有效的凭证，我们可以查看目标网站的历史页面。WaybackMachine：https://archive.org/ 是挖掘我们目标存档的最佳资源。WaybackMachine 不仅可以从不同时间恢复网页，还可以从 GET 请求中收集 URL。

很多时候，当我有一个黑盒目标，没有任何办法注册自己的用户，我去 WaybackMachine 搜索我的目标的一些相关域和子域。之后，我打开结果页面中的 URL 选项卡，并按日期（最新到最新）排序。在右上角我们有一个搜索框，**我们可以用它来查找具有特定关键字的 URL，如 user，email，uuid，password，key，secret，token 等**。

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/CBJYPapLzSHcEMylZpXMvU0AbVYXUgP6ib6hvl4hSWAMciaOemduSoe2oiauKQ4Ju2H9orUXPjEXO91fgEPosONmQ/640?wx_fmt=jpeg&from=appmsg)

从 WaybackMachine 捕获有效的 JWT

我之前在漏洞挖掘中通过这个网站直接挖掘到了目标的 IDOR 漏洞。

方法 #5：postman 收集
================

Postman 是一个测试、构建和调试 API 的平台，这是开发人员构建 API 的最常用工具之一。

Postman 可以用于制作 HTTP 请求：参数，主体数据，头部，令牌等等。这个工具在开发人员中非常受欢迎，因为他们可以专注于构建后端并轻松测试它，而不需要前端在中间传递数据。

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/CBJYPapLzSHcEMylZpXMvU0AbVYXUgP6X3pHdpawYCaYLGfl7BETyZk23T9zuq2kzh6KIHCvIc5DHCyavBpibIQ/640?wx_fmt=jpeg&from=appmsg)

Postman 界面（来自 Postman.com）

那么，为什么这个工具对黑客也很重要呢？

现在，为了使用 Postman，开发人员需要在 Postman.com 中创建一个帐户。就像在 GitHub 中一样，在创建帐户并开始处理项目后，**他们需要配置项目（“集合”）的类型：公共或私人**。

在很多情况下，**我在公共的项目集合中看到过敏感的凭证，主要是 API 密钥和令牌，但也有 cookie，并拥有管理员权限。**对于许多组织来说，这绝对是一个安全盲点，即使是大型和（几乎）安全的公司。

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/CBJYPapLzSHcEMylZpXMvU0AbVYXUgP6rDCswVC2RS3HvcaPiad93q0iaGI5rhjvUalcZJ9h8b9TNTOmManicsicdg/640?wx_fmt=jpeg&from=appmsg)

Postman 集合中的 Cookie、key、token 和 uid

只需访问 Postman.com 并搜索我们的目标集合，我们就可以找到有时比用户名和密码更有价值的有价值的数据。如果我们找到 JWT 或访问令牌，我们可以绕过 2FA！

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/CBJYPapLzSHcEMylZpXMvU0AbVYXUgP6kQDU2Jd89l3YLGKvdzA4TebqkB8vrfMGRgKI8zzavCI24UpKVpXnwQ/640?wx_fmt=jpeg&from=appmsg)

在 Postman 集合中找到授权 header

并且这些凭据通常由应用程序的开发人员使用，因此它通常拥有整个应用程序的管理员权限。

方法 #6：特殊文件路径
============

当我们进行信息收集（ffuf，gobuster，dirbuster 等）时，我们有时会在单词列表中遗漏一些重要的文件路径，这些路径是默认文件的凭据。我举一些具体的例子。

**VSCode SFTP 配置文件**。VSCode 允许开发人员通过安装 SFTP 扩展来远程编辑文件。如果开发人员安装了这个扩展，他 / 她可以在本地 VSCode 编写代码并会自动同步保存在远程节点如 - 生产服务器。但问题在哪里？有一个小的配置文件，很多时候可能会有遗留。**该文件包含 IP 地址、用户名和密码，用于将代码自动发送到远程服务器**。如果我们发现类似的东西，我们可能可以用 FTP 连接到服务器，有时这些是 SSH 的相同密码！

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/CBJYPapLzSHcEMylZpXMvU0AbVYXUgP6Wx3rZIFbkMd8z5zt470lYrzCZza5TWb8K5kVHHzPxvUV1GfDt0svNg/640?wx_fmt=jpeg&from=appmsg)

使用 VSCode SFTP 扩展的 FTP 凭据

**Config.json 文件。**这些文件对我们来说也是非常有价值的，它们拥有各种各样的信用：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/CBJYPapLzSHcEMylZpXMvU0AbVYXUgP65TVjUVx4ib5DvoXSw4Kibz8LxnKIVEmx8z7m9E1ia9GTgmAiakGgbTDicQA/640?wx_fmt=png&from=appmsg)

config.json 文件

**Git 文件**。这是我的最爱之一。fuzzing /.git 文件，如果你找到这个端点，使用 GitTools：https://github.com/internetwache/GitTools 这样的工具来转储和提取文件。一个网站的 git 文件夹在大多数情况下，代码包含对我们有用的硬编码密钥。为了自动化从转储的 git 目录中寻找秘密，我推荐使用 Trufflehog。

方法 #7：公开的 Docker 注册表
====================

就像公共 GitHub 存储库和公共 Postman 集合一样，我们可以找公开可用的 Docker 注册表。我见过许多公司开放自己的注册表来上传他们的 Docker 镜像并管理它（而不是向 DockerHub 付费）。但他们忘记了他们必须配置一个安全的密码来访问这个注册表。

结果是这些公司将他们的 Docker 镜像上传到这些注册中心，任何人都可以下载这些 Docker 镜像，其中包含公司的纯源代码。就像是找到了目标的代码库！

对此，请看到本公众号中的文章：《安全盲点：如何从 Docker Registry 到 RCE》，这里不会在这里深入讨论细节。

方法 #8：JavaScript 文件
===================

我们可以通过 JavaScript 了解很多关于网站的信息。JavaScript 包含前端逻辑的一部分，它告诉我们当 XHR/AJAX 请求被发送时会发生什么，API 路径等等。

除此之外，JavaScript 也可能包含一些凭证。在大多数情况下，它将是一些 API 密钥，Firebase 令牌和其他第三方密钥。但在其他情况下，甚至可能是 JWT 的服务和密码留在代码中。

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/CBJYPapLzSHcEMylZpXMvU0AbVYXUgP6usrkPxzqA9VmrupCye4gAP9ic6SnZSvoQjF1jb753r0HBHnlibib6IRAw/640?wx_fmt=jpeg&from=appmsg)

在目标的 JavaScript 文件中找到有效的 JWT

上面的图片来自我的一个项目，发现了一个拥有高级权限的 “测试” 用户的 JWT。这有助于进一步寻找后面的漏洞。

方法 #9：通过已拿下的目标横向
================

假设我们已经设法获得了对目标服务器的特权访问权限，并且我们希望横向移动以获得对其他资产的访问权限，我们可以考虑使用这些已经拿下的节点作为密码陷阱。

在大多数情况下，服务器的密码在公司的其他服务器之间共享。特别是当有像 Ansible 这样的自动化时，为了做自动化的事情，它必须使用 SSH 凭据连接到每个节点。如果有一个共享的密码，你可以击败整个网络，只需危及一台服务器。

如果我们在一个随机的 Ubuntu 服务器上有 root 用户，我们可以安装一个工具，如 3Snake，用于转储每个 SSH 密码或键盘记录 SUDO 命令。如果我们等到下一次人类 / 自动化登录到我们的拿下的服务器时，我们将获取密码，并能够将其密码喷洒到其他服务器。

方法 #10：注入恶意 JavaScript
======================

在这种情况下，我们可以通过登录表单或 cookie 更改或注入恶意 JavaScript 代码到网页。这可以通过两种主要方式来实现：

*   注入存储 XSS 键盘记录程序
    
*   存储加载到网页的静态文件（JS、CSS、图像）的 Bucket S3
    

关于第二种方式（使用 S3 桶），请看本公众号中的文章《红队攻防 | 从 S3 存储桶到企业内部专网》。

如果我们将目光放在加载到网站的 JavaScript 内容上，我们可以窃取使用该网站的所有用户的凭据！

总结
==

在几乎每一次攻防、红队和 bug 赏金中，凭据都能改变游戏规则。我们在信息收集和漏洞研究上投入了大量的精力和时间，通过找到一些有效的凭据可能会节省我们大量的时间，并推动整个操作向前发展。

我在这里提到的大多数方法都很简单，并且不会消耗很多时间。  
以上内容由白帽子左一翻译并整理。原文：https://medium.com/@red.whisperer/credential-stuffing-like-an-apt-mastering-credentials-harvesting-0018dc3c8134  

**声明：⽂中所涉及的技术、思路和⼯具仅供以安全为⽬的的学****习交流使⽤，任何⼈不得将其⽤于⾮法⽤途以及盈利等⽬的，否则后果⾃⾏承担。**所有渗透都需获取授权**！**  

**如果你是一个网络安全爱好者，欢迎加入我的知识星球：zk 安全知识星球, 我们一起进步一起学习。星球不定期会分享一些前言漏洞，每周安全面试经验、SRC 实战纪实等文章分享，微信识别二维码，只需 25，即可加入，如不满意，72 小时内可在 App 内无条件自助退款。  
**

![](https://mmbiz.qpic.cn/sz_mmbiz_png/CBJYPapLzSFIJlRFYoItlJDrScxuTPmfnqibC1ApJ2OKh5sF41qicCo5AvQ4icuG8kbqQxZ5HVypvJ8jZDzsmD37Q/640?wx_fmt=other&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1&tp=webp)![](https://mmbiz.qpic.cn/sz_mmbiz_png/CBJYPapLzSE3xxjQrLXjiaAWoqibdM1AFZ0uePzzUOG049bSjeEkbft1NfIm833fQ0ibIbW5IoE2ftnWoS3YxRPLg/640?wx_fmt=other&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1&tp=webp)