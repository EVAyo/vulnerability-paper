<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/1j7IEyLUevzSUvkfirhqzg)

大家好，我是 3had0w，今天给大家分享一个我最近在写的 CobaltStrike 后渗透插件 (PostExpKit)，目前暂时只完成了提权模块，其他模块功能还在编写和测试...。

**为什么写这个插件？**

因为之前用其他师傅的插件发现不是很全，很多常用 exp 都没有，用起来也不太习惯，有的插件部分代码也是 copy 的，可能都没测试过，根本没法使用，所以想根据自己的经验和习惯写一款适合自己用的提权插件。

写这个插件只是为了更高效的进行提权测试，但没有涉及免杀这部分内容，实战中还是得看遇到啥样的场景，然后再根据自己积累的实战经验去做测试......。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/XOPdGZ2MYOcGEgSOdyibuSaOxRvzgtUIgHvR9027YxthlFwzJHoJ5gUPQT925RGfxjmHavZ0icicI6Ed9P2Cg7soQ/640?wx_fmt=png&from=appmsg)

**插件特点及功能简介**

插件基于 OPSEC 原则去写，我们进行后渗透时应当尽量避免使用 fork&run 模式的命令，尽可能避免在 Beacon 下使用 cmd.exe、powershell.exe 等高危进程去执行命令和程序，这样能有效规避 AV/EDR 的检测和拦截...。

```
https://www.cobaltstrike.com/help-opsec
https://hausec.com/2021/07/26/cobalt-strike-and-tradecraft/

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/XOPdGZ2MYOcGEgSOdyibuSaOxRvzgtUIghIUKLsib1NegyduJMo3MaGPTXrUybbiaQYwdklQrnQFV28QibWEI9ZdKA/640?wx_fmt=png&from=appmsg)

**插件主要用到以下执行方式，建议按顺序选择：**  

```
BOF内存执行（inline-execute）
NET内存执行（InlineExecute-Assembly）
NET内存执行（execute-assembly）
DLL反射执行（bdllspawn）
EXE内存执行（BOFRunPortable）
EXE落地执行（sharpcmd、shell）
[...SNIP...]

```

**目前该插件的提权模块主要包含以下常用功能：**

```
1. 扫描指定用户可读写目录
2. 检查可利用漏洞/错误配置
3. 内存执行EXE/.NET文件
4. 10几种UAC绕过技术合集
5. 列出所有可模拟令牌/利用
6. 读取SAM注册表获取哈希值
7. 常用MS/CVE提权利用工具
8. 常用Potato提权利用工具
9. Potato提权可执行命令/上线
[...SNIP...]

```

![](https://mmbiz.qpic.cn/sz_mmbiz_gif/XOPdGZ2MYOcGEgSOdyibuSaOxRvzgtUIgEn9cGkfIZ7H8gUT4bGP8VbM6B8ycNkdEqGy2dwRdLFy4GrbqibopgRg/640?wx_fmt=gif&from=appmsg)

**提权模块部分功能演示**

这里以 EfsPotato 土豆为例演示，可以在不同场景下选择 command 执行命令或 shellcode 直接上线，纯半自动化傻瓜式操作，只需点几下就能 getsystem。

**command 执行命令：**

![](https://mmbiz.qpic.cn/sz_mmbiz_gif/XOPdGZ2MYOcGEgSOdyibuSaOxRvzgtUIgpTpnCKVNnh1IWB023oGuVfxUiaL7ibny4jK3aTeH50paL6Y4CXUOWHxA/640?wx_fmt=gif&from=appmsg)

**shellcode 直接上线：**

![](https://mmbiz.qpic.cn/sz_mmbiz_gif/XOPdGZ2MYOcGEgSOdyibuSaOxRvzgtUIghgwLelnuyOWMDac1SFWcGPaNNbQA6tzYH5saIHGz1UEA6dtdC1zjDw/640?wx_fmt=gif&from=appmsg)

这个插件目前只在潇湘信安知识星球公开，感兴趣的师傅可在下方领取优惠券加入。大家在使用插件的过程中有啥问题可以在知识星球或者 WX 找我反馈、交流。![](https://res.wx.qq.com/t/wx_fed/we-emoji/res/v1.3.10/assets/newemoji/smiley_83b.png)

**加入潇湘信安知识星球**

知识星球仅前 1-400 名: 99¥，400-600 名: 128¥，600-800 名: 148¥，800-1000 + 名: 168¥。

限时优惠：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/XOPdGZ2MYOcKGNyJ8jSPNpMahribWIY2cut8eAiakTpr6lAzlLt1xubcuUg4la0LMHmhnENia4icnjOwTsfDqq4I7A/640?wx_fmt=other&from=appmsg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)