<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/thMx_85LC4KGTbaCal09JA)

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450ATcz6jUJnFNeOxRzVZ9Lbc0INLwTJTZT1GaNutZrfDn6csvjBoS2ox0efLUEexXqPEcVbYfbLo8w/640?wx_fmt=png)

 **Part1 前言** 
--------------

**在正式文章之前，插播一下：恭喜梅西圆梦，获得世界杯冠军，加冕球王，一场精彩绝伦的球赛**。开心之后，还是要静下心学习的，我们也要继续努力。

Fortify 全名叫 Fortify SCA，是惠普公司 HP 的出品的一款源代码安全测试工具，这家公司也出品过另一款很厉害的 Web 漏洞扫描器叫 Webinspect。美国的 Fortify、美国的 Coverity、美国的 Codesecure、美国的 IBM AppScan Source 以色列的 Checkmarx、加拿大的 Klockwork 是现在国际上比较出名的几款代码审计工具，今天就讲一下 fortify 的使用吧，其它工具的使用后续再介绍。

**Fortify 对于新手是可以快速上手的，但是它绝不是一款傻瓜工具，它有很多的自定义操作，还有命令行操作，还可以自己编写规则库**，这些都需要大家仔细阅读 Fortify 的说明书，再次强调一遍，仔细阅读说明书，后续 ABC_123 会抽时间慢慢讲。

**求助：哪位朋友有 Codesecure、IBM Security AppScan Source 的破解版或者是试用版，方便的话发我试用一下，保证不用于商业目的，Thanks♪(･ω･)ﾉ**

 **Part2 具体使用过程** 
------------------

*   **Fortify 的安装过程**
    

安装过程比较简单，我就挑关键步骤讲解了。下载安装包之后，一直点击 “下一步” 就行，这里需要选择一个 license 文件 foritfy.license。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2VtjlEpacjdKEw7ARaGxRFNtSTHciciboFbMPEwBV4furU6yNBVFJbgKrw/640?wx_fmt=png)

接下来按照默认，一直点击 “下一步” 即可。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2VtA2L0FDtV0tWXFbOWqAn20ib2CsbcQguZ5icFsuN0ZF0YrYxicgA5ujTQ/640?wx_fmt=png)

软件打开如下所示：  

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2VfSGXfGNcphYG5yMqWO6GXNCHnEbFYcEPjjQTibKWaGz2wyJcxJUFaZw/640?wx_fmt=png)

*   **升级中文规则库  
    **
    

接下来重点看一下如何升级中文规则库。打开 **Audit Workbench** 快捷方式，在弹出的 gui 界面，点击 **Options** 选项，点开 **Security Content Management** 选项，点击 **Update Security Content - zh_CN** 选项可以升级 Fortify 的中文规则库。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2VxnQ7zSmbFc5Jnj7wTRtEPFffSl7VDYibXPDaibHaw6HyiaJkPPAhyhzQw/640?wx_fmt=png)

出现以下弹窗，说明中文规则库升级成功。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2VoQpbJYf4PbVNS2F1HRqmFLKGpYllCJt63eM9dhTNQsCL9jktDBnaHg/640?wx_fmt=png)

如果受 license 限制，无法升级到最新的规则库，那么可以跟有商业版的朋友要一个最新版的中文规则库，手工对 **ExternalMetadata** 及 **rules** 两个文件夹的文件进行替换。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2VFmXqfycDiak497ia4tvFUibOZBksnLqbLoicmpN88psqCpoO1u4Tu2wP9Q/640?wx_fmt=png)

在 **C:\Program Files\Fortify\Fortify_SCA_and_Apps_20.1.1\Core\config** 目录下，将以下文件进行替换。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2VkNt39DcQ6J8MtCqEicb4rk1vmT6ag3lt7kD3QD5ppZ7ibqicOCeVfKaYA/640?wx_fmt=png)

再看一下 **Security Content Management** 配置，发现规则库已经不是 2019 年的，已经是 2022 年的。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2ViboCDNtC7juFicK9YQW5S6vpbRZ5x1DvZKuzQqdnVDoibbavs8p674enQ/640?wx_fmt=png)

*   **审计 Java 代码过程**
    ----------------
    

如果是 java 项目，可以直接点击 “**Scan Java Project**” 选项。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2VOR3Wa5ibTU929DSoYGLx0b0tseUWNQIZLAbsPeSeR9HD3kv8LYO1Vbg/640?wx_fmt=png)

这里 java version，可以选择 web 应用的 java 代码的所在环境的 java 版本，这里我们选择 1.8。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2VG81m9ib5vib1hkaI9RvIibNUQoupxbKltwYF7LibAfvwtLsib7ssNTRWOMg/640?wx_fmt=png)

如果扫描对象是 Java web 代码，就选择 “Yes”，如果不是 Java web，就选择 No，其它的选项保持默认即可。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2VaqnNdyHqCmg3xRhw53libI3icTmwfDYE562VrMprxygGmYNAIUlG7DLw/640?wx_fmt=png)

接下来点击 “**Scan**”，Fortify 就开始对代码进行代码审计了。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2Vz1XcNQiaZ3mw22WJ6fcs7AfDTW3K09REE5sje6HKC87gSQrBeMVGYDA/640?wx_fmt=png)

这时候发现，对于 webgoat 源代码 Fortify 只扫描出了 36 个高危漏洞，为啥最基本的 sql 注入漏洞没扫描出来呢？重新理一下思路，Fortify 扫描源代码漏洞前，是需要对源码编译的，**没有 jar 包有些类肯定是编译不成功的**。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2VKxwSibxW4NGh2Na4BFefhbz4c5ecESHVSJCqAftLRCwJAlwf63sQ3EA/640?wx_fmt=png)

*   **加载 jar 包重新扫描**
    

接下来打开 pom.xml 查看 web 应用需要依赖哪些 jar 包，将所有需要 jar 包放到 webgoat 目录下即可，Fortify 会自动识别和加载. jar 文件。如果 web 应用所依赖的 jar 包太多，手工找起来太麻烦，可以直接解压编译后的. war 文件或者 springboot 的. jar 文件获取所有 jar 包文件。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2VBicGltmUkJPpDfL3nW3d82vMZflyGY3txxibzElIuWLFj1t1kAuTH3eQ/640?wx_fmt=png)

重新运行 fortify 扫描一下，加载 jar 包后扫描出了 81 个高危漏洞，这样的扫描结果看起来还算是正常。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2VxnRC1EbrLZtAPpDtq8x4S38P4Fj43u1Emy4U1K5WtBjYCm8WbwDrtw/640?wx_fmt=png)

Fortify 扫描结果展示界面如下：  

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2VEMufgx5T3TMTLGe4YicJ1RZcjU06YvrXAUxYsiaRBbRWOW6LUWAEUQEw/640?wx_fmt=png)

*   **代码审计结果  
    **
    

Fortify 的 **Diagram** 功能非常强大，以图表形式展示源代码中漏洞触发点的从开始到触发的所有过程，我们可以借助此功能，分析是否有过滤函数对漏洞触发的特殊字符进行了过滤。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2VaV0KsowDIRCT6JQSmDOyPlic0N1Kcr40mwgU5Kvd2a3ZfTNj91mFwvg/640?wx_fmt=png)

这个界面给出了中文的漏洞修补建议。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2VcqtOBiaHIDuJVN5HV0AkEdl0g9uzVnnicPKUumbNTHMGSQQXY7GDhmUw/640?wx_fmt=png)

点击 “**Group By**” 按钮，可以以不同漏洞分类标准对漏洞进行不同的分类展示。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2VFDGob1LAqolqJDJibnYqYsiaH1GgSkOQKt40XLBLH2o4bqmuOH9b9EAQ/640?wx_fmt=png)

如果遇到误报，可以选择 “**Hide in AWB**”，对该漏洞结果进行隐藏。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2Vaue2EXMEicApXic7LvialRk9cAg3vkIXjz7J81tSXuhH4OFoq5ureFzIg/640?wx_fmt=png)

最后是生成报告功能，这个功能我一般不用，只是作为参考，一般都是自己写代码审计报告。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2Vb1m20xeN3dNwlVUyfYUrCNA7GRVCvwKloVZKXUfK3hIJvMSwlYkXqw/640?wx_fmt=png)

*   **中文乱码解决  
    **
    -------------
    

Fortify 默认的编码不是 UTF-8，导致部分中文的 Java 代码会出现乱码问题。如果是单文件乱码，可以使用 **Edit** 选项卡下的 **Set Encoding** 进行设置，**鼠标光标在右侧代码框内点击一下，否则此项功能不能用**，但是这种方法只适用于单个文件的乱码解决。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2VjPOX0rk4wYjD6yTsafvVaZRb0DG5msyrsPHz8r0ByIftWC4yuI8IUQ/640?wx_fmt=png)

如下所示，可以选择不同的文本编码，中文可选择 UTF-8 编码：  

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2V5ARbtTG2UnxNzps6QgdXDrS2PffCQIzUJNLg75MliaFeVNLolTES0hQ/640?wx_fmt=png)

如下图所示，乱码问题成功解决。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2VxA7aBHtVK5Xic0L98vrGQ1Q8WjP3ict1wcnOVAwZK9Evx6yfD1QpPicVA/640?wx_fmt=png)

如果想一劳永逸解决乱码问题，只能在 Fortify 的配置文件中指定 Java 文件的编码了

**C:\Program Files\Fortify\Fortify_SCA_and_Apps_20.1.1\Core\private-bin\awb\productlaunch.cmd****，**在命令行最后添加 - Dfile.encoding=utf-8。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DteV9OsanHXe7ib5ia9Vicn2VibK10HqEyzldHY86aticsfwhaXB2ULicouHjgO64iceQxIBaQR5p6OmibwA/640?wx_fmt=png)

 **Part3 总结** 

**1.**  后续还会继续分享 Fortify 代码审计工具的使用教程，也会分享 Checkmarx、Coverity 等代码审计工具的使用教程，敬请期待。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450A5qqg2iaK6KIYYR8y6pF5Rh3JHDibOKOop204nXz618iawdRb8dABicMPtHb2PkJE8x6koJO5HyuwZJQ/640?wx_fmt=png)

专注于网络安全技术分享，包括红队攻防、蓝队分析、渗透测试、代码审计等

每周一篇，99% 原创，敬请关注

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450A5qqg2iaK6KIYYR8y6pF5Rhn137KeqqlDkuRyY4G61jATRzyOrCBts8ucxkLpMNsYutSOY7BkPziaw/640?wx_fmt=jpeg)