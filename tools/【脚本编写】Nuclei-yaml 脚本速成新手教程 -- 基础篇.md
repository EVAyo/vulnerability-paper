<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/9n13N28-c_zmaqae2-iAUw)

****本文由安云安全内部群 - 鲁鲁师傅投稿****

![](https://mmbiz.qpic.cn/mmbiz_gif/4yJaCArQwpACMJuBxI11jPgvHCxQZFQxPrt5iaQRibgGl0aIzFo4hDCYcFuyViag6zhuqNEjjeasfMEAy1rkaOahw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

  

****写在前面****

  

![](https://mmbiz.qpic.cn/mmbiz_gif/4yJaCArQwpACMJuBxI11jPgvHCxQZFQxPrt5iaQRibgGl0aIzFo4hDCYcFuyViag6zhuqNEjjeasfMEAy1rkaOahw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

  

    YAML 是一种数据序列化语言，用于人类直接编写和阅读，YAML 的特性使得它非常适合用于配置文件、数据交换等场景，因为它既易于人类阅读又易于机器解析。

    然而目前网上相关的脚本编写教程相对较少，语法用例也比较稀缺，自学起来比较费劲，所以才诞生了写一个基础教程的想法；我也是一点一点从模仿 ----> 实践积累起来的，目前还有很多用法没有用到，但是应付下常规的脚本编写还是足够了，至于一些复杂的 HTTP 请求，奉劝还是不要用 yaml 来写，能不能实现不说，绝对是给自己找麻烦！

 **PS：可能很多师傅听说 YAML 是从 Nuclei(一款基于 YAML 语法模板的开发的定制化快速漏洞扫描器) 开始的，很多时候我们都是使用别人写好的 nuclei 模板进行漏洞验证，自己也没有怎么尝试过 nuclei 脚本的编写。这篇教程，主要是给初学者以及还没学，但是对 yaml 快速编写批量扫描脚本感兴趣的小伙伴的一个速成教程，里面的原理以及相关的专业性介绍我就省略了，说的不对的，各位看管请不要挑刺儿，我只是想尽一点微薄之力，让其他初学小伙伴少走点弯路哈~**

![](https://mmbiz.qpic.cn/sz_mmbiz_png/yeJvia5dNx5ickP7mRo94TVlbfkvCIqCuCEOHxHguWKLHt8K0uEWcLusDsJvTR8ZoicMOJra6n2t0OYnMB2r7VzYg/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_gif/4yJaCArQwpACMJuBxI11jPgvHCxQZFQxPrt5iaQRibgGl0aIzFo4hDCYcFuyViag6zhuqNEjjeasfMEAy1rkaOahw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

  

**基本知识**

  

![](https://mmbiz.qpic.cn/mmbiz_gif/4yJaCArQwpACMJuBxI11jPgvHCxQZFQxPrt5iaQRibgGl0aIzFo4hDCYcFuyViag6zhuqNEjjeasfMEAy1rkaOahw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

  

 **任何语言，基本语法都是非常重要的，但是关于 yaml，您只需要掌握这几点要求即可：**

1.  **大小写敏感**：YAML 对大小写敏感，这意味着键名的大小写必须精确匹配。
    
2.  **使用缩进表示层级关系**：YAML 通过缩进来表示数据的层级结构。缩进时不允许使用 Tab 键，只允许使用空格键。**缩进的空格数目不重要，只要相同层级的元素左侧对齐即可**。
    
3.  **注释**：使用`#`符号表示注释，从`#`字符开始到行尾的内容都会被解析器忽略。
    
4.  **数据类型**：YAML 支持的数据类型包括对象（键值对的集合）、数组（一组按次序排列的值）、纯量（单个的、不可再分的值，如字符串、布尔值、整数、浮点数等）。
    
5.  **变量使用**：YAML 提供了锚点（&）和引用（*）的语法，用于复用数据，避免重复定义。
    
6.  **复合结构**：对象和数组可以结合使用，形成复合结构，如在一个 YAML 文件中定义多个对象或数组。
    

**上述 6 个常见的知识点，作为初学者，您实际碰到的情况，只需要特别注意第 1 和第 2 项，这两个是新手最容易犯错误的地方，其他的了解下就行了；**

![](https://mmbiz.qpic.cn/mmbiz_gif/4yJaCArQwpACMJuBxI11jPgvHCxQZFQxPrt5iaQRibgGl0aIzFo4hDCYcFuyViag6zhuqNEjjeasfMEAy1rkaOahw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

  

**模板语法**

  

![](https://mmbiz.qpic.cn/mmbiz_gif/4yJaCArQwpACMJuBxI11jPgvHCxQZFQxPrt5iaQRibgGl0aIzFo4hDCYcFuyViag6zhuqNEjjeasfMEAy1rkaOahw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

  

 **在编写一个 poc 模板时，必备的几个元素：**

**1.id：****id 不能有中文、特殊字符、-- 以及空格等内容，id 这个参数，您可以理解为是输出的标题，一个简单易懂的 ID，可以让您更快的判断出，该漏洞的大致情况：**

**正确写法：**seeyon-xxxx-rce  

**错误写法：**seeyon--xxxx-rce 或 用友 xxxx-rce

**在语法错误后，nuclei 执行时会提示 “Could not run nuclei: no templates provided for scan”，当看到该提示时，记得先排查下模板 id 是否存在特殊字符；**

**2.info：****信息块，名称 、 作者 、 严重性 、 描述 、参考和 标签 ，这些都属于信息块的范围，一般情况下，我们只需要写入名称、作者、严重性、描述、标签这几项即可；**

**3.name：****模板名称，这个建议跟 id 相同即可；**

**4.author：****作者名称，标识版权的一种方式，但是加不加也就那样，毕竟下载后随时可以更改，也保护不了啥。**

**5.severity：****严重性，这里不可以使用中文，一般用 critical、hight、Medium、info 来表示威胁等级；**

**6.description：****漏洞介绍，这里可以使用中文，也不限制特殊字符，一般是用来做漏洞介绍用的，可以方便使用者了解该漏洞的具体说明；**

**7.tags：****标签，是为了给漏洞加一个标签，方便进行统一扫描，例如：tags: seeyon(切记不要用中文哈)**

**用例格式**

```
id: jindie-EAS-myUploadFile-upload
info:
   name: jindie-EAS-myUploadFile-upload
   author: 思沃科技
   severity: critical
   description: 金蝶EAS myUploadFile任意文件上传
   tags: Kingdee

```

![](https://mmbiz.qpic.cn/mmbiz_gif/4yJaCArQwpACMJuBxI11jPgvHCxQZFQxPrt5iaQRibgGl0aIzFo4hDCYcFuyViag6zhuqNEjjeasfMEAy1rkaOahw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

  

**脚本格式示例**

  

![](https://mmbiz.qpic.cn/mmbiz_gif/4yJaCArQwpACMJuBxI11jPgvHCxQZFQxPrt5iaQRibgGl0aIzFo4hDCYcFuyViag6zhuqNEjjeasfMEAy1rkaOahw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

  

 **yaml** **方****法还有很多，这里以常见的 HTTP 方法为例**

**（一定要注意上下层的格式缩进问题）**

```
id: jindie-EAS-myUploadFile-upload
info:
  name: jindie-EAS-myUploadFile-upload111
  author: 思沃科技
  severity: critical
  description: 金蝶EAS myUploadFile任意文件上传
http:
  - raw:
      - |
        HTTP请求体
    筛选与匹配

```

![](https://mmbiz.qpic.cn/mmbiz_gif/4yJaCArQwpACMJuBxI11jPgvHCxQZFQxPrt5iaQRibgGl0aIzFo4hDCYcFuyViag6zhuqNEjjeasfMEAy1rkaOahw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

  

**常用匹配 / 筛选器**

  

![](https://mmbiz.qpic.cn/mmbiz_gif/4yJaCArQwpACMJuBxI11jPgvHCxQZFQxPrt5iaQRibgGl0aIzFo4hDCYcFuyViag6zhuqNEjjeasfMEAy1rkaOahw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

  

**1、matchers** 

```
所支持参数：
1、size：判断返回包大小 
2、word ：关键词匹配
3、regex ：正则表达式
4、binary ：要为十六进制响应匹配二进制
5、dsl：匹配协议响应

```

如下为示例：

```
#检查响应的大小是否大于1000字节
matchers:
  - size: ">1000"
#匹配包含 “error” 关键词的响应
matchers:
  - word: "error"
#匹配响应中的版本号：
matchers:
  - regex: "Version: (\\d+\\.\\d+\\.\\d+)"
#如果期望响应的前两个字节是 0x01 0x02：
matchers:
  - binary: "0102"
#匹配 HTTP 响应码为 200 的情况：
matchers:
  - dsl: "response_code == 200"

```

**2、extractors**

 **正则表达式提取器，通过该方法，将正则表达式匹配到的内容，提取到指定变量中去使用。在下面的示例中，如果响应中包含类似 “Version: 1.2.3” 的文本，它将提取版本号并存储在名为 version 的变量中。**

```
extractors:
  - regex:
      pattern: "Version: (\\d+\\.\\d+\\.\\d+)"
      target: version

```

**3、JSON 提取器**  

**用于从 JSON 块中提取对象的值，同时该提取器也支持赋值。在下面的示例中，如果 JSON 响应包含一个名为 user 的对象，其中有一个名为 name 的属性，它将提取该属性的值并存储在名为 username 的变量中。**

```
extractors:
  - json:
      path: .user.name
      target: username

```

**4、Xpath 提取器**

 **从 HTML 响应中提取属性值的 xpath 提取器，在下面的示例中，如果 HTML 响应包含一个 <img> 标签，它将提取 src 属性的值并存储在名为 image_url 的变量中**

```
extractors:
  - xpath:
      expression: //img/@src
      target: image_url

```

**（上述四种方法，是比较常用的，其他方法后面慢慢说）**

![](https://mmbiz.qpic.cn/mmbiz_gif/4yJaCArQwpACMJuBxI11jPgvHCxQZFQxPrt5iaQRibgGl0aIzFo4hDCYcFuyViag6zhuqNEjjeasfMEAy1rkaOahw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

  

**yaml 内置保留字**

  

![](https://mmbiz.qpic.cn/mmbiz_gif/4yJaCArQwpACMJuBxI11jPgvHCxQZFQxPrt5iaQRibgGl0aIzFo4hDCYcFuyViag6zhuqNEjjeasfMEAy1rkaOahw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

  

```
\{\{Hostname\}\}：这是一个常用的保留字，表示主机名。
\{\{randstr\}\}：这是一个随机字符串。
\{\{rand_int(1,9999)\}\}：这是一个生成 1 到 9999 之间随机整数的保留字。
\{\{BaseURL\}\}：表示完整的基本 URL，例如 https://example.com:443/foo/bar.php。
\{\{RootURL\}\}：表示不包含路径和文件的基本 URL，例如 https://example.com:443。
\{\{Host\}\}：表示主机名，例如 example.com。
\{\{Port\}\}：表示端口号，例如 443。
\{\{Path\}\}：表示路径，例如 /seeyon/login。
\{\{File\}\}：表示文件名，例如 bar.php。
\{\{Scheme\}\}：表示协议，例如 https。
\{\{hex_decode("")\}\}：这是一个十六进制解码的保留字。
md5()：这是一个 MD5 转换的保留字。

```

![](https://mmbiz.qpic.cn/mmbiz_gif/4yJaCArQwpACMJuBxI11jPgvHCxQZFQxPrt5iaQRibgGl0aIzFo4hDCYcFuyViag6zhuqNEjjeasfMEAy1rkaOahw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

  

**常用变量**

  

![](https://mmbiz.qpic.cn/mmbiz_gif/4yJaCArQwpACMJuBxI11jPgvHCxQZFQxPrt5iaQRibgGl0aIzFo4hDCYcFuyViag6zhuqNEjjeasfMEAy1rkaOahw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

  

**1、定义变量**

**在 YAML 中，可以使用 `variables` 来定义变量，例如下****面的代码将 "ABCDEFG" 的内容保存在名为 token 的变量中****即 token = "ABCDEFG"**

```
variables:
  token: "ABCDEFG"

```

**使用方法：****将变量放到 \{\{变量名\}\} 中去，举个例子，下面请求中的 Authorization 头部会使用 token 变量的值**

```
requests:
  - method: GET
    path: /api/some-endpoint
    headers:
      Authorization: "Bearer \{\{token\}\}"

```

**2、**攻击载荷****

**在 YAML 中，**payloads **用来提供攻击载荷的部分，例如**

```
payloads:    
  变量名: 变量内容

```

**在攻击载荷这里可以选择攻击模式 (Attack)，**支持的参数有三种：

**1、攻城锤 (batteringram)，只使用一个有效载荷集，例如：**

```
payloads:
  username: ["admin", "user", "test"]
  password: ["password123", "123456", "letmein"]

```

**2、集束炸弹 (clusterbomb)，将尝试所有用户名和令牌的组合**

```
payloads:
  username: ["admin", "user", "test"]
  token: ["abc123", "xyz456", "pqr789"]

```

**3、干草叉 (Pitchfork)，干草叉攻击型为每个位置使用一个有效载荷集。它将第一个有效载荷置于第一个位置，将第二个有效载荷置于第二位置，依此类推**

```
payloads:
  query: ["admin", "user", "test"]
  page: [1, 2, 3]

```

**接下来以一个用友的命令执行漏洞作为例子**

**如下是一批用友 bsh.servlet.BshServlet 命令执行的路径，在测试中，我们不希望逐个测试这些链路，因此可以使用 payloads 方法来进行批量扫描。**

```
/service/~baseapp/UploadServlet
/service/ECFileManageServlet
/servlet/~ic/nc.bs.framework.mx.monitor.MonitorServlet
/servlet/~ic/nc.bs.framework.mx.MxServlet
/servlet/~uapxbrl/uap.xbrl.persistenceImpl.XbrlPersistenceServlet

```

**1、首先定义变量**

```
payloads：
  yypath：
        - '/service/~baseapp/UploadServlet'
        - '/service/ECFileManageServlet'
        - '/servlet/~ic/nc.bs.framework.mx.monitor.MonitorServlet'
        - '/servlet/~ic/nc.bs.framework.mx.MxServlet'
        - '/servlet/~uapxbrl/uap.xbrl.persistenceImpl.XbrlPersistenceServlet'
        - '/servlet/~uapss/com.yonyou.ante.servlet.FileReceiveServlet'
        - '/servlet/~ic/nc.document.pub.fileSystem.servlet.DownloadServlet'
        - '/servlet/~ic/nc.document.pub.fileSystem.servlet.UploadServlet'
        - '/servlet/~ic/nc.document.pub.fileSystem.servlet.DeleteServlet'
        - '/servlet/~ic/com.ufida.zior.console.ActionHandlerServlet'
        - '/ServiceDispatcherServlet'
        - '/servlet/~baseapp/nc.message.bs.NCMessageServlet'
        - '/fs/update/DownloadServlet'
        - '/service/~cc/nc.bs.logging.config.LoggingConfigServlet'    

```

**2、使用变量**

```
requests:
  - method: GET
    path: "\{\{ yypath \}\}"

```

![](https://mmbiz.qpic.cn/mmbiz_gif/4yJaCArQwpACMJuBxI11jPgvHCxQZFQxPrt5iaQRibgGl0aIzFo4hDCYcFuyViag6zhuqNEjjeasfMEAy1rkaOahw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

  

**写在最后**

  

**![](https://mmbiz.qpic.cn/mmbiz_gif/4yJaCArQwpACMJuBxI11jPgvHCxQZFQxPrt5iaQRibgGl0aIzFo4hDCYcFuyViag6zhuqNEjjeasfMEAy1rkaOahw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)**

  

  这篇文章主要讲了 yaml 脚本速成新手教程 -- 基础常识篇的内容，后面我会将 SQL 注入、文件上传、暴力破解、未授权访问、命令执行等常见的情况，通过笔记的方式分享给各位师傅，逐步完善，希望能给大家带来帮助。

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/yeJvia5dNx5ickP7mRo94TVlbfkvCIqCuC1A2oX0sg2YBKQIBSg0pAaxea38ChVYibxJs5kGlArbIJVtiaITiaSLJ1w/640?wx_fmt=jpeg&from=appmsg)