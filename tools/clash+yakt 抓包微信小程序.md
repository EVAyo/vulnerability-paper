<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/Y3vYzpsUyzihy678mNec9A)

**0x00** **免责声明**

!  

![](https://mmbiz.qpic.cn/mmbiz_svg/1MLz0YkS76HN2mDzsc3eKehjJJTibD6cvzwcAQjFRKJibj2hFeFx9xqPxeAVNLIWWM7ia8XD9YUsUYyFLonA46ewoicJrmJO2oNx/640?wx_fmt=svg&from=appmsg)

本文仅用于技术讨论与学习，利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，文章作者及本公众号团队不为此承担任何责任。

**0x01 前言**

!  

![](https://mmbiz.qpic.cn/mmbiz_svg/1MLz0YkS76HN2mDzsc3eKehjJJTibD6cvzwcAQjFRKJibj2hFeFx9xqPxeAVNLIWWM7ia8XD9YUsUYyFLonA46ewoicJrmJO2oNx/640?wx_fmt=svg&from=appmsg)

在抓 app 和微信小程序时，通常使用 Proxifier 进行代理，但是总是莫名其妙的没有反应，这时就只能重启电脑。这时我们就可以使用 clash 进行抓包，亲测可用。

**0x02 代理模式设置**

!  

![](https://mmbiz.qpic.cn/mmbiz_svg/1MLz0YkS76HN2mDzsc3eKehjJJTibD6cvzwcAQjFRKJibj2hFeFx9xqPxeAVNLIWWM7ia8XD9YUsUYyFLonA46ewoicJrmJO2oNx/640?wx_fmt=svg&from=appmsg)

开启服务模式，系统代理

![](https://mmbiz.qpic.cn/mmbiz_png/uIXF7K92VEIIrX4HnYTZCtC9tnyH6AVMjugicicSVOCJU8BmeIozWtpco3GkOkNdEREmhS09VOia8VKf7JicLHSSTg/640?wx_fmt=png&from=appmsg)

确保 wintun.dll 存在

![](https://mmbiz.qpic.cn/mmbiz_png/uIXF7K92VEIIrX4HnYTZCtC9tnyH6AVMPxvOg4cMbfNK6OkG7LA0WiaWmOibJnA9T6vYudYKfqxxDGq1WPf9POYg/640?wx_fmt=png&from=appmsg)

**0x03 配置代理文件**

!  

![](https://mmbiz.qpic.cn/mmbiz_svg/1MLz0YkS76HN2mDzsc3eKehjJJTibD6cvzwcAQjFRKJibj2hFeFx9xqPxeAVNLIWWM7ia8XD9YUsUYyFLonA46ewoicJrmJO2oNx/640?wx_fmt=svg&from=appmsg)

在配置选项中导入配置文件

![](https://mmbiz.qpic.cn/mmbiz_png/uIXF7K92VEIIrX4HnYTZCtC9tnyH6AVMofTa6ZOYe9QbNHJzUf4pq3PgtsO02Sia4BphLaEwSVJ5QGApU9rTrsQ/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_jpg/uIXF7K92VEIIrX4HnYTZCtC9tnyH6AVMbHaEbUz0xyrW2oXH1Gcg02Sh1sx2O0RAwActFaMXbhh20dutR8qe3g/640?wx_fmt=other&from=appmsg)

该配置文件提供了只抓微信小程序和全局代理两个节点

‍

```
# 代理设置
proxies:
  - name: Charles
    type: http
    server: 127.0.0.1
    port: 8080  # 根据抓包工具配置
# 代理组设置
proxy-groups:
  - name: Proxy
    type: select
    proxies:
      - Charles
      - DIRECT
  - name: GlobalProxy
    type: select
    proxies:
      - Charles
      - Proxy
      - DIRECT
# 规则设置
rules:
  - DOMAIN-SUFFIX,wxapp.qq.com,Proxy   # 微信小程序的域名匹配规则，流量通过 Charles 代理
  - DOMAIN-SUFFIX,wechat.com,Proxy    # 可能与微信小程序相关的域名，也经过 Charles 代理
  - DOMAIN-SUFFIX,tencent.com,Proxy    # 腾讯相关的域名，也经过 Charles 代理
  - DOMAIN-SUFFIX,weixin.qq.com,Proxy    # 微信相关的域名，也经过 Charles 代理
  - DOMAIN-SUFFIX,qq.com,Proxy    # QQ 相关的域名，也经过 Charles 代理
  - MATCH,GlobalProxy   # 默认规则，可在 GlobalProxy 中切换全局代理和直连
# DNS 配置
dns:
  enable: true
  ipv6: false
  enhanced-mode: fake-ip # 或使用 redir-host，取决于设备和需求
  nameserver:
    - 8.8.8.8
    - 1.1.1.1
# 其他设置
tun:
  enable: true
  stack: system # 或 gvisor，取决于设备支持
  dns-hijack:
    - 198.18.0.2:53
  auto-route: true
  auto-detect-interface: true # Clash 会自动检测出口网卡
# 日志级别，可选 "info", "warning", "error", "debug", "silent"
log-level: info

```

**0x04 抓包效果**

!  

![](https://mmbiz.qpic.cn/mmbiz_svg/1MLz0YkS76HN2mDzsc3eKehjJJTibD6cvzwcAQjFRKJibj2hFeFx9xqPxeAVNLIWWM7ia8XD9YUsUYyFLonA46ewoicJrmJO2oNx/640?wx_fmt=svg&from=appmsg)

配置与 yakt 联动 (如使用 burp 微信必须在 3.7.6 版本以下)，ip 填写本机 ip 或 127.0.0.1（本地记得导入 yakt 证书）
------------------------------------------------------------------------------

![](https://mmbiz.qpic.cn/mmbiz_png/uIXF7K92VEIIrX4HnYTZCtC9tnyH6AVMq1G6UytpkibxRLvTkFibVG6ujicmib8FtttHxmy3wfiaGweu8GRrFicsJK4w/640?wx_fmt=png&from=appmsg)

抓包效果，可以看到抓取成功
-------------

![](https://mmbiz.qpic.cn/mmbiz_png/uIXF7K92VEIIrX4HnYTZCtC9tnyH6AVMZmqvjkdqTotZRSKToIamOfZk6wBxRaPibwsV6VZXYYvpEr75p5E2OVg/640?wx_fmt=png&from=appmsg)

**0x05 总结**

!  

![](https://mmbiz.qpic.cn/mmbiz_svg/1MLz0YkS76HN2mDzsc3eKehjJJTibD6cvzwcAQjFRKJibj2hFeFx9xqPxeAVNLIWWM7ia8XD9YUsUYyFLonA46ewoicJrmJO2oNx/640?wx_fmt=svg&from=appmsg)

    该方法不仅适用 pc 端，还可适用于抓取手机 app 但是 clash 本身不会无视客户端的证书校验，所以需要一些其它方式去解决证书问题，鸽鸽们可以自行研究一下，配置文件 Android 和 pc 基本可以通用。  

```
# 代理设置
proxies:
  - name: Charles
    type: http
    server: 127.0.0.1
    port: 8080  # 根据抓包工具配置
# 代理组设置
proxy-groups:
  - name: Proxy
    type: select
    proxies:
      - Charles
      - DIRECT
  - name: GlobalProxy
    type: select
    proxies:
      - Charles
      - Proxy
      - DIRECT
# 规则设置
rules:
  - DOMAIN-SUFFIX,wxapp.qq.com,Proxy   # 微信小程序的域名匹配规则，流量通过 Charles 代理
  - DOMAIN-SUFFIX,wechat.com,Proxy    # 可能与微信小程序相关的域名，也经过 Charles 代理
  - DOMAIN-SUFFIX,tencent.com,Proxy    # 腾讯相关的域名，也经过 Charles 代理
  - DOMAIN-SUFFIX,weixin.qq.com,Proxy    # 微信相关的域名，也经过 Charles 代理
  - DOMAIN-SUFFIX,qq.com,Proxy    # QQ 相关的域名，也经过 Charles 代理
  - MATCH,GlobalProxy   # 默认规则，可在 GlobalProxy 中切换全局代理和直连
# DNS 配置
dns:
  enable: true
  ipv6: false
  enhanced-mode: fake-ip # 或使用 redir-host，取决于设备和需求
  nameserver:
    - 8.8.8.8
    - 1.1.1.1
# 其他设置
tun:
  enable: true
  stack: system # 或 gvisor，取决于设备支持
  dns-hijack:
    - 198.18.0.2:53
  auto-route: true
  auto-detect-interface: true # Clash 会自动检测出口网卡
# 日志级别，可选 "info", "warning", "error", "debug", "silent"
log-level: info

```

!  

![](https://mmbiz.qpic.cn/mmbiz_svg/1MLz0YkS76HN2mDzsc3eKehjJJTibD6cvzwcAQjFRKJibj2hFeFx9xqPxeAVNLIWWM7ia8XD9YUsUYyFLonA46ewoicJrmJO2oNx/640?wx_fmt=svg&from=appmsg)

欢迎各位鸽鸽加我邀请进交流群！！！

![](https://mmbiz.qpic.cn/mmbiz_jpg/uIXF7K92VEIIrX4HnYTZCtC9tnyH6AVMpib2bfOQFVfdOibtDlMxEzCSOgBkngMq3cq9rsDxibTQyInwj7ib093v2g/640?wx_fmt=jpeg)