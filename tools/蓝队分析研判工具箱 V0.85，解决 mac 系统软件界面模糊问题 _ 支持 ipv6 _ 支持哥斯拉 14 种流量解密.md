<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/ye5QeFiIvb32IB_VSqyQGw)

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450ATcz6jUJnFNeOxRzVZ9LbcCCMJ6Af2WYicgMPA32IwibF8mI2ibC9h8jaHkhxnZzZuqctMLRTxDudicA/640?wx_fmt=png)

 **Part1 前言** 
--------------

**大家好，我是 ABC_123**。“蓝队分析研判工具箱” 就是把我平时写的蓝队小工具集合起来形成的，重点解决蓝队分析工作中的一些痛点问题。**此 0.85 版本重点解决苹果 mac 系统软件界面模糊问题，解决 **IPv6 的支持问题，**支持哥斯拉 webshell 全部 14 种加密流量的解密，感谢 "小黑" 的帮助**，添加溯源分析功能、网空资产测绘功能：包括 Hunter、佛法、VirusTotal、Censys、Shadon、Zoomeye、Quake、微步威胁情报搜索功能，查看图片经纬度地理位置等功能，对所有文本框添加右键菜单，解决 Linux、mac 及 jdk 高版本兼容问题，很多其它功能如日志分析、聚合分析、接口查询由于时间关系未能完成，后续再继续更新。**文末会给出 ABC_123 的官方 Github 下载地址，后续会持续在 github 发布该工具的最新版本**。

**建议大家把公众号 “希潭实验室” 设为星标，否则可能就看不到啦！**因为公众号现在只对常读和星标的公众号才能展示大图推送。操作方法：点击右上角的【...】，然后点击【设为星标】即可。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450DbhnGmO67ewLDJqstfHZSHdFeDURNa0QpfjclGrvg0lfANPtuLbf5Ddur3HZmdfAydibIf9zazCKQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

 **Part2 使用说明及功能介绍** 
---------------------

*   **解决 IPv6 的支持问题**
    

不少网友给我发信息，希望支持 IPv6 的处理，然后我研究了一下午，完善了此功能，“提取 ip 地址”、“查询 ip 对应物理地址”、“ip 地址处理” 等功能均支持 IPv6。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Aq45DWy0sC13ohzblYsXs67odmag7dOogXBVqazhDyBNHXoPpVhCV0xURiaDr4Fibmvb003Mn89liaQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Aq45DWy0sC13ohzblYsXs6ICszyQSzWR54jN6QRqTa3Jqlo4W3T6Za2CKf0VnyOX7kiau7av2wanA/640?wx_fmt=png)

*   **支持 14 种哥斯拉 webshell 算法解密功能**
    

不少网友给我发邮件，希望我更新哥斯拉的流量解密功能，哥斯拉的算法总共 14 种，写起来实在是太麻烦了，这样我就利用十一假期，抽出一天的时间，把此功能进行了完善。

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450Db2adiclOlibIHWxcbPnJeGuVMcj8V39EJBDICr3I5pOLoKH0SrttjbeE7CnjVBTK1PQMkHwZ2cg0A/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450Db2adiclOlibIHWxcbPnJeGuUuYiaibeWAsN0VLd6gn1UZiaPic6e1YTyS8bziatpDpzwFGhSdSpOFnc6PQ/640?wx_fmt=jpeg)

如下所示，如果是二进制格式的请求包或者返回包，需要转成 hex16 进制形式，然后再使用工具进行解密。  

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450Db2adiclOlibIHWxcbPnJeGu2bluyfbAWAPicoS03icwG4eJwjRSNfKFhYa9M3nf61NYddEpHs1HdJgA/640?wx_fmt=jpeg)

*   **新增网空资产测绘功能**
    

此功能还在完善中，暂时只能输入 xxx.com 或者 ip 地址或者 ip 段进行搜索，点击 “一键查询所有” 按钮，程序会自动调用 Hunter、佛法、VirusTotal、Censys、Shadon、Zoomeye、Quake、微步威胁情报的 api，转换成相应的搜索语句进行搜索。

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450DkLQIf1nKjhbG606CpKBmXGicvqiab8npadNsIHgtFQ6icZ4GMdibibytXcXlGhkhEBUFfKNEVBa6ZOVQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

需要填入相应的 api 的 key，然后点击 “保存所有配置” 方可使用此功能。

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450DkLQIf1nKjhbG606CpKBmXzK30P0JACjWg75opBBqTtvY6SsN18RTbBrB77ib4LUFiaT1NzGsXj9KQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

需要填入相应的 api 的 key，然后点击 “保存所有配置” 方可使用此功能。

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450DkLQIf1nKjhbG606CpKBmXZXz55dzvWicI45Kh5tZ4BpKGWqTGNtWIl40t6FA91HtQeTPc8E3nWbw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

*   **添加溯源辅助功能**
    

可以查看图片的 exif 信息，包括经纬度、地理位置等信息，可以对 NPS 代理进行漏洞检测，**但是程序本身不提供漏洞利用功能**。后续会加入对 CobaltStrike 的分析功能，暂时没时间更新了。

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450DkLQIf1nKjhbG606CpKBmXqQoKBtb3icDghOQxxp6iaUicEf8Zib5WBmsssoJXszzoe5qMFZWyaUGtqA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

如下图所示，可以查看图片的 exif 信息，包括经纬度、地理位置等敏感信息。

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450DkLQIf1nKjhbG606CpKBmXvP7Bia6eJX6CKvW5w394B5Wsd5D81E2XWNh6S9NgT7014lF2JaibiaJDQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

*   **新增常用网址功能**
    

汇集了常用的蓝队溯源分析网址，方便红蓝人员进行溯源分析或者应急响应分析。

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450DkLQIf1nKjhbG606CpKBmXA7N6pMXbftn1uhTn2WgxQUVDtpuwVzn1ibsojRtPhFtbwZy52QFE2Fw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

*   **新增代码格式化功能**
    

可格式化 javascript/java/jsp/json/css/xml 等代码，并且高亮显示，方便红蓝双方对代码进行可视化分析。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450D999DkaemHnnaGgyZCPxzHUyTrMjVXxnHoc7nGwvsFmcDHC8UiauUem5QPI2iac2MSLSVEfRRQ4nNA/640?wx_fmt=png)

*   **新增 5 种 Java 内存马 class 文件反编译功能**
    ---------------------------------
    

通过调用 Intellij Idea、CFR、Procyon、JD-Core、JDK 等 5 种反编译工具接口，分别对 Base64 加密的 class 文件、转成 Byte 数组的 class 文件、BECL 编码的 class 文件、Base64 编码 + Gzip 编码的 class 文件、原版 class 文件反编译成 java 代码，方便蓝队人员分析异常流量中的内存马代码。

当然，**此功能对于红队人员也特别方便**，方便大家编写 tomcat、springboot、weblogic 内存马时进行 class 文件反编译对比分析。

 **1**  如下图示所示，程序对 Base64 加密的内存马 class 文件进行反编译分析。

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450DkLQIf1nKjhbG606CpKBmX9d4QawzWINjVc2DZbQmD2ZCgRmVtWQE1ia7E0dETo18e4MT35QibvUrw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450DkLQIf1nKjhbG606CpKBmXJqBr5OWdIWaZdl6Du2Sicmdj5brHJUicJrUbTcN8hTHSH8p87LXFuQTA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

*   **ip 地址排除白名单功能**
    

此功能为了解决，在日常蓝队工作中，各种安全设备会告警上万个 ip，但是有的 ip 是企业正常的 ip，称之为白名单 ip，手工一个个筛选非常麻烦，所以我就写了这个功能，可以生成真正可用的可封禁的 ip 地址列表。这个功能的特点是，对于 ip 地址的导入，兼容各种 ip 地址格式，兼容格式如下图所示。

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450DkLQIf1nKjhbG606CpKBmXuA8D6qVEZu8tibDvmXvBiaicEVWO8tpD2tJtSjgnvmupsHr70zQpMaDibg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

*   **端口连接添加 ip 归属地址 | 对国外 IP 高亮显示**
    --------------------------------
    

假设甲方客户的内网主机中了恶意病毒，蓝队人员通常会执行 netstat -an 命令去查看每个端口或者进程连接国外 ip 地址情况。将 **netstat -an** 结果贴到工具中，点击 “**查询 ip 对应物理地址**” 按钮，程序就会在每一行结果后面，添加上每个 ip 地址对应的国家、城市、经纬度、国外大学等物理地址，方便蓝队人员快速定位出存疑的 ip、端口、进程，而且**此功能无需联网使用，断网情况下仍然可以用。**本次更新优化了查询速度，基本上秒出结果，**同时对国外的 IP 地址进行了标黄处理，方便查看**。

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450DkLQIf1nKjhbG606CpKBmXlibbSgP2vRau4nR5BicOwuCrnQzFibMlsbLbicdmdgX3wngHIEHJfQ3hcQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

*   **Java 反序列化数据包分析功能**
    

此功能可以直接对 java 反序列化数据包进行解包分析，参考了 **SerializationDumper** 工具的代码。

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450DkLQIf1nKjhbG606CpKBmXqXXy8qKm6BgDapCqSmt8EIwOiasobibFrTHg9urowFZK8WwzCXETbEtg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

*   **冰蝎及哥斯拉 webshell 流量解密功能**
    --------------------------
    

编写这个功能耗费了我很大的精力，对于冰蝎 webshell，从流量中找到秘钥即可解密。对于哥斯拉 webshell，目前只支持 java 型 webshell 流量解密，其它功能后续再加上。由于哥斯拉低版本的 1.x-2.x 与 3.x-4.x 版本的流量加密过程稍微有点不一样，因此解密功能分开写了。暂不支持冰蝎 4.x 的解密，后续会加上。

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450Db2adiclOlibIHWxcbPnJeGuJ3UElBCMKDNLRLI5a5ia5DDs9UP6WxH102RRZQIKJjQFBlpYAOOTf2g/640?wx_fmt=jpeg)

*   **在 Jar 包中搜索指定类名**
    ------------------
    

对于蓝队人员，此功能可以在指定的 jar 包目录中筛选出含有恶意类名的 jar 包文件，**现在很多红队人员制作的不死内存马，会将 jar 包中的 class 文件修改掉，关机重启后内存马仍然可用**，那么这个分析功能会非常有用。

对于红队人员，在编写调试 0day 或者 Nday 的 POC 时，比如说 weblogic 中间件，它所包含的依赖 jar 包可能有上千个，**查找存在漏洞的类究竟依赖于哪个 jar 包是非常头痛的一件事**，这个工具可以帮您解决这个问题。在编写调试 weblogic 的 poc 时，ABC_123 就是使用这个功能查找指定 jar 包依赖的。

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450DkLQIf1nKjhbG606CpKBmXbkf5txhX2Anfa8ghjEeNhukePQaMDODEe5KJJic3wCJK7sE1AMibyBKw/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

*   **解密 Shiro 数据包 / CAS 数据包 / Log4j2 数据包功能**
    -----------------------------------------
    

对于设备告警的 Shiro 反序列化攻击行为，部分蓝队分析人员，对 Shiro 反序列化攻击做不了研判工作，**难以辨别是否是攻击行为**，还是正常的业务行为，还是设备误报。于是我在解密数据包的同时，加入了数据包分析功能，可以快速研判是否有反序列化攻击行为。

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450DkLQIf1nKjhbG606CpKBmXDt7QENapQrp0eRYNnMWmEeZmibxsQEcZzQl4tG5hZoA7mK5mHOjBiaEQ/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

*   编码 / 解码工具
    

在蓝队分析工作中，不少朋友反映没有一款好用的编码 / 解码工具，不是功能有 bug，就是功能不全。比如说最简单的 URL 编码、16 进制的 Hex 编码、Base64 编码，**很多工具就没有考虑到中文字符的 GB2312、UTF-8 编码问题**，导致解密结果不正确或者是乱码。于是我仔细研读了网上的关于编码 / 解码的文章，对常用的编码 / 解码功能进行调试，写成了如下功能。看后续大家反馈，如果好用的话，我可以把 “编码 / 解码” 功能单独拎出来写一个工具，主要功能如下。

 **1**   更改软件界面，加入 GB2312、UTF-8、GBK、BIG5、ISO-8859-1、GB18030 等编码库，解决中文汉字在编码解码过程中产生的乱码问题。

 **2**   将 “becl 编码文件功能” 中的 becl 编码类更换为 “回忆飘如雪” 师傅编写的 Java 类，解决部分 JDK 由于缺失相应的 class 文件而无法 Becl 编码的问题。

 **3**   新增 “Hex 编码二进制文件” 功能，可以将二进制文件编码成 16 进制格式。

 **4**   将 Base64 编码功能统一更换为第三方 jar 包，使其通用性更强。

 **5**   支持将二进制文件转为 byte 数组格式。

 **6**   新增 UTF-7 编码。

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450DkLQIf1nKjhbG606CpKBmXkWZbIhvTF4hCGKZptPGVlcxNSJSiaboyIvajcgm2rnkxwX9xicU5WljA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

二进制文件、文本文件各种哈希值校验功能。

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450DkLQIf1nKjhbG606CpKBmXwTkjmY7Y75ZTbHAu6IwicBhJCu5sk3DcIUZZib3NlsjqU24t8WZib1lvA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

同时还可以对二进制文件进行 base64 编码、hex16 进制编码、BECL 编码、转为 byte 数组等操作。

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450DkLQIf1nKjhbG606CpKBmXkl3Qyyj5SgTXpjnbjOCg6yeE1zb1zO2NPibUvib9ia0tWcwmzf9w883Fg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)

**关注公众号 " 希潭实验室”，回复数字 “1009”，即可得到此蓝队分析研判工具箱 V0.85 的下载地址。**

 **Part3 总结** 

**1.**  后续还会继续更新这个工具，有好的建议可以在公众号后台给我留言。

**2.**  冰蝎 4.x、天蝎 webshell 解密、IPV6 的支持，后续有时间会更新。

**3.**  后续会加入一些威胁情报检索功能，以及聚合分析功能，敬请关注。

**4.**  后续会加入 weblogic 日志分析功能，其它 web 日志分析功能。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450A5qqg2iaK6KIYYR8y6pF5Rh3JHDibOKOop204nXz618iawdRb8dABicMPtHb2PkJE8x6koJO5HyuwZJQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

**公众号专注于网络安全技术分享，包括 APT 事件分析、红队攻防、蓝队分析、渗透测试、代码审计等，每周一篇，99% 原创，敬请关注。**

**Contact me: 0day123abc#gmail.com(replace # with @)**