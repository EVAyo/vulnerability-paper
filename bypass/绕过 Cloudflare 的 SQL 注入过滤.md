<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/DutI5NRt7nZFAD-CqYchag)<table><tbody><tr><td width="557" valign="top" height="62"><section><strong>声明：</strong>该公众号大部分文章来自作者日常学习笔记，也有部分文章是经过作者授权和其他公众号白名单转载，未经授权，严禁转载，如需转载，联系开白。</section><section>请勿利用文章内的相关技术从事非法测试，如因此产生的一切不良后果与文章作者和本公众号无关。</section></td></tr></tbody></table>

来源：medium，作者：Amit Dutta

现在只对常读和星标的公众号才展示大图推送，建议大家把潇湘信安 “设为星标”，否则可能看不到了！

在这个项目中，我最初的方法是尝试通过发现网站的原始 IP 来绕过 WAF（Cloudflare）。当这种方法失败时，我深入研究了 WAF 绕过技术并找到了解决方案。

由于特定的 “www.XYZ.ac.in” 网站容易受到 SQL 注入攻击，因此我继续进行 SQL 注入攻击。

“XYZ.ac.in” 网站有 6 列。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/XOPdGZ2MYOf19lWtFQBPgHPWTibfAX6UtO3K7OjOK9OzO6Ric4Hx3TASnhiaQxKWKXq4jRT3GcVticBlm171PLia65Q/640?wx_fmt=png&from=appmsg)

当尝试使用 UNION SELECT 语句时，我发现它被 Cloudflare 阻止了。

因此，我尝试通过找到目标网站的原始 IP 来绕过 Cloudflare。

为了实现这一点，我使用 Censys 进行 IP 发现。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/XOPdGZ2MYOf19lWtFQBPgHPWTibfAX6UtiaObkpjlSnyQmsgsITR3JuZsoLo8XMCicZS6LTDBhQdXhBvibcqCibn7xg/640?wx_fmt=png&from=appmsg)

正如你所见，我没有得到该网站的原始 IP。

尝试使用一种技巧来绕过它，即输入混合有大小写字母的 “union select” 语句，例如 “UnIoN sSelect”。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/XOPdGZ2MYOf19lWtFQBPgHPWTibfAX6UtpHRc1efT0sW1icGpexnDbq5AKJmiaAbEy9d5lGzENjBzHP1gVbvBpteQ/640?wx_fmt=png&from=appmsg)

但它也没有起作用。

让我们深入研究这个挑战，并尝试一种绕过 Cloudflare 安全性的技巧。

花了一些时间后，我找到了一种绕过它的方法，即添加

```
'/*!UnIon/*trick-comment*/*/ sElect 1,2,3,4,5,6 -- -

```

* 注意：可能看起来与绕过 MOD 安全性类似，但它是不同的。

这里使用的技术称为混淆，其中语句的制作方式可以避免常见的过滤模式，但仍然由底层数据库执行。

让我们尝试一下。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/XOPdGZ2MYOf19lWtFQBPgHPWTibfAX6UtOl2mgIt5uqicocTVjxXXsFbrpCeibCuw6aopvZY17rJtwQicxSQOClJeA/640?wx_fmt=png&from=appmsg)

是的，状态代码 200 OK 表明我已经成功绕过 Cloudflare 的 SQL 注入过滤器。

现在，让我们继续进行 SQL 注入攻击。

```
'/*!Union/*AmitTheNoob*/*/ select 1,2,3,table_name,5,6 from information_schema.tables where table_schema=database()-- -

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/XOPdGZ2MYOf19lWtFQBPgHPWTibfAX6UtEb19NLM7RotqRvkq1EU7brVUFG3Td7KX1Kl6aRhav12ynsibRry6M7g/640?wx_fmt=png&from=appmsg)

我能够使用 SQL 注入攻击成功从数据库中提取表。

虽然我可以选择逐个检索表和列（我计划在以后的文章中介绍这个主题），但这里我的重点是讨论 Cloudflare 绕过，因此我将避免过多地深入细节。

相反，我将使用 DIOS（一次性转储）方法，这是我从 SecurityIdiots.com 学到的

![](https://mmbiz.qpic.cn/sz_mmbiz_png/XOPdGZ2MYOf19lWtFQBPgHPWTibfAX6UtYe2I2RvFQweLuVCdRQ3L7pewMpJab0Krf4AMjvkQeV99ibQugEVCeaw/640?wx_fmt=png&from=appmsg)

看来我也需要混淆 DIOS（一次性转储）方法。通过这样做，我可以隐藏其真实性质，并使 Cloudflare 等安全系统更难检测到。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/XOPdGZ2MYOf19lWtFQBPgHPWTibfAX6Ut9H5HNyeTnkKNfQrkkn8qJVibQfEfWLh9Uz6WEH2ibtNtxZVAZQ0ATViaA/640?wx_fmt=png&from=appmsg)

我一次性成功检索了所有表名和列名。

我检索了凭据并通过文件上传执行了远程代码。由于本文重点介绍如何绕过 Cloudflare，因此我选择不深入探讨这些其他主题，以保持文章简洁。  

**关注我们**

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOeSsicAgIUNHtMib9a69NOWXw1A7mgRqqiat1SycQ0b6e5mBqC0pVJ3oicrQnCTh4gqMGiaKUPicTsUc4Tw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1) 还在等什么？赶紧点击下方名片开始学习吧！![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOeSsicAgIUNHtMib9a69NOWXw1A7mgRqqiat1SycQ0b6e5mBqC0pVJ3oicrQnCTh4gqMGiaKUPicTsUc4Tw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

**知 识 星 球**

  

  

仅前 1-400 名: 99¥，400-600 名: 128¥，600-800 名: 148¥，800-1000 + 名: 168¥

![](https://mmbiz.qpic.cn/sz_mmbiz_png/XOPdGZ2MYOcKGNyJ8jSPNpMahribWIY2cut8eAiakTpr6lAzlLt1xubcuUg4la0LMHmhnENia4icnjOwTsfDqq4I7A/640?wx_fmt=png&from=appmsg)

**推 荐 阅 读**

  

  

  

[![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOe2nibXhkXA8A79MhARiaW5Q0H2aiaR0OwyR63JAI1pRGAc7FZMgIHb9kicboQziaJkTbnlAgOvkdiaHf5g/640?wx_fmt=png)](http://mp.weixin.qq.com/s?__biz=Mzg4NTUwMzM1Ng==&mid=2247499188&idx=1&sn=9ce15a0e66b2595285e544aaa0c49c24&chksm=cfa559a7f8d2d0b162f00e0c1b02c85219f2668c282b32967b2530f15051b47b21ee2855a783&scene=21#wechat_redirect)

[![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOe2nibXhkXA8A79MhARiaW5Q0ibIORUp7SmHhzy2uyXKsgn7YwfdjIpZDFx0vT7AJDMtqKf9l5WCzIIQ/640?wx_fmt=png)](http://mp.weixin.qq.com/s?__biz=Mzg4NTUwMzM1Ng==&mid=2247496043&idx=1&sn=4daa27ade9915de6021fea1c2a21d7bc&chksm=cfa55578f8d2dc6ef887ce27215f942ec233320fa6878bc1666ce0fecb0e7f6c7f96a3ba4e2b&scene=21#wechat_redirect)

[![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOf8eyzKWPF5pVok5vsp74xolhlyLt6UPab7jQddW6ywSs7ibSeMAiae8TXWjHyej0rmzO5iaZCYicSgxg/640?wx_fmt=png)](http://mp.weixin.qq.com/s?__biz=Mzg4NTUwMzM1Ng==&mid=2247486327&idx=1&sn=71fc57dc96c7e3b1806993ad0a12794a&chksm=cfa6af64f8d1267259efd56edab4ad3cd43331ec53d3e029311bae1da987b2319a3cb9c0970e&scene=21#wechat_redirect)

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOdAPjIVeN2ZahG9ibP0Y3wlfg6BO1WO7MZfo1JeW7zDWcLSTQ5Ek8zXAia5w1nMnogpbpXP6OxXXOicA/640?wx_fmt=png)