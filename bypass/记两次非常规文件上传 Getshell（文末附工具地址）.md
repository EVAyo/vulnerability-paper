<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/p1htx18oyLzxdM5t1M7YVQ)

常规绕过前端和后端的任意文件上传已经没意思了，本文记录下之前和最近遇到的 2 个不太常规的任意文件上传 Getshell 的案例。

**[** **路径穿越 + 文件上传 Get Shell** **]**
-------------------------------------

Nmap 快速全端口扫描发现开放 22，80 和 3306 端口。访问目标，使用 [hfinger](https://github.com/HackAllSec/hfinger) 扫描发现 Web 应用使用了`Spring Boot`和`Ueditor`，同时在留言页面发现有个上传图片功能：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/s7bObPUU0RTxet89OhmFYmPY3asPCLfichGUDzMXDDYvA2m2sknuCbQjSjtTMNjldcOv4ZAkNcxf6lmZnn06G8w/640?wx_fmt=png&from=appmsg)

抓包发现上传采用自定义 API 实现，没有任何限制。但是访问正常图片、txt 文件、html 文件都可以，访问 jsp 时却返回 404：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/s7bObPUU0RTxet89OhmFYmPY3asPCLfic8ibJzOyPADj1o4GuvIdt6peib3JANUbGnibhsqbyn7Hkwts8sojewLh5g/640?wx_fmt=png&from=appmsg)

经过查询可能的原因是：

*   缺少依赖：如`spring-boot-starter-tomcat`和`javax.servlet-api`
    
*   配置错误：`application.properties`或`application.yml`中的 JSP 配置可能不正确
    
*   文件位置不正确：JSP 文件必须放在正确的目录下，通常是`/src/main/webapp/WEB-INF/views/`
    

访问`index.jsp`也返回 404，应该是使用了默认的配置没有解析 jsp。难道煮熟的鸭子就这么飞了？  
俗话说只有不努力的黑客，没有攻不破的系统，继续尝试采用目录穿越上传到其它目录，发现报错信息返回了网站绝对路径，可以看出有 tomcat（其实 Spring Boot 默认内置了 Tomcat Web 容器）。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/s7bObPUU0RRvwcPDcIk0m577p8x6oHbcrY0Jibet1oZo2x2TyL3rwa23xTicgT4P76LiauJlbYWVRl1FAQSgD4p1Q/640?wx_fmt=png&from=appmsg)

根据暴露的网站绝对路径，直接构造 4 个`../`将文件上传到网站根目录下，利用 Tomcat 进行解析 jsp 成功：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/s7bObPUU0RTxet89OhmFYmPY3asPCLficupYp2FS3pL4iceITuB4tMSEN8IGwkr0jxvwXwPk87w8S00hxIj5uk7g/640?wx_fmt=png&from=appmsg)

然后替换为 Webshell 即可拿下目标：  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/s7bObPUU0RTxet89OhmFYmPY3asPCLficb3NibvUDvyLXEDHYhAz8Y7A2d2ujFDe0edMyMgYickQPKXfcQ30IicdQA/640?wx_fmt=png&from=appmsg)

**[** **Excel 导入 Get Shell** **]**
----------------------------------

某次项目中发现用户批量导入功能前端没有校验文件后缀和内容：

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/s7bObPUU0RRvwcPDcIk0m577p8x6oHbcNtDGvunpfUX4qAvRzX25srKb1Owic5OBHzUmzya1akibwtibxj3UiaJ3Dw/640?wx_fmt=jpeg&from=appmsg)

但是提交后会返回 “文件名称不支持”：

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/s7bObPUU0RRvwcPDcIk0m577p8x6oHbc6LuXwx4gic4gYMVYick1lxjFGcHrSx80cdyeqTYvHjttElMhj126M9Eg/640?wx_fmt=jpeg&from=appmsg)

而上传包含`.xls`或`.xlsx`的后缀时返回导入失败：

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/s7bObPUU0RRvwcPDcIk0m577p8x6oHbcfmjIjDHKGzTQTfVVWOSO3icKmWbZxmrWpDKwGXmBOviaITEULR1n8yMg/640?wx_fmt=jpeg&from=appmsg)

这说明后端可能执行了 Excel 文件导入操作。上传名称为`xxx.xls.xxx`的正常模板文件时没有报错，这说明猜想是正确的。

然后构造名称为`xxx.xls.jsp`的 webshell 文件，虽然返回导入失败，但是根据目录扫描发现的`uploads`目录拼接上传的文件名后，返回 200：

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/s7bObPUU0RRvwcPDcIk0m577p8x6oHbcHTvs1t5FniaPuI2RbYWSRlGCkxB7ekCY5OZZFq1ia5SbrHRtKzDcvP0w/640?wx_fmt=jpeg&from=appmsg)

然后成功连接 webshell：

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/s7bObPUU0RRvwcPDcIk0m577p8x6oHbcIIF9Rz09dpGIq1RYnUr4w1yticRUKialwKExPKicIA3zcLwicTUCzJsCnQ/640?wx_fmt=jpeg&from=appmsg)

拿下目标：

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/s7bObPUU0RRvwcPDcIk0m577p8x6oHbcW7u3Op3JtAbASMmvibz888wcap6FXytM1picjt5woDPic1W2HMWGFTrlg/640?wx_fmt=jpeg&from=appmsg)

关于上篇文章，太多师傅在后台私信了，原本开头提了本公众号不提供地址的！但是私信太多太多了，还是回复一下师傅们吧！！！

![](https://mmbiz.qpic.cn/mmbiz_png/ehibzaP4CvW4v5HBUicQ2iaS95fC2u3pQOj5tia8S8xPfdCNaSS4F9kj3YZEODyuV6xrbCibORRmIia9Yialt9efSfxIQ/640?wx_fmt=png&from=appmsg)

这边工具地址是编译后的 jar，并未开源，敏感时期，安全性自测啊！！！有需要建议虚机运行吧（**声明：并未测试，安全性自行负责，与本公众号无关！！！**声明：并未测试，安全性自行负责，与本公众号无关！！！**声明：并未测试，安全性自行负责，与本公众号无关！！！******）

工具地址：https://github.com/DeEpinGh0st/MDUT-Extend-Release