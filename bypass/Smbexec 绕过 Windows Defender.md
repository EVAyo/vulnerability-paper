<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/47GDeYN6X_cgNlwlJA1VPQ)

每日一句经典: 人生就像一杯茶，不会苦一辈子，但总会苦一阵子。

动动您的小手，点点关注您的关注就是我更新的动力噢。

这里字数可能不太够噢，后面可能会凑字数不要介意啦。  

首先使用原生的 Smbexec.py 执行:

```
python3 smbexec.py Administrator@192.168.213.141

```

![](https://mmbiz.qpic.cn/mmbiz_png/ia1z64qxm2mqjAJMBU2Ez3zN80b3BXkvsu8ZWWAluoRlNB2rTVaxnBy6efERorGT0nUYFqpXoZ51a44qRWJ7D5w/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_png/ia1z64qxm2mqjAJMBU2Ez3zN80b3BXkvsIyBkRYs2gSULpmYNRnWn3Hu4bMtHSL6TsiafPLkuacVgGibiaW04Bwaqg/640?wx_fmt=png&from=appmsg)

Smbexec 会尝试将. bat 文件写入到临时目录，然后将它删除。

这里我们将写入. bat 的名称改掉以及它存在一些特征。

改之前：

![](https://mmbiz.qpic.cn/mmbiz_png/ia1z64qxm2mqjAJMBU2Ez3zN80b3BXkvsy6oMUcjUjhq8pDw5crKBUOgzwZbq2H60Fd1Sffa2BfAmFY9TfUHahA/640?wx_fmt=png&from=appmsg)

改之后:

![](https://mmbiz.qpic.cn/mmbiz_png/ia1z64qxm2mqjAJMBU2Ez3zN80b3BXkvswiarwCBSn7K6t17w82B0xH5r4RFkryvmWvPud8Z5uWBKA70frnkvOYg/640?wx_fmt=png&from=appmsg)

我们再次尝试运行:

发现还是不太行。

![](https://mmbiz.qpic.cn/mmbiz_png/ia1z64qxm2mqjAJMBU2Ez3zN80b3BXkvsTWMicxwXmlstviaptd74WTnhIDBo9wZwhcXumfNzHblPExEb3qrgicmGQ/640?wx_fmt=png&from=appmsg)

那就有可能是参数的问题了。

这里来到 RemoteShell 函数。

可以看到这里它调用了系统的变量，我们可以来看一下这个系统变量指的是什么。

![](https://mmbiz.qpic.cn/mmbiz_png/ia1z64qxm2mqjAJMBU2Ez3zN80b3BXkvsYvMQ65Br23nB3wt5F7SFOia6zcicic56HKD6KKT93t4IXwmymCpIVicQOQ/640?wx_fmt=png&from=appmsg)

可以看到它指向的是 C:\windows\system32\cmd.exe

![](https://mmbiz.qpic.cn/mmbiz_png/ia1z64qxm2mqjAJMBU2Ez3zN80b3BXkvsK06UgGNqUm5y9LYIGr7pgk8tEaHm2tBMQdPiaGb2CmmnSCCpgalich0Q/640?wx_fmt=png&from=appmsg)

那么我们是不是可以找到相应的来替换即可？

可以看到这里的指向的是 C:\WINDOWS

![](https://mmbiz.qpic.cn/mmbiz_png/ia1z64qxm2mqjAJMBU2Ez3zN80b3BXkvsib1mQlqY5bIFnvD7icMabW9ESg7J7VuRpGAkTqkDbsn4kdggLic5WJDNw/640?wx_fmt=png&from=appmsg)

那么我们就可以使用 "SystemRoot"\\system32\\cmd.exe

![](https://mmbiz.qpic.cn/mmbiz_png/ia1z64qxm2mqjAJMBU2Ez3zN80b3BXkvsnIKaEfpCL8kG9jPqEQu1MibT11Gicqibypas1fib5ibVic3Mnr48lox8Zu5A/640?wx_fmt=png&from=appmsg)

但是还是会被杀掉。

![](https://mmbiz.qpic.cn/mmbiz_png/ia1z64qxm2mqjAJMBU2Ez3zN80b3BXkvshdfg0MwNrLLphJJAEtib6zY0q1bQQERe0AIpeHflLeEmuj29JMsa1mA/640?wx_fmt=png&from=appmsg)

那么接下来就是参数了。  

那么我们尝试给他参数加一点污染。

可以看到加上逗号是不会影响执行的。

![](https://mmbiz.qpic.cn/mmbiz_png/ia1z64qxm2mqjAJMBU2Ez3zN80b3BXkvsiaWqyMMbCedF1fhmGLeFepYCXgZCDGrL5PLlVwa1L0TqnAeu3m2lLTA/640?wx_fmt=png&from=appmsg)

那么我们给他加上逗号即可。

![](https://mmbiz.qpic.cn/mmbiz_png/ia1z64qxm2mqjAJMBU2Ez3zN80b3BXkvsgqyN3KicZxpRTvoyibMmnpxV02GHqftnrBpC0ZZkOPBVIyYVDJLRja1g/640?wx_fmt=png&from=appmsg)

可以看到成功执行。

![](https://mmbiz.qpic.cn/mmbiz_png/ia1z64qxm2mqjAJMBU2Ez3zN80b3BXkvsh6Ioml760pt9pCPzBUkY4hRYbXzVxxDkicUJvxBT4vdoLOeCDia7DSvQ/640?wx_fmt=png&from=appmsg)

看完了别忘了点关注噢谢谢您啦。