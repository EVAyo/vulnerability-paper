<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/5nhG_sKAJyhI9s0b1Px3Og)

![图片](https://mmbiz.qpic.cn/sz_mmbiz_gif/4136w7o9JvebOMokYU4FmbK3icfoKFGTy417cPFOmN5Px5rgeefP0TYkmu7Yic3OlJRxxavGETGq7OIrFwKicK8mQ/640?wx_fmt=gif&from=appmsg)

点击蓝字 · 关注我们

* * *

> 日期：2024-01-30
> 
> 作者：Corl7
> 
> 介绍：免杀 Fscan 过火绒、3 某 0、Defender。

* * *

0x00 前言
-------

在打攻防时，`Fscan`落地就被杀，于是就萌生了免杀`Fscan`的想法。通过学习了免杀相关知识之后，就开始尝试使用各种方法对`Fscan`进行免杀。

0x01 原生 Fscan
-------------

通过在`Github`下载编译好的`Fscan`，下载的时候就被本地的`Defender`拦截。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/4136w7o9JvebOMokYU4FmbK3icfoKFGTyfmvfddjNxZ3hRzLl6Xic3Chz9dBwPia8XWCb33U9DlQAtUN0VcKoKZMA/640?wx_fmt=png&from=appmsg)

那么`Fscan`为什么下载就直接被拦截了呢，原因就是使用了`UPX`壳，`UPX`壳特征也非常明显，因此已经被各种杀毒软件查杀。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/4136w7o9JvebOMokYU4FmbK3icfoKFGTyqicQ2ugQvps8SrKz1jxSHxCIaKVx7E9aVPoiaD6wVVz8kULUzopkPxvQ/640?wx_fmt=png&from=appmsg)

那知道查杀点是使用`UPX`加壳原因，是不是可以自己下载源码进行编译呢~

![](https://mmbiz.qpic.cn/sz_mmbiz_png/4136w7o9JvebOMokYU4FmbK3icfoKFGTyTaTaWrKDY0JQfVDVib4eHEDwcxNoKCGn4PLq5zdFTjxXUhia6N4ZoKvg/640?wx_fmt=png&from=appmsg)

0x02 自行编译
---------

下载源码，使用命令进行编译，编译完成之后，会生成`mian.exe`。

```
go build -ldflags="-s -w " -trimpath main.go

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/4136w7o9JvebOMokYU4FmbK3icfoKFGTyaODqrmiaqS0pTCMDdukJmuK28tHstPeibjMZ3EZIsHRsppcsgV08Dewg/640?wx_fmt=png&from=appmsg)

对生成的`main.exe`使用`Defender`进行扫描，属实没想到直接就过了`Defender`，只能说`Defender`确实有点拉。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/4136w7o9JvebOMokYU4FmbK3icfoKFGTy53J4uHqJzIskt6cM38ArAqJHK5pLDic1Fw4AyVIsdP02y95YMicWeYBA/640?wx_fmt=png&from=appmsg)

使用`3某0`进行扫描，直接被启发式给查杀了。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/4136w7o9JvebOMokYU4FmbK3icfoKFGTyJJE2ZGabB0yalJibMqoSuTN6Ka71WLhlUF0ELvV0VQQ303u81mb2zLA/640?wx_fmt=png&from=appmsg)

打了签名之后，`3某0`就查杀不出来了。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/4136w7o9JvebOMokYU4FmbK3icfoKFGTyJRVGa7AaCrhmXBQoaespW1Hj70vGnFOH3IFf9aCn6vPdiafUgib7SMdA/640?wx_fmt=png&from=appmsg)

使用火绒进行查杀，火绒直接报`HackTool/Fscan.e`。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/4136w7o9JvebOMokYU4FmbK3icfoKFGTyYib6XfVPcXM8cMjHTkKH5RyW6ZicxZH5LicmtLq8SUvpLwcHHfnuYPRjA/640?wx_fmt=png&from=appmsg)

那么，火绒为什么可以直接查杀出来呢，首先感觉肯定有明文的`fscan`字符串，使用`strings`工具查找一下。

```
strings .\main.exe | findstr "fscan"

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/4136w7o9JvebOMokYU4FmbK3icfoKFGTyA78uib7wpWvs0qRVllAibz7pm7eQcRWjTaAcZ0R8ut4absjicM8iaUO7nQ/640?wx_fmt=png&from=appmsg)

通过查找结果可以发现，`fscan`字符串主要出现在`github.com/shadow1ng/fscan/Plugins/`、`github.com/shadow1ng/fscan/WebScan/`、`github.com/shadow1ng/fscan/common`这三个导入包中，还有一处是出现在`fscan version:`地方。那是不是可以就可以将这三个包，替换成本地导入的方式。

将`fscan`源码拖入到`Sublime`中，并打开`mian.go`，可以看到导入包中存在`github.com/shadow1ng/fscan/Plugins`、`github.com/shadow1ng/fscan/common`。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/4136w7o9JvebOMokYU4FmbK3icfoKFGTyNNRMibBHqFSw2aSVVjkePK8YumQMvibTbVjuE7lJLuoib18CJmVf5Kfqg/640?wx_fmt=png&from=appmsg)

在`Sublime`中进行全局替换，将`github.com/shadow1ng/fscan`替换为`main`，替换为你想替换的任意字符都行。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/4136w7o9JvebOMokYU4FmbK3icfoKFGTyO7mFAc9ZY2MDHF0ek42buYx48H0y32SicIF5VUyRYmBiayfRU3bVbFEQ/640?wx_fmt=png&from=appmsg)

在`common/flag.go`文件中，将`fscan version`替换为`sc version`，这里也是替换为你想替换的字符就行。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/4136w7o9JvebOMokYU4FmbK3icfoKFGTyxIgeSA7aDMNmcFAvFN6iaMOqSNGIkkkUC06pDyfpSIYNicUStJH7A2IA/640?wx_fmt=png&from=appmsg)

接下来，在`GOPATH`下的`src`目录中，新建一个`main`目录。并将`fscan`源码中的`common`、`Plugins`、`WebScan`目录，全部拷贝到新建立的`main`目录中。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/4136w7o9JvebOMokYU4FmbK3icfoKFGTyEicNzkCGKTcviaHuSTZhN6x5lFInroaPQ7FIOVQLNcWap3zibY6yyCDQA/640?wx_fmt=png&from=appmsg)

再使用编译命令进行编译，编译完成之后，再次使用`strings`查找`fscan`字符，可见已经是查找不到了。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/4136w7o9JvebOMokYU4FmbK3icfoKFGTy6wKk65wMTnf4vMzDJ8GRQiaXjZuOx5VU15sBukbFskrPsLb9Wa2dQicA/640?wx_fmt=png&from=appmsg)

将编译完的`main.exe`再次使用火绒进行查杀，属实没想到又被查杀了。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/4136w7o9JvebOMokYU4FmbK3icfoKFGTyMGARVkxFA4sKYZqwjwYEM9DNNWdjMXKstwCcLvpoqjrTf7LawNETEA/640?wx_fmt=png&from=appmsg)

既然使用`go`编译会进行报毒，那么换一种编译工具进行编译，这里使用`garble`对`fscan`进行编译。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/4136w7o9JvebOMokYU4FmbK3icfoKFGTyFmWIKx5sRSpSZgjdMlzNKAvNhiatpnPnficTCicSVGsX1o3ODg2ONrm8A/640?wx_fmt=png&from=appmsg)

编译完成之后，再将`main.exe`使用火绒进行查杀，可见已经是查杀不出来了。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/4136w7o9JvebOMokYU4FmbK3icfoKFGTyuiav8pFrNvlv4Srt1K6vS716xXSZB8CrsfY5B5wa6r5BgJnX7nkLgDw/640?wx_fmt=png&from=appmsg)

0x03 总结
-------

通过实践发现，直接对源码进行编译，编译完成之后，即可过`Defender`，打了签名之后，即可过`3某0`，使用`garble`编译之后，即可过火绒。虽然说简单修改之后，可以过`Defender`、`3某0`、火绒，但是仍然过不了卡巴斯基，只能说可以满足日常扫描的需求。还有另外一个较大缺点，那就是体积较大，编译完成之后`24M`左右。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/4136w7o9JvebOMokYU4FmbK3icfoKFGTyW0jMHvCSxJE51MvfDREtkMeHZykd7fqZMfvlQnK5ZDibI4oYickGj2RQ/640?wx_fmt=png&from=appmsg)

**免责声明：本文仅供安全研究与讨论之用，严禁用于非法用途，违者后果自负。**

点此亲启

**ABOUT US**

**宸极实验室**隶属山东九州信泰信息科技股份有限公司，致力于网络安全对抗技术研究，是山东省发改委认定的 “网络安全对抗关键技术山东省工程实验室”。团队成员专注于 Web 安全、移动安全、红蓝对抗等领域，善于利用黑客视角发现和解决网络安全问题。

团队自成立以来，圆满完成了多次国家级、省部级重要网络安全保障和攻防演习活动，并积极参加各类网络安全竞赛，屡获殊荣。

对信息安全感兴趣的小伙伴欢迎加入宸极实验室，关注公众号，回复『招聘』，获取联系方式。

![图片](https://mmbiz.qpic.cn/mmbiz_svg/YCOL3hU8ffUqCzyREqVSq3AFOuib0FwZVRlWXWOXsYozHV0XiaYJVGoTian40eVZcGbhUIs9Vltp8YCicncMWEVm9XUSIP0Bj3cA/640?wx_fmt=svg)