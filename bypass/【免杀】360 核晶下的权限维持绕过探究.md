<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/2e6_1I2_BU4vq2vr5yKyIA)

【声明】本文所涉及的技术、思路和工具仅用于安全测试和防御研究，切勿将其用于非法入侵或攻击他人系统以及盈利等目的，一切后果由操作者自行承担！

想第一时间看到我们的大图推送吗？赶紧把我们设为星标吧！这样您就不会错过任何精彩内容啦！感谢您的支持！🌟

![](https://mmbiz.qpic.cn/mmbiz_png/bL2iaicTYdZn7E7yf0iarPkibGAoXFz81PKty5ENNZxChgkibTrrzGgiaKzyFF9V4g5u0fBaeGk4NHFGP40Rsh5uhfRQ/640?wx_fmt=png&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1&tp=wxpic)

****前言****

  

360 核晶作为一款杀毒软件，无疑拥有相当的强大实力。与国外许多强大的杀毒软件类似，它也有自己擅长的领域。不同于卡巴斯基的内存扫描，核晶的强项在于其行为检测能力。一旦发现程序试图利用注册表、计划任务或其他提权注入操作，它都能及时发出警报。这种基于应用程序行为的检测方式非常难以绕过。

![](https://mmbiz.qpic.cn/mmbiz_png/8icD66YlDDibKNmEK88k19IhEKqUZz2qib689hjFO7AvUXhSscsy7ne75zI5PY0QG7oFBdBmqM8g89j4XWwNavfUA/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_png/8icD66YlDDibKNmEK88k19IhEKqUZz2qib6niaaRut5g7a4Fk08QibDa3Ia97MevibBbB6YvWNcOQGIhqIIKvGa4dAfg/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_png/bL2iaicTYdZn7E7yf0iarPkibGAoXFz81PKty5ENNZxChgkibTrrzGgiaKzyFF9V4g5u0fBaeGk4NHFGP40Rsh5uhfRQ/640?wx_fmt=png&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1&tp=wxpic)

****绕核晶初试****

![](https://mmbiz.qpic.cn/mmbiz_gif/1WyXJ9AxlFHHIb1T8E4S0ONsKBnUwbkicxhCBIHyza4xEKJmBBFcjfMwY2bEXYO24q0l5Cy5iasAmMCk8f2ljKwQ/640?wx_fmt=gif&from=appmsg&wxfrom=13&tp=wxpic)

*   **BOF**
    

以前的核晶它对于注册表与计划任务的监管主要是基于 CMD 窗口，当时绕过核晶可以简单地采用 Windows API 操作注册表，实现对核晶的绕过。

但现如今的核晶显然不能简单地利用 Windows API 进行绕过，甚至于许多 BOF 都无法实现绕过。（这里指的是我自己找的一些较老的 BOF，如果是自主开发 BOF 或者一些新 BOF 则不一定)

*   **伪造 PEB**
    

这时候就引出一个思考，核晶的行为检测是基于什么原理呢？它是在哪一进行的行为检测？R3？还是 R0？

于是我尝试过伪造 PEB 的方式来伪造自己的权限，想利用伪造的高权限尝试对核晶的行为检测进行绕过，但也依旧失败了。（有可能是笔者实力不到位，并未深入到内核层。）

*   **利用白加黑**
    

既然之前的思路都不行，那么使用白加黑可以吧？众所周知，行为检测的手段有利有弊。好处就是行为检测很难规避，除非是基于内核层直接对硬件进行操控。但问题是核晶环境下又不允许加载未知的驱动，想要对内核动手我目前能想到的方法就只能利用漏洞。

行为检测的坏处也很明显，那就是容易误报。需要利用注册表或者计划任务实现自启动的程序有很多，大部分程序都并非是木马程序，因此就需要设置白名单，避免出现大量告警，所以利用白名单很显然能够成为绕过核晶的手段。

但很不巧，简单地利用 DLL 中导出函数上线依旧被核晶拦截，并且报出了恶意的黑 DLL。

![](https://mmbiz.qpic.cn/mmbiz_png/bL2iaicTYdZn7E7yf0iarPkibGAoXFz81PKty5ENNZxChgkibTrrzGgiaKzyFF9V4g5u0fBaeGk4NHFGP40Rsh5uhfRQ/640?wx_fmt=png&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1&tp=wxpic)

****突破核晶维权技术****

![](https://mmbiz.qpic.cn/mmbiz_gif/1WyXJ9AxlFHHIb1T8E4S0ONsKBnUwbkicxhCBIHyza4xEKJmBBFcjfMwY2bEXYO24q0l5Cy5iasAmMCk8f2ljKwQ/640?wx_fmt=gif&from=appmsg&wxfrom=13&tp=wxpic)

*   **DLL 侧加载**
    

利用 DLL 侧加载实现白加黑能够对我们的黑 DLL 有更好的隐藏效果，使用 DLL 侧加载实现的白加黑上线成功避免黑 DLL 被识别并成功实现注册表维权。

*   **核晶致盲**
    

核晶致盲问题是应对核晶的老办法了，所谓的核晶致盲就是利用核晶兼容性差这一点，启动会对核晶虚拟化技术产生冲突的程序，实现致盲核晶。

网上爆出能实现核晶致盲的程序有不少，包括但不限于 LOL，雷电模拟器等。在上线的同时启动能致盲核晶的程序，依旧能实现核晶下维权。

![](https://mmbiz.qpic.cn/mmbiz_png/bL2iaicTYdZn7E7yf0iarPkibGAoXFz81PKty5ENNZxChgkibTrrzGgiaKzyFF9V4g5u0fBaeGk4NHFGP40Rsh5uhfRQ/640?wx_fmt=png&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1&tp=wxpic)

**效果展示**

![](https://mmbiz.qpic.cn/mmbiz_gif/1WyXJ9AxlFHHIb1T8E4S0ONsKBnUwbkicxhCBIHyza4xEKJmBBFcjfMwY2bEXYO24q0l5Cy5iasAmMCk8f2ljKwQ/640?wx_fmt=gif&from=appmsg&wxfrom=13&tp=wxpic)

CS 维权回显：

![](https://mmbiz.qpic.cn/mmbiz_png/8icD66YlDDibKNmEK88k19IhEKqUZz2qib6kUibZpZ9rCBNZw5ZzCpAuZw1EzbkdBrwzjPbsGag1QcPU4ibuL6WibS2Q/640?wx_fmt=png&from=appmsg)

核晶下添加的注册表项：

![](https://mmbiz.qpic.cn/mmbiz_png/8icD66YlDDibKNmEK88k19IhEKqUZz2qib6bsrwqV5TOicOub2cHWwRiamSY1RafHM6LahcYOqwI1bDkN6rHWqw0O6Q/640?wx_fmt=png&from=appmsg)

**如果您对免杀对抗感兴趣，想要深入探讨、交流并学习更多相关内容，欢迎各位师傅加入官方技术交流群!!!（关注公众号，回复【加群】，添加管理员微信，拉您进群）**

**同时，也欢迎加入知识星球，我们会不定期分享学习资料，**

![](https://mmbiz.qpic.cn/mmbiz_jpg/8icD66YlDDibIHkcMHGiaeop9s6Y2JXh2YV36WWQ53ahhTmKGaw3QfJgf3U6ywhEuQlXJJYPgYgl0DicLibz5uzianCA/640?wx_fmt=jpeg&from=appmsg&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1)

**除了学习资料分享，我们提供网安证书报考特惠渠道以及最新的免杀课程！详细信息，请扫描下方二维码进行咨询。**

**证书报考咨询：**

![](https://mmbiz.qpic.cn/sz_mmbiz_png/ybfuP4rl0R3DLZpAC8rL1xRxam3iajeuBWwkPQMTxt9EIUWk5Z1atbnYV2PvaRibHExvozRKTEteqTiahWtBBB51g/640?wx_fmt=other&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1&tp=webp)

**免杀课程咨询：**

![](https://mmbiz.qpic.cn/sz_mmbiz_png/ybfuP4rl0R3DLZpAC8rL1xRxam3iajeuB2UWtYAHWLZs7JIKsdYzjUx5GE8WULhwwaibibOkSj1hRJvdoTuyAliaYw/640?wx_fmt=other&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1&tp=webp)

**点击下****方名片进入公众号，欢迎关注！**  

**喜欢我们的文章的话，别忘了给我们点个赞哦！感谢您的支持👍**