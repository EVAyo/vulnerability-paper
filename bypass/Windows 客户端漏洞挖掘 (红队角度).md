<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/OWq-KWz2h6VNbtaxn9ZyMw)

**0x01 前言**
-----------

周五的时候看了 key 佬的演讲受益良多呀，来水水，写下目前针对 Windows 客户端类程序的部分挖掘入口吧，然后分享一下随手挖的很简单很简单的案例。

传统客户端  

监听类的:

这里说的监听类的，指的就是安装客户端后启动的端口服务，这个思路 WEB、设备类的 0Click 几乎都是这样，Windows 客户端这块看具体业务了也可能有，比如历史上某远控软件 RCE、某 VPN RCE。走的 HTTP 逆起来还是比较简单的，前阵子搞金融的私有协议的可难玩一些，不过还好最后交差了。

非监听类的

第一种:

虽然这种没有对外监听，但是有命令行或者图形化操作的功能，这种可以针对其程序功能挖掘，思路要打开，用来 1Click 或者提权等，举个简单的应用，比如某些程序安装之后是以 System 运行的，此时如果存在 RCE 或加载 DLL 的相关操作都是可以用来本地提权的，还有就是有些白签名程序，存在直接 RCE 或加载 DLL 都有绕过如某卫士、某擎信任链检测的效果。

第二种:

伪协议很多客户端其实都有伪协议，可以分析其功能来决定如何利用。案例的话比如钉钉的这个漏洞 POC，通过伪协议可以加载 JS 配合 Chromium V8 漏洞来达到 1 Click RCE 的效果。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8OCDvYCI13rgYLYxJo5kiczWljGA2u4ap26OXmEToaa824U1sWyxLWicXcgz45tOjM33hKTkPnpqjDA/640?wx_fmt=png&from=appmsg)

WEB 类客户端：

比较主流的应该是这三个 CEF、QtWebEngine、Electron 都是基于 Chromium 引擎可以尝试 Chromium 漏洞，其中 Electron 还基于 NodeJs，因为 NodeJs 的特性导致可以轻松 RCE，其他两个应该是不行。

所以对于这种第一个是 XSS 配合 NodeJs 语法，比如蚁剑与 Clash 出现过的 1 Click RCE 都是功能点 XSS 搭配 NodeJs 来 RCE。

有些情况下 NodeIntegration 为 False 不能直接使用 NodeJs 原生语法 RCE，这个时候如果  
ContextIsolation 为 False(默认就是 False)，就可以寻找 Preload.js 中的自定义 API 来寻找漏洞点。

参考如下解释。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8OCDvYCI13rgYLYxJo5kiczWUKicUkYqLYzGq4gFPOjz25UNPIhYGoqbCOnerAoXicq7C6Pu78BDe4dg/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8OCDvYCI13rgYLYxJo5kiczWrUx0zpved2LrpY3yPzeMF88hyBFClfqW1Gv6pIcFHTg6XpPW4hIcqg/640?wx_fmt=png&from=appmsg)

第二个还是伪链接，跟传统客户端不同的是，如果找一个可以加载 JS 的伪链接，就可以配合上面提到的 NodeJs 特性或者 Preload.js。

这次还看到 key 佬分享了一个使用 WKE 自定义前端渲染的漏洞案例，首先找到了一个可以加载任意 JS 的伪链接，然后寻找 WkeJSbindFunction 来看 JS 语法与本地函数的绑定情况，围绕这块去找 Sink 点。

下面来看一下前天随手挖的两个案例吧。

**0x02 漏洞分析与利用** 
-----------------

第一个：  

发现安装某软件被控端之后开启两个服务。  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8OCDvYCI13rgYLYxJo5kiczWEq9c2mnm1WRE4yxUaIoiayRHs8mibnAibVIrvQq6CgKZUyVY2JbOORHxg/640?wx_fmt=png&from=appmsg)

OSPLinkProxy 服务对应 LinkProxy.exe。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8OCDvYCI13rgYLYxJo5kiczW8Qu8CLR21RKP9lAC7xL0iaeUicrSML4icxhZhtWJ6qJ75ke9ab1glI7uA/640?wx_fmt=png&from=appmsg)

访问对应对应服务端口 33580。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8OCDvYCI13rgYLYxJo5kiczWvGf00VjBvziaISUX8yqf6GwhHAzzLhiaHzh02TicyDlwdgp9z3wJ3VibXA/640?wx_fmt=png&from=appmsg)

发现一个路由。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8OCDvYCI13rgYLYxJo5kiczWelbONtaQ2mMZhCL4tGBgHQSLbyVjzGtNkSyJQqLHHLNtJ6LGhlghnQ/640?wx_fmt=png&from=appmsg)

接收名为 "param" 的参数。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8OCDvYCI13rgYLYxJo5kiczWREP3crQV5RwxicgV94RRqrElLMhicMdVy4y3XA4hoOmZgGib9UlBvRFnA/640?wx_fmt=png&from=appmsg)

对接收的参数内容进行了一次默认码表的 Base64 解密。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8OCDvYCI13rgYLYxJo5kiczWGicWztDia0MaLnoFeqDuqky4cjqicCM7w5iaUywHGnnL5OZaZtFibviceAmQ/640?wx_fmt=png&from=appmsg)

调用 CreateProcessAsUserA 传递 "OpenLinkProxy.exe ShellExecute" 拼接 param 解密后的内容。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8OCDvYCI13rgYLYxJo5kiczWqSP6yicSnOGdJfLvSWxFTUy4LEP4y7c2rZMeXonqwCq7QDeZpeQHUGg/640?wx_fmt=png&from=appmsg)

逆向 OpenLinkProxy 发现最终调用 ShellExecute 且可传递执行的文件与参数。  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8OCDvYCI13rgYLYxJo5kiczWDcNf8qStuKv4JJjMoTNqicvrUviaNbT6dHGqSuJdQZjdOu5KMibs3kbtw/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8OCDvYCI13rgYLYxJo5kiczWmP9eD9rsfQxb1Z0MmxDwU19HYy4QmwgxXD7csuZH1sOxzziaHkuxlhw/640?wx_fmt=png&from=appmsg)

测试可以执行。这种也可以单独利用，上面提到过。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8OCDvYCI13rgYLYxJo5kiczW3xOGufHuvmfYB6LMLJoiagFlZZpHuWZiaGvtWl5JpMic6OQStBLfic1icEw/640?wx_fmt=png&from=appmsg)

IPC 调用成功。  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8OCDvYCI13rgYLYxJo5kiczWmt506AdhZNRDZYicVDicgcKXD7icQViaEIAzZYDVichurvILK5W6a9Zf2Gw/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8O8PJhoK0sAzYzDlqjwGmnGCwqy3HXic3DXQHIJD2hOia4PKsMquibgFtc7uxiaXG6zjw0qBcWTj8G8Kg/640?wx_fmt=png&from=appmsg)

第二个：

不过多解释了，很简单 LoadLibrary 可控，GetProcAddress 无参调用。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8O8PJhoK0sAzYzDlqjwGmnGdp6V6fuOXGvs2ZvbbjFmumaIuZj5JU69yoeF5pBzibZxtEJBoPt0gmQ/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8O8PJhoK0sAzYzDlqjwGmnGicR8akAAcc3IsyfOWiaeWxuB2aQZn69Ry33mib0RSOgziaZ0Xonicib2ucxg/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8O8PJhoK0sAzYzDlqjwGmnG68blL3raTJx6bQILwGSDNTzJrhS3X886FkD0rD9qiaWnia5cj4DPvuCg/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8O8PJhoK0sAzYzDlqjwGmnG444N5gibRTBsF4G5zU57xWzxgntkdrDQuicbHplPU5ffsmdLK1rsT79g/640?wx_fmt=png&from=appmsg)

签名程序且高权限。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8O8PJhoK0sAzYzDlqjwGmnG0k8XO5CqbZ8JmauHUbOEp99d8xGr1ftc2y4BnUSHXP1hHWyWXjz6gQ/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zZrDr2DM8O8PJhoK0sAzYzDlqjwGmnGNvgfIJdOA9pcXL1aDGdF89BsyFicc3AEYwGDPNa9PB7LAZt5VClIibPw/640?wx_fmt=png&from=appmsg)

**0x03 小密圈‍‍‍‍‍‍‍‍**
--------------------

最后送你一张优惠券，欢迎加入小密圈，好朋友。  

-------------------------

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/9zZrDr2DM8Pv0Vz6Q9ibXrmgqicwlYpQqTTEPbwBI3r3APQKhibcpqoVjFt5F2TNIAn9te78HhoD7G2ibpBozD0CEg/640?wx_fmt=jpeg&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1)  

--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------