<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/STK9QvMUsZ6F4xivwB12cw)

环境介绍
----

在进行某次地市攻防时，webshell 上传上去无法连接，但页面存在。普通的 webshell 上传上去会被杀掉。通过上传打入内存马成功连接 webshell。

使用工具
----

一款支持高度自定义的 Java 内存马生成工具 -----Java Memshell Generator

工具地址：https://github.com/pen4uin/java-memshell-generator/

![](https://mmbiz.qpic.cn/mmbiz_png/ngAMNZdJSs128hg6r3YANaMMicelDxbdQOu0iaKxXw0pIPLWvMrjOuYt6icjKbfdLvbNXgmiaJFm5KEicHDmrQfgEYQ/640?wx_fmt=png&from=appmsg)

实战操作
----

漏洞是 JeeSpringCloud uploadFile.jsp 文件上传漏洞

正常上传，是可以上传的，但木马会被杀掉

![](https://mmbiz.qpic.cn/mmbiz_png/ngAMNZdJSs128hg6r3YANaMMicelDxbdQxRRGniaUSoiaNBLfIYLSR6VLhKcmIdb9PsaSxH3KaLONWzsmlHquCHGw/640?wx_fmt=png&from=appmsg)

通过工具生成内存马

![](https://mmbiz.qpic.cn/mmbiz_png/ngAMNZdJSs128hg6r3YANaMMicelDxbdQvEwia3O19cuvVOcqmQfWV4eu10icD57Lgb8wXE4rqVFCOjRe6RoIeJvQ/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_png/ngAMNZdJSs128hg6r3YANaMMicelDxbdQPf3zdymyRRoVGQyZtSlWMyvqibM2UxbFV6BgSERfg5pN2K2thOb9slQ/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_png/ngAMNZdJSs128hg6r3YANaMMicelDxbdQ2Ny3rNJIqTMVNjuTnibddASI6j6CrLib3VjrTSqH2j2GXfuAUR2ib4UCw/640?wx_fmt=png&from=appmsg)

把生成的 jsp 放到上传处进行上传

![](https://mmbiz.qpic.cn/mmbiz_png/ngAMNZdJSs128hg6r3YANaMMicelDxbdQ8Ghybic8iajKflvVAH8gB1vgvMicMJBzYjpdicSGibmrSsQohkYXraOwdMw/640?wx_fmt=png&from=appmsg)

进行访问，这时候就已经打入了内存马

![](https://mmbiz.qpic.cn/mmbiz_png/ngAMNZdJSs128hg6r3YANaMMicelDxbdQibA0FSic0BocmUpX8rDDe8cozicTFVOhqhzYp0gfric3AV1AIX9NUlIHag/640?wx_fmt=png&from=appmsg)

根据工具的信息进行连接，这里进行冰蝎连接，路径随意，记得添加头部信息

![](https://mmbiz.qpic.cn/mmbiz_png/ngAMNZdJSs128hg6r3YANaMMicelDxbdQnuOHblupcowBjnPxibWUCeBKR2NxjVylwmHcwVNzFhVibaia3sZ30mv9w/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_png/ngAMNZdJSs128hg6r3YANaMMicelDxbdQt57wDQI5vkib431arEQhlxFkjrQ3eqic6iaGeeCMLXSFWLSdT9h3qGebg/640?wx_fmt=png&from=appmsg)