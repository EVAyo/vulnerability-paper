<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/sYAtDB1wWwb2KoT2ZAvArQ)

![](https://mmbiz.qpic.cn/mmbiz_jpg/WGegAIkTRic8ua5rjd1e0eXeJO6jbND0QEI4gyB4DXvBTXr7gwU84INRYSWfhcUtELNog3rmQQEIsyAYISFVCag/640?wx_fmt=jpeg)

本期作者 / 0xc4se

**背景**

WiFi Pineapple（大菠萝）是由国外无线安全审计公司 Hak5 开发并售卖的一款无线安全测试神器。集合了一些功能强大的模块，基本可以还原钓鱼攻击的全过程。在学习无线安全时也是一个不错的工具，本文主要讲 WiFi Pineapple 基础配置和 Evil Portal(恶意门户) 和 HTTPeek(绵羊墙) 模块实现的俩种攻击方式。

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738WBE9iawAg4tX11rAIm5Tz7fjDnKPUtrGFOg0sUcU8En5aXvJf2icJybw/640?wx_fmt=jpeg)

**环境搭建**

WiFi Pineapple 连接电源后，等待机器开机后，蓝灯开始闪烁，会生成一个 Pineapple_xxxx 的 WiFi AP，我们使用 pc 连接 wifi 后访问 http://172.16.42.1:1471 进行系统设置。通过长按 4s WiFi Pineapple 的重置按钮来进行下一步。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738HTYzBY2hAIUHcUvFvIeiaQUJNPp6dRqRiaW6KpUJCDCqJtVcogiaMhE5g/640?wx_fmt=png)

这里可以选择联网和本地上传刷写固件俩种方式。这里我选择本地上传文件上传方式刷固件。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738nGibZcjrelIiaC4KNZ8wQK4FSDOXYEotBg8vDsAs1rB71ks7Geibp72Rw/640?wx_fmt=png)

固件下载地址为 "https://downloads.hak5.org/pineapple/mk7", 下载完成后进行上传并进行下一步。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738xcc4GubQEByzuviaaiaMt65f4BqUZORXcvtJ9pngMYHFp0r05dMTcDJw/640?wx_fmt=png)

等待验证完成，开始刷写固件，此时设备的 led 灯开始红色和蓝色闪烁后，闪烁停止后，设备将重新启动。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738BBldCIGHaBAPicfQQfsJ3bwvVIHoTE1Crhre1Ua0mP9pkKZRZyNia0Kg/640?wx_fmt=png)

等待 led 灯停止闪烁后，我们重新连接 Pineapple_xxxx 的 WiFi AP，并重新访问 http://172.16.42.1:1471，点击 begin setup 开始设置系统。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738cxKmjALMK2oicGkcLTHEgXyuxNLsYMibCn1MVS0GUYgDZXoR9v83vlnQ/640?wx_fmt=png)

按照消息提示按下重置按钮 4 秒钟，就可以进行下一步操作。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t73876xgG6V5XjSnHN7Aquic8UdmVVL3LISAvcKzLFpQb09YEdsjqe11XHw/640?wx_fmt=png)

这里设置 Management AP 和 Open AP，Management AP 作为我们管理 wifi pineapple 的管理 ap，而 open ap 是开放给其他人的。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738sdIHRO30E1QJZfUYtbmYcd2WM0Zvx71icYia14KbEhuuyibIic60OzOEqA/640?wx_fmt=png)

这里可以指定筛选客户端，这里可以在 “Allow List” 和“Deny List”之间进行选择。Allow List 中添加允许的客户端后，才可进行访问。选择 Deny List 则默认全部可访问，在 list 中添加拒绝的客户端可拒绝其访问。选择 Allow List 更加安全，但是这里我选择 Deny List。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738uzBOwHCD9vJYpibequFibpWNx1Sicic6NdaL9TDJqXZKKGFjp7FynSgsWg/640?wx_fmt=png)

在这里我们可以指定 SSID 以允许或拒绝连接我们的 wifipineapple，这里我默认选择 Deny List。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738ibiaDdlHicibZpZ1ibl7rnTogqA56XtxiaIjHU6Wfc5tx1anGgMcmVXabS1g/640?wx_fmt=png)

后面一路 continue 就行，设置完成后，我们重新访问 http://172.16.42.1:1471 来进行登录，并使用我们设置的密码即可进行登录。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738bzrTKSwRcT33ibBTcgibKrxNWribCHt4fcxribWQyCHhXvmUmxxDV8osDQ/640?wx_fmt=png)

登录后，此时 Wifi Pineapple 还不能连接网络，这里弹窗让我们选择联网方式。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738x9x9e3xg4uSsNSbfMnhicB5fdfolJIsNz6meFON9of2y4ia6uFENtrsA/640?wx_fmt=png)

我们可以使用 usb 转网口拓展坞插入 wifi pineapple 来连接网线，也可以选择连接可上网 wifi。在 Networking 选项中点击 scan 可扫描出附近 wifi，选择相应的 SSID，并输入密码后连接 wifi。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738icozZ1YLuSPzbcqowoZk7OdG8b4Z5QF6WR0XCwCMfx2nbcIMg9x8ySw/640?wx_fmt=png)

此时基础配置已经完成了。

总结一下上面的内容，目前 WiFi Pineapple 生成了 Management AP 和 Open AP，我们的 PC 机连接 Management AP 从 web 界面管理 wifi pineapple，而 Open AP 开放给所有人使用。但是此时 Management AP 和 Open AP 都无法正常访问外网，我们需要在 PineAP 菜单栏中开启 "Impersonate all networks" 按钮 (如果你不像俩个 AP 联网，可选择不开启该功能)。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738Wx9OVK0NGQ4J8byfkXlyv2usbDvB6NdDpEkUlk5PSvicwiciarz6bPrYw/640?wx_fmt=png)

点击菜单栏中的 Modules，在 Modules 选项中选择想要安装的模块进行安装。这里我直接将所有模块进行安装添加到 wifi pineapple。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738549u4zic6m0FPCpP57A5rKQh5BMw3Av7D9OjapBXM0cKBI3Qt1KCdBw/640?wx_fmt=png)

**WiFi Pineapple 功能介绍**

WiFi Pineapple web 界面中共有 Dashboard、Campains、PineAP、Recon、Logging、Modules 以及 Setting 几个菜单。

Dashboard：首页仪表盘，有运行时间， CPU 使用率， 客户端连接数，通知通告，登陆页面浏览器统计等信息。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738JSHX4BDO8XQnJIQszy0D1GMD3yohUTU2ChNm46UYKAF5keDH1bYc7w/640?wx_fmt=png)

Campains：活动，已创建的广告活动显示在该页面，其中显示了当前状态、名称、创建日期和广告系列类型。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738lPTYarMGPPWOytoSPibGzJoQHe9dnrGicPQcFmleSthribT4lL6YIEJVw/640?wx_fmt=png)

Pin AP：AP 套件，可设置 WiFi Pineapple 的流氓接入点。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738ZoschRsKj36JeicvuXZv1px6LupdohHl2mLKGOCR4JrZvxGZUibJnuDA/640?wx_fmt=png)

Recon：侦查， 用于侦查附近的 wifi 状态信息等。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738oBGzzHShLxRQtDPypFZzM6oJ7nLIkF3YibKpWkx9fvvibBEriaCYAZz0g/640?wx_fmt=png)

Logging：收集的 WPA 握手会显示在这里。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t7389wR4hQibMgy556AMchXm3cLln8kqJ5QaIFibyuhAcCEhmPqK3r3acBVA/640?wx_fmt=png)

Setting：setting 页面允许修改 WiFi pineapple 的各个方面、检查更新和自定义用户界面。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738U7coWCUpCDtOtdiaHA7G81ZUuXvRZInuiaqGZzon5ULgvhphwAVSDlOQ/640?wx_fmt=png)

**模块使用**

这里就不讲基础功能的使用了，环境搭建一遍下来，差不多的功能都已经使用过了，所以这里我们直接开始模块使用练习。

**HTTPeek（绵羊墙）**

HTTPeek 显示连接到 Wifi 菠萝的客户端以明文形式发送的所有图像、URL、cookie 和数据。

我们的手机连接到 wifi pineapple 的 Open AP 后。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738ukocoSZZXDf7Ua3elPib46XesBcQ4f5g4tnxJOGupiamoDQJNQWVI0YA/640?wx_fmt=png)

我们进入 HTTPeek 模块

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738NMZIuWoPqibQC3FxhFGhKKHNMKBicmQib0cklibM4OovPve7GPr113hmQw/640?wx_fmt=png)

点击 Enable 开启模块，点击 Start Listening 开始监听，手机所有连到 Pineapple 客户端的 http 连接都会被抓到

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t73863DlfX4rhFGAw2jBgKGw5mgvCt8NuCN1PcuEPewsBXldeBL2blFdqA/640?wx_fmt=png)

当手机访问了某个后，HTTPeek 页面将会显示客户端访问数据的 URL、Cookies、数据内容，以及图片

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738jt3NXN5VmfzgUIfYZkNCBKD7VmFwvf0wOTylRs9cSAaTNsmhl9eTlQ/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738n17iarZOIeFdwhXve6cDN801kWjNpicVLa1AQDg77T6jJYbjbhbGo33g/640?wx_fmt=png)

**Evil Portal（恶意门户）**

点击 Modules 模块可以看到已安装的所有模块，点击进入 Evil Portal 模块。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738vh0wz3CCnIedHzeHlzleGoOSegVJRuwxtn2qpib7orIuUgvQwicYLOMg/640?wx_fmt=png)

我们点击 "New Portal" 新建一个 portal，名字这里我命名为 "badBaidu"。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738TXY3Osdmkyc5u9zQ1FgSJZV3UfMMpdrKXq77GgEjaOR1zrdI8GFV9A/640?wx_fmt=png)

点击 start 会同时开启 web server，此时我们点击 badBaidu 的 preview 按钮，即可查看效果。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738rV8saQmA34BFpFHRyJSQmUlebqNak0FyJZuJXxpEcVYLbWbqyu1OdQ/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738DnP2nCpsRZrs7MkkVs6woQ33EVpgNWHpHuibJFAfB0XTsibVibjUWUCrA/640?wx_fmt=png)

此时我们的手机连接 wifi pineapple 的 Open AP。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738MFn6755pibZ5VPLZejmsuictUvsXuWd2EmpA0hVQfUOx7jcghzjwvlMg/640?wx_fmt=png)

手机打开浏览器就会跳转到我们设置的 badBaidu 界面。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738D1bXYLoooPrjn5eVjenRa2uDVEhQbKbrHjBOFMuyJmadYtr3COHKcQ/640?wx_fmt=png)

我们将手机连接的 mac 地址加入 Evil Portal 模块的 Permanent Clients 和 Allowed Clients 列表中。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738Bp6hVOGNBcHlUelpHn7qxiaMyvvHLkBbkiacKersbWGvXz2ibmZSBCSrg/640?wx_fmt=png)

如果我们想要实现 DNS 劫持，此时我们打开 DNSspoof 模块，可以将 bbaidu.com 域名解析 ip 设置为 172.16.42.1。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738MSQcKznvsF4HThlhdv0s30dJAXLYYvwSl3DCzJ5xEl2RQqEeMcugcA/640?wx_fmt=png)

手机浏览器访问 http://bbaidu.com 就会解析到我们设置的 portal 页面。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738uXtbGkdt97duhwpXrlTQRaOBicpdaGI8hLkLPESSZUo4odTOPqsxbgQ/640?wx_fmt=png)

  

但是这样的界面太过于简陋，如果想要实现攻击效果，我们就需要更加逼真的页面。在 github 中已经有 repo(https://github.com/SgtFoose/Evil-Portals) 实现一些大家经常访问的页面，如 google 登录、星巴克登录和 facebook 登录界面等等。我们想要将里面的 portal 加入我们的 wifi pineapple，可以通过 ssh 进行文件传输。

首先点击右上角的 cmd 按钮，就会进入 wifi pineapple 的终端，可以看到我们生成的 Badbaidu 生成在 / root/portals 目录下。将 repo 下载到本地，并使用 ssh 进入传输。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t7385cKvjh5lbEdF9n5gJicyGVE5mchJkAphibICQiaIaicOcibJiaxmkocb2iaTA/640?wx_fmt=png)

此时 wifi pineapple 文件系统 "/root/portals" 目录下内容为：

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t7388NazPaAP60fwicZACvYmSAoiaAbicGSK9zr2JbzUzaXMMVqibU5ZWribrvw/640?wx_fmt=png)

刷新界面后就会发现 Evil Portal 模块中 Library 添加了我们传输的 portal。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738PNuVhOnJbcc0fYiatuq9l9oicIrc17ga3PWgCSVJsanQ1uGBeZgRnxzA/640?wx_fmt=png)

点击 Deactive 使 Badbaidu portal 不生效后，再开启星巴克登录后，预览效果如下：

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738g0RE1ve2jNlPX9icNk9fkyd6jsvPSuPlibMZhSr1k6xDXNH3zIC9wjrQ/640?wx_fmt=png)

手机打开浏览器后就会跳转到星巴克登录界面，如果此时有人输入了自己的 email 和 password 就会被后台抓到。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t738Vp5CtqVMLzknAX2SsnPbJBlFPLdWV7lZqMGBCJzmEPIAiaFibS8uh8uw/640?wx_fmt=png)

点击 view log 即可查看登录用户的设备 mac 以及 email 和 password 信息。

![图片](https://mmbiz.qpic.cn/mmbiz_png/WGegAIkTRicicI0Q0Q0brZ4IiaRibU52t7381pzJqYr68qCMHiaKbvKX2sUoVC8y8cIksFSib1MaibWu1RncxWRQegFPg/640?wx_fmt=png)

除了本小节中提到的 3 种攻击方式，wifi pineapple 还可实现其他方式的攻击，如：伪造 AP、客户端取消身份验证以及泛洪攻击等等。如果大家感兴趣可以自己亲自去搞一下，这里就不再演示。

**总结**

本小节简单介绍了 WiFi Pineapple 的环境搭建、功能介绍以及绵羊墙、恶意门户俩种攻击方式，除了以上俩种攻击方式，大家可以拓展思路配合其他组件形成多组合攻击。

注：大家在研究和学习 WiFi Pineapple 一定要遵守法律规范，以免给自己造成麻烦。

![](https://mmbiz.qpic.cn/mmbiz_jpg/WGegAIkTRic8ua5rjd1e0eXeJO6jbND0QYickqdy8BmJibf8xicSXEloHM1YiaSDibTkxwwHvDfxwoB2fklz4EL8bOEw/640?wx_fmt=jpeg)