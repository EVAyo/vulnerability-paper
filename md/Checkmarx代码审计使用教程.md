<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/_o6jKc9S6-CVo4IrWuyFhQ)

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450ATcz6jUJnFNeOxRzVZ9LbcCCMJ6Af2WYicgMPA32IwibF8mI2ibC9h8jaHkhxnZzZuqctMLRTxDudicA/640?wx_fmt=png)

 **Part1 前言** 
--------------

Checkmarx 是以色列研发的一款代码审计工具，是. NET 开发的，只能在 Windows 下使用。很多人喜欢把它和 fortify 进行比较，其实很难说两款工具孰优孰劣，各有秋千吧，两款工具配合起来互补一下更好。Checkmarx 和 Fortify 一样，是商业版的，没有免费版。**就我本人实战使用的经验来看，对于有些高危漏洞，有时候 Fortify 能扫出来，有时候 Checkmarx 能扫出来，没法评判哪个工具更厉害**。Checkmarx 的使用教程网上很少，我看了它的说明书，说明书写得有点复杂，我写一个简单的教程方便大家上手吧。

关于 checkmarx 的命令行工具的使用、Checkmarx 的 API 接口调用方法，我们后续再讲。**欢迎关注本人 ABC_123 的公众号，99% 原创，欢迎关注，欢迎转发**。

**求助：哪位朋友有 Codesecure、IBM Security AppScan Source 的破解版或者是试用版，方便的话发我试用一下，保证不用于商业目的，Thanks♪(･ω･)ﾉ**

 **Part2 安装过程** 
----------------

不得不说，Checkmarx 的安装通常是一波三折的，需要额外安装 IIS、.NET 环境、SQLServer 数据库等等，我通常是安装好几遍才能成功。**我强烈建议大家安装在 win2012 或者 win2016 的虚拟机当中，如果安装失败可以还原一下重装**，或者大家可以从网上找一个别人做好的虚拟机版的破解版，当然有能力的公司可以购买一款商业版，本公众号就不提供下载地址了，大家网上自寻。对于软件的安装过程，我就说几个关键点：

 ****1****  确保以下几个服务处于启动状态 CxJobsManager、CxScansManager、CxSystemManager、CxScanEngine、IIS Admin Service、World Wide Web Publishing Service。

 **2**   安装完成之后，显示失败，不要着急，需要等待几分钟，因为 Checkmarx 的各种服务需要一定的时间去启动。

 **3**   Checkmarx 和大多数代码审计工具一样，需要系统配置很高，我一般给它开 16G 内存。

 **4**   操作系统建议选择 win2012 或者 win2016，最新版的可能是需要 win2019，不太确定。

 **5**   网上有不少版本的破解版，**有的破解版扫描到 90% 或者 99% 就一直卡住不动，那是破解不完美，有暗桩没去掉，大家要仔细甄别**。

软件界面默认是英文的，按照如下设置，可以改成中文界面。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92KBCtAemlde9FloMslhlibSiaM06MNOib5icK5erIuh2zTntEqm1NmpF8jEA/640?wx_fmt=png)

 **Part3 使用客户端进行代码扫描** 
-----------------------

Checkmarx 有两种使用方法，一种是客户端程序，一种是 Web 界面。首先介绍一下客户端程序的使用，首先点击桌面的 “**Checkmarx Audit**” 快捷方式，输入用户名密码进行登录。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92Kgwhic2TIGeZSqkk2xrc9akApZLzkXibw3YaGibIG3l9iaW3Y2MEJMtQ1OQ/640?wx_fmt=png)

然后点击 “**New Local Project**” 按钮，点击 “**Browse**” 按钮，选择需要进行代码扫描的 java 代码的文件夹，**记得要有附带完整的 jar 包，否则 Checkmarx 编译不成功，导致扫描结果漏报**。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92KTgZyOzicj8NEvnWNzOIrCtFyStEJxzd8HYqkTYOdmWdJowX89dmHLWg/640?wx_fmt=png)

点击 “**Count**” 可以直接给出代码行数，方便评估代码审计的工作量。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92KqUYsUUYicT6TBqTMRLRXiabMYvia60HqoG8MeRrRJ1rbtnE26tCZ4uS6A/640?wx_fmt=png)

勾选 “**Select Queries Before Loading Project**” 选项，可以手工选择代码审计的规则库。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92Kic6jfDLiapEolgfKNVwRXZrszyDviby2EjUP2IfkhU1dyCUEKoYib4XwuQ/640?wx_fmt=png)

在 “**Run Multiple Queries**” 界面下，可以选择需要使用的代码审计规则库。如果是 java 代码，我们只需要勾选 Java 选项即可，然后点击 “**Scan**” 按钮。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92KHPZRWqpBW8aiaCa0WljxAAWLsXoX6McV2JxMNXQUSz3jKaibV2NyXMDA/640?wx_fmt=png)

Checkmarx 就开始扫描了，在 “**Loading Project**” 窗口下，可以看到扫描进度。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92KOQUyCBmmekH6G2DFJRxrGR0RVqAg6MQ3zia3cLFWagW0RtFs7pVCwsg/640?wx_fmt=png)

接下来查看扫描结果，勾选 “**Hide Empty**”，可以隐藏掉没有漏洞的扫描结果项，这样 “**Results History**” 下的漏洞结果一目了然。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92K0g4mAz0sWkEiaxBLn8wzfZjdnCFdPGLicMeuIM3tciam7vdRdfL96MLrA/640?wx_fmt=png)

在右下角方框中，点击一下，可以直接对相应的代码进行预览，Checkmarx 可以对代码进行高亮显示。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92K23YBvd2Gm5tov3v1Lzd4vdspk1sTDuOFASabHKiaroBIa2mrAa2ictmw/640?wx_fmt=png)

在最右边方框中可以看到漏洞污点传播的整个流程图，这个功能类似于 Fortify 的 Diragram 功能，非常方便。代码审计人员可以借助此流程图，审计漏洞污点传播过程中，有没有一些过滤函数把漏洞利用的特殊字符给过滤掉或者转义掉，并根据过滤函数查找是否存在绕过的可能性。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92KSPPbILGrlFxPIt2jf7ibzk5RG4WdRVGzPETz4qfISEk01NqJoSpdm5w/640?wx_fmt=png)

在这个窗口下，可以保存扫描结果，下次可以使用 checkmarx 重新打开。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92KzuVUIYvqGLiaWV0FXxYylGgrPom5ibYEX1F62sY2icxZdum5sGGticlYLw/640?wx_fmt=png)

再次打开界面，在界面左边的 “**Projects**”，可以看到以往扫描过的代码审计项目。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92KfIEJo2l1R1at1FDCjVic2pDH6EtLGWAtb88UfdsrC07x1QKSkBV3Awg/640?wx_fmt=png)

 **Part4 使用 Web 界面代码扫描** 
-------------------------

接下来讲一下 Web 界面的使用方法，点击桌面的快捷方式 “**Checkmarx Portal**”，将会打开一个 web 界面。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92KOoibsnk6OCcOOMs0EhIQaEJOqYjyXEic1QzADTjIs1PPBNheIEW0vAicw/640?wx_fmt=png)

输入用户名密码之后，可以使用 Web 界面进行代码审计工作，但是我个人不太建议使用这个界面，因为 Web 界面操作起来有点卡。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92KMYWLqwYvyVVSia9MwtELRAOQXY7bp06hhXXZqhSW6nz8VVglL7qu6icw/640?wx_fmt=png)

在 “**仪表盘**” 标签下，可以看到我们之前用客户端程序 “**Checkmarx Audit**” 进行扫描的扫描结果，项目名为 **scan111**，

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92KtHDY72EYghByuEXfTVqctlh7FETfUGictJRiaKiaptNlY88YGSkbA0t1w/640?wx_fmt=png)

接下来讲讲如何进行代码扫描，首先点击 “新建项目” 按钮。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92KdLXiak9LqJggFSOpB1CHSKWcZnROUmXVVBh2Diczp3QBAYvT5VOxG2Fw/640?wx_fmt=png)

点击上传 java 源码压缩包，部分版本可能有 200M 文件大小限制，这时候需要用 **CxZip utility** 进行处理。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92KKGBRkcic8CVIewsAFmOAAwaOvTMicZZAic0DgmPX2BcL7EqCWRjGtb4JQ/640?wx_fmt=png)

点击 “**计算行数**”，可以得知代码的总行数，进而预估代码审计的工作量。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92KRsibYobE35SHNflVEkk7TUwytJhylAGUTWtjDqqkjHMRuzCnJDzTzCQ/640?wx_fmt=png)

之后一直点击 “**下一步**”，最后点击 “**完成**”。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92KbjSib4icWCT8Y2uAsvibcAdMLMvWT9nwyWokNMx4VSR48fiaickzaJeRqeg/640?wx_fmt=png)

之后便开始扫描过程了，如下图所示，代表扫描工作完成了 **6%**。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92KX7fHGf5Zcwh2Sqx2rrTOibq4q89dqcGwcENePQjexQKJNVWShYibia9PQ/640?wx_fmt=png)

扫描完成后，可以看到当前项目的整体漏洞分布情况，包括发现了多少高危漏洞，多少中低危漏洞等。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92KVOh2FPXOoibwkINQU7O9xbGMuV7SKQhP49b9LklDEZneHTBNTV6ick2Q/640?wx_fmt=png)

点击 “**打开扫描总结**”，会弹出以下界面。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92K14TAJQ5ia7PIlr7dwvXYfshI1OG07PYiaSvYPT3lz58yY6lrlr72xhfQ/640?wx_fmt=png)

点击 “**打开察看器**”，可以像客户端一样对扫描结果进行操作，查看代码审计漏洞的细节，但是操作起来有点卡。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92Khz1yNrMUIfpQsc49YFgyOhQZtHdg3eia7fpHSSANCUwREX4hRK1P1CA/640?wx_fmt=png)

点击右下角长方框中的文件路径，可以直接查看 java 代码，Checkmarx 给出了代码的高亮显示。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92KQTb6a5dBibArGJUBuMLEnPY2TJBhicuGZTKUguEZsZEpuV1dwMnwUe6w/640?wx_fmt=png)

Checkmarx 在这里给出了一个非常好用的功能，**红色方框代表各种各样的 Web 漏洞触发流程的交集点，也可以理解为，红色方框中给出了漏洞的最佳修复点，修复漏洞就可以从交集点处修复**，那么交集点往前的 sql 注入漏洞都得了修复，减少了很大的修复漏洞的工作量。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92KhUTEcmqQxFib76taCZbEvgp1fEecXI2XftRqYugPrgTS5cWO4c7EeCg/640?wx_fmt=png)

如下图所示，修复红框中的一处漏洞，上面多条漏洞触发流程都被中断，都会得到修复。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92KUFJy3pcuiaurs8Zc5pBGaM2ungjsYEibL9yZDShwOJyowXNZkOIiaEicuA/640?wx_fmt=png)

点击如下图标，可以生成各种形式的报告。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92KUYdxIIXu9WWSqhCH1o4K2hENFGrYY0c7d5ic3cpeqepLgNeUYoCKExA/640?wx_fmt=png)

手动勾选需要报告体现的各种漏洞类型，点击 “**生成报告**” 按钮。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92KbFLPrX46vQ29Hich8MmqUh45XOAbUXJnNHHj7Zs9vLwglOkr4qGbFkg/640?wx_fmt=png)

最终生成的报告如下，和 Fortify 一样，还是自己编写代码审计报告吧。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CFKhxYrMGrlQ9IWhkvd92K1O8wPDppV3ics8aHc2bB5xaL2Spqu9kIfGB8ib0Yo1ZUXOQ4XT6ujq8A/640?wx_fmt=png)

 **Part5 总结** 
--------------

**1.** 关于 Checkmarx 的命令行工具的使用、Checkmarx 的 API 接口调用方法，我们后续再讲。

**2.**  对于这些商业版的代码审计工具，记得要仔细看使用说明书。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450A5qqg2iaK6KIYYR8y6pF5Rh3JHDibOKOop204nXz618iawdRb8dABicMPtHb2PkJE8x6koJO5HyuwZJQ/640?wx_fmt=png)

专注于网络安全技术分享，包括红队攻防、蓝队分析、渗透测试、代码审计等

每周一篇，99% 原创，敬请关注

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450A5qqg2iaK6KIYYR8y6pF5Rhn137KeqqlDkuRyY4G61jATRzyOrCBts8ucxkLpMNsYutSOY7BkPziaw/640?wx_fmt=jpeg)