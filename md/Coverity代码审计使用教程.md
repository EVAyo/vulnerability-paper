<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/j3bZtXQ_RdTBl98f8y6Kog)

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450ATcz6jUJnFNeOxRzVZ9LbcCCMJ6Af2WYicgMPA32IwibF8mI2ibC9h8jaHkhxnZzZuqctMLRTxDudicA/640?wx_fmt=png)

 **Part1 前言** 
--------------

前面几期介绍了 Fortify 及 Checkmarx 的使用，**本期介绍另一款代码审计工具 Coverity 的使用**，Coverity 可以审计 c、c++、Java 等代码，使用起来非常麻烦，相比于 Fortify 和 Checkmarx，Coverity 对于代码审计工作最大的遗憾就是，**Coverity 要求代码完美编译（不知道有没有网友可以解决这个缺憾）**，而我们在日常的工作中，不太可能拿到可以完美编译的源代码，因此我不常用这个工具，这大概也是 Coverity 在国内使用量不如 Fortify 和 Checkmarx 的原因吧。

**求助：哪位朋友有 Codesecure、Klockwork、IBM Security AppScan Source 的破解版或者是试用版，方便的话发我试用一下，保证不外传，保证不用于商业目的，Thanks♪(･ω･)ﾉ**

 **Part2 审计 Java 代码过程** 
------------------------

*   **客户端使用过程**
    

Coverity 安装完成之后，双击桌面的快捷方式 **cov-wizard.exe** 可以打开一个 gui 界面，建议初学者可以先通过 gui 界面入手，熟悉之后，再从非常复杂的命令行使用入手。

首先新建一个项目名 “**project111**”：

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dqjpb8kpXJky3WtibT6iaibuxpr7sDOyZBQKM3MEZFXFhwnaON9j4xRLq2PFdNHVnbW3ZRZAtQ46Q5g/640?wx_fmt=png)

接下来开始配置 Coverity 代码审计的各项参数：

 **1**  “**工作目录**”，指定你想要进行代码审计的 Java 代码文件夹。

 **2**  “**中间目录**”，指定输出扫描结果的文件夹，为以后生成代码审计报告做准备。

 **3**  “**构建设置**”，指定 Java 代码的编译方法。

命令行构建对于 java 可以用多种方法，我列举两种亲测可用的编译方法：

**1.** 清除：**mvn clean** ， 构建：**mvn package**

**2.** 清除：**ant clean**   ,   构建：**ant**

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dqjpb8kpXJky3WtibT6iaibuxibz11fxLJtncKaOsib78krtL7xfy4Yib9NnOcHiaHkKXkCud3dTIQacHMA/640?wx_fmt=png)

接下来点击 “**下一步**”，勾选相应的扫描规则，也可以按照默认勾选。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dqjpb8kpXJky3WtibT6iaibuxJF3I1xQx5GOgSJRz5tg0PIG86CxEJAmibC65JSHBChibUyV6080tMwew/640?wx_fmt=png)

点击 “**高级分析选项**”，可以设置 “**最大工作内存 (MB)**”，同时可以手工设置 “**攻击性级别**”。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dqjpb8kpXJky3WtibT6iaibuxYWnTmf26ox7YEpoolWxDDaEwySpzopeU2ARz0PeDuxGQN6ycCiaricKA/640?wx_fmt=png)

接下来点击 “**运行分析**”，即可开始代码审计工作了。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dqjpb8kpXJky3WtibT6iaibuxvfiaEuYYfrD84dcNHUQL3UO3jiaWT8IxkyxnKI3MTCeU2efHnb8icPSeA/640?wx_fmt=png)

点击 “**控制台**” 按钮，可以看到代码扫描的整个过程。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dqjpb8kpXJky3WtibT6iaibuxMVV12ickYP9ybpzWMpV3wmoyeFgDREicVia5kjicQ1yogp2kVllTXgEVnw/640?wx_fmt=png)

如下图所示，是 “**mvn clean**” 过程。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dqjpb8kpXJky3WtibT6iaibuxibRSUtnQuhNC4zSmicILPUFkIEbsMoaz2hKYyiagOaQCJliazeuKfELiawg/640?wx_fmt=png)

如下图所示，Coverity 开始为代码分析做准备。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dqjpb8kpXJky3WtibT6iaibuxFXWap74X7LQzrQqMMzjGEC5ldGohWiaJb1u0tHXniaChx2BSYxSYEA3w/640?wx_fmt=png)

如下图所示，展示了各种 Web 漏洞对应的扫描结果。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dqjpb8kpXJky3WtibT6iaibuxYmMluc8rdoAZFkHUsAPYB5Xd95aDdRcGQbT4ruTYIga58ry6GNNV0w/640?wx_fmt=png)

接下来点击 “**中间目录详情**”，可以看到代码审计结果的概况。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dqjpb8kpXJky3WtibT6iaibuxFicVhC9ygtt5UeRHoAytIJ3HficcOP1n7IIEicNtoibm7fda2WZsRqxQXw/640?wx_fmt=png)

*   **Web 界面的使用**
    -------------
    

客户端的完成代码扫描之后，可以将扫描结果上传到 Coverity 的 Web 端，Coverity 默认的 http 端口是 8080，https 端口是 8443，我们可以输入在安装过程中设置的用户名及密码进行登录。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dqjpb8kpXJky3WtibT6iaibuxNd3xAog6V2LkibPyD5m1icOAn98JQsrQZVUDBWH6Npa6541fcHib7FsAA/640?wx_fmt=png)

登录成功之后会显示以下 Web 界面。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dqjpb8kpXJky3WtibT6iaibuxXhPITG7ABw0vX2Cum2yg0qWdVgougiazBJPZvCsLiapQCObCEUcZiaia0g/640?wx_fmt=png)

在 “**配置 - 项目和数据流**” 界面下，新建一个 “**数据流**”，名字起为 “**111111**”，后续可以将代码审计结果放在此 “**数据流**” 下展示。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dqjpb8kpXJky3WtibT6iaibuxGHn8tVIVvvQeP9IaGSN80okOBFJqWgv31ic99EXWEr1mmf293Vg4jEQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dqjpb8kpXJky3WtibT6iaibuxiaI5r6icSpUBzPnET0FNAjqSlPMgiah4jUHPBoNKHwPicu42BEUpgD53ug/640?wx_fmt=png)

访问如下网址，点击 “**创建并下载**” 可以生成一个 **auth-key.txt** 文件，这个文件是需要提供给客户端程序 **cov-analysis.exe** 来使用的。

https://win-iccdc05mgj6:8443/authentication-keys

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dqjpb8kpXJky3WtibT6iaibuxRZFpTMXH8oxialZW587gpco6mvx8JTrZkDVRMmWczCtLSC4yjGAq8oA/640?wx_fmt=png)

*   **客户端提交扫描结果**
    -------------
    

在客户端程序 “**Coverity Wizard**” 界面下，在 “**验证秘钥文件**” 处导入 **auth-key.txt** 文件，点击 “**测试连接**”，提示 “**已成功连接**”，说明我们的配置没问题。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dqjpb8kpXJky3WtibT6iaibux0JliazK4g2nbBcN4tDF94DmPSMiaRibxniaKVtYvt3LXJkhFFzdDuxltjw/640?wx_fmt=png)

接下来选择 “**提交到数据流**” 的 “**111111**” 名称，然后点击 “**提交缺陷**”，即可将扫描结果上传到 Web 界面进行展示。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dqjpb8kpXJky3WtibT6iaibuxXWvn7U30yZaISQI3ess9rOzbsbUesNWCeMiblnO13nEZhKZxRLWLAmQ/640?wx_fmt=png)

非常遗憾的是，之前我测试时，Web 界面的使用都是可以成功的，但是现在始终显示 “**[ERROR] The server's certificate is not yet valid. It will become valid on 2022-12-23 06:58:26 UTC.**” 这个错误，**如果您有解决办法，请后台留言告诉我，Thanks**。正常不出错的话，代码审计结果会这样展示：

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dqjpb8kpXJky3WtibT6iaibuxdqfW4hm1MiaRkibnM09yiaV7T5Q4h3tV2c9G0liaq5N2QFhJ6Kt6VhrnzQ/640?wx_fmt=png)

为了查看扫描报告，最后通过导出 html 报告的方法，在本地浏览器中，查看最终的代码审计结果报告。

 **1** 如下图所示，这是 SQL 注入漏洞的结果展示。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dqjpb8kpXJky3WtibT6iaibuxZoe2Asf2IYiaMt0aQMeia0V3Jz0onGEdTh2Egp20SPjmMFEZzbVJgwJA/640?wx_fmt=png)

 **2**  如下图所示，这是 Xpath 注入漏洞的结果展示。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dqjpb8kpXJky3WtibT6iaibuxpCEImgwic0ibZicibXVzAr2OCHqRdqwg2FFPJZicpkXcw2D1XOaicBicmcjLQ/640?wx_fmt=png)

 **3**  如下图所示，这是 XSS 代码漏洞的结果展示。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dqjpb8kpXJky3WtibT6iaibux7RYLxiaGXmPiaeBoDCIynpvzibhL6axJ7sCfgI5Dibl5vw7OpIFicQNLDkQ/640?wx_fmt=png)

 **Part3 总结** 

**1.**  国内很多研究者，更喜欢使用 Coverity 进行 C 及 C++ 的代码审计，它的功能很强大，就是使用起来非常麻烦，需要大家仔细研读使用说明书。

**2.**  大家有新版的 Coverity 程序，方便的话可以发我一个研究下。  

**3.** Help: Which friend has a cracked or trial version of Codesecure, Klockwork, and IBM Security AppScan Source? If it's convenient, send it to me for trial, and I guarantee that it will not be used for commercial purposes。Thanks♪(･ω･)ﾉ。**Contact me by e-mail : 0day123abc#gmail.com(replace # with @)****。**

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450A5qqg2iaK6KIYYR8y6pF5Rh3JHDibOKOop204nXz618iawdRb8dABicMPtHb2PkJE8x6koJO5HyuwZJQ/640?wx_fmt=png)

专注于网络安全技术分享，包括红队攻防、蓝队分析、渗透测试、代码审计等

每周一篇，99% 原创，敬请关注

Contact me by e-mail : 0day123abc#gmail.com(replace # with @)

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450A5qqg2iaK6KIYYR8y6pF5Rhn137KeqqlDkuRyY4G61jATRzyOrCBts8ucxkLpMNsYutSOY7BkPziaw/640?wx_fmt=jpeg)