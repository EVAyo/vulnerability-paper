<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/Udncd_xXaJ5Uo73LASvEww)

0x00 提醒
-------

上一篇 [Electron 安全与你我息息相关](https://mp.weixin.qq.com/s?__biz=MzU1NDkwMzAyMg==&mid=2247500135&idx=1&sn=fe0f27a3d49a57b19df6fa1b23150645&chksm=fbdef5e6cca97cf083147a6fb5c85b87c7bb6da92ede5cb9dae29b3d55639388e227087e1209&token=1495738975&lang=zh_CN&scene=21#wechat_redirect)文章非常的长，虽然提供了 `PDF` 版本，但还是导致很多人仅仅是点开看了一下，完读率大概 `7.95%` 左右，但上一篇真的是我觉得很重要的一篇，对大家了解 `Electron` 开发的应用程序安全有帮助，与每个人切实相关

但是上一篇文章内容太多，导致很多内容粒度比较粗，可能会给大家造成误解，因此我们打算再写一些文章，**一来是将细节补充清楚**，二来是再此来呼吁大家注意`Electron` 安全这件事，如果大家不做出反应，应用程序的开发者是不会有所行动的，这无异于在电脑中埋了一些地雷

我们的公众号已开启了留言功能，大家可以在文章下留言讨论啦~

0x01 简介
-------

`Electron` 的架构以及开发等知识可以参照官网，官网有非常详细的介绍，今天我们要谈论的可能是 `Electron` 最重要的安全特性之一  —— `nodeIntegration`

> https://www.electronjs.org/zh/docs/latest/
> 
> https://www.electronjs.org/zh/docs/latest/tutorial/security#2-%E4%B8%8D%E8%A6%81%E4%B8%BA%E8%BF%9C%E7%A8%8B%E5%86%85%E5%AE%B9%E5%90%AF%E7%94%A8-nodejs-%E9%9B%86%E6%88%90

在 `Electron 5` 版本以来，这个特性被默认设置为 `false`

> https://releases.electronjs.org/releases/stable?version=5&page=7&limit=2
> 
> 时间为 2019-04-24 (1815 days ago)

在 `Electron 20` 版本以来，除非指定 `nodeIntegration: true` 或 `sandbox: false` ，不然渲染器会被沙盒化

那这个特性是干什么呢？

官方的解释是:

> 是否启用`Node integration`

官方在安全建议中是这样描述的

> 加载远程内容时，不论使用的是哪一种渲染器（`BrowserWindow`，`BrowserView` 或者 `webview`），最重要的就是绝对不要启用 Node.js 集成。其目的是限制您授予远程内容的权限, 从而使攻击者在您的网站上执行 JavaScript 时更难伤害您的用户。

这个描述似乎在说，开启了 `nodeIntegration` 之后，渲染进程就可以获取到  `NodeJS` 的能力，这样渲染进程可以直接使用系统相关的方法，进而达到命令执行的效果

官方眼中的渲染器到底具体是什么呢？预加载脚本？渲染页面中的 `JS` ？是否还包括那些嵌入的页面中的 `JS`  ，他们都可以获取到这种能力吗？

带着这种疑问，我们开始今天的文章

这篇文章在文末也提供了 `PDF` 版本

* * *

*   0x00 提醒
    
*   0x01 简介
    
*   0x02 搭建测试程序
    

*   1. 测试项
    
*   2. 配置分组
    
*   3. Electron 版本管理
    
*   4. Payload
    
*   5. iframe 服务器
    
*   6. window.open 服务器
    
*   7. 关闭 CSP
    

*   0x03 Electron 3.0
    

*   默认配置
    
*   配置 1
    
*   配置 2
    
*   配置 3
    
*   配置 4
    
*   配置 5
    
*   配置 9
    
*   Electron 3.0 总结
    

*   0x04 Electron 5.0
    

*   默认配置
    
*   配置 1
    
*   配置 2
    
*   配置 3
    
*   配置 4
    
*   配置 5
    
*   配置 9
    
*   Electron 5.0 总结
    

*   0x05 Electron 19.0
    

*   默认配置
    
*   配置 1
    
*   配置 2
    
*   配置 3
    
*   配置 4
    
*   配置 9
    
*   Electron 19.0 总结
    

*   0x06 Electron 20.0
    

*   默认配置
    
*   配置 1
    
*   配置 2
    
*   配置 3
    
*   配置 4
    
*   配置 9
    
*   配置 6
    
*   Electron 20.0 总结
    

*   0x07 Electron 29.0
    

*   默认配置
    
*   配置 1
    
*   配置 2
    
*   配置 3
    
*   配置 4
    
*   配置 9
    
*   配置 6
    
*   Electron 29.0 总结
    

*   0x08 小结
    
*   0x09 总结
    
*   0x10 PDF 版本 & Github
    
*   往期文章
    

* * *

0x02 搭建测试程序
-----------

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3BpMZ8BAofs5DbJy4gDrd06Z3d2zaic3TCVtYEicwCRCUN9keTXVKpbTQ/640?wx_fmt=png&from=appmsg)

我们根据官方重大更改中提到的两个节点 `Electron 5.0` 和 `Electron 20.0` 将整个时间线分成四段，取 5 个点，分别测试一下 `nodeIntegration` 的具体影响

### 1. 测试项

`Electron` 官方开发了 `Electron Fiddle` 程序，可以直接选择 `Electron` 版本，非常方便，但是需要系统准备对应的 `NodeJS` 环境，代码就使用默认的，我们在其中 "加料"，我们主要从以下几个角度测试

> https://www.electronjs.org/zh/fiddle

<table data-tool="mdnice编辑器"><thead><tr><th>安全配置</th><th>测试点</th></tr></thead><tbody><tr><td>nodeIntegration</td><td>渲染页面</td></tr><tr><td>contextIsolation</td><td>预加载脚本 (Preload)</td></tr><tr><td>sanbox</td><td>iframe 内页面</td></tr></tbody></table>

### 2. 配置分组

按照 `true` 和 `false` 进行分组

<table data-tool="mdnice编辑器"><thead><tr><th>配置序号</th><th>nodeIntegration</th><th>contextIsolation</th><th>sanbox</th></tr></thead><tbody><tr><td>1</td><td>true</td><td>true</td><td>true</td></tr><tr><td>2</td><td>true</td><td>true</td><td>false</td></tr><tr><td>3</td><td>true</td><td>false</td><td>true</td></tr><tr><td>4</td><td>true</td><td>false</td><td>false</td></tr><tr><td>5</td><td>false</td><td>true</td><td>true</td></tr><tr><td>6</td><td>false</td><td>true</td><td>false</td></tr><tr><td>7</td><td>false</td><td>false</td><td>true</td></tr><tr><td>8</td><td>false</td><td>false</td><td>false</td></tr></tbody></table>

### 3. Electron 版本管理

每个 `Electron` 版本对应的 `NodeJS` 版本如下

<table data-tool="mdnice编辑器"><thead><tr><th>Electron 版本</th><th>NodeJS 版本</th></tr></thead><tbody><tr><td>Electron 3.0</td><td>NodeJS 10.2.0</td></tr><tr><td>Electron 5.0</td><td>NodeJS 12.0.0</td></tr><tr><td>Electron 19.0</td><td>NodeJS 16.14.2</td></tr><tr><td>Electron 20.0</td><td>NodeJS 16.15.0</td></tr><tr><td>Electron 29.0</td><td>NodeJS 20.9.0</td></tr></tbody></table>

使用 `nvm` 进行多版本管理，用 `Deepin Linux` 进行测试

> https://github.com/nvm-sh/nvm

低版本的 `Nodejs` 就用 `Ubuntu Desktop 18.04` 来进行安装，高版本的 `Nodejs` 用 `Deepin Linux` 进行安装测试

安装 `Fiddle`

> https://www.electronjs.org/zh/fiddle

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3EqVBYmWqav8kM0M9Oiaf11iah2cZ3g3zy4MwngXqawUBOiafHLxB0FRrA/640?wx_fmt=png&from=appmsg)

安装 `nvm`

> https://github.com/nvm-sh/nvm

```
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.7/install.sh | bash


```

### 4. Payload

`Deepin`

```
require('child_process').exec('deepin-music')


```

`Payload` 是打开 `Deepin` 音乐程序

`Windows 11`

```
require('child_process').exec('calc')


```

`MacOS`

```
require('child_process').exec('open /System/Applications/Calculator.app')


```

### 5. iframe 服务器

在内网起一个 `http` 服务器，设置一个恶意的 `html`

```
192.168.31.215


```

```
<!DOCTYPE html>
<html>
<head>
</head>
<body>

<div>
  <h1>Hello World!</h1>
  <script>require('child_process').exec('deepin-music')</script>
</div>

</body>
</html>



```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3unVjicA2YWOr5yaq6SIKu3Z23PeoSV9tLcpDCvHZIz1EFia6sexQqkOA/640?wx_fmt=png&from=appmsg)

### 6. window.open 服务器

```
192.168.31.215


```

在 `iframe` 中通过 `window.open` 打开页面进行执行

`2.html`

```
<!DOCTYPE html>
<html>
  <head>
  </head>
  <body>
    <div>
      <h1>Hello World!</h1>
      <script>window.open("http://192.168.31.215/3.html")</script>
    </div>
  </body>
</html>


```

`3.html`

```
<!DOCTYPE html>
<html>
<head>
</head>
<body>
  <div>
    <h1>Hello World!</h1>
    <script>require('child_process').exec('deepin-music')</script>
  </div>
</body>
</html>


```

### 7. 关闭 CSP

为了测试 `iframe` ，关闭 `CSP`

0x03 Electron 3.0
-----------------

安装 `NodeJs 10.2.0`

```
nvm install 10.2.0


```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3aVNPWBWbI7oicFX3P2IfaBR3rJ3ibQtUtROVcRYY2FHJkDJhXIX1ZHFg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3yib1ms7s3stVBFVgCLJaWlADUzbzqibLxROPUdPibeFyFVEiccbDdAMPDg/640?wx_fmt=png&from=appmsg)

这里会安装失败，可能是版本太老了，所以该用命令行进行安装

```
sudo npm install -g electron@3.0.0


```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S316OagU9bVq65m8Lpc8ibXredGyjVCzLIAWVmkjlz6ufl1Yg8cvGlu6A/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S361hOm9ib4WKHmC4vCusTOJahYF9mcyUvFic0NwyjV2kHLszIfAjAyPJQ/640?wx_fmt=png&from=appmsg)

在 `Fiddle` 中添加我们自行安装的 `Electron 3.0.0`

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3Sn4bb2z06licJhLcG5Dxu6aqV1fIYWhkvqCS5W31DETexU3UiaBW6MZQ/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3V0z9MoCKl4D2jZHpq9p5BxKRic9cOXiblBFVpVZxr30dzuBGEpZXs2bQ/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3NqMrLs9yTCBDTGc6stjd0fzEgf8dPUiab7Fcxn1hCzdGXykB2ZEJB2A/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S36MUSY26u4yyoJheCItibeYP4wXb3Tc3tEnnH3fDEvpFqtu9DQs6QMew/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3HIVk32rBklZ8MfWW1dAoTtUYpAQ7rQazdqG5iaqgtO830Lt4U7M1u9w/640?wx_fmt=png&from=appmsg)

点击 `Run` 测试是否可以正常显示

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3ntia9ztsJ41FK7yAajTibiaicyAt8QCoIFx96tiaPu9MRdrW9BicMm891sicA/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S35laG9AGRFqoQthMtdoGFKYdjTod1Zg4JrBXYXX2mSgniaGq6ZKFtMlw/640?wx_fmt=png&from=appmsg)

能够正常运行

按照官方手册介绍，`Electron 3.0` 默认安全配置为

*   `nodeIntegration: true`
    
*   `contextIsolation: false`
    
*   `sandbox: false`
    

### 默认配置

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3ichMmA2Mg9XiaL2bX0tJfMyYWTsAMUHiaCl4ic8iczC6cRJFgU0eCyBH4kw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3kenJb9Hc8kYotd4HQpynXrgTiaPSkQl2AsUaCD3IO4nlwYLYkj1DFNA/640?wx_fmt=png&from=appmsg)

成功

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3QzqDj60R14KtMgevBjA8hMuPZyo2IK1kwQOnM2gcTWeM0KIySVfibdg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3ichL0xjzYJFQtt8qYFhSauy9f3NHlaMibkn5RiaHFh5MIpYJ9hKic4ygBA/640?wx_fmt=png&from=appmsg)

成功

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3yhQKsaER0nVoCWg5MuicYX3MT2R45ibpkxq6jgv9n4iaLJPedIwnTt7bQ/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3SwMicHMP7lD1pfsDXg6WkoKFZXE2ceh85O5ibr00vuSjFUsrzApkedRA/640?wx_fmt=png&from=appmsg)

`iframe`直接执行失败， `window.open` 执行成功

#### 小结

在默认配置中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>是</td></tr><tr><td>iframe</td><td>否</td></tr><tr><td>iframe + window.open</td><td>是</td></tr></tbody></table>

### 配置 1

```
nodeIntegration: true
contextIsolation: true
sandbox: true


```

分别尝试在 预加载脚本、渲染进程、`iframe` 中进行测试

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3IF6EN1ZoalSJuYRGs6Bgd8VDNqibd3LibbTvZHcmOSicMmsQ04mq3HcSA/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3nKnQt2BMHnqTLb4bk8DPl100jIpvkCuh4FQhQlBYkD1QX11OxpSDWg/640?wx_fmt=png&from=appmsg)

成功

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S38OJAZyyoELAwNgpiahZTE2ic7NFV8kibiaQZWJ5S1QBTR8nbCMbiaicbaBsA/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3kFQiawVAdK66icavXnlJ1AibStNA66t7QqFrib3t7XicQsicwZmRB8Qxl3NQ/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3Eb0I5q3YVAZaNkDEuR7VnEY8dV7LZzWCxyGfurF7U7ArhNkrOR3A2g/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3dYGiciapwFicvm5d77fzibqIRdLpmwcMGIIO8HviaGsbd0ELyicnGVG6RDibA/640?wx_fmt=png&from=appmsg)

失败

#### 小结

在配置 1 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr></tbody></table>

### 配置 2

```
nodeIntegration: true
contextIsolation: true
sandbox: false


```

这回只需要在上一步中不能执行 `NodeJS` 的环境中测试

#### 预加载脚本

肯定可以

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3iaeXVOwyA5a7T98T7AYtYPp2wlmAApMA9RjCnt2Aico8GVkG8CwOibf8A/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3Yfib6pLHic6LV07W5nlguR5QicyvOImTMYAS0VoMMvoSiaUhrMDMbGXbOg/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3QxRVv9qv6Pz81jYVYkMMq165TibGyFxpHhU17jJvOlXSEh2KodQOjuw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3cYNqdN0n1YbPEPyAXFLrbvUjeo4bodmPN7Y13uLltkD4ZOAWH7xahQ/640?wx_fmt=png&from=appmsg)

失败

#### 小结

在配置 2 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr></tbody></table>

### 配置 3

```
nodeIntegration: true
contextIsolation: false
sandbox: true


```

这回只需要在配置 1 中不能执行 `NodeJS` 的环境中测试

#### 预加载脚本

肯定可以

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3uYXLMibovvpCuKSOahbDPflpm4pE6fVSdGwO9vTdCW3OmneK8bu0QJw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3lMXFiaUrIPDVibchS1ibtGU88UxpsjnSRkIlt5Xx21FueLQ5I3mPn7Axg/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3n0IjuFmqmewFhK5Y88TYUzs7ZuicPlZOibdsyz7rAmq0QCCAAiaicT31rw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3nrkm0YA9YNlxgjP0DfcbYIAdpxrC8VM0DJFDKk825mHeEVWI14icfBA/640?wx_fmt=png&from=appmsg)

失败

#### 小结

在配置 3 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr></tbody></table>

### 配置 4

```
nodeIntegration: true
contextIsolation: false
sandbox: false


```

这回只需要在配置 1 中不能执行 `NodeJS` 的环境中测试

#### 预加载脚本

肯定可以

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3iaPY6QADBMScC7gmT2YqmBZm4fHSWiajKZuUVCiamtco6gWSXOSvZ1WAA/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3UCPN7okibibjD898K8Vk8D8icvKA37jnTnKcH7dicxULKCgibsGeWgLp9OA/640?wx_fmt=png&from=appmsg)

成功

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3YPU5Kh6Kicu52EUx1hUHAaP8Wtez2f7gfL7u3f0jNJsiaIQqiaQl4SB1Q/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3clnsAWFYokKHQWHqFB4yqIeAsDEmvkQuqcPFrvzbm7lt9uzKZpLXaA/640?wx_fmt=png&from=appmsg)

#### iframe window.open 测试

在 `iframe` 中通过 `window.open` 打开页面进行执行

`2.html`

```
<!DOCTYPE html>
<html>
  <head>
  </head>
  <body>
    <div>
      <h1>Hello World!</h1>
      <script>window.open("http://192.168.31.215/3.html")</script>
    </div>
  </body>
</html>




```

`3.html`

```
<!DOCTYPE html>
<html>
<head>
</head>
<body>
  <div>
    <h1>Hello World!</h1>
    <script>require('child_process').exec('deepin-music')</script>
  </div>
</body>
</html>


```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3Jb6GKsB7uFWegZ9vIgQprPno6Ih2Jk6XKf2LZia5bj2eUONh4FgF1Iw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3XgpIcbS4XF0SzXtS87s83BrxLHSIxjTWiaFsjwKO3vcA6oLe4d2218g/640?wx_fmt=png&from=appmsg)

成功执行，当然，我是测试过了，在前面的配置中是无法执行的

#### 小结

在配置 4 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>是</td></tr><tr><td>iframe</td><td>否</td></tr><tr><td>iframe + window.open</td><td>是</td></tr></tbody></table>

### 配置 5

```
nodeIntegration: false
contextIsolation: true
sandbox: true


```

分别尝试在 预加载脚本、渲染进程、`iframe` 中进行测试

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3p72gCnnEagXZkibMiclFWlfhZPrtUB0Zl3nQAa6ygcwRGwaibtPfYj5TQ/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3HN2Xm5dLWczmYc4N8tlp2ibicwkqxCvzkicSeNtmlL8QzKjYIbW2wMTEw/640?wx_fmt=png&from=appmsg)

成功执行

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3ia2I8HgfbC6D2YIdFiaoPwPMyU4TQibI2Zqghvh0icFAPxP0Tssiax62seQ/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3ib15RKJvF9Bth6RGjaI2d0RZAic6APPF9DZ6h9UnOJKgUNzibtjBmsKDQ/640?wx_fmt=png&from=appmsg)

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3zL5SZjgFfTEKVfSFSf1w2FwDhbtHiaXGwZHs8G0Y6g2MiaSZpBiceHhxg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3jpyz8dbAoMibHtkrFJ3rBnOXoerdtmdMS8ZP7KyoXN1pojcTH4hBmPQ/640?wx_fmt=png&from=appmsg)

#### 小结

在配置 5 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr></tbody></table>

### 配置 9

```
nodeIntegration: false
contextIsolation: false
sandbox: false


```

分别尝试在 预加载脚本、渲染进程、`iframe` 中进行测试

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3ty9BcKQaMx5j0iaabpDHgoaaQzaCIZ8Hn3o40pbBqia7s0CNbPSvUPrQ/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3kF1XpSt1GxvfdT7mTA4eMaPfUDPJ6ic8ic0jCibo2ea1AHVviaibMvWlvvw/640?wx_fmt=png&from=appmsg)

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3IYJJjkiarY8pHFAL6HnO0mpTtx5wSicokpWg02c4JuKphENIc1icuUjYw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3jJRrLk7pPIZTQ3mvZcjnw3MqfszQsibod0ZCCzZOxiaf07WZuZyLDeiaw/640?wx_fmt=png&from=appmsg)

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3hJzDo8vl41L6mNnMnxLj2upic2yBfwxCbyXpbJsMJXoEaY4vuvgDVug/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3WiaiaoVzGTcLYYdsgia65Q58ruvfCFOzzTicgnSNvw4Z2C7PET4S7e8zBg/640?wx_fmt=png&from=appmsg)

#### 小结

在配置 9 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr></tbody></table>

剩下就不用测试了了，可以得出结论了

* * *

### Electron 3.0 总结

预加载脚本、渲染页面、`iframe` 测试点在以下情况可以执行 `NodeJS`

<table data-tool="mdnice编辑器"><thead><tr><th>安全配置</th><th>预加载脚本</th><th>渲染页面</th><th>iframe</th></tr></thead><tbody><tr><td>nodeIntegration</td><td>不影响</td><td>true</td><td>true</td></tr><tr><td>contextIsolation</td><td>不影响</td><td>false</td><td>false</td></tr><tr><td>sandbox</td><td>不影响</td><td>false</td><td>false</td></tr><tr><td>额外条件</td><td><br></td><td><br></td><td>+ window.open</td></tr></tbody></table>

在默认配置中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>是</td></tr><tr><td>iframe</td><td>否</td></tr><tr><td>iframe + window.open</td><td>是</td></tr></tbody></table>

0x04 Electron 5.0
-----------------

`Electron 5.0` 在 `Linux` 上无法使用 `sandbox: true` ，所以 `sandbox: true` 的部分在 `Windows` 上进行验证

【Windows 部分配置安装】

安装 `nvm-windows`

> https://github.com/coreybutler/nvm-windows

安装 `NodeJS 12.0.0`

```
nvm install 12.0.0
nvm use 12.0.0


```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S37iaC7mIE15AiaqibxicGyRCB8a2RKmmBTv9c0ziaysXvyq4znibjjahZlNXw/640?wx_fmt=png&from=appmsg)

新建文件夹并创建 `NodeJS` 项目

> https://www.electronjs.org/zh/docs/latest/tutorial/quick-start

```
npm init


```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3UY6EmvfTUDBUvkER7bkVkmt9lXRhZKvDSfIuM51BnCTT0gia1WycdUw/640?wx_fmt=png&from=appmsg)

安装 `Electron 5.0`

```
npm install --save-dev electron@5.0.0


```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3ZyEkDvxaGbzzxTQpWj9BxWhoGolYueIJS9fQ6iaT2J37QxFz7QiczIibw/640?wx_fmt=png&from=appmsg)

`package.json` 中添加启动参数

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3bawTfsslbEQ1icIkWydtoYjFKtHdJkicBgxJWux8usIeQGUGvdCmic77Q/640?wx_fmt=png&from=appmsg)

准备脚本，也就是 `Fiddle` 中的 `main.js`、`renderer.js`、`index.html`、`preload.js`

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S30QXSkhALMbLYHThJgcX0Q4k6mvos9sFhNW9AgSUVl8E2BeribX8icEsw/640?wx_fmt=png&from=appmsg)

启动项目测试一下

```
npm run start


```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S37dWgamsAYH0OCicjUnLsNQg94M33WCrh29ZmCGJtfDtV4EZyQyOPfIw/640?wx_fmt=png&from=appmsg)

可以正常启动

【Linux 部分配置安装】

安装 `NodeJS 12.0.0`

```
nvm install 12.0.0
nvm use 12.0.0


```

安装 `Electron 5.0`

```
npm install -g electron@5.0.0


```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3EENcDhBo33y5olZllAqMoOlmGjL3IJCKSOqPwUeqB9DpuCn7sOo0Kw/640?wx_fmt=png&from=appmsg)

与 `Electron 3.0` 一样，版本较低，需要手动配置

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3f7hOgXA3t9n1Jcgfs8oDAjRDpEibQu9B2nQl43fsUviciaF4jgdCZNEsA/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3wpG6icttWYV4sBElicxBxaFkA6LUUmYYMkSWWoH2Lbpuony8TAMGZehw/640?wx_fmt=png&from=appmsg)

按照官方手册介绍，`Electron 5.0` 默认安全配置为

*   `nodeIntegration: false`
    
*   `contextIsolation: true`
    
*   `mixed sandbox: true`
    
*   `sandbox: false`
    

在 `5.0` 的发布说明中写明了，`mixed sandbox` 默认启用，但是 `mixed sandbox` 并不等同于 `sandbox`，至于 sandbox 具体是什么，在官网也没有搜索到

> https://www.electronjs.org/zh/blog/electron-5-0

### 默认配置

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3kIE9grhbtkbG7S2TB9QxUx7DIiaITDXmFBUk1icTaI5wphJvriaYicjUNg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S36VH7VOw7QIqo6tLQW7Oria1uy4ZXI6tRDFZ0WUM1icia91UicsZVF34afA/640?wx_fmt=png&from=appmsg)

成功

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3FsNGJD8U4Mx8dk9xU0n99Ms1OibZW2fdh8975u1mvwMibxOJV5eNTWgw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S373b9B0hdNj22skNrfJXia4lt9P8cDJpbicIKxDwTIoBxdicPMoApgqWTg/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3LDibdQk58iajyMV1dV32G42u1ibLMu208qKWOWhCVUenmaqx2Zia4zeC5A/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3YD2z17sFRdyVzlMZs3sYLtTXNHqmNh4BRlibS07JWOaL6UMQ45VEy5w/640?wx_fmt=png&from=appmsg)

失败

#### 小结

在默认配置中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr><tr><td>iframe + window.open</td><td>否</td></tr></tbody></table>

### 配置 1

```
nodeIntegration: true
contextIsolation: true
sandbox: true  


```

分别尝试在 预加载脚本、渲染进程、`iframe` 中进行测试

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3ia1TfE0UicxTcPYMYTP8aIJicya2hbfMxpJxOhuKe98le5u7p6KicJXnSA/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3R86WkLibluIAFFuh4IvicwxsFbTMPzz6jhte0jT2ziaTDxyKTlX2Lrukw/640?wx_fmt=png&from=appmsg)

成功

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S34J92sFezXpib8gA6lChYT61XamZibbof2icOCI8Aw8VtHUbPYDWvz1bEg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3ickjoQD7DEcSwhFq1BB7E0yKgPeXEWoQbJVOUfrtkt2icOdzcHzl2J0g/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S33XAsng7l48ReZ8o9GJ2QejPibIickcdzp59A48Wv7Ge9icTOhzjibDTStw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3gnrrlWyqPLonH5kwyt4ZXvlicSgALvGJoruGPSxA9qoicQgwnUr9v0ag/640?wx_fmt=png&from=appmsg)

失败

#### 小结

在配置 1 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr></tbody></table>

### 配置 2

```
nodeIntegration: true
contextIsolation: true
sandbox: false


```

这回只需要在上一步中不能执行 `NodeJS` 的环境中测试

#### 预加载脚本

肯定可以

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3XVUxdKIlUqSJEcnNFsCgMQIC5PueF6OQ0tBLLicbZCcQOLwozQ0BDOg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S35eDiabo2fa7oQafAenAdqRicnxFyDaGQeHkEtLicIDibFQRGVicm4XeMZibQ/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3AFIcAo75IxBficwGwO1t9iaPQ7stIXicMfdwk1VjiblvqiaYvfB18SeoJ8Q/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3MtFdqtvaVsL2ztABuuCpM0ZsW45rPf4ic2afUDxfJc2zTJ8m0fYOIIg/640?wx_fmt=png&from=appmsg)

失败

#### 小结

在配置 2 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr></tbody></table>

### 配置 3

```
nodeIntegration: true
contextIsolation: false
sandbox: true


```

这回只需要在配置 1 中不能执行 `NodeJS` 的环境中测试

#### 预加载脚本

肯定可以

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3XkRFZ9G0Owia1gCb2M8wP40NuUIOzsFE0FpqSuRleBtm28urtoCmmGw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3h5ltiaONomeKicwd0ahsRqtWur1EeCckmMKI8gc9tyaj6r2bqUB5Wtdw/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3Zbia9hibZ001p9zvRu9dWgbibmTgPS3iaSo2K3mlobnQCtdWJGibmc3eedg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3Ks2Kubnsln8kH7eOzPya7A0wDhH56sBxcqfgpzMibiaOg2EDncKKvYVQ/640?wx_fmt=png&from=appmsg)

失败

#### 小结

在配置 3 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr><tr><td>iframe + window.open</td><td>否</td></tr></tbody></table>

### 配置 4

```
nodeIntegration: true
contextIsolation: false
sandbox: false


```

这回只需要在配置 1 中不能执行 `NodeJS` 的环境中测试

#### 预加载脚本

肯定可以

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3icKf1z9eLB3l3cV0GEx8iajRMWM7tonMhIywZ6DMNynL6z0JhUuZBdWw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3ERrl8ricH4icnJQtiaROVBFve1rQeO790DuIVGuUUTZ8oILlszWSRng4g/640?wx_fmt=png&from=appmsg)

成功

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3Qeb8S87wmvldQCv6C34BsibheDAQQfTfCPud58UuGLQkOMwgdhLIsQg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3RTMArVlhWAJRjbpRicbXtCleJEibWMck2cUTwiblpqpwrZ2kudmbpdB9Q/640?wx_fmt=png&from=appmsg)

#### 小结

在配置 4 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>是</td></tr><tr><td>iframe</td><td>否</td></tr><tr><td>iframe + window.open</td><td>是</td></tr></tbody></table>

### 配置 5

```
nodeIntegration: false
contextIsolation: true
sandbox: true


```

分别尝试在 预加载脚本、渲染进程、`iframe` 中进行测试

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3Vaa9QRmrvJqNMVlFNSOcq4QvWWiciaplibKiaazGtwLDX95kcWlcpma7IQ/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3yVG7G6l6esaOE6oEprxmLQy86mXvaVQPiaSlhSibkbt0AjBvuJLLMBUQ/640?wx_fmt=png&from=appmsg)

成功执行

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3avaFBpy5drmeib6UFORrFicpGf7J2fC8zyjXlf5fyBk3lg2krdVyWoKg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3KrDib23bPYria6w4GsicLjgl9iaOrFGojTdkewbzAiavEia4d4gZ1AwlCFgQ/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S37UTytib4OUQN2jmsmAib4dZERhad0lsdP2NKx22MNbjKiafytFYfDiaK5g/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3uXudntschChldJ2BBBrYG2TK88uT3SyPIiafwA9riavU48Fa6FsBauicg/640?wx_fmt=png&from=appmsg)

失败

#### 小结

在配置 5 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr></tbody></table>

### 配置 9

```
nodeIntegration: false
contextIsolation: false
sandbox: false


```

分别尝试在 预加载脚本、渲染进程、`iframe` 中进行测试

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S30G4yjadjzqibRzL66jpFrxgesN0VQKoWLBCOqqIRt7ItwhVCHXYSoGg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3hehZPRa8Zh1AlCoSOsiaag7iawox9gsnickGaTbf0ibY7kuRlhhuwJ5H1Q/640?wx_fmt=png&from=appmsg)

成功

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S39eqibI4NibQDEJjHIicSNeQvqQctrib2LcUeD6lFZeKw8G0eMVmyXicF2XA/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3tibhCQzqiaV77iat1MWwp7wjN2zMiar5JLHAxPNtggOtibhU8wGx1aQRxyg/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3ccDhbZBHZke7SviaNT4neyb4srZdpJzkVNR8t9gY2WMfzzGS5vaTj9Q/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3wypHibia3ibSSkpGwRunibtdP3BQuSmE8YXGZFUiatbziapxlL0ic4VCL9lJg/640?wx_fmt=png&from=appmsg)

失败

#### 小结

在配置 9 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr></tbody></table>

剩下就不用测试了了，可以得出结论了

* * *

### Electron 5.0 总结

预加载脚本、渲染页面、`iframe` 测试点在以下情况可以执行 `NodeJS`

<table data-tool="mdnice编辑器"><thead><tr><th>安全配置</th><th>预加载脚本</th><th>渲染页面</th><th>iframe</th></tr></thead><tbody><tr><td>nodeIntegration</td><td>不影响</td><td>true</td><td>true</td></tr><tr><td>contextIsolation</td><td>不影响</td><td>false</td><td>false</td></tr><tr><td>sandbox</td><td>不影响</td><td>false</td><td>false</td></tr><tr><td>额外条件</td><td><br></td><td><br></td><td>+ window.open</td></tr></tbody></table>

在默认配置中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr><tr><td>iframe + window.open</td><td>否</td></tr></tbody></table>

0x05 Electron 19.0
------------------

安装 `NodeJS 16.14.2`

```
nvm install 16.14.2


```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3jEVQNvHJpVr4J9YRP0VfKmzsiajTibP6AXfHFsYpIGEtaAlmASQX6Mgw/640?wx_fmt=png&from=appmsg)

安装 `Electron 19.0`

这回直接用 `Fiddle` 就可以了

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S33ibRQjaS6xHZxyTgd8sncVedwxriaibmFY9SGmRCs1XuHrKujiamkOia8pA/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S39YBbkVGDwxQjxDGrowH6dbONQyI1vnxaPdsEYlTgfEOiaLhQJp6zrvw/640?wx_fmt=png&from=appmsg)

按照官方手册介绍，`Electron 19.0` 默认安全配置

*   `nodeIntegration: false`
    
*   `contextIsolation: true`
    
*   `sandbox: false`
    

### 默认配置

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S31XkfXZOlYsxR3wKSW01wMSFphvpOrwrnZScBe56EakCDo6IAY28cPw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3slhkLMvk77eiaHMtNz7sl2yrqNcocJoxa5ZFdLIVRpZEVq1sCx81Bhw/640?wx_fmt=png&from=appmsg)

成功

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3BV7ibb1Wuks1Aqib2g3yPJ67LsyLcib1m0Tic880icn0ictgvvBVyApPd9iaw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S37rQHfD2lHmfzH1OqPSc9C4AAFHn5sicJO5Xt2KVR9LKf5h7xUm77BRw/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3Izoiacfk727jeYdPknyh9aBzsamyIld9ibOzNKibwpnU6ENVEVLazGm8g/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3tIUeiaQlsfTXV7u8jh2bWzibibcaniaKYDsIjticvXYZ6yjLCujGYgSyM0w/640?wx_fmt=png&from=appmsg)

失败

#### 小结

在默认配置中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr><tr><td>iframe + window.open</td><td>否</td></tr></tbody></table>

### 配置 1

```
nodeIntegration: true
contextIsolation: true
sandbox: true  


```

分别尝试在 预加载脚本、渲染进程、`iframe` 中进行测试

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S38CgWCicErgmFJlVVlDoaqyCqmZsia9EDZmhKmJxwPickHnRHdqibm6ksrA/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S36NWu9RZyqJ8kNfjOAicEQwSxcUSZpcK72spNmZLfTqEicnIiceTbrI7ug/640?wx_fmt=png&from=appmsg)

这里可以看出，预加载脚本就只能执行受限制的 `NodeJS` 方法了，基本无直接危害

失败

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3icL2NSEPsvGs6txQTOdW2IwnMicE3usleGvTDzyKlE28suqqqmtfV7sg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3YeCVfBmZy3GhgqsoHuTlZmyNo0gb6mne4wGBAX35Nbn17Yk9ZAXsNA/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3ccIQbcLReYlVnowciagibprgznvx6ia3LzE9icn21rwTVvAEkica1AkPbHA/640?wx_fmt=png&from=appmsg)

![](../../../../../Library/Application Support/typora-user-images/image-20240413015409087.png)

失败

#### 小结

在配置 1 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>否</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr></tbody></table>

### 配置 2

```
nodeIntegration: true
contextIsolation: true
sandbox: false


```

这回只需要在上一步中不能执行 `NodeJS` 的环境中测试，也就是全部环境了

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3YeexTWGibw4k3dmzP46vH2hIdUX8gYAfZMJyKJcdsicy0OA6HF2NNBzQ/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3icxHLut6sZl9QXe0xNjJzbOeIeIbiazNarqnkMiciaUnj2pxYzM10LcBNw/640?wx_fmt=png&from=appmsg)

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3l1KXRiaz57fjTNEHWMnQCucIhCM5YMV3sEwEkFfP4CZx7MRub2APsJw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3Z1cuyjnL5yBwQJDmuAcjSO1PoNqHxT71NaY9Sva8Egn5GkkJibibIoyg/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3gzQCNImeDGMaFnibW1PfGapepFUxP7zzry6GZLNlicQTmvfPjzukSmdg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3czDULrAk90XazDJe6uRsTtSCptLPPicicok6RyayH4miaYH7WibkKyrtuQ/640?wx_fmt=png&from=appmsg)

失败

#### 小结

在配置 2 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr></tbody></table>

### 配置 3

```
nodeIntegration: true
contextIsolation: false
sandbox: true


```

这回只需要在配置 1 中不能执行 `NodeJS` 的环境中测试

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3LL5eHfdiaqTsj9ow4FepMKyOvGKOic7cTmzSEWCNZd4RTtvjHAQiaHWtQ/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3d5Jpl82RDa4V4A0VFU00ClBz2ZR5M9V27KBupwEnrNXfZodICMz66A/640?wx_fmt=png&from=appmsg)

失败

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S35xnia84TLq3UrtTL9pwl9o7sYdvQHLjfMibu6nETRH2ianM4EwTtwWSfg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3HwQsmfianA5bibEdcf0EkA60yTO2NttBofic2VGIjXQtliaFfJeicA0WdbA/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S37hMWDVV6MDbwwgG2V2ialZZkeOUIibUvejnYjxHUMWwV5qImg4ibSVwPw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S38Z4wjtaYZpcLTLtl4BP4BABe4NETKibC0rD6v1X58ZgNJicY6MfqclAQ/640?wx_fmt=png&from=appmsg)

直接执行失败， `window.open` 执行失败

#### 小结

在配置 3 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>否</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr><tr><td>iframe + window.open</td><td>否</td></tr></tbody></table>

### 配置 4

```
nodeIntegration: true
contextIsolation: false
sandbox: false


```

这回只需要在配置 1 中不能执行 `NodeJS` 的环境中测试

#### 预加载脚本

肯定可以

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S33MficFsicqufbTs71J17sVdVMz5JC9HFgciaLFNPpxG8c3SItUa7hZVBA/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3zYiaXKMfkrlP6bPlCuZFdk4BtnRypICM7Zibkw98icLUSiaqzF2Yicc4PzA/640?wx_fmt=png&from=appmsg)

成功

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3ObPEYWibOHGf7MBOMndpmbIvPtutrS0n1tL4DhTaLXYKMFyng3fdOqQ/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3l55wnr16D4icOcCVNxfntyydibRSeMxFVljsoBk8NQFfXHcrLTLibchBA/640?wx_fmt=png&from=appmsg)

失败

#### 小结

在配置 4 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>是</td></tr><tr><td>iframe</td><td>否</td></tr><tr><td>iframe + window.open</td><td>否</td></tr></tbody></table>

### 配置 9

```
nodeIntegration: false
contextIsolation: false
sandbox: false


```

分别尝试在 预加载脚本、渲染进程、`iframe` 中进行测试

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S36StEBa6SLu2AAelWBpV6a8rh2tCbEo7QVtYs5EAwAHUZvzdDGnucvg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3IRPQZvrIp5G26A1OciaLWs1Lsn6I7xHrVOs8YGDWXDPQlFqKqibUGScA/640?wx_fmt=png&from=appmsg)

成功

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S34UjkeN1vdzv64YdWIVRNaibj7qFCC4XlFWic0a7DpnicTB0uK6iaysBia5w/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3Mey7uIx9z4nJM3ZWBxlICodoX9Pm5Yre1epnfMEIXgfcah1LXdN4PQ/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3yLwOvMz0znU7Bxpuon6VUkxPeNL4KIic5AeojIWcgmyukttjm7Ric1Fg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S33lP7aalrWbrONVrXz9BkduSicibBDDFJ5UoZbFuR1N2oiaaHpnWibQNXTg/640?wx_fmt=png&from=appmsg)

失败

#### 小结

在配置 9 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr></tbody></table>

剩下就不用测试了了，可以得出结论了

* * *

### Electron 19.0 总结

预加载脚本、渲染页面、`iframe` 测试点在以下情况可以执行 `NodeJS`

<table data-tool="mdnice编辑器"><thead><tr><th>安全配置</th><th>预加载脚本</th><th>渲染页面</th><th>iframe</th></tr></thead><tbody><tr><td>nodeIntegration</td><td>不影响</td><td>true</td><td><br></td></tr><tr><td>contextIsolation</td><td>不影响</td><td>false</td><td><br></td></tr><tr><td>sandbox</td><td>false</td><td>false</td><td><br></td></tr><tr><td>额外条件</td><td><br></td><td><br></td><td><br></td></tr></tbody></table>

> 这里不着急谈绕过和覆盖，那是下一篇文章要探讨的

在默认配置中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr><tr><td>iframe + window.open</td><td>否</td></tr></tbody></table>

0x06 Electron 20.0
------------------

安装 `NodeJS 16.15.0`

```
nvm install 16.15.0


```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S39ZoqQ1BI1Ykd1AadbwLmVg6ZmaiaSCibCKpicVQxTgC8oqQNRqA7QtUsw/640?wx_fmt=png&from=appmsg)

安装 `Electron 20.0`

这回直接用 `Fiddle` 就可以了

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S33P41388ujTzTRIibEv4e1xXBPKQe6rZwqjV2O3TXlgnsoA7D9LGRruA/640?wx_fmt=png&from=appmsg)

按照官方手册介绍，`Electron 20.0` 默认安全配置

*   `nodeIntegration: false`
    
*   `contextIsolation: true`
    
*   `sandbox: true`
    

在 `Deepin Linux` 中，`Electron 20`这个版本开发者工具里面的 `console` 打不开，一点就闪退，可能是 `bug` ，所以用 `MacOS` 进行代替

### 默认配置

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S36libhhRM2lTUiaeOh1sWHGgQsCk2mUlw0Ticv7GibxcblaLe7YmlW7F7icQ/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S388DGrKezBma6dR50Chf6qpPmjARybEXhqrvnHib1Vgk1dzwiahXtP4ew/640?wx_fmt=png&from=appmsg)

失败

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3kjxpeznicmgxRNSSTERxurJVhovXCYAMbegReianhzr9vasfjIPY5GAw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3Bc9AxZHfAMb8hy4l0yCRc3mibK5hRyZUpibawRwoOsu1fa61lwkRnmqQ/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S39D7iaJlicXYYjribxlPicbmFdFCJoHxEM3iak0aVFNerTEhibibsgJ3Lmbd3A/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3OATJpU1341uNWZJaS8h0ib1wCia5KHWib6WLd7ibxiaia7anzeZzNRE4zGpA/640?wx_fmt=png&from=appmsg)

失败

#### 小结

在默认配置中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>否</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr><tr><td>iframe + window.open</td><td>否</td></tr></tbody></table>

### 配置 1

```
nodeIntegration: true
contextIsolation: true
sandbox: true  


```

分别尝试在 预加载脚本、渲染进程、`iframe` 中进行测试

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3WfJMJiaoRozzsSmELCRBKyeib2hKXEbOPMiaRZlYD7ficm7ljULWbFms3A/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3GgKZdLUE1qCbcpBiapS4KhmCicibicqqiara6su0woj48icoic9RicXQVYNZAw/640?wx_fmt=png&from=appmsg)

这里可以看出，预加载脚本就只能执行受限制的 `NodeJS` 方法了，基本无直接危害

失败

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3ksFxq8wiaKZkNyEgibUJeJyb9YXEDA8K99diaibuGSK764k9JUOeG8LWKw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3JMW6tcFNx4c8ia3WXeuNFsicQc8icvhMQhGVmHxF4E7H56kBeO5ZwFz1g/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3g6jZLGr8cul0RFY0vEDia19edCwmu3LshCPuJicBftLHldicryEgibpARw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3CHu8aX02KZy7XQmh35XxvnAnp5IKsiaFNWH1K80z1BpRdNRiaW61vwgA/640?wx_fmt=png&from=appmsg)

失败

#### 小结

在配置 1 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>否</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr></tbody></table>

### 配置 2

```
nodeIntegration: true
contextIsolation: true
sandbox: false


```

这回只需要在上一步中不能执行 `NodeJS` 的环境中测试，也就是全部环境了

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3jmXhdZPibo78Qnu2vmmhxzYvFXiaNhokXho2Q7oDfxA4vFI8zMceUfMQ/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3jxsSI9H4mXEkTh35TCf2Fyew6TUh0RZV1FBWz6K1JTfeEFwq2gsslg/640?wx_fmt=png&from=appmsg)

成功执行

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3WvEUBImiaChGebNvQRQ4DPIYkIXKwiaUylhY0T4tLibQYu6HGN6K3v1AA/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3GUeIbrJlomnOMhvlqAZEXq3jIVG6x9Ol0lMiajib4OxdrWyW6GZuzObQ/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3EGdVPQcQmNgerD8icJKpLlSEYaZXC2aVusLVxpp8jwOSVasune3fibLQ/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3W0kmHpIAC6MFDmEWcou2CNq9SW1NPQQaz54GQTLIiagFtRU7sRMfJaA/640?wx_fmt=png&from=appmsg)

失败

#### 小结

在配置 2 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr></tbody></table>

### 配置 3

```
nodeIntegration: true
contextIsolation: false
sandbox: true


```

这回只需要在配置 1 中不能执行 `NodeJS` 的环境中测试

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3tpIBHj8Ao5y5zkvbYeaolhuNCRZWH6VamyflTnFsRIkcht4E0JOkeA/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3ZB2iah5DASepYRgJ6VVW9icuKJ5mhxpfLaZdmYKCrUJtqKDwyUAICqyg/640?wx_fmt=png&from=appmsg)

失败

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3icnqlYl3WVjhx8wkDpTibKFiaUcnWHkNvbzsj08MR6ZfOH1icnY0zlicuwA/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3k20sxbyaOR8UxicbMq8ZJibIHc5plDXibhErjloibGWwf2Z5sgovVSnrzw/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3C0Iel4vyEZOINmzCHSntRKzdI9ubraZlDw1Summhr4wc1yInGprnzA/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3CCbjDErGIGUmlUMCchrubXOk9la2AYRPbtmpPdSCColkhZzic7LtPTQ/640?wx_fmt=png&from=appmsg)

直接执行失败， `window.open` 执行失败

#### 小结

在配置 3 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>否</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr><tr><td>iframe + window.open</td><td>否</td></tr></tbody></table>

### 配置 4

```
nodeIntegration: true
contextIsolation: false
sandbox: false


```

这回只需要在配置 1 中不能执行 `NodeJS` 的环境中测试

#### 预加载脚本

肯定可以

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3ZtACH6fqwP5icibcHXjlENeichBTHalXxtoUx9wian7tWbIeibZxqicl5UdQ/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3FnKsY6Pu8NibKYmQPK7Fom2MwGnF9qKBtiaVSM0FtYACm8lu92GCvPNw/640?wx_fmt=png&from=appmsg)

成功

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3lNWBiaXfESzVQOE8SIWVakfIWUO8gtPzJU2oNE7se6n0F0b4lEMReuw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3Nc5cYbt7TakQquIniaNzSBEyFyTLkK8YMNEribmhrJnOu8jWCdL0bxicg/640?wx_fmt=png&from=appmsg)

失败

#### 小结

在配置 4 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>是</td></tr><tr><td>iframe</td><td>否</td></tr><tr><td>iframe + window.open</td><td>否</td></tr></tbody></table>

### 配置 9

```
nodeIntegration: false
contextIsolation: false
sandbox: false


```

分别尝试在 预加载脚本、渲染进程、`iframe` 中进行测试

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3RH0D6Tx1f28AVNhBPUbKGueo9OgR93hMeQx0FBwDV6YONnBpbBUWuw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3Os2xLOJamdc2JUibPRKbiaH0w29xytRHmfnUUa0DpPMLNuEymyKdr0lw/640?wx_fmt=png&from=appmsg)

成功

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3QGI3CI7tBmyJiaFjwBTV8HTicSxmk9DoDU49wAibT53KvPNnxEdnFGZkg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3gMMySiaILjOpAWcx6SMfMCUhaqOZso2DibBkuHtFnBiaXrmTc29UmQptA/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3gQ8T8cOTEnS7zc0RYxVZu7awFkqkHT2qRPiaa2d9rbg1z7eWTsKuoQw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3TXib7C2pKNdZ2Igdj0zYpIa5AFlfKXPRf5icjqVOk4w66ia23XrSljic3g/640?wx_fmt=png&from=appmsg)

失败

#### 小结

在配置 9 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr></tbody></table>

### 配置 6

```
nodeIntegration: false
contextIsolation: true
sandbox: false


```

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3P94mtn614t222K1IIFnryXPJFHqnt2YNHtyGvAqpB8MAJksrTFfcRg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3LV0PicianPOaJ9vkhTZlmM5KjPyEXGCVUgRrZSBxVDyynKVPTAMQ5s5Q/640?wx_fmt=png&from=appmsg)

成功

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3Qgl9NMDytjkW6bFGsFzuSswhZdLrhGyyBmsWEZ5oiawwvZQGST29egw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3UDUhSYaHE9Yd0xmVTDP8L8g0g6otP1eFfZvwiaxqqNlcXN66pa48FvQ/640?wx_fmt=png&from=appmsg)

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3VhMMpTtpoldMDDVsCSIT7QliaAp2uYuXvuYLr7Y7fZbzPtxGUv16Pvw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3JbB9XvSDfll0l3YS5ImyEaIW03xmPu36Httr7pJkd7O572ZGFM7KRw/640?wx_fmt=png&from=appmsg)

失败

剩下就不用测试了了，可以得出结论了

* * *

### Electron 20.0 总结

预加载脚本、渲染页面、`iframe` 测试点在以下情况可以执行 `NodeJS`

<table data-tool="mdnice编辑器"><thead><tr><th>安全配置</th><th>预加载脚本</th><th>渲染页面</th><th>iframe</th></tr></thead><tbody><tr><td>nodeIntegration</td><td>不影响</td><td>true</td><td><br></td></tr><tr><td>contextIsolation</td><td>不影响</td><td>false</td><td><br></td></tr><tr><td>sandbox</td><td>false</td><td>false</td><td><br></td></tr><tr><td>额外条件</td><td><br></td><td><br></td><td><br></td></tr></tbody></table>

> 这里不着急谈绕过和覆盖，那是下一篇文章要探讨的

在默认配置中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>否</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr><tr><td>iframe + window.open</td><td>否</td></tr></tbody></table>

0x07 Electron 29.0
------------------

安装 `NodeJS 20.9.0`

```
nvm install 20.9.0


```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3ribKJKnkupDI6kLCeRdIaFSdUJSpuTibQMRjq27QkHn0QGpS3S7t0CjQ/640?wx_fmt=png&from=appmsg)

安装 `Electron 29.0`

这回直接用 `Fiddle` 就可以了

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3rGia7orCw48YKyDK8DpaVSKxH1w2DNtB8lueUURWbjSWyKBM3UICEJg/640?wx_fmt=png&from=appmsg)

按照官方手册介绍，`Electron 29.0` 默认安全配置应该和 `20.0` 一样

*   `nodeIntegration: false`
    
*   `contextIsolation: true`
    
*   `sandbox: true`
    

### 默认配置

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3hQgyRpAqgJUWQhhBar6iaibvhTu1ofA9FDiaIicyZmjliacdBItQ0bqJ8RQ/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S35QZ8RMmXhNXOM1F782vq5amw1Ca7XGJxqks08Ot2J3nTOPbv24diatw/640?wx_fmt=png&from=appmsg)

失败

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S32D48o5tHibdfl96BrvzYoxzPH5TlwNroxJepSxj8PUMk3twMuqoDAYw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3OsIpX5aHicFdyDqic5MZhHLLwibSqlIME5GibHellhZxxdYIOCDdnhN15w/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3xMiaBiaicqO61pynhrIvNBXZn5sibDzUQaiarMj3q28NZiaSfb7cOHIhOTYQ/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3icwqaBuLKgichuXHVvkwQJNYjXrY6rpqJqk1fLNDgZYsPkh9yFZh7Mfg/640?wx_fmt=png&from=appmsg)

失败

#### 小结

在默认配置中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>否</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr><tr><td>iframe + window.open</td><td>否</td></tr></tbody></table>

### 配置 1

```
nodeIntegration: true
contextIsolation: true
sandbox: true  


```

分别尝试在 预加载脚本、渲染进程、`iframe` 中进行测试

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3ibiaiaAyMhLGW23dAEaDSp2orWicnHJFFafnGFDbkeib3ibLibSTQ1fUKyWwg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3HpHMtWCR4qBL0pr9DyJHGQWh7DsQeM5jpXklS0HM3o9XLCEib1sJHsw/640?wx_fmt=png&from=appmsg)

失败

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3gAbCdo0W5D1In50icxpaspm7QtAv4fM5IPPn0My3NzMX4XQNxBjiaCAQ/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3pKjUYKhQHC4JmWMvA70iaI9lM9mGrNzd2X1HibM1cymndwbQpBHnKuzg/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3rb2bEKsiaVxEhqL5tTDHR0cia1LaUibkdZeyCgBPQLJQ5rHxS0PostImg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3JA4YyjOWcdzsv4uBy7zCHtZbzYaXC5bdtnH1YVQx1y1Lt6k9icyAtpw/640?wx_fmt=png&from=appmsg)

失败

#### 小结

在配置 1 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>否</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr></tbody></table>

### 配置 2

```
nodeIntegration: true
contextIsolation: true
sandbox: false


```

这回只需要在上一步中不能执行 `NodeJS` 的环境中测试，也就是全部环境了

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S32bvmrniaSWbERh7vfViaPTLpWK91BS9EVrZ5wg0H3CoJKXOO0npn0SWQ/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3FRc6AJ6MdymibWYqjERYakUbgSuh5hbrricfSqbUjzfu5RiaXXnXZQZgg/640?wx_fmt=png&from=appmsg)

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3KoXTgSSuZqMkibJ4aTxlFY3O47VuygLKLA2H20SpC0Wicm1lic092z2Vg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3T63QvGticTgzMCwNpb47ev393HVyv1YOIprbGyKPI4J3HKekMXo3e2A/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3NRJWACeibtvBNtaphCT6Fznract1rYc2qVic86trb0ibLzELRJ1GgCjWg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3VIpgkfrXf7b4dmWIlj1iby9HeFjzmJ9nF1QC1xrgicxd0vC7YzgUdIicw/640?wx_fmt=png&from=appmsg)

失败

#### 小结

在配置 2 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr></tbody></table>

### 配置 3

```
nodeIntegration: true
contextIsolation: false
sandbox: true


```

这回只需要在配置 1 中不能执行 `NodeJS` 的环境中测试

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3McwjyvHzl64rCIS5ywu5HpibibJaqWN8bFGcyhUwARibOnehJvscDzibcg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3AdCKmhrkaUxxt7KKBtiaicibkSKYJlU08567uLHnqmM49OibqJ0MaHFM9w/640?wx_fmt=png&from=appmsg)

失败

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3ia8oRpicIeKsbYBxSib5VEeuuUj1Dia3yxC9GVjVDrjOsEYiawjQXc6NiaGA/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3wCLchCDw7MSwr8lgstBL2NGemuXXBia2fq1icvwwvT1MT6gX8L5kiafRg/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3lBWRtSfHv5HoZesGKia7mNkKZjT4iaZHm2zw6pxlLPXialAP3DsXo5CXw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3DBUK23rSC2iciaY40wZYKk8kDYiby1WEbpczkaJbKCNCnsVaehydVop5w/640?wx_fmt=png&from=appmsg)

直接执行失败， `window.open` 执行失败

#### 小结

在配置 3 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>否</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr><tr><td>iframe + window.open</td><td>否</td></tr></tbody></table>

### 配置 4

```
nodeIntegration: true
contextIsolation: false
sandbox: false


```

这回只需要在配置 1 中不能执行 `NodeJS` 的环境中测试

#### 预加载脚本

肯定可以

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3qWkdsfiasqltuE9PibcbWOuUcia6LwhGhn315U93bKibVXMicLTeur7icb0w/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3c8XlEzA6QPOL7o24XJwNogiaSR6zx7jUSeOyS3QZ5jzV2QgyKn4NYWQ/640?wx_fmt=png&from=appmsg)

成功

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3Ay4hYuSIKh7lGM10icnSuhSVSMxf03ictFqQbegCAZYicViboKxFen5GUg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3ly49HfsyGza9cnsJqkBgzYa8MTT95caiaspeKLe485gLNIsNibZXdu4g/640?wx_fmt=png&from=appmsg)

失败

#### 小结

在配置 4 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>是</td></tr><tr><td>iframe</td><td>否</td></tr><tr><td>iframe + window.open</td><td>否</td></tr></tbody></table>

### 配置 9

```
nodeIntegration: false
contextIsolation: false
sandbox: false


```

分别尝试在 预加载脚本、渲染进程、`iframe` 中进行测试

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S30GS3al52rerN33Uca4JCNTOJwia7rKaZqmcZFbU1qPNzqGHwYic1koBA/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3cL4ATvUKxKO42EicxtAnrQIJwDag0BGMfZNdSRzgECradB8EdFPnzvQ/640?wx_fmt=png&from=appmsg)

成功

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3PB1kJOjLelkwoLNGOIAgfMmiaTibM7RIn60T4NQ46OrL3qJdFlic0XZCQ/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3FEiapVR6643KiaBoIbsSrJ6e74n9zOgpLtRKrYw7U988JfII1OJRvyLQ/640?wx_fmt=png&from=appmsg)

失败

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3ImicZlTgw5uyaIUV3WYQYCC50jz9fY90VV6GPmRianAFvhPMkJOC33xw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3QUjD8IeogCvkj70tTticiaotib0lsDQc2R7IMISODzB2CKIWXfsBQ72Cg/640?wx_fmt=png&from=appmsg)

失败

#### 小结

在配置 9 中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>是</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr></tbody></table>

### 配置 6

```
nodeIntegration: false
contextIsolation: true
sandbox: false


```

#### 预加载脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S346R4cMFXpqLWFDqJnpT4lhSOEt6ib1gnGgq9VfL5DbtfTYpg3eJibMHg/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3eDVYD9nueQzD4O3BqDDndPpn1E49qVsEWnvQwWZxzoF7gzfSDk7jHQ/640?wx_fmt=png&from=appmsg)

成功

#### 渲染进程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3pZv2icZ4hQGafxqkv5JuA5XxOTkaibjlJLB1xZvibAR1CT98vORH70jgQ/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3p0icUEfSdPS3Nic4PUmedoHCNoemSf2ESKoufDSMaz7C6AEia3TK7Ax5g/640?wx_fmt=png&from=appmsg)

失败，而且因为 `bug` 还不允许打开 `console`

#### iframe

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S35qwYpBaoNR9mQXfNlwj7H2yj0v0WiamXYDyZMvQ0xicRSeNYr7BLoB0Q/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3OmM6wf2HGTfsZq1xEN8u8oSRbCUUYN3vP8DicQ7wMmd5otO3iabib6Jfg/640?wx_fmt=png&from=appmsg)

失败

剩下就不用测试了了，可以得出结论了

* * *

### Electron 29.0 总结

预加载脚本、渲染页面、`iframe` 测试点在以下情况可以执行 `NodeJS`

<table data-tool="mdnice编辑器"><thead><tr><th>安全配置</th><th>预加载脚本</th><th>渲染页面</th><th>iframe</th></tr></thead><tbody><tr><td>nodeIntegration</td><td>不影响</td><td>true</td><td><br></td></tr><tr><td>contextIsolation</td><td>不影响</td><td>false</td><td><br></td></tr><tr><td>sandbox</td><td>false</td><td>false</td><td><br></td></tr><tr><td>额外条件</td><td><br></td><td><br></td><td><br></td></tr></tbody></table>

> 这里不着急谈绕过和覆盖，那是下一篇文章要探讨的

在默认配置中

<table data-tool="mdnice编辑器"><thead><tr><th>测试点</th><th>是 / 否可以执行 NodeJS</th></tr></thead><tbody><tr><td>预加载脚本</td><td>否</td></tr><tr><td>渲染页面</td><td>否</td></tr><tr><td>iframe</td><td>否</td></tr><tr><td>iframe + window.open</td><td>否</td></tr></tbody></table>

0x08 小结
-------

将以上几个版本的总结贴到一起，如下

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3JXSOlDDkcjtJkzhGmxL8TNNmDcVhHGONzBGo41NLw8sH1BDz8PZKQA/640?wx_fmt=png&from=appmsg)

相同的配置在不同版本下表现的结果并不完全相同，在 `5.0`和`19.0` 之间的重大更改中，并未提及 `sandbox` 对页面影响的变化，但实际上至少在 `19.0` 版本开始，预加载脚本想要 `NodeJS` 能力必须设置 `sandbox` （这里的 `sandbox` 是指主进程创建窗口时候的 `sandbox`），那到底是从哪个版本开始的呢？

所以我们需要再次测试了，但这里就不把过程中展示出来了

**从 `Electron 6.0.0` 开始 `sandbox: true` 时， `Preload` 脚本的 `NodeJS` 环境为受限环境**

**再此之前即使设置了 `sandbox: true`预加载脚本还是可以加载并使用`require('child_process')` 这种模块**

经过测试 `iframe + window.open` 的问题在 `Electron 14.0.0` 中被修复

0x09 总结
-------

从上面的对比结果可以看出， `nodeIntegration` 的作用确实是主要在于渲染进程是否具备执行 `NodeJS` 的能力，只有当 `nodeIntegration` 被设置为 `true` 时，渲染进程 (这里不含 `preload`)  和 `iframe` 才有可能获取到执行 `NodeJS` 的能力，但也同时配合关闭上下文隔离和沙箱

如果采用默认配置，则三个配置项的时间线如下

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S3whpPjMOwybic0oog04fPdZEBZKDNOnIcNXS19G2yvLIgK6yVUkYYqqQ/640?wx_fmt=png&from=appmsg)

如果从攻击测试视角查看默认配置项时间线如下

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fZT30hrVgRcXtFUoVbc2iaBd48LiaJia0S33Mne0xnelfCXdT8DjictXMqoXvbUia1KFRJicXH7Pdia37typ6yWlaV9kg/640?wx_fmt=png&from=appmsg)

当然，这个是从这篇文章出发的，这篇文章主要讨论 `nodeIntegration` 这个参数，其他攻击手法及时间线没有放入图中

这里再次呼吁，对于 `Electron` 程序，我们至少可以按照上一篇文章 [Electron 安全与你我息息相关](https://mp.weixin.qq.com/s?__biz=MzU1NDkwMzAyMg==&mid=2247500135&idx=1&sn=fe0f27a3d49a57b19df6fa1b23150645&scene=21#wechat_redirect) 中介绍的普通用户可操作的检查方式对使用的应用程序的安全性进行检查，进而决定使用该程序时的注意事项以及要不要继续使用，当然更好的是向开发者提出建议，采用更安全的开发方式

0x10 PDF 版本 & Github
--------------------

PDF 版本下载地址

```
https://pan.baidu.com/s/164fZ7KXzD_jktW_UG3oA2w?pwd=zcj9


```

我们将 `Electron` 安全相关的内容建立了一个 `Github` 项目，地址如下

```
https://github.com/Just-Hack-For-Fun/Electron-Security


```

往期文章
----

*   [Electron 安全与你我息息相关](http://mp.weixin.qq.com/s?__biz=MzU1NDkwMzAyMg==&mid=2247500135&idx=1&sn=fe0f27a3d49a57b19df6fa1b23150645&chksm=fbdef5e6cca97cf083147a6fb5c85b87c7bb6da92ede5cb9dae29b3d55639388e227087e1209&scene=21#wechat_redirect)  
    
*   [远程调试的利用](http://mp.weixin.qq.com/s?__biz=MzU1NDkwMzAyMg==&mid=2247499809&idx=1&sn=439aeaf8f795725cb2fb777503eb2856&chksm=fbdef4a0cca97db6a666a29ce55d492920772ca6f62dd5f250b969dc575dd88255389611a490&scene=21#wechat_redirect)  
    
*   [JS 代码混淆  |  js 逆向系列](http://mp.weixin.qq.com/s?__biz=MzU1NDkwMzAyMg==&mid=2247494073&idx=1&sn=1dacff867f7cdb123294a6e5218489e6&chksm=fbdedd38cca9542eaf60de2b6c12f6ab67930dad37ec6585b339e345844b25d6640b045d8565&scene=21#wechat_redirect)  
    
*   [JS Hook |  js 逆向系列](http://mp.weixin.qq.com/s?__biz=MzU1NDkwMzAyMg==&mid=2247493902&idx=1&sn=69c1019110fed77d2cd2ebb8507a0a8b&chksm=fbdedd8fcca9549917ad2523ea64a3da21c027bc37e78756cdde7b70e05f7bc0f16a5ceccd9f&scene=21#wechat_redirect)
    

![](https://mmbiz.qpic.cn/mmbiz_png/fZT30hrVgRePhExdNHBxNXo5ykEQRnV6h5D294E334CzZaiaFRfibvESn4icHoenCrJf06jfJNVBZwpaAmCZbM6Gw/640?wx_fmt=other&wxfrom=5&wx_lazy=1&wx_co=1&tp=webp)

有态度，不苟同