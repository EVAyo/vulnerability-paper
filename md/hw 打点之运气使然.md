<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/amNHL9Hhfs--d8pmrQBBrg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/DuibU3GqmxVmRsdItbBVRKegNHicHQvAHDdZsGpLVU7touSU1AU1twHTfRjG3Vu5aUh0RnPPllfVUhs4qdWF5QYQ/640?wx_fmt=png)

声明：Tide 安全团队原创文章，转载请声明出处！文中所涉及的技术、思路和工具仅供以安全为目的的学习交流使用，任何人不得将其用于非法用途给予盈利等目的，否则后果自行承担！

![](https://mmbiz.qpic.cn/sz_mmbiz_png/9zYJrD2VibHmqgf4y9Bqh9nDynW5fHvgbgkSGAfRboFPuCGjVoC3qMl6wlFucsx3Y3jt4gibQgZ6LxpoozE0Tdow/640?wx_fmt=png)

0x01 目标
-------

目标是一个登录的页面，

还有配套的验证码，手工尝试几次后放弃

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmkplj5o5wLPklBhDzSuc2f6fef5jN7Wze2p9tGeVXMtSHERicTapibkpA/640?wx_fmt=png)

因为存在 waf 所以路径一扫就封。

0x02 历史漏洞
---------

从这儿可以看到下面有开发公司的名称

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRm4QXImcGHWpTlg8opfWHohW2RwJzA6n5BiaVg62sibXzUAGvDZT8ibiadyw/640?wx_fmt=png)

于是直接去搜索公司 + 系统名称, 结果在 cnvd 发现曾经的漏洞。任意文件上传漏洞。

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmicEFaYdPDYEOAg7nfdrRglurAWvvc1IBOSicFoRq5u6g73oCicsrUFltg/640?wx_fmt=png)

漏洞详情中存在漏洞具体的路径，于是直接访问查看。

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmFBSCCwUUeeBPppxXnWqsCvrmBlTCFATAiamoLFGJZhJkhKTZqLt1Ydw/640?wx_fmt=png)

本以为是需要构造下数据包之类，这下鸭子喂到嘴里了。burp 启动～ 选择文件 -->

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRm9eRU3rKN2Q5a9Rl26dIcmCVlyXEulT2AMKcTticYQHibq4q7V8TI2mvg/640?wx_fmt=png)

上传 --> 点不动！

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmWCUDiaLmDgNgYvYmdoyZNEylic8kMvPebcy4jVw5K9WdggIvibwI9cY6w/640?wx_fmt=png)

竟然没有任何反应，猜测浏览器问题或者上传按钮被嘎掉了。IE 启动～

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmuBX2SubkafVhYIyjCrC5QzXeDrhoaEW2DUYx7yw8kAj3xgM8qV15YQ/640?wx_fmt=png)

依然不行，于是构造上传。

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRma1uAZ95ibN0SOFfGDDVJiaMnH014R7LqTMYGzIwAf3Zia4t4LlvTeXhJw/640?wx_fmt=png)

还是不行

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmDVvkSHaA0ecX2SSraicQWqwJwPqnc8j1uJpEXia5CcfhGNhbiavoKYEkw/640?wx_fmt=png)

返回页面依然是这个前段页面，所以需要找到真正的上传路径。

0x03 照葫芦画瓢
----------

既然 cnvd 收录了，那肯定不止有一个改系统，所以找一个相同的系统存在该漏洞的，然后替换数据包肯定行。

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmLSxatzFR21bko4kROLibw8kxqqwMeHnnffPzFeDOeKmZvyp87RzhJgA/640?wx_fmt=png)

直接去 fofa 搜索公司，发现的确存在几套系统。大喜 ！遂复制路径，继续开测。

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmR0oMk9WEjs6RhxNO39icjM0qicl1R9jksgFamFOOeiaLZ0ShSMga5EB2w/640?wx_fmt=png)

结果发现上传按钮皆不行。

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRm5HLetogHBia6tEdVDF5sVvHX06znGgv5qyAfCv9PBxb5Nbribbt93Juw/640?wx_fmt=png)

秉持着不能空军的原则，既然上传不行那我就开扫，扫不出来就爆破。于是就把搜集到的这几个站都扫描一遍，发现其中一个站存在目录遍历。

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmo1SdziaemXSVn8VbYjJv1XyHOsTjJDqlER2BKghTOEwsCcYCjUTpaZA/640?wx_fmt=png)

放眼望去全是上传，妙！

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmAYuTNfKmtgIITjKPgKv5fLYzxGib0j9gPwsbnRO2iakW6GLb6HBPmDIg/640?wx_fmt=png)![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmBSj6VBHJ7QaXdj4BDnVZDYApMql8A3m3ROUF3XZGupQQLvsic0iaxg5g/640?wx_fmt=png)

可以上传，返回路径！但是黑名单～

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmiaczVS1RcRiaA89oMdabsV1UXmCJ2bb4PV4uPvXAqVbiaDBBtU1mUaicKg/640?wx_fmt=png)

不甘心，于是挨个测试，发现 aspx 后缀非黑名单即白名单。asp 后缀则有点问题。

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmurIIEMoRfxjWLqNr5Ze3VHplbR0Lkjmq7tPkklbNSbhE57cwShjuJw/640?wx_fmt=png)

白名单

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmOuF5ibpSxz5Wvn2ZJv2ayomSgtQkF0021vDxYibaibIgT6bz1SIyBaqOw/640?wx_fmt=png)

无奈～

0x04 峰回路转
---------

本以为到此结束，想到了 fileUpload_summernote.asp 的空白页面

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmurIIEMoRfxjWLqNr5Ze3VHplbR0Lkjmq7tPkklbNSbhE57cwShjuJw/640?wx_fmt=png)

有没有可能它就是那个真正的上传路径，构造数据包试试

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmPUxvy3lUaT3eltwa0IKB4CyBzLEdFX1DGzm2V7HxKjXGz6IDkQ8Tww/640?wx_fmt=png)

返回 500～

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmjuJ2BiaJPkx10M2nCrmar7sZph1dMo0OxibYh01icI26SicykhGjUbB2rA/640?wx_fmt=png)

因为上面上传正常图片给了一个路径

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmYtEJF71JtPkr9dS7ImqPFzGFq6YwIFEgiah14KkKHiaRvfPKggYNWuHQ/640?wx_fmt=png)

不死心的再来看看 嘿～您猜怎么着～ 它还真在啊！

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmEtMvWZa232DWLlvhAicMIAwNicZOAzN9AgkjofTe4quGxdljib2yrJMibA/640?wx_fmt=png)![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmBMQoPMbp1ObWZcL1yGyVco7LHiadNgytf6nykNdoY9sxSWfSQ1EBaTQ/640?wx_fmt=png)

拿下拿下，幸福来得实在突然。

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmMNG2MpdDA4S7WjmMnwPaZqYuyibXZVrWia8R8iaXaib7iacq1LiawKSnc5bA/640?wx_fmt=png)

回到目标上直接梭哈搞定。

0x05 结语
-------

在拿到权限后怀着好奇心又去看了看源码，首先是上传的黑名单 很明显是一个一个后缀去对比的，没啥好的办法。

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmicncS9Ct5GlqGPoibGibAuKyNQ5szZH0oPJMkHbkz9evibKicpCWlkqDpzg/640?wx_fmt=png)

然后又去看了看白名单。这里首先获取文件名 --》文件名转成小写，然后通过获取到的文件名去和白名单做对比，如果没有白名单内容则 “FilesType”!=1 然后提示只支持白名单文件。

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmVKTbDsOkVxewTjos7bIt59LuWubI4p5XYsuDXu5wdnKHiaU0WkCx1Ww/640?wx_fmt=png)

那么问题来了这里他获取的是整个的文件名称，以及做对比的也是整个文件名称。

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmcAKj3JDAo9zGuDQexQIDCmcwtkOyQJwkgFD7QXGJR4RJmszRA0wK0g/640?wx_fmt=png)

所以说并不是获取的后缀去做对比那么是不是就可以这样写然后绕过。123123.png.asp

![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmxOoERvR6Plq7q7kjxzGR9Q7Gia4ksuvqYeNZHfiab2SO8R2TpHhVAjiaQ/640?wx_fmt=png)![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRm5ic5Vvov2yXE7aYaCh8819tS3EuOIBAyDqdhTia9AFXmM2pntYuCcIAg/640?wx_fmt=png)

绕过。收工！![](https://mmbiz.qpic.cn/mmbiz_png/rTicZ9Hibb6RVBqSuhBPSg3UYXOHBJiccRmrDGawGgiarFblK0icGGnbDCiaZWo4aoGlN4P8w6xUxRbudJlPsgTpfjYQ/640?wx_fmt=png)

往期推荐

[敏感信息泄露](http://mp.weixin.qq.com/s?__biz=Mzg2NTA4OTI5NA==&mid=2247500219&idx=1&sn=8da48a9a049bab2f9215ad373868a1a5&chksm=ce5de3daf92a6acc7c2a58329c913062e9c34a9615ce742b761b2775916781abb50159a7d2d7&scene=21#wechat_redirect)  

[潮影在线免杀平台上线了](http://mp.weixin.qq.com/s?__biz=Mzg2NTA4OTI5NA==&mid=2247499902&idx=1&sn=59cba8d980b4ecb0deefff99edaabd4d&chksm=ce5de21ff92a6b09a8972a0144557b0099e443aa8e018b17151c816fc7f08f3615ecb22617fc&scene=21#wechat_redirect)  

[自动化渗透测试工具开发实践](http://mp.weixin.qq.com/s?__biz=Mzg2NTA4OTI5NA==&mid=2247498466&idx=1&sn=085c15679436dedb06a179ca8d47951a&chksm=ce5dd883f92a5195ef74ac517741f6d3da0da40b5501d72016e52cb70344904bb85b8aef65ba&scene=21#wechat_redirect)  

[【红蓝对抗】利用 CS 进行内网横向](http://mp.weixin.qq.com/s?__biz=Mzg2NTA4OTI5NA==&mid=2247492640&idx=1&sn=43b1991dc5628eab322923083fde8d70&chksm=ce5dc641f92a4f57ffb18e2977644b1f977fcc5e0eccdf10956d3ae4ce70dc95024500631e89&scene=21#wechat_redirect)  

[一个 Go 版 (更强大) 的 TideFinger](http://mp.weixin.qq.com/s?__biz=Mzg2NTA4OTI5NA==&mid=2247498344&idx=1&sn=3679330363ff6890166b09f6a502f769&chksm=ce5dd809f92a511f6066fcbb12fb5c1dc8c2642e4e2690dad64d76cc6f9247eae356d16f5810&scene=21#wechat_redirect)  

[SRC 资产导航监测平台 Tsrc 上线了](http://mp.weixin.qq.com/s?__biz=Mzg2NTA4OTI5NA==&mid=2247499823&idx=1&sn=065ffeae6bd02fff922cfb12c5a0f4df&chksm=ce5de24ef92a6b58f709260b691e6b36e4a53aac00d3022946302b8e638696ed55c70e13e16f&scene=21#wechat_redirect)

[新潮信息 - Tide 安全团队 2022 年度总结](http://mp.weixin.qq.com/s?__biz=Mzg2NTA4OTI5NA==&mid=2247506056&idx=1&sn=ad6dd23f58f5fd8ce899a1e292f5b685&chksm=ce5dfae9f92a73ff4f14c812436cb5bfecb29db04eada11c409e946d5338c82a92bcaa425736&scene=21#wechat_redirect)

[记一次实战攻防 (打点 - Edr - 内网 - 横向 - Vcenter)](http://mp.weixin.qq.com/s?__biz=Mzg2NTA4OTI5NA==&mid=2247498965&idx=1&sn=655548831da6808a020ad07294a92e60&chksm=ce5ddeb4f92a57a283d5692c246e54655319ab0d09f6403e354300a2777cda6ae4c787631ab3&scene=21#wechat_redirect)

![](https://mmbiz.qpic.cn/mmbiz_gif/rTicZ9Hibb6RWbGNtVfIZbm2rmGO4hQDzQUrLN62vEGlA4fPmib5utUAp9gbQicb6FC82RjsVI5vx7wEc9yAAiaFEoQ/640?wx_fmt=gif)

E

N

D

  

**Tide 团队产品及服务**

**团队自研平台**：潮汐在线指纹识别平台 | 潮听漏洞情报平台 | 潮巡资产管理与威胁监测平台 | 潮汐网络空间资产测绘 | 潮声漏洞检测平台 | 在线免杀平台 | CTF 练习平台 | 物联网固件检测平台 | SRC 资产监控平台  | ......

**技术分享方向**:Web 安全 | 红蓝对抗 | 移动安全 | 应急响应 | 工控安全 | 物联网安全 | 密码学 | 人工智能 | ctf 等方面的沟通及分享

**团队知识 wiki**：红蓝对抗 | 漏洞武器库 | 远控免杀 | 移动安全 | 物联网安全 | 代码审计 | CTF | 工控安全 | 应急响应 | 人工智能 | 密码学 | CobaltStrike | 安全测试用例 | ......

**团队网盘资料**：安全法律法规 | 安全认证资料 | 代码审计 | 渗透安全工具 | 工控安全工具 | 移动安全工具 | 物联网安全 | 其它安全文库合辑  | ......

扫码加入一起学习吧~

![](https://mmbiz.qpic.cn/mmbiz_gif/bL2iaicTYdZn4bib2lic6dng5krLaNOdrDVLcLylWP1Op3Kibz2n6pOZjibrFd1xATEoZ6dXhaicMLgRQSicNQwGmDwicvA/640?wx_fmt=gif)

![图片](https://mmbiz.qpic.cn/mmbiz_jpg/rTicZ9Hibb6RUGxmZ0l89buUNbyVALKxic2nM7hnDCkAKIrjKhdcDfVkGq3PxNzgs7m55BBMwmicc0AvFpYcrd6J6Q/640?wx_fmt=jpeg)