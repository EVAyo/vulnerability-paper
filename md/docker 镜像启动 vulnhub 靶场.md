<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/QFf7SiKiC5BjOPsXHTNQ_Q)

![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgJHGxRSfVlI02pBf15B0slPyoWRWfSP0mM3LqDQKhOhVwfvVKma68JRwQ7E2Oysib3Nsw5ny7uaSw/640?wx_fmt=gif&tp=webp&wxfrom=5&wx_lazy=1)

**前言**

最近打算搞一个新的系列，实战打靶 vulnhub，然后每个靶场都会开放一周给大家一个在线环境去练习，但是买的云服务器都不开虚拟化，后来想着用 docker 去运行 vmware 的虚拟机，百度搜了一下居然真有将 owa 和 vmdk 格式的文件转为 docker 镜像的方法，自己搭建测试了一下没什么问题，给大家分享一下，如果不方便在本地搭建的话可以自己买台云服务器，在服务器上搭建这种靶场。

![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgJHGxRSfVlI02pBf15B0slPyoWRWfSP0mM3LqDQKhOhVwfvVKma68JRwQ7E2Oysib3Nsw5ny7uaSw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1&tp=webp)

**转换方法**

先将 vmdk 格式文件转为 raw 格式

```
qemu-img convert -f vmdk -O raw DarkHole_2-disk1.vmdk dark.raw

```

需要先执行：

```
apt install qemu-utils

```

安装一下 qemu-utils 工具

![](https://mmbiz.qpic.cn/mmbiz_png/WAyrRuvrubHaoWTwHC6mCO541AMZSnqIO5dSPmn9MibibhfOAfOVuw0Us1STuicQVGjEFS4oL9HpP6AoibIqF02Q7w/640?wx_fmt=png)

第二步用 guestfish 打包  

也是要先安装一下：

```
apt install guestfish

```

安装好后执行：

```
sudo guestfish -a dark.raw  --ro

```

![](https://mmbiz.qpic.cn/mmbiz_png/WAyrRuvrubHaoWTwHC6mCO541AMZSnqIjXenic6I07L4eDJrAjpqZIIa0rPIxdU3HWCib65mg5Ql3ZuoDiakLWyOQ/640?wx_fmt=png)

然后进入工具的命令行

再依次执行

```
run
list-filesystems
mount /dev/ubuntu-vg/ubuntu-lv /

```

/dev/ubuntu-vg/ubuntu-lv 这个路径是通过 list-filesystems 命令返回结果得到的

![](https://mmbiz.qpic.cn/mmbiz_png/WAyrRuvrubHaoWTwHC6mCO541AMZSnqIa8vzxdcauAZp6e9LR4terJeJzAjHP9bViaZGd0kAbXAIVkaTymb4HTg/640?wx_fmt=png)

然后打包

```
tar-out  / - | xz --best >> ubuntu.xz（这一步会花费很长时间）

```

最后导入压缩包到 docker 并启动    

```
cat ubuntu.xz | docker import - ubuntu-server:v0.1

```

![](https://mmbiz.qpic.cn/mmbiz_png/WAyrRuvrubHaoWTwHC6mCO541AMZSnqIhZx8ic6vj4hkaleR4jrBSb2aXqIlNm7aB62vfTobMgADeZYiaaCc3Ixw/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/WAyrRuvrubHaoWTwHC6mCO541AMZSnqInYL28HxBIRHB6jmuFlb1WCFIdLTHPX1IicAIDASdlZricduY4dlyhp3A/640?wx_fmt=png)

然后启动 docker 即可

参考文章：https://www.cnblogs.com/missed-forest/p/17669312.html 

![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgJHGxRSfVlI02pBf15B0slPyoWRWfSP0mM3LqDQKhOhVwfvVKma68JRwQ7E2Oysib3Nsw5ny7uaSw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1&tp=webp)

**关于我们**

![](https://mmbiz.qpic.cn/mmbiz_jpg/WAyrRuvrubGNIiaG0Mg4FZ85BtUFLg9pXeTIwxZmgUMKEvTFickkUThj7JYYZSEnc910eHc2j6ppDqceqNK9qEEg/640?wx_fmt=other&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1&tp=webp)

群内不定期更新各种 POC

![](https://mmbiz.qpic.cn/mmbiz_png/WAyrRuvrubEnmrSbNrxiapV7OuFGHcbphCxSX3ia3k3iazWrpKcmMcSS2Npibicl6dKeEYmSSzUlaFtL5Mu9wrCTspw/640?wx_fmt=other&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1&tp=webp)

![](https://mmbiz.qpic.cn/mmbiz_png/WAyrRuvrubGbqzHel6ZMgMG9a267xj5TPLicxCCde3VgckZyUoJ6ZYWoicsO3K2AeuCIQ2To6o6SibCurdtkkBNXg/640?wx_fmt=other&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1&tp=webp)

![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWiaHpokNh4uWxia9Vv2eYjfzjK9Euejia8GQQAicPWkJI7HfpDplIlc3tPr73ZYKHIdg9kIHpWaJia2tGA/640?wx_fmt=gif&wxfrom=5&wx_lazy=1&tp=webp)

**点分享**

![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWiaHpokNh4uWxia9Vv2eYjfzjXjW9bUCoUia7g4iaVGGGm5AKWRMoDMQoFDdJuiceofhPJ8SJpKSGToZcw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1&tp=webp)

**点收藏**

![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWiaHpokNh4uWxia9Vv2eYjfzjAEe2Bq3UgWlgxribzfYtnQ6EVkxkao5qmK0xpaoycfHyGVl7zFicPGibw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1&tp=webp)

**点在看**

![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWiaHpokNh4uWxia9Vv2eYjfzjDia9eCL6sIvuL17F5uKHsjx0GNc6estct1jOfWh4EtOcVsvzynOar1Q/640?wx_fmt=gif&wxfrom=5&wx_lazy=1&tp=webp)

**点点赞**