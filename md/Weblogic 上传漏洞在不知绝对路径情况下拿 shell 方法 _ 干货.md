<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/NZb6NElACzT5YjMIy0N2Gw)

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450ATcz6jUJnFNeOxRzVZ9Lbc0INLwTJTZT1GaNutZrfDn6csvjBoS2ox0efLUEexXqPEcVbYfbLo8w/640?wx_fmt=png)

 **Part1 前言** 
--------------

**大家好，我是 ABC_123**。Weblogic 曾经爆出一个上传漏洞，漏洞编号是 CVE-2018-2894，这个漏洞利用起来稍微有点麻烦，很多朋友由于不知道绝对路径而没法上传 shell，从而放弃对其的进一步利用，ABC_123 曾经搭环境尝试了各种方法去解决这个问题，接下来给出自己的研究成果。

 **Part2 技术研究过程** 
------------------

*   **上传漏洞利用步骤及分析**
    

首先复习一下 weblogic 上传漏洞利用过程，一般情况下，存在上传漏洞的页面是 **/ws_utc/config.do**，在 “**Work Home Dir**” 处会自带一个绝对路径，一般是 /u01/oracle/user_projects/domains/base_domain/tmp/WSTestPageWorkDir，然后可以结合上述路径更改为如下路径，接着上传 jsp 文件获取一个 webshell。

/u01/oracle/user_projects/domains/base_domain/servers/AdminServer/tmp/_WL_internal/com.oracle.webservices.wls.ws-testclient-app-wls/4mcj4y/war/css

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dq1Q8s4COc7InkMO0jIGjiaQ9P5LiagXxCwHAHfPwibt7ZKOmias7jj4fA4yUhxpMtE1ejAvhhVOJRqg/640?wx_fmt=png&from=appmsg)

上传成功之后，根据返回的网页源码，将 jsp 的 webshell 的时间戳与相对路径结合，就可以得到 webshell 的完整 URL 地址了。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dq1Q8s4COc7InkMO0jIGjiaEpt5vytMlpeLdqcRZx20icNs8t2z5vTbPR8DKfcwQ1NXSCBy53Ksn2A/640?wx_fmt=png&from=appmsg)

但是我们经常遇到的情况是 “**当前的工作目录**” 是空的，或者是被其它攻击者给随意更改成错误的路径，导致不知道绝对路径导致上传 webshell 失败，那如何解决这个问题呢？

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dq1Q8s4COc7InkMO0jIGjiaz3xED5ePeTnJv04cq6Wy9heTyrMuJTQelmlTNIXNpcWClkC5Kc8WZg/640?wx_fmt=png&from=appmsg)

首先我们做一下尝试，将绝对路径更改为以 **servers/** 开头的相对路径，发现也是可以上传成功的。通过试验我们发现，此处仅需要知道 **servers/** 开头的相对路径即可，这在一定程度上，降低了 getshell 的难度。

servers/AdminServer/tmp/_WL_internal/com.oracle.webservices.wls.ws-testclient-app-wls/4mcj4y/war/css。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dq1Q8s4COc7InkMO0jIGjiaCYibsYhheadSUjrm0x4X8K8DUSDRv9wASKo4dx4y0jyfggz0SuevTibw/640?wx_fmt=png&from=appmsg)

这里需要注意的是，上述路径中 **/AdminServer/** 在不同的 weblogic 安装环境中可能不一样的，它可能是 / Server-0 / 或者 / app_server1/，它可能是管理服务器名称，也可能是被管服务器 (MS) 名称。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dq1Q8s4COc7InkMO0jIGjia4ellWpoAvEOTuAwIfFavhF11TB2exZArjEVHhEicicAFQEMI6oxdoRuw/640?wx_fmt=png&from=appmsg)

路径中的 **/4mcj4y/** 值也不是固定的，它是由 / AdminServer / 结合另一个变量计算出来的，所以我们只需要知道 / AdminServer / 处的值就好办了。如下图所示，github 上有很多通过当前 weblogic 服务器名称计算出该值的脚本程序。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dq1Q8s4COc7InkMO0jIGjia4SW8OPBBjNIGoKTD2FWf7aF5CX4C6EfcdSJcrjvxwzCYAC5ont9oFg/640?wx_fmt=png&from=appmsg)

*   ### **IIOP 协议获取相对路径**
    

经过研究发现，如果目标 weblogic 端口的 iiop 协议开放的话，直接向 iiop 协议端口 7001 或者其它端口发送一个数据包，在返回数据包中就会有获取相对路径最关键的服务器实例名称（此处是 AdminServer）。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dq1Q8s4COc7InkMO0jIGjiavpL0u14e1UYYatcPdFOM5r5qlby2e73l0sibACoShs4DhMp2Szl10oA/640?wx_fmt=png&from=appmsg)

知道了 AdminServer 这个值，就可以使用脚本计算出完整的相对路径了，就可以上传 webshell 了。

*   ### **通过报错泄露路径**
    

通过报错的方法，也可以不断获取完整的绝对路径，这种方法有时候能成功，有时候不能成功，我也没深入研究为什么。这个方法实测效果不太好，但是有时候可以作为探测目标绝度路径是否存在的一种方法。在 “**Work Home Dir**” 处填入 “**servers**”，然后点击提交，会弹出一个报错页面，其中就会泄露一部分绝对路径。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dq1Q8s4COc7InkMO0jIGjiaHmVxlYjHEK61zRqb9DFbuzsELqjxvrVGaUq4JhRXP9LPo234lxKFzg/640?wx_fmt=png&from=appmsg)

*   ### **XXE 漏洞获取 weblogic 的绝对路径**
    

经过仔细观察发现，此上传漏洞的编号是 CVE-2018-2894，在 CVE-2018-2894 编号附近，有一个 XXE 漏洞 CVE-2018-3246，因为两个漏洞编号相近，所以两个漏洞理论上会同时存在。因此如果目标环境出网的情况下，我们通过这个 XXE 漏洞获取到 weblogic 的路径，然后再利用上传漏洞获取 webshell。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dq1Q8s4COc7InkMO0jIGjia8Ett5s2JfMQD8CzyBibWDiaBMJUVIfFslmF9TTnN9hKibpW0x8icbMGKIg/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450Dq1Q8s4COc7InkMO0jIGjiaQyiblaUYUSV7agF8lmrKyDKZQz8uNHnc3tvxCHSxFr58MgmvKmxTg4Q/640?wx_fmt=png&from=appmsg)

 **Part3 总结** 
--------------

本文中 ABC_123 给出了 3 种方法，各有优缺点，实战中结合起来用，基本上可以搞定这个上传漏洞的利用。

**方法 1：**报错获取绝对路径，缺点是不一定每次都能报错，而且有时候报错出来的路径不全。

**方法 2：**IIOP 协议可以获取 AdminServer，但是目标 weblogic 端口必须没有屏蔽 IIOP 协议。

**方法 3：**XXE 漏洞获取绝对路径，但是目标 weblogic 必须得能够出网。

**★  
**

**付费圈子  
**

  

  

**欢 迎 加 入 星 球 ！**

**代码审计 + 免杀 + 渗透学习资源 + 各种资料文档 + 各种工具 + 付费会员**

![](https://mmbiz.qpic.cn/mmbiz_gif/pLGTianTzSu7XRhTMZOBAqXehvREhD5ThABGJdRialUx3dQWwO7fclsicyiajicKfvXV4kHs38nkwFxUSckVF2nYlibA/640?wx_fmt=gif&random=0.4447566002908574&tp=wxpic&wxfrom=5&wx_lazy=1)

  

****进成员内部群****

![](https://mmbiz.qpic.cn/mmbiz_jpg/pPVXCo8Wd8AQHAyOTgM5sLrvP6qiboXljGWG0uOdvcNR8Qw5QJLxSVrbFds2j7MxExOz1ozb9ZoYwR68leoLdAg/640?wx_fmt=jpeg&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1)

  

  

![](https://mmbiz.qpic.cn/mmbiz_gif/pLGTianTzSu7XRhTMZOBAqXehvREhD5ThABGJdRialUx3dQWwO7fclsicyiajicKfvXV4kHs38nkwFxUSckVF2nYlibA/640?wx_fmt=gif&random=0.09738205945672873&tp=wxpic&wxfrom=5&wx_lazy=1)

  

****星球的最近主题和星球内部工具一些展示****

![](https://mmbiz.qpic.cn/mmbiz_jpg/pPVXCo8Wd8Doq0iczyRiaBfhTQyfzqSGuia4lfHfazabEKr2EDe7sGVoxUhLrNRA4FbI1yef6IkWdmzxvZrTiaJncg/640?wx_fmt=jpeg&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1)

![](https://mmbiz.qpic.cn/mmbiz_png/pPVXCo8Wd8BmE6FAA8Bq7H9GZIRt1xYZpmYNWxrrzolt71FtX5HyM03H0cxkiaYelv7ZSajLtibEdBXUpCibdItXw/640?wx_fmt=png&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1)

![](https://mmbiz.qpic.cn/mmbiz_png/pPVXCo8Wd8ADSxxicsBmvhX9yBIPibyJTWnDpqropKaIKtZQE3B9ZpgttJuibibCht1jXkNY7tUhLxJRdU6gibnrn0w/640?wx_fmt=png&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1)

![](https://mmbiz.qpic.cn/mmbiz_png/pPVXCo8Wd8DKZcqe8mOKY1OQN5yfOaD5MpGk0JkyWcDKZvqqTWL0YKO6fmC56kSpcKicxEjK0cCu8fG3mLFLeEg/640?wx_fmt=png&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1)

![](https://mmbiz.qpic.cn/mmbiz_png/pPVXCo8Wd8CKksEIzZyEb3tEFGzGYSXfribrG4jKOkRKGKYb7zk7MTNZPT6Wp3bLd2BPhuFHddIL6sqrg1d2qHQ/640?wx_fmt=png&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1)

![](https://mmbiz.qpic.cn/mmbiz_png/pPVXCo8Wd8D0bS8ibc3XhFcDYkVusFvc3c6onthQpPGZn4v32rpOp7CeFiamGdeC7JBk0mGVsiciazLp3z0SIJAtnQ/640?wx_fmt=png&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1)

![](https://mmbiz.qpic.cn/mmbiz_png/pPVXCo8Wd8B96heXWOIseicx7lYZcN8KRN8xTiaOibRiaHVP4weL4mxd0gyaWSuTIVJhBRdBmWXjibmcfes6qR1w49w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1&tp=wxpic)

![](https://mmbiz.qpic.cn/mmbiz_png/pPVXCo8Wd8DKZcqe8mOKY1OQN5yfOaD5MpGk0JkyWcDKZvqqTWL0YKO6fmC56kSpcKicxEjK0cCu8fG3mLFLeEg/640?wx_fmt=png&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1)

![](https://mmbiz.qpic.cn/mmbiz_png/pPVXCo8Wd8AqNwoQuOBy9yePOpO5Kr6aHIxj7d0ibfAuPx9fAempAoH9JfIgX4nKzCwDyhQzPrRIx4upyw5yT4Q/640?wx_fmt=png&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1)

**![](https://mmbiz.qpic.cn/mmbiz_png/pPVXCo8Wd8CzYcn7C4DHT0vibm3SyRASB2Rz5WYRNLKHragHRliaADVFCc97licvVdY0lfRDeIK9MibelOPMiapTT3w/640?wx_fmt=png&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1)**

![](https://mmbiz.qpic.cn/mmbiz_gif/pLGTianTzSu7XRhTMZOBAqXehvREhD5ThABGJdRialUx3dQWwO7fclsicyiajicKfvXV4kHs38nkwFxUSckVF2nYlibA/640?wx_fmt=gif&random=0.4447566002908574&tp=wxpic&wxfrom=5&wx_lazy=1)

  

**加入安全交流群**

 [![](https://mmbiz.qpic.cn/mmbiz_png/pPVXCo8Wd8DungicHdGVdJpoQp8uIUIs1rP8lb21yu5ndpdotiaGqicq8x5IFcKNpE8WsmrPDpohlNfTf2pf2GJUg/640?wx_fmt=png&tp=wxpic&wxfrom=5&wx_lazy=1&wx_co=1)](http://mp.weixin.qq.com/s?__biz=MzkxNDAyNTY2NA==&mid=2247489372&idx=1&sn=5e14ba5fa59059fb1ee405e56ef90d40&chksm=c175eaf3f60263e5ef5415a8a9fc134f0890fdb9c25ab956116d17109baf98b3bd6bed572a2d&scene=21#wechat_redirect)                

**关 注 有 礼**

  

  

关注下方公众号回复 “666” 可以领取一套领取黑客成长秘籍

![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOeSsicAgIUNHtMib9a69NOWXw1A7mgRqqiat1SycQ0b6e5mBqC0pVJ3oicrQnCTh4gqMGiaKUPicTsUc4Tw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1&tp=wxpic) 还在等什么？赶紧点击下方名片关注学习吧！![](https://mmbiz.qpic.cn/mmbiz_png/XOPdGZ2MYOeSsicAgIUNHtMib9a69NOWXw1A7mgRqqiat1SycQ0b6e5mBqC0pVJ3oicrQnCTh4gqMGiaKUPicTsUc4Tw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1&tp=wxpic)

![](https://mmbiz.qpic.cn/mmbiz_png/ndicuTO22p6ibN1yF91ZicoggaJJZX3vQ77Vhx81O5GRyfuQoBRjpaUyLOErsSo8PwNYlT1XzZ6fbwQuXBRKf4j3Q/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1&tp=wxpic)  

**推荐阅读**

[****干货｜史上最全一句话木马****](http://mp.weixin.qq.com/s?__biz=MzkxNDAyNTY2NA==&mid=2247489259&idx=1&sn=b268701409ad4e8785cd5ebc23176fc8&chksm=c175eb44f60262527120100bd353b3316948928bd7f44cf9b6a49f89d5ffafad88c6f1522226&scene=21#wechat_redirect)

[**干货 | CS 绕过 vultr 特征检测修改算法**](http://mp.weixin.qq.com/s?__biz=MzkxNDAyNTY2NA==&mid=2247486980&idx=1&sn=6d65ae57f03bd32fddb37d7055e5ac8e&chksm=c175f3abf6027abdad06009b2fe964e79f2ca60701ae806b451c18845c656c12b9948670dcbc&scene=21#wechat_redirect)  

[**实战 | 用中国人写的红队服务器搞一次内网穿透练习**](http://mp.weixin.qq.com/s?__biz=MzkxNDAyNTY2NA==&mid=2247488628&idx=1&sn=ff2c617cccc00fe262ed9610c790fe0e&chksm=c175e9dbf60260cd0e67439304c822d28d510f1e332867e78a07d631ab27143309d14e27e53f&scene=21#wechat_redirect)  

[**实战 | 渗透某培训平台经历**](http://mp.weixin.qq.com/s?__biz=MzkxNDAyNTY2NA==&mid=2247488613&idx=1&sn=12884f3d196ac4f5c262a587590d516d&chksm=c175e9caf60260dcc0d5d81a560025d548c61fda975d02237d344fd79adc77ac592e7e562939&scene=21#wechat_redirect)  

[**实战 | 一次曲折的钓鱼溯源反制**](http://mp.weixin.qq.com/s?__biz=MzkxNDAyNTY2NA==&mid=2247489278&idx=1&sn=5347fdbf7bbeb3fd37865e191163763f&chksm=c175eb51f602624777fb84e7928bb4fa45c30f35e27f3d66fc563ed97fa3c16ff06d172b868c&scene=21#wechat_redirect)

**免责声明**

由于传播、利用本公众号渗透安全团队所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，公众号渗透安全团队及作者不为**此**承担任何责任，一旦造成后果请自行承担！如有侵权烦请告知，我们会立即删除并致歉。谢谢！

好文分享收藏赞一下最美点在看哦