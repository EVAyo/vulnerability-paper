<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/cmkTMw_QS8o1wMsRd0E0XQ)

Part1 前言
========

在近几年的 HW 比赛、红队项目中，攻击队在外围打点时，越来越依赖于对 Java 站点的漏洞挖掘。Java 站点的主流框架大致就是两个：Struts2 系列（包括 Webwork 等）及 Spring 系列（包括 Spring MVC、SpringBoot 等）。很多攻击队员在查找网站漏洞时，由于无法判断出网站所使用的框架，对于. do 结尾的网站上去就是用 Struts2 工具、Spring 漏洞工具开扫，这样的做法效率极低，容易被 WAF 封禁 IP，进而导致错过相关漏洞。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450BEn8sPLdWFiaJ0GIjJhicV45dV58qkHwmttTXaFib7uJVAmmowOT01BZFibuVfLlQeL7y7OicDUh1oY8Q/640?wx_fmt=png)

网上的区分 Struts2 与 Spring 的方法，大多数是通过查看. do 及. action 后缀、网页报错、网站 error 异常、浏览器 favicon.ico 图标、Struts2 拦截器报错等等，但是这些方法适用范围比较窄。

本人前几年在调试分析 S2-016、S2-032 等漏洞的时候，无意中发现了几个特别简单实用的方法，现分享给大家。简单来说，就是利用 Struts2 框架和 Spring 框架在处理一些特殊的 URL 路径时，返回结果不一样的特性。

Part2 方法汇总
==========

方法 1、URL 中添加不存在路径
-----------------

在 URL 的反斜杠部分添加网站不存在的路径，最好是随机字符串组成的较长路径，如果返回同样的页面，则大概率是 Struts2 框架，如果返回 404 或者是报错，则大概率是 Spring 框架。

比如说：http://192.168.237.128:8080/struts2_032/example/aaaaaa1/bbbbbbbb2/ccccccccc3/HelloWorld.action

在 Struts2 框架下，完全可以正常返回页面。  

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450BEn8sPLdWFiaJ0GIjJhicV45nN8dez1d3iaSu6ylObBC4v1004LFPVoIp6nB8pyXappQr3WXwTObhKg/640?wx_fmt=jpeg)

而 Spring 框架会出错

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450BEn8sPLdWFiaJ0GIjJhicV45HI4MDiaGPzbiaphtWWHtYrA1tibULWMHXibe9D5yibcJDsLzEsRupwgCGBQ/640?wx_fmt=jpeg)

具体判断过程应参考如下步骤，一会儿讲讲具体原因：

对于如下 URL：http://127.0.0.1:9999/S2_016_war/barspace/login.do

### 第 1 步：

在最后右边反斜杠处添加一个不存在的路径 / xxxxxxxxxx/，如下所示：

http://127.0.0.1:9999/S2_016_war/barspace/xxxxxxxxx/login.do 返回与原 URL 相同页面，则是 Struts2 框架

http://127.0.0.1:9999/S2_016_war/barspace/xxxxxxxxx/login.do 返回与原 URL 异同页面，则是 Spring 框架

### 第 2 步：

如果两个 URL 均报错、或者均正常，无法区分，那么继续在前一个反斜杠处添加一个不存在的路径，如下所示：

http://127.0.0.1:9999/S2_016_war/xxxxxxxxx/barspace/login.do 返回与原 URL 相同页面，则是 Struts2 框架

http://127.0.0.1:9999/S2_016_war/xxxxxxxxx/barspace/login.do 返回与原 URL 异同页面，则是 Spring 框架

### 第 3 步：

如果还是没法区分，继续在前一个反斜杠处添加一个不存在的路径，如下所示：

http://127.0.0.1:9999/xxxxxxxxx/S2_016_war/barspace/login.do 返回与原 URL 相同页面，则是 Struts2 框架

http://127.0.0.1:9999/xxxxxxxxx/S2_016_war/barspace/login.do 返回与原 URL 异同页面，则是 Spring 框架

按照前面的步骤，依次添加不存在的路径，直到 URL 根目录为止。

### 原理 1：Struts2 的 URL 构造

如果了解 Struts2 框架的读者，一眼就能看明白这种方法的原理，对于其他读者，要想弄明白这个方法的原理，首先需要看一下 Struts2 的 URL 构造：

Struts2 站点的 URL 路径包括四部分组成：工程名 + namespace 命名空间 + action 名 + Struts2 扩展名，举个例子，对于如下 URL：http://127.0.0.1:9999/S2_016_war/barspace/login.action

如果在 Struts2 框架中，大致应该这样去分析这个 URL：

/S2-016-war / 部分是 war 包部署的工程名，也可以说是项目名、上下文等等，说法不一。

/barspace / 部分是 Struts2 的命名空间 namespace。

/login 部分是 Struts2 的 action 名，指向具体处理请求的 Java 类。

.action 部分是 Struts2 的扩展名，也可以定义为. do、.dw 等等。

参考如下的 struts.xml 配置文件：

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450BEn8sPLdWFiaJ0GIjJhicV45VibE1hRHDgibm48iaicRJcVcLaicib59uiaZic5k9F3hsPof2S71dZItAksJUQ/640?wx_fmt=png)

同样对于 URL：http://127.0.0.1:9999/S2_016_war/barspace/login.action

如果网站应用直接部署在 Tomcat 根目录下，则工程名可以为空，此时 URL 如下所示：

http://127.0.0.1:9999/barspace/login.action

如果 namespace 设置为空，则 URL 如下：

http://127.0.0.1:9999/login.action

如果 Struts2 请求的扩展名为空，则 URL 如下：

http://127.0.0.1:9999/login（由此可见，这种 URL 路径也可能是 Struts2 框架的）

其中 namespace 可以配置为 / barspace/spac1、action 也可以配置为 / login/user.action。这也是为什么有时候，我们需要在 URL 的每一个反斜杠前都添加一次不存在 URL 路径的原因，因为很难直接从 URL 中判断出哪一部分是 namespace、哪一部分是 action 名。

### 原理 2：Struts2 向上查找 action 名

在了解了 Struts2 的 URL 构造之后，接下来看一下如下 URL，在 Struts2 下是可以返回正常页面的：http://127.0.0.1:9999/S2_016_war/barspace/aaaaaaaaaa1/bbbbbbbb2/ccccccccc3/ddddddddddddd4/login.action

因为按照 Struts2 框架规则，首先会在当前路径下找 action 名 login，如果没有找到去上一层找，还没有找到会去上上层找，一直找到应用程序的根路径为止。层层向上查找，直接找到应用程序为止。（真实的流程比这个复杂）

注：在网站的前端如果有 nginx 时，这种方法可能会无效，因为 nginx 可能会配置一些特殊 URL 转发，这时候就是 nginx 转发优先了。

方法 2、URL 添加 / struts/domTT.css
------------------------------

在 URL 的 Web 应用根目录下添加 / struts/domTT.css，如果返回 css 代码，那么 99% 是 Struts2。

注：这个 domTT.css 文件在网站源码文件中是找不到的，用磁盘搜索的方式搜索不到的，那为什么能访问到呢，因为这个文件在 Struts2 的 jar 包中。

原理：凡是以 / struts 开头的 URL，Struts2 的过滤器都会到 struts2-core-2.0.x.jar：/org/apache/struts2/static / 下面去找资源，然后读取此文件内容。

举例如下：

http://192.168.237.128:8080/struts2_032/example/HelloWorld.action  

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450BEn8sPLdWFiaJ0GIjJhicV45L0EmzKt3LAicRMQukfMiboaN7hkB4nhrh8HFcTROMzbYzR1YhTmg37jA/640?wx_fmt=jpeg)

在网站根目录下添加 /struts/domTT.css 后访问，返回 css 代码。  

http://192.168.237.128:8080/struts2_032/struts/domTT.css

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450BEn8sPLdWFiaJ0GIjJhicV458IJrl1A2ZuFN8gqfIIYicPz2Q8MBnHHiaTk6HSiaPjyaQggE5iax0Ov7yg/640?wx_fmt=png)

注: 有一些低版本的 Struts2 框架，domTT.css 文件不存在，需要更换为其它静态文件路径。

方法 3、404、500 响应码返回信息
--------------------

输入一个不存在的路径，返回 404 页面，或者传入一些乱码字符，造成当前页面 500 响应码报错，抛出异常信息。

Struts2 常用的关键字有这些：例如 no action mapped、struts2、namespace、defined for action 等。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450BEn8sPLdWFiaJ0GIjJhicV4570qHsdiboRDtobnguMv4p2jGIiagk3Hh5vAMD9WStqGkX6BMmEHau7Xw/640?wx_fmt=png)![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450BEn8sPLdWFiaJ0GIjJhicV45x4RhtMqBxc16rXHCdYgesPGZzYS9vHN4Ft99Eib81YiabrFN6hhF3jWg/640?wx_fmt=png)![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450BEn8sPLdWFiaJ0GIjJhicV45AIqoGBkl3Ig4kDx5rhDUke42wPNZr9AiaV3ZgYKjbLQ4wssibzxwFgaA/640?wx_fmt=png)

Spring 的报错信息如下：含有 Whitelabel Error Page 关键字

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450BEn8sPLdWFiaJ0GIjJhicV45SaibvuKkdhvUHVIDmc68KYj9mj06dictcHiaNKAQWlALfJ9DyYoiaeEsSQ/640?wx_fmt=png)

方法 4：看网站图标 favicon.ico
----------------------

注意看下图的左上角，有一片小绿叶的图标，那基本上就是 Spring 了，而 Struts2 框架没有常用的 favicon.ico 图标。

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450BEn8sPLdWFiaJ0GIjJhicV45VEyft4sVGcRnMajknGzL9A6EXxENq3Ln4fovnxvfd8ftButGAATeng/640?wx_fmt=jpeg)

Part3 总结：
=========

1.  URL 扩展名不能用于区分 Struts2、Spring 框架，.do 结尾的 URL 可能是 Struts2、也可能是 Spring，具体看程序员在配置文件中怎么写。
    
2.  利用处理特定 URL 时返回页面不相同的方法，可以区分不同的框架。
    
3.  总结各种报错信息，可以区分不同 Web 应用所采用的框架。
    
4.  多调试分析一下公开的漏洞，也会发现很多有趣的东西。还有其它的方法，有待大家挖掘。
    

* * *

后续还会分享几个区分 Fastjson 与 Jackson，Tomcat 与 Weblogic 中间件的方法。

网络安全 abc123

专注于红队、蓝队技术分享，每周一篇

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450BEn8sPLdWFiaJ0GIjJhicV45MfMCbTIU0xDtPVrgywVMAIpezf4ww0KPf6fCGf3slNXxH0gELtTicWA/640?wx_fmt=jpeg)