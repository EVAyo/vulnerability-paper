<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/5QMqEBUBm6lHN1qHMD-dyA)

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450ATcz6jUJnFNeOxRzVZ9LbcaA8wBFW4icTiaL7ELd8ia04Olh40TBx7CquHZyCicicl4eYJno2y0oZ0H4A/640?wx_fmt=png)

 **Part1 前言** 
--------------

前面几期介绍了 Fortify、Checkmarx、Coverity 等商用代码审计工具的使用，方便大家上手，本期介绍另一款商用代码审计工具 Klocwork 的使用。Klocwork 是来自加拿大的代码审计工具，同样可以支持 C++、java 及 c# 等代码的审计工作。

**求助：哪位朋友有 Codesecure、IBM Security AppScan Source、国产的 codepecker 代码审计工具的破解版或者是试用版，方便的话发我试用一下，保证不外传，保证不用于商业目的，Thanks♪(･ω･)ﾉ**

 **Part2 使用过程** 
----------------

正版软件是需要加密狗授权的，我这里摸索出来一个标准步骤，方便大家上手少走弯路。Klocwork 安装完成后，将以下两个路径添加到环境变量中：**C:\Klocwork\10\CMD\bin**，**C:\Klocwork\10\Server\bin**。在使用之前，首先删除 **C:\Klocwork\10\Server** 目录的 log 文件。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450A8iaeyQapuGUpw2ZzAkZ7YEv43nOeeVBicL2UIAP9brO5DPRYGHWq6ibfAgQrmGNrqe43K4ibQj1DUbg/640?wx_fmt=png)

接下来分别启动 Klocwork 代码审计工具的 3 个服务，强烈建议大家不要选择一键启动，否则服务启动失败，难以排查原因出在哪里。

 **1**  启动 license 服务：

kwservice -r projects_root start license

 **2**  启动数据库服务：

kwservice -r projects_root start database

 **3**  启动 Web 服务和分析引擎：

kwservice -r projects_root start klocwork

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450A8iaeyQapuGUpw2ZzAkZ7YEp4uLo3SR1iamLTgqU49FKY8MzWt7NibeL7FjOxhXbypARdTwvr7tw2NQ/640?wx_fmt=png)

访问如下 URL 地址，如果 Web 界面能够正常打开，说明前面步骤没有问题。

http://127.0.0.1:8085/portal/Portal.html

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450A8iaeyQapuGUpw2ZzAkZ7YE94ywkzfYHnnRWsjWteOkteJ7ztaoXjPaqa9F0Kasfy8jBL9hWoB1Yw/640?wx_fmt=png)

在正式开始审计 Java 代码前，需要设置一下 Java 编译环境，添加 ANT 环境变量 **%ANT_HOME%\bin** 如下。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450A8iaeyQapuGUpw2ZzAkZ7YEI8QVjDoKog0R4cYlNkJR761PkcklkG8abVyhUfM8NXaPia14micHOZAA/640?wx_fmt=png)

接下来开始对 Java 代码进行编译。首先运行 **ant clean**，等待编译完成，点击 **kwant** 之后，在你选择的 java 代码文件夹中会生成一个 kwinject.out 文件。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450A8iaeyQapuGUpw2ZzAkZ7YErPKy5tlV49jwZGE14fEE3ficuYHZ7NgQopnvzZ4kIz0upJNzPU4U35Q/640?wx_fmt=png)

接下来连续运行 3 个命令：**kwcheck create** 、**kwcheck import kwinject.out** 、**kwcheck run**。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450A8iaeyQapuGUpw2ZzAkZ7YEhS6cRaOegXARVaRC0c2ZzC9MBZDm44Amgr4VibOSJpqrBvqXia9Hkmww/640?wx_fmt=png)

扫描完成之后，执行 **kwgcheck**，会弹出一个软件界面，点击最下边的漏洞问题条目，即可对代码漏洞进行分析和查看。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450A8iaeyQapuGUpw2ZzAkZ7YEgVGtkoyHTqJJdop1QvRSsRUw7g0cFU92HicAJ6WwHWbbo9w3dZ4eQjQ/640?wx_fmt=png)

如果出现中文乱码问题，可以在这里选择 UTF-8 编码。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450A8iaeyQapuGUpw2ZzAkZ7YE6MD6WmMocickml32rm97fEASLkm9RUEh2pXL5mvRkHQichzc1CDBCbBg/640?wx_fmt=png)

Klocwork 我用的不是很多，这篇文章旨在节省大家看长篇大论的说明书的时间。

 **Part3 总结** 

Help: Which friend has a cracked or trial version of Codesecure, Klockwork, and IBM Security AppScan Source? If it's convenient, send it to me for trial, and I guarantee that it will not be used for commercial purposes。Thanks♪(･ω･)ﾉ。Contact me by e-mail : 0day123abc#gmail.com(replace # with @)。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450A5qqg2iaK6KIYYR8y6pF5Rh3JHDibOKOop204nXz618iawdRb8dABicMPtHb2PkJE8x6koJO5HyuwZJQ/640?wx_fmt=png)

**专注于网络安全技术分享，包括红队攻防、蓝队分析、渗透测试、代码审计等。每周一篇，99% 原创，敬请关注**

Contact me: 0day123abc#gmail.com(replace # with @)

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450A5qqg2iaK6KIYYR8y6pF5Rhn137KeqqlDkuRyY4G61jATRzyOrCBts8ucxkLpMNsYutSOY7BkPziaw/640?wx_fmt=jpeg)