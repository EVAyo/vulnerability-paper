<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/FEnal9ZkIEJOXLcmX0WXgQ)

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450ATcz6jUJnFNeOxRzVZ9Lbc0INLwTJTZT1GaNutZrfDn6csvjBoS2ox0efLUEexXqPEcVbYfbLo8w/640?wx_fmt=png)

 **Part1 前言** 
--------------

最近感染了新冠，大病初愈，没气力写复杂的文章了，索性就把《代码审计工具系列教程》写完吧。前面几期分别讲了 Fortify、Checkmarx、Coverity、Klocwork 等代码审计工具的使用，反响还不错，本期讲讲 Fortify 命令行下的调用方法。Fortify 的命令行程序名字是 sourceanalyzer.exe，如果您没用过这个程序，那 Fortify 可真是需要好好补补课了，**如果您在为如何去调用 Fortify 实现自动化代码审计平台，这篇文章可以帮到您**。

 **Part2 Fortify 审计代码的 4 个阶段** 
-------------------------------

Fortify 完成代码审计工作，大致需要以下 4 个步骤：

 **1**   **Clean：清除阶段。**主要是清除之前转换的 NST。命令大致如下：**sourceanalyzer -b proName -clean**。

 **2**    **Translation：转换阶段。**源代码内部格式转换阶段，将各种源代码转换成 Fortify 所支持的特有格式。

 **3**    **Show-File：查看阶段。**在完成转换之后，展示这次转换的文件，多用于检查转换是否成功完整。命令大致如下：**sourceanalyzer -b proName -show-files**。

 ****4****  **Scan：分析引擎扫描阶段。**命令大致如下：**sourceanalyzer -b proName -Xmx1250m -scan -f proName.fpr**。

与代码审计结果最相关的其实是第 2 步的转换阶段，使用起来是有很多技巧的。对于 JavaWeb 项目，大致需要对以下文件进行转换：

**1.**   转换. Java 文件。

**2.**   转换. jsp 文件。

**3.**   转换 JavaWeb 的 configuration 配置文件如. xml、.properties 文件。

**sourceanalyzer -b proName “mydirectory/myfile.xml”**。

 **Part3 常用的命令行** 
------------------

Fortify 代码审计工具的命令行程序是 sourceanalyzer.exe，文件路径是 **D:\Program\Foritfys\Fortify_SCA_and_Apps_22.1.0\bin**。执行以下命令 sourceanalyzer --help 可以查看 Fortify 的命令行程序的各个参数的使用说明。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CzsqDicrn59nYdZzWTnsaZbZWLo80LLw80n6oYg8QU6dALynEmEFXGiagRyugt58wI94lxvP1hiaKZA/640?wx_fmt=png)

具体详细的使用说明还是要看 Fortify 说明书，**我这里给出几个比较常用的参数的使用说明吧**。

**1. ** Fortify 支持的指定文件路径的通配符：'*' 匹配部分文件名 ， '**' 递归地匹配目录。

**2.**  -clean 清除之前转换的 NST。

**3. ** -b 定义一个扫描项目的名称。

**4.**  -encoding "UTF-8" 设置中文编码。

**5.**  -cp "**/*.jar"  主要用于 java 项目，有的文档称之为 classpath，也可以理解为 jar 包的路径。

**6.**  -source 1.7 指定你要扫描的 Java 项目是在什么版本的 JDK 上编写的，可用的值是 1.7, 1.8,1.9, 7, 8, 9, 10, 11, 12, 13, 14, 17。默认的值是 "1.8"。

**7.**  -f result.fpr 生成一个 fpr 文件，以后可以用图形界面查看这个结果文件。

**8.**   -64 使用 64 位，一般都需要加上。

**9.**  -Xmx 指定 Fortify 静态代码分析器使用的最大内存量，比如 - Xmx10000m。官方说明书不建议值取在 32 GB 和 48 GB 之间，因为取值 32G 或者更小的内存，反而会增加性能。如果扫描需要超过 32 GB，则建议取值为 64 GB 或更多。

**10.**  -verbose 在控制台输出详细信息。

**11.**  -quick  以降低精准度实现快速扫描，如果你的项目非常大，可以加上该选项。

**12.**  -p| -scan-precision  使用快速扫描以扫描精度级别扫描项目。扫描精度级别越低，扫描性能越快。有效值为 1、2、3 和 4。

**13.**  -show-build-ids 显示本机曾经扫描过的 Build ID，也就是项目名称。

**14.**  -show-build-tree 显示每一个文件在转换时所依赖的文件。

**15.**  -show-build-warnings 查看在转换过程中所有的警告信息。

**16.**  -exclude "**/Test/*.java" 排查 Test 编译文件，排除对测试文件的审计，减少 Fortify 的工作量。

**17.**  -logfile 指定 Fortify 静态代码分析器创建的日志文件。

 **Part4 实战过程** 

接下来给出一个扫描 webgoat 代码的 Fortify 命令行使用过程，具体过程比这个要复杂，我给出一个通用步骤吧：

 **1**  **清理之前转换的 NST：**  

**sourceanalyzer -b test -clean**

 **2**  **翻译. Java 代码文件：**

**sourceanalyzer -b test -64 -encoding "UTF-8" -source 1.7 -Xmx6000m -cp "WEB-INF/lib/*.jar" "./**/*.java" -verbose**

 **3**  **翻译. jsp 代码文件：**

**sourceanalyzer -b test -64 -encoding "UTF-8" -source 1.7 -Xmx6000m -cp "WEB-INF/lib/*.jar" "WEB-INF/**/*.jsp" -verbose**

 **4**  **翻译 JavaWeb 配置文件：**

**sourceanalyzer -b test -64 -encoding "UTF-8" -source 1.7 -Xmx6000m "./**/*.xml" -verbose**

 **5**  **开始扫描过程：**

**sourceanalyzer -b test -Xmx6000m -scan -f test.fpr**

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CzsqDicrn59nYdZzWTnsaZb8Od85s4vffm5icgXydvehK4rPmheZHM6q51nicWkJTjCfTVQxEW9XGpQ/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CzsqDicrn59nYdZzWTnsaZbr7j0fZZfibKzFIKujnL3ic519gmHW67YDxtalCJv2RpsBfIABuJGby0w/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CzsqDicrn59nYdZzWTnsaZbXzRuRZMDYe558CqibBNKmh6A9MibiaMmpRibEhXq5z2gF39He5I04ChLHA/640?wx_fmt=png)

扫描完成之后，使用 auditworkbench 图形界面打开 test.fpr 查看扫描结果。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CzsqDicrn59nYdZzWTnsaZbF7kqUR1BzhhcsIydmtCSRozedaTVJKYic2picQ3OtEn3Mo7GIVibL9A4A/640?wx_fmt=png)

查看 Diagram 图表的具体使用如下：

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CzsqDicrn59nYdZzWTnsaZblaK5RXlTzjOxs3e5vRC8uYFaUOb0jzXLMBLl5gT3ExtCfoTCicXuibqg/640?wx_fmt=png)

使用 ReportGenerator 程序将. fpr 文件转换成 pdf 文件。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CzsqDicrn59nYdZzWTnsaZbfGtHiawghEyqz0MttPicng5dib3DAC5JL6RQeWADtfOAdKafQevXVWT0w/640?wx_fmt=png)

如下图所示，生成了 pdf 文件。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450CzsqDicrn59nYdZzWTnsaZbKX43qm7FWvWYqRDBngrTMScqS0Lf6iaVFhVBWFlSxGb3fy2EnwC07NA/640?wx_fmt=png)

 **Part5 总结**   

Help: Which friend has a cracked or trial version of Codesecure, Klockwork, and IBM Security AppScan Source? If it's convenient, send it to me for trial, and I guarantee that it will not be used for commercial purposes。Thanks♪(･ω･)ﾉ。Contact me by e-mail : 0day123abc#gmail.com(replace # with @)。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450A5qqg2iaK6KIYYR8y6pF5Rh3JHDibOKOop204nXz618iawdRb8dABicMPtHb2PkJE8x6koJO5HyuwZJQ/640?wx_fmt=png)

**专注于网络安全技术分享，包括红队攻防、蓝队分析、渗透测试、代码审计等。每周一篇，99% 原创，敬请关注**

Contact me: 0day123abc#gmail.com(replace # with @)

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450A5qqg2iaK6KIYYR8y6pF5Rhn137KeqqlDkuRyY4G61jATRzyOrCBts8ucxkLpMNsYutSOY7BkPziaw/640?wx_fmt=jpeg)