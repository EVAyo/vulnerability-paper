> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/wiCXRQE3Crj-1jqlSFrGtw)

概述
--

本文包含对 **Stuxnet** 的 **全面技术分析**，Stuxnet 是迄今为止发现的最先进和复杂的恶意软件之一。**Stuxnet** 被设计为一种精确武器，专门针对工业控制系统 (ICS)，尤其是伊朗核浓缩计划中使用的系统。该分析深入探讨了其架构、有效载荷以及它利用的 0day，这些漏洞用于攻击运行 **Siemens Step7** PLC 软件的系统。

Stuxnet 因使用多个 0day 和高度针对性的工业设备攻击而著称。2010 年的发现标志着网络安全的一个转折点，揭示了恶意软件可能造成物理损害并改变地缘政治事件的潜力。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/KgxDGkACWnRiaNFhf9pFuNJIzuZTCyTJ2bvKh9nTMPAYtTUADIX2YkVh60PeAib0mQrCZibiavfkhgMoGhuiayN5nNQ/640?wx_fmt=png&from=appmsg)

* * *

Stuxnet 的主要特点
-------------

*   **四个 0day**  : 利用了 Windows 操作系统中的多个未知漏洞。
    
*   **复杂的 Rootkit**  : 内核级 Rootkit，使其能够逃避传统安全系统的检测。
    
*   **高度专业化的攻击目标**  : 特别针对 **Siemens Step7 PLCs**，显示了前所未有的精准度。
    
*   **复杂的传播机制**  : 可通过 USB 驱动器、网络共享和打印机后台处理服务传播。
    
*   **高级混淆和反分析技术**  : 包括加密通信、代码打包和反调试技术，以延迟逆向工程的努力。
    
*   **模块化结构**  : 多个模块用于传播、有效载荷传递和自更新功能，使其成为一个高度灵活的恶意软件框架。
    

* * *

目录
--

*   技术‍规格
    
*   Stuxnet 架构
    
*   深入探讨漏洞
    
*   传播机制
    
*   有效载荷分析
    
*   Rootkit 技术
    
*   命令与控制 (C2) 基础设施
    
*   混淆、反逆向和规避
    
*   归属和行动者
    
*   目标
    
*   影响及长期后果
    
*   结论
    
*   参考文献
    

* * *

技术规格
----

*   **恶意软件名称**  : Stuxnet (蠕虫)
    
*   **首次发现**  : 2010 年 6 月
    
*   **疑似创建日期**  : 2005 - 2007 年
    
*   **作者**  : 很可能是国家资助的（美国和以色列被怀疑）
    
*   **目标系统**  : Windows XP, Windows 7, Windows Server 2003, Siemens Step7 PLCs
    
*   **利用的 CVE**  :
    

*   **CVE-2010-2568**  : Windows 快捷方式 (.LNK) 漏洞。
    
*   **CVE-2010-2729**  : 打印机后台处理服务漏洞。
    
*   **CVE-2010-2743**  : Windows 内核提权漏洞。
    
*   **CVE-2010-2772**  : Siemens WinCC 漏洞，用于控制 PLC。
    

*   **编程语言**  : C, C++, 汇编
    
*   **加密算法**  : RC4, 基于 XOR 的字符串混淆, SHA-256
    
*   **主要目的**  : 破坏工业控制系统 (ICS)，重点是伊朗的核离心机
    
*   **有效载荷**  : 操纵离心机速度，造成物理损害
    
*   **C2 通信**  : 使用 RC4 加密
    

* * *

Stuxnet 架构
----------

Stuxnet 的多层架构使其既可以用作间谍工具，也可以用作破坏武器。它包含以下主要组件：

1.  **感染和传播引擎**  : 通过网络传播和 USB 驱动器，利用 0day。
    
2.  **命令与控制模块**  : 允许远程操作员与受感染系统通信并发布更新。
    
3.  **Rootkit**  : 提供隐蔽能力，以逃避防病毒和安全系统的检测。
    
4.  **ICS 专用有效载荷**  : 专门针对 Siemens PLCs，旨在破坏关键基础设施。
    

### 架构的主要特点  :

*   **分层设计**  : 每个组件独立运作，但可以无缝交互以执行复杂指令。
    
*   **模块化**  : 使恶意软件能够在部署后进化、接收更新并扩展其功能。
    
*   **持久性**  : 一旦安装，Stuxnet 由于其深度集成到系统进程中，非常难以移除。
    

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/KgxDGkACWnRiaNFhf9pFuNJIzuZTCyTJ2FibqNsPmAv7Gr9nTO2B4mD3zJ1QpDFiaRia1JOc1mSqVhLMsbv3CQHhYA/640?wx_fmt=jpeg&from=appmsg)

* * *

深入探讨漏洞
------

### CVE-2010-2568  : Windows 快捷方式 (LNK) 漏洞

Stuxnet 通过在 Windows 资源管理器中使用畸形的 .LNK 文件执行代码，使其成为强大的初始感染向量，尤其是在依赖隔离系统的工业设施中。

### CVE-2010-2729  : 打印机后台处理服务漏洞

通过利用打印机后台处理服务，Stuxnet 在共享打印机的联网计算机之间传播，允许横向移动而无需外部通信。

### CVE-2010-2743  : Windows 内核提权漏洞

Stuxnet 一旦在系统中立足，就利用提权漏洞以 SYSTEM 级别运行，允许其安装内核模式 Rootkit。

### CVE-2010-2772  : Siemens WinCC Step7 漏洞

此漏洞允许 Stuxnet 直接与 Siemens PLCs 交互，改变其逻辑，通过操纵离心机速度导致工业机械的物理损坏。

* * *

传播机制
----

1.  **USB 驱动器**  : Stuxnet 的成功很大程度上依赖于受感染的 USB 驱动器。这对于攻击 **隔离** 系统（如核设施中使用的系统）至关重要。
    
2.  **网络共享**  : 利用开放的文件共享，Stuxnet 在受感染网络内横向移动，感染安装了 Siemens Step7 软件的系统。
    
3.  **打印机后台处理服务漏洞**  : 这使得 Stuxnet 能够绕过网络限制，传播到未直接连接互联网的系统。
    
4.  **Siemens 默认凭据**  : Siemens 软件中的硬编码默认凭据允许 Stuxnet 在无需用户交互的情况下传播到运行 Step7 的机器。
    

* * *

有效载荷分析
------

### 工业破坏

Stuxnet 的主要目标是改变 Siemens S7 PLCs 的操作行为。具体来说，它改变了伊朗铀浓缩计划中使用的离心机的频率。修改后的逻辑旨在将离心机推入可能导致其逐渐损坏的操作范围，从而延缓伊朗的浓缩能力。

### PLC 操纵

*   **频率波动**  : Stuxnet 周期性地改变离心机的速度，使其在危险的高速或低速下运行。
    
*   **隐藏攻击**  : 在这些修改期间，Stuxnet 向操作员提供虚假数据，显示离心机正常运行，有效地掩盖了损害。
    

* * *

Rootkit 技术
----------

### 内核级 Rootkit

Stuxnet 采用了复杂的 Rootkit 技术来隐藏其存在：

1.  **内核修补**  : 修改内核级别的 API，以隐藏其文件、进程和注册表项，使其不被系统管理员和安全工具发现。
    
2.  **驱动程序插入**  : Stuxnet 使用签名的驱动程序（最初是盗用的数字证书）来安装恶意内核模式驱动程序，确保其能够在系统最低级别运行而不被检测。
    
3.  **挂钩 API**  : 恶意软件挂钩关键系统 API，以在常规系统操作期间避免被监控工具检测，隐藏其存在。
    

* * *

命令与控制 (C2) 基础设施
---------------

### 加密通信

Stuxnet 使用加密的 **命令与控制** 基础设施来促进远程更新，并允许操作员在部署后更改恶意软件。受感染系统与 C2 服务器之间的通信使用 **RC4 算法** 加密。

### 冗余 C2 域

恶意软件包含一个备用 C2 域列表，以确保即使主要 C2 域被关闭，仍能获取更新或指令。

### 离线能力

即使在 C2 通信被阻断的环境中（如隔离网络），Stuxnet 仍能自主执行预定的破坏任务，使其异常灵活。

* * *

混淆、反逆向和规避
---------

### 多态代码

Stuxnet 在每次感染时都会改变其结构，使其难以被基于签名的检测系统识别。这种多态性意味着每个恶意软件副本都是独特的。

### 代码打包

恶意软件的关键组件被打包，以增加逆向工程的难度。分析师在到达核心逻辑之前面临多层打包和加密。

### 反调试机制

Stuxnet 包含多种陷阱以阻碍调试努力，例如：

*   **自我修改**  : 某些代码部分会在分析时重写自己或以不同方式执行。
    
*   **时间延迟执行**  : 某些组件只有在特定时间后才会激活，防止分析师在短期沙箱执行中识别恶意行为。
    

* * *

归属和行动者
------

Stuxnet 广泛被认为是 **美国** 和 **以色列** 的联合行动，尽管两国均未正式确认参与。证据表明，此次攻击是 **奥运会行动** 的一部分，这是一个旨在减缓伊朗核计划的秘密网络行动。

### 归属的关键证据  :

1.  **数字证书**  : Stuxnet 使用了从 **Realtek Semiconductor** 和 **JMicron Technology** 盗用的数字证书，这指向了国家资助的能力。
    
2.  **复杂性和资源**  : 恶意软件的复杂性，包括使用多个 0day，表明涉及了一个资源丰富的国家级行动者。
    
3.  **政治背景**  : 2005-2010 年的地缘政治背景与美国和以色列阻止伊朗发展核武器的努力相符。
    

* * *

目标
--

### 主要目标：伊朗的核计划

Stuxnet 特别针对伊朗的 **纳坦兹核浓缩设施**。其目的是通过攻击控制离心机的 Siemens PLCs 来破坏该设施的铀浓缩能力。

### 附带感染

尽管具有高度针对性，Stuxnet 仍感染了全球超过 100,000 个系统，包括印度、印度尼西亚和其他国家的网络。然而，这些感染主要是附带损害，因为恶意软件的破坏性有效载荷仅在存在特定 Siemens 配置时才会激活。

* * *

影响及长期后果
-------

### 短期影响  :

*   **破坏成功**  : Stuxnet 成功延缓了伊朗的核浓缩能力，对纳坦兹的离心机造成了显著的物理损害。
    
*   **全球意识**  : Stuxnet 的发现揭示了网络攻击可能造成的现实世界物理效应，引发了全球对关键基础设施安全的关注。
    

### 长期影响  :

*   **网络战的兴起**  : Stuxnet 标志着网络武器用于军事和政治目标的开端，导致网络战成为现代冲突的关键方面。
    
*   **加强 ICS 安全**  : 全球各地的行业开始更加重视 ICS 和 SCADA 安全，导致安全协议和标准的改进。
    
*   **启发未来攻击**  : Stuxnet 使用的战术启发了其他恶意软件，如 **Duqu**、**Flame** 和 **Industroyer**，这些恶意软件都针对关键基础设施。
    
*   **国家级扩散**  : Stuxnet 为其他国家开发进攻性网络能力树立了先例。自其发现以来，归因于国家行为者的网络间谍和网络破坏活动有所增加。
    

* * *

结论
--

Stuxnet 被广泛认为是有史以来最显著和复杂的恶意软件。它重新定义了网络攻击的可能性，证明了精心设计的恶意软件能够在现实世界中造成物理损害。Stuxnet 的开发及其随后的发现标志着网络安全新时代的开始，在这个时代，保护关键基础设施免受网络攻击已成为各国政府和全球各行业的首要任务。

* * *

参考文献
----

*   Symantec 的 Stuxnet 文件
    
*   工业控制系统网络应急响应小组 (ICS-CERT)
    
*   SANS ICS
    
*   W32.Stuxnet 分析
    

1.  关键行业面对网络攻击，McAfee 和国际战略研究：黑暗中，2011 年。
    
2.  David Albright, Paul Brannan, 和 Christina Walrond（科学和国际安全研究所）：Stuxnet 是否摧毁了纳坦兹浓缩工厂的 1,000 台离心机？2010 年 12 月 22 日。
    
3.  Stuxnet：防止并引发下一次世界大战的计算机病毒。：为什么文件（youtube.com），2021 年 3 月 4 日。
    
4.  Amr Thabet              ：Stuxnet 恶意软件分析论文。
    
5.  风险与韧性团队，苏黎世联邦理工学院安全研究中心 (CSS)：热点分析：Stuxnet，2017 年 10 月。
    
6.  Nicolas Falliere, Liam O Murchu, 和 Eric Chien：W32.Stuxnet 文件（版本 1.3），2010 年 11 月。
    
7.  Phillip Porras, Hassen Saidi, 和 Vinod Yegneswaran：Conficker 逻辑和会合点分析，2009 年 2 月 4 日。
    
8.  卡巴斯基威胁       ：WORM.WIN32.Stuxnet。
    
9.  ESET：Stuxnet 显微镜下。
    
10.  Geoff Chappell         ：MRXCLS.SYS 恶意软件加载器，2010 年 10 月 21 日。
    

术语及其含义
------

1.  **目标**              : 伊朗纳坦兹核设施中用于铀浓缩过程的离心机。
    
2.  **工具 / 武器**         : Stuxnet：一种使用四个 0day 并通过 USB 闪存驱动器感染计算机网络的蠕虫。
    
3.  **隔离网络**  : 隔离网络是指与不安全网络隔离的网络，这意味着它不直接连接到互联网，也不连接到任何其他连接到互联网的系统。真正的隔离计算机还进行了物理隔离，即数据只能通过物理方式（例如 USB、可移动媒体或与另一台机器的火线）传递给它。
    
4.  **FEP**                 : 燃料浓缩厂。
    
5.  **SCADA 系统**       : 监控和数据采集系统。
    
6.  **0day / 利用** : 软件开发者尚未意识到的安全漏洞，可以用于黑客攻击系统。
    
7.  **PLC**                 : 可编程逻辑控制器。
    
8.  **DLL**                 : 动态链接库。
    
9.  **P2P (点对点)**  : 在点对点 (P2P) 网络中，一组计算机以平等的权限和责任链接在一起处理数据。
    
10.  **PE**                 : 可移植可执行文件。
    
11.  **RPC**                : 远程过程调用。
    

*   Stuxnet 恶意软件分析论文
    
*   剖析 Stuxnet 恶意软件：Windows 机器上的取证分析入门