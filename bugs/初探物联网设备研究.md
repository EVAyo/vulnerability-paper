<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/S__5Mfa5KkOeJVfsuswjfw)

    最近从闲鱼买来了破二手路由器，拆开研究了下，虽然趟了挺多坑，但最终还是获取到了源码。

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5HTFKgv5JiaxyU6p8NkAYBIIsAVf8XYGRaQQFksaVdTeZ8UMxmtJzF3ibljlo6ovPoBkc30dTQWe6kw/640?wx_fmt=png)

**路由器生前照片：**

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5Emp6VfQtTPIzJMQe3NQJmpA5RfOatKWbxaGicHkfc9GTpd2UUAJY5mibmh5hL5QdnGPQY42dcSXPaA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5Emp6VfQtTPIzJMQe3NQJmp7oqwX6xBj1icOjHOibQknicwj7PHT9sLCibUVXlcln3iaEEkdbkjuzDiag8g/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5Emp6VfQtTPIzJMQe3NQJmp4PVfJwVAVLQb9rhrOa87LqVpjiariajU8lktyQY30j4VnnZVVyicIbX4A/640?wx_fmt=png)

**使用热风枪将芯片吹下来：**

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5Emp6VfQtTPIzJMQe3NQJmpsmUgXiaou1LCFFoXQ7IE6UzJCCZvzlYHt51b0Zjrx0PROhk0tkvTybA/640?wx_fmt=png)

**不小心把 PCB 板的铜箔也摘掉了，厚葬吧**

**处理一下引脚的铜箔**

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5Emp6VfQtTPIzJMQe3NQJmpVpleCKGd6EcEoOykOYE4vnK1iaUicctibH1TM6oJibNyV3HiaQSichzf8iaYw/640?wx_fmt=png)

**将芯片放入 RTH 编程器中读取源码：**

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5Emp6VfQtTPIzJMQe3NQJmpDZLOusjpWznYMCL4iawPCs2Pb2P9o8CaEibpGxIW9kldaqg060sN33PA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5Emp6VfQtTPIzJMQe3NQJmpicBk5XnMZ9H0dqM1bAXkcPicEsribA1wicBfKRIPV5NF2DLKxhquCBAScw/640?wx_fmt=png)

**把提取出来的 BIN 文件放入 Ubuntu 中进行接下来的分析：**

**使用 file 命令查看 bin 文件，这里担心的是 BIN 文件可能是二进制镜像文件也可能是数据文件。**

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5Emp6VfQtTPIzJMQe3NQJmpHdmkSBcDQZhXna7AIeCBicrmFHzxSogNnON8k539Y1IorvB2UeIZLNQ/640?wx_fmt=png)

**使用 binwalk 一把梭**

**获取路由器中镜像文件**

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5Emp6VfQtTPIzJMQe3NQJmpicf5F8SJ0s12t2Kt7PiblPQ2qbqa1J0dfNP03PDNMzURVibicZUoN9QQTw/640?wx_fmt=png)

**在 etc_ro 文件下发现源码**

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5Emp6VfQtTPIzJMQe3NQJmpbH9DqiaTtecOm3mhgF4qAEIXerAmdlyZPbGX4yYejJ0Q5Y1Jx4icVd3Q/640?wx_fmt=png)

**查看其中的配置信息**

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5Emp6VfQtTPIzJMQe3NQJmp5SUyQibpWpeCFTbibmiaegQ5m9MBLhD8GK9I8vKoFlFDcIicicdwetHmhZA/640?wx_fmt=png)

**遍历一下源码中的配置文件. conf**

**查看下配置文件**

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5Emp6VfQtTPIzJMQe3NQJmpicN8QqGiaP3v3eGJXkgtH6sY6jTmhJ7LOjoVgyrNibzdicDKjbPlQ1xvgg/640?wx_fmt=png)

**在 web 文件下进行源码审计**

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5Emp6VfQtTPIzJMQe3NQJmprhY5QfoyIjIeQOk6tIkKouia8A3jXAyhnDl7H5tCwzeFyXBKAEtkp6Q/640?wx_fmt=png)

**使用源码审计工具进行审计：**

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5Emp6VfQtTPIzJMQe3NQJmpGU8Cic5DWpviak1Nal842aiaeYS178lMdAS4jiablCqv02F7erIfgIfiavw/640?wx_fmt=png)

**参数可控且无过滤**

![](https://mmbiz.qpic.cn/mmbiz_png/KGyt5Iecd5Emp6VfQtTPIzJMQe3NQJmpcxm6YQqsw3zpm7mPIDRxavKn2wEYLu4nOf30aYFXq1EUPjqoCEjbAA/640?wx_fmt=png)