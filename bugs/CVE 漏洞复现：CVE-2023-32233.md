<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/gNZ7w3GDD3kQLChuPqD6OA)

在一座繁华的工业城市中，有一家名为 “未来制造” 的大型自动化工厂，它以其先进的生产技术和高效的运营模式闻名遐迩。这家工厂不仅生产各种高科技产品，还为周边的许多企业提供零部件和原材料。然而，一场突如其来的网络安全危机，让这座看似坚不可摧的工业巨人陷入了前所未有的困境。

故事的高潮始于一个普通的下午，工厂的 IT 团队在例行检查中发现了一个名为 CVE-2023-32233 的漏洞。IT 团队迅速启动了应急响应机制，试图通过更新系统补丁来修复这个漏洞。然而，由于时间紧迫，且需要在不影响正常生产的情况下进行操作，整个过程充满了挑战。在紧张的气氛中，工厂的管理层决定采取极端措施，暂停所有生产线的运行，以确保安全升级的顺利进行。

在接下来的几天里，工厂内部一片忙碌。技术人员夜以继日地工作，不仅要确保所有系统都得到了及时的更新，还要对整个工厂的网络安全架构进行彻底的审查和加固。与此同时，工厂的公关部门也在积极与媒体沟通，试图减轻外界对工厂安全性的担忧。

然而，就在一切似乎即将恢复正常之际，一个意想不到的事件发生了。一名内部员工，为了个人的复仇目的，利用了这次危机，通过漏洞提权，故意破坏了部分系统，使得部分生产线再次陷入瘫痪状态。这一行为不仅加剧了工厂的困境，也让整个事件的性质从技术问题升级为严重的社会事件。

面对这一突如其来的变故，工厂的管理层不得不重新评估其安全策略，并加强了对员工的网络安全培训。同时，他们也向公众和合作伙伴坦诚了这一事件的经过，承诺将采取更加严格的安全措施，以防止类似事件的再次发生。

（以上故事为虚构）

[漏洞名称]：CVE-2023-32233 NetFilter 权限提升 
-------------------------------------

[漏洞描述]：由研究人员 Patryk Sondej （波兰）和 Piotr Krysiuk（爱尔兰）发现，Linux 内核的 Netfilter 子系统在处理批量请求更新 nf_tables 配置信息时，由于处理匿名集的逻辑存在缺陷，存在释放重利用（UAF）漏洞。

[影响版本]：v5.1-rc1 <= Linux Kernel <= 6.3.1

[漏洞原理]：与 iptables 类似，Netfilter 是 Linux 内核提供的一个框架，它允许以自定义处理程序的形式实现各种与网络相关的操作，可以提供数据包的过滤、转发、地址转换 NAT 功能。Linux 内核版本 v5.14 — v6.6 的 netfilter 子系统 nf_tables 组件中存在释放后使用漏洞，由于在 nft_verdict_init（）函数中，允许正值作为 hook 判决中的丢弃错误，因此当 NF_DROP 发出类似于 NF_ACCEPT 的丢弃错误时，nf_hook_slow（）函数可能会导致双重释放漏洞，从而本地低权攻击者可利用该漏洞将权限提升为 root，对目标进行恶意攻击。

[环境搭建]:

exp 下载地址：https://github.com/Liuk3r/CVE-2023-32233

首先进入超级用户模式：    

![](https://mmbiz.qpic.cn/sz_mmbiz_png/Rfoz3XfSibg8bIorVjcFV9C6B6qhJzRKiaXI6adAl1dIE2ibKicvsN4GK7dvpBTGN4FFdZc1HjnTAhxT4DYzShhpibA/640?wx_fmt=png)

执行命令：apt install gcc libmnl-dev libnftnl-dev

安装编译环境：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/Rfoz3XfSibg8bIorVjcFV9C6B6qhJzRKia50oiaFNrczZAekQZWCO7n7kQNrpBVPjPjiboz0vnnicQRaIEDiaMnibIPcw/640?wx_fmt=png)

编译 poc 二进制文件：

输入：gcc -Wall -o exploit exploit.c -lmnl -lnftnl

![](https://mmbiz.qpic.cn/sz_mmbiz_png/Rfoz3XfSibg8bIorVjcFV9C6B6qhJzRKiapic5xHqzu7mGE4CEcPsZx7cCIWqr6iaNn3vuoBgjYHiaDAz4eAXx9sbbA/640?wx_fmt=png)    

如果觉得以上太困难

个人推荐去大佬的环境下载地址，里面有做好的镜像，可以直接进行下面复现过程。

（现成的虚拟机，附带带编译好的 exp，登录密码 123456）

https://pan.baidu.com/s/1yQUrToQTiaDXcsHYVeKeSQ?pwd=8888

[复现过程]：

输入命令：cd ~

          ls

查看根目录：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/Rfoz3XfSibg8bIorVjcFV9C6B6qhJzRKia8ib3LM2ibnZwaKticb9dyZEloMMkNbu4oujKxIdxIvkDC8DOQHtBbC0ibw/640?wx_fmt=png)

执行编译好的 exp 文件：

./exp    

![](https://mmbiz.qpic.cn/sz_mmbiz_png/Rfoz3XfSibg8bIorVjcFV9C6B6qhJzRKia5w8nUIl3KZR47M42YNP7zkFEmxlzLFLefleo9Nn6vYnROLBzIJxtxw/640?wx_fmt=png)

成功得到 root 权限：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/Rfoz3XfSibg8bIorVjcFV9C6B6qhJzRKiaFCl4Ysaibv0rSO81MgrSKLkjCX4dxZSRmXHV1vhDwJT7XQahhLmibgGA/640?wx_fmt=png)    

![](https://mmbiz.qpic.cn/sz_mmbiz_png/Rfoz3XfSibg8bIorVjcFV9C6B6qhJzRKiagvOYP6DCPR5tcCfQH9iaUL4b1haAUIbHtXYlX8JHMH9Er87OdgsWbkw/640?wx_fmt=png)

[参考资料]：

Liuk3r/CVE-2023-32233：CVE-2023-32233：Linux 内核中的安全漏洞 CVE-2023-32233 (github.com)

CVE 漏洞复现 - CVE-2023-32233 NetFilter 权限提升 - CSDN 博客

CVE-2023-32233 （LINUX 内核权限提升漏洞）_cve-2023 提权 - CSDN 博客