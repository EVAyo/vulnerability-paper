> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/RV2bjbsvvr0DimnW5yE5Mg)

![](https://mmbiz.qpic.cn/sz_mmbiz_gif/kJjVGsbcK2AF46f8Y0u3bgU8dw37YuMiavaUWBe24ZgIkrsUtpaAeONmuLMDw33YK4iaoicTv1Udmn08vdEILY6icg/640?wx_fmt=gif&from=appmsg)

**声明**

本文属于 OneTS 安全团队成员 **Asoul** 的原创文章，转载请声明出处！本文章仅用于学习交流使用，因利用此文信息而造成的任何直接或间接的后果及损失，均由使用者本人负责，OneTS 安全团队及文章作者不为此承担任何责任。

**01**

Harbor 默认账号密码：admin:Harbor12345

Harbor 存在历史的未授权 CVE-2022-46463

在界面上找到搜索功能: 输入 123，然后抓包

![](https://mmbiz.qpic.cn/sz_mmbiz_png/kJjVGsbcK2AF46f8Y0u3bgU8dw37YuMiaiarZptJdzicSWrwHb2JYibThtJKDwyYnzZey7yPMNcDxK82LbJBDUHg1Q/640?wx_fmt=png&from=appmsg)

删掉改为空值， 然后发包过去，即可在界面上获取全部的数据。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/kJjVGsbcK2AF46f8Y0u3bgU8dw37YuMiagmic8ic7DF4ictncpSM89WqlFvSZ8D7JtsOicTsTGP0yrEfwN0aVSXFZLQ/640?wx_fmt=png&from=appmsg)

**02**

**为什么说是进阶呢？**

因为在 **CVE-2022-46463** 中是可以直接下载镜像的，但是在 src 挖掘的过程中发现企业已经修复了这个 cve，并且在网上找来找去都没有找到其他能绕过和利用的方法，但是我摸索的时候无意中发现了一种绕过方法。

**此时我们开启 bp 拦截，然后点击要下载的镜像，页面会跳回到登录页面**

![](https://mmbiz.qpic.cn/sz_mmbiz_png/kJjVGsbcK2AF46f8Y0u3bgU8dw37YuMiaBPjzhWyLbaibgyKaqia0TgByU9A4Ondyb0qEJdUsibahn41rY1T9Wibung/640?wx_fmt=png&from=appmsg)

**03**

将如下返回包修改

![](https://mmbiz.qpic.cn/sz_mmbiz_png/kJjVGsbcK2AF46f8Y0u3bgU8dw37YuMiazc7D3AEQnFtubncH0G9aOoZiaQjib5nwss1PzPXq4mYVsOqtNvMKq7qg/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/sz_mmbiz_png/kJjVGsbcK2AF46f8Y0u3bgU8dw37YuMiafN70PJuVtAqPqUFw9toAVWPjCYic7XYc1BD0aewunlCGxnYOb6co6pg/640?wx_fmt=png&from=appmsg)

然后一直放包，**注意当这个界面加载到这里就不要再放包了**。因为继续放包，**前端会变成 unserialize**，所有的按钮都没法点。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/kJjVGsbcK2AF46f8Y0u3bgU8dw37YuMiaSnjRhvZHPcePvfqozSQIqdmWV6ROm1TRgvzFf1ViaVJicN1o4WYWdNWQ/640?wx_fmt=png&from=appmsg)

**然后在拦截的情况下直接点拉取命令下的复制按钮，就会成功复制出拉取命令**

因为 “复制” 这个功能无需通过 http 数据包的形式，而是直接复制到我们电脑中，所以就**成功在未授权的情况下拿到了镜像**

![](https://mmbiz.qpic.cn/sz_mmbiz_png/kJjVGsbcK2AF46f8Y0u3bgU8dw37YuMiawH2icscIMyJIJiaNWOGRMxdGEBSm6by8RfqJLOPYPk1elp1VqEovQ9cA/640?wx_fmt=png&from=appmsg)

正常到这里就结束了，但是还可以再精进下

**获取 Dockerfile(因为在构建镜像的命令中可能含有敏感数据)**

docker history dockerhub.xxxxxx.com/xxxx/xxxx-service:2.4 --no-trunc

然后通过 **dockerfile 分析 rce** 的可能，例如泄露一些云服务账号密码等，但是我并没有找到，要是各位大佬找到了可以回来留言~