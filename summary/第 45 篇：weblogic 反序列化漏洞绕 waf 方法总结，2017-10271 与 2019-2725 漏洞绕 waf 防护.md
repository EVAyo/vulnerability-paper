<meta name="referrer" content="no-referrer"/>
> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/8hUYRYoAqjthqgBI_zn9ZA)

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450ATcz6jUJnFNeOxRzVZ9LbcaA8wBFW4icTiaL7ELd8ia04Olh40TBx7CquHZyCicicl4eYJno2y0oZ0H4A/640?wx_fmt=png)

 **Part1 前言** 
--------------

在日常的渗透测试及各种攻防比赛项目中，waf 设备的拦截是越来越厉害了，以至于很多朋友遇到 weblogic 2017-10271、weblogic 2019-2725 等反序列化漏洞就直接放弃。过去几年我曾帮助多位朋友绕过 waf 拿下权限，本期 ABC_123 就分享几个真正实战中用到的绕 waf 技巧，给大家拓展一下思路。

**后续 ABC_123 将会继续分享 weblogic 系列漏洞绕 waf 的方法，欢迎关注本公众号 “ABC123 安全研究实验室”。  
**

 **Part2 技术研究过程** 
------------------

*   **weblogic 漏洞利用**
    -----------------
    

weblogic 2017-10271 及 2019-2725 这两种漏洞的绕 waf 方法基本上相同，我们只需要举其中一个例子演示即可。先看一个 weblogic 2019-2725 漏洞利用过程，如下图所示，提交 payload 之后，成功执行了命令。**后续绕 waf 过程都围绕以下这个 http 请求数据包展**开****。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450AnOEbsVUeFUKZ0VeLklqnZ18bXGFAxRZYnLqyCzvoz5ck945UMEjGj1VS94RQ1kiavbNfSr7icPzag/640?wx_fmt=png)

*   **添加多个反斜杠**
    -----------
    

很多 waf 设备对 URL 进行了判断，那么我们可以用如下方法试试，添加多个 **/////////////**。下图只做演示，实际情况要添加好几倍长度的 **//////////** 才有效。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450AnOEbsVUeFUKZ0VeLklqnZD8hnfLY5yfD1ZNc28Hz4Zl8MC6Hs2MJ0dum6kF4w6W9j65oiavYjiabA/640?wx_fmt=png)

*   **添加无用的 GET 请求参数**
    ------------------
    

接下来我们还可以添加无意义的 GET 请求参数，添加 **username=xxxxx** 或者 **password=sdfewfwfeewffew** 等等。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450AnOEbsVUeFUKZ0VeLklqnZngqGN7uG2hqFXy6AHqIFZjM5S5AZXIibTKC8ps3VOwvEmCsP7FiaAicMg/640?wx_fmt=png)

*   **URL 编码混淆掺杂**
    --------------
    

为了进一步绕过 waf，我们还可以对 URL 路径进行 URL 编码混淆掺杂，这里不要将整个 url 路径全部用 URL 编码，如下图所示，**一小段一小段地进行 URL 编码绕 waf 效果更好**。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450AnOEbsVUeFUKZ0VeLklqnZAaHlNnHhIMGiaK3KkKxZtdrUMwTURNKoX2xvLhrucSzNFoYQjz0Lic6g/640?wx_fmt=png)

*   **请求包 XML 标签内掺杂脏数据**
    --------------------
    

我们也可以在请求数据包中添加脏数据，可以在 **<wsa:RelatesTo>** 标签中间添加脏数据，由于是 POST 请求数据包，这里面可以添加很长很长的脏数据。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450AnOEbsVUeFUKZ0VeLklqnZL4RDHyV0StZB5Vp0cxKQREKcGVcicibMCn5v9p1cRk9wjzc5I0vFsSJw/640?wx_fmt=png)

*   **请求包头部添加脏数据**
    --------------
    

有的 waf 设备可能检测了以 **<soapenv:** 开头的请求数据包，那么我们可以在头部添加 xxxxxxx 脏数据，经过测试发现 payload 仍然是可以正常执行的。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450AnOEbsVUeFUKZ0VeLklqnZgcqVcg01g0sMNBkADpUYVWcDY8ia0pjfiaWTjURYmuH5nMtRUNahYQXw/640?wx_fmt=png)

*   **请求数据包添加 XML 注释**
    ------------------
    

有的 waf 设备可能对请求数据包进行了内容检测，这个非常难绕过，绕过方法之一，就是用 XML 注释掺杂的方法绕过 waf 设备检测。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450AnOEbsVUeFUKZ0VeLklqnZicaD8VDzdH4fVjrGR67fF81icvT2KFvHnMicUlibPpv4UaibqX9aNNtYia7Q/640?wx_fmt=png)

 **Part3 总结** 
--------------

**1.**   上述的绕 waf 思路，都是我在实战中常用的，反复深度利用脏数据的同时，与其它的绕 waf 方法结合起来效果会更好。

**2.**   理解一个技术问题需要理解它的原理，然后才能举一反三。

![](https://mmbiz.qpic.cn/mmbiz_png/OAz0RNU450A5qqg2iaK6KIYYR8y6pF5Rh3JHDibOKOop204nXz618iawdRb8dABicMPtHb2PkJE8x6koJO5HyuwZJQ/640?wx_fmt=png)

**专注于网络安全技术分享，包括红队攻防、蓝队分析、渗透测试、代码审计等。每周一篇，99% 原创，敬请关注**

**Contact me: 0day123abc#gmail.com(replace # with @)**

![](https://mmbiz.qpic.cn/mmbiz_jpg/OAz0RNU450A5qqg2iaK6KIYYR8y6pF5Rhn137KeqqlDkuRyY4G61jATRzyOrCBts8ucxkLpMNsYutSOY7BkPziaw/640?wx_fmt=jpeg)